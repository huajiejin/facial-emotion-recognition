(self.webpackChunkfacial_emotion_recognition_client=self.webpackChunkfacial_emotion_recognition_client||[]).push([[179],{929:(tc,cs,Co)=>{"use strict";function Hi(n){return"function"==typeof n}let Pm=!1;const li={Promise:void 0,set useDeprecatedSynchronousErrorHandling(n){if(n){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else Pm&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Pm=n},get useDeprecatedSynchronousErrorHandling(){return Pm}};function ou(n){setTimeout(()=>{throw n},0)}const Sh={closed:!0,next(n){},error(n){if(li.useDeprecatedSynchronousErrorHandling)throw n;ou(n)},complete(){}},su=Array.isArray||(n=>n&&"number"==typeof n.length);function Lm(n){return null!==n&&"object"==typeof n}const Ah=(()=>{function n(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((e,r)=>`${r+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return n.prototype=Object.create(Error.prototype),n})();class st{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:e,_ctorUnsubscribe:r,_unsubscribe:i,_subscriptions:o}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof st)e.remove(this);else if(null!==e)for(let s=0;s<e.length;++s)e[s].remove(this);if(Hi(i)){r&&(this._unsubscribe=void 0);try{i.call(this)}catch(s){t=s instanceof Ah?AC(s.errors):[s]}}if(su(o)){let s=-1,a=o.length;for(;++s<a;){const u=o[s];if(Lm(u))try{u.unsubscribe()}catch(l){t=t||[],l instanceof Ah?t=t.concat(AC(l.errors)):t.push(l)}}}if(t)throw new Ah(t)}add(t){let e=t;if(!t)return st.EMPTY;switch(typeof t){case"function":e=new st(t);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof st)){const o=e;e=new st,e._subscriptions=[o]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:r}=e;if(null===r)e._parentOrParents=this;else if(r instanceof st){if(r===this)return e;e._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return e;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[e]:i.push(e),e}remove(t){const e=this._subscriptions;if(e){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}}}var n;function AC(n){return n.reduce((t,e)=>t.concat(e instanceof Ah?e.errors:e),[])}st.EMPTY=((n=new st).closed=!0,n);const Mh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class vt extends st{constructor(t,e,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Sh;break;case 1:if(!t){this.destination=Sh;break}if("object"==typeof t){t instanceof vt?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new MC(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new MC(this,t,e,r)}}[Mh](){return this}static create(t,e,r){const i=new vt(t,e,r);return i.syncErrorThrowable=!1,i}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class MC extends vt{constructor(t,e,r,i){super(),this._parentSubscriber=t;let o,s=this;Hi(e)?o=e:e&&(o=e.next,r=e.error,i=e.complete,e!==Sh&&(s=Object.create(e),Hi(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=o,this._error=r,this._complete=i}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;li.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:r}=li;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):ou(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;ou(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);li.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(r){if(this.unsubscribe(),li.useDeprecatedSynchronousErrorHandling)throw r;ou(r)}}__tryOrSetError(t,e,r){if(!li.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(i){return li.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=i,t.syncErrorThrown=!0,!0):(ou(i),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const nc="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ih(n){return n}let Ke=(()=>{class n{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(e){const r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,i){const{operator:o}=this,s=function(n,t,e){if(n){if(n instanceof vt)return n;if(n[Mh])return n[Mh]()}return n||t||e?new vt(n,t,e):new vt(Sh)}(e,r,i);if(s.add(o?o.call(s,this.source):this.source||li.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),li.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s}_trySubscribe(e){try{return this._subscribe(e)}catch(r){li.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=r),function(n){for(;n;){const{closed:t,destination:e,isStopped:r}=n;if(t||r)return!1;n=e&&e instanceof vt?e:null}return!0}(e)?e.error(r):console.warn(r)}}forEach(e,r){return new(r=TC(r))((i,o)=>{let s;s=this.subscribe(a=>{try{e(a)}catch(u){o(u),s&&s.unsubscribe()}},o,i)})}_subscribe(e){const{source:r}=this;return r&&r.subscribe(e)}[nc](){return this}pipe(...e){return 0===e.length?this:function(n){return 0===n.length?Ih:1===n.length?n[0]:function(e){return n.reduce((r,i)=>i(r),e)}}(e)(this)}toPromise(e){return new(e=TC(e))((r,i)=>{let o;this.subscribe(s=>o=s,s=>i(s),()=>r(o))})}}return n.create=t=>new n(t),n})();function TC(n){if(n||(n=li.Promise||Promise),!n)throw new Error("no Promise impl found");return n}const Js=(()=>{function n(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return n.prototype=Object.create(Error.prototype),n})();class RC extends st{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}class FC extends vt{constructor(t){super(t),this.destination=t}}let be=(()=>{class n extends Ke{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Mh](){return new FC(this)}lift(e){const r=new kC(this,this);return r.operator=e,r}next(e){if(this.closed)throw new Js;if(!this.isStopped){const{observers:r}=this,i=r.length,o=r.slice();for(let s=0;s<i;s++)o[s].next(e)}}error(e){if(this.closed)throw new Js;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:r}=this,i=r.length,o=r.slice();for(let s=0;s<i;s++)o[s].error(e);this.observers.length=0}complete(){if(this.closed)throw new Js;this.isStopped=!0;const{observers:e}=this,r=e.length,i=e.slice();for(let o=0;o<r;o++)i[o].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new Js;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new Js;return this.hasError?(e.error(this.thrownError),st.EMPTY):this.isStopped?(e.complete(),st.EMPTY):(this.observers.push(e),new RC(this,e))}asObservable(){const e=new Ke;return e.source=this,e}}return n.create=(t,e)=>new kC(t,e),n})();class kC extends be{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):st.EMPTY}}function au(n){return n&&"function"==typeof n.schedule}function Se(n,t){return function(r){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new iV(n,t))}}class iV{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new oV(t,this.project,this.thisArg))}}class oV extends vt{constructor(t,e,r){super(t),this.project=e,this.count=0,this.thisArg=r||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(e)}}const OC=n=>t=>{for(let e=0,r=n.length;e<r&&!t.closed;e++)t.next(n[e]);t.complete()},Th="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",NC=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function PC(n){return!!n&&"function"!=typeof n.subscribe&&"function"==typeof n.then}const Bm=n=>{if(n&&"function"==typeof n[nc])return(n=>t=>{const e=n[nc]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)})(n);if(NC(n))return OC(n);if(PC(n))return(n=>t=>(n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,ou),t))(n);if(n&&"function"==typeof n[Th])return(n=>t=>{const e=n[Th]();for(;;){let r;try{r=e.next()}catch(i){return t.error(i),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof e.return&&t.add(()=>{e.return&&e.return()}),t})(n);{const e=`You provided ${Lm(n)?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(e)}};function Vm(n,t){return new Ke(e=>{const r=new st;let i=0;return r.add(t.schedule(function(){i!==n.length?(e.next(n[i++]),e.closed||r.add(this.schedule())):e.complete()})),r})}function Jt(n,t){return t?function(n,t){if(null!=n){if(function(n){return n&&"function"==typeof n[nc]}(n))return function(n,t){return new Ke(e=>{const r=new st;return r.add(t.schedule(()=>{const i=n[nc]();r.add(i.subscribe({next(o){r.add(t.schedule(()=>e.next(o)))},error(o){r.add(t.schedule(()=>e.error(o)))},complete(){r.add(t.schedule(()=>e.complete()))}}))})),r})}(n,t);if(PC(n))return function(n,t){return new Ke(e=>{const r=new st;return r.add(t.schedule(()=>n.then(i=>{r.add(t.schedule(()=>{e.next(i),r.add(t.schedule(()=>e.complete()))}))},i=>{r.add(t.schedule(()=>e.error(i)))}))),r})}(n,t);if(NC(n))return Vm(n,t);if(function(n){return n&&"function"==typeof n[Th]}(n)||"string"==typeof n)return function(n,t){if(!n)throw new Error("Iterable cannot be null");return new Ke(e=>{const r=new st;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(t.schedule(()=>{i=n[Th](),r.add(t.schedule(function(){if(e.closed)return;let o,s;try{const a=i.next();o=a.value,s=a.done}catch(a){return void e.error(a)}s?e.complete():(e.next(o),this.schedule())}))})),r})}(n,t)}throw new TypeError((null!==n&&typeof n||n)+" is not observable")}(n,t):n instanceof Ke?n:new Ke(Bm(n))}class uu extends vt{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class lu extends vt{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function cu(n,t){if(t.closed)return;if(n instanceof Ke)return n.subscribe(t);let e;try{e=Bm(n)(t)}catch(r){t.error(r)}return e}function En(n,t,e=Number.POSITIVE_INFINITY){return"function"==typeof t?r=>r.pipe(En((i,o)=>Jt(n(i,o)).pipe(Se((s,a)=>t(i,s,o,a))),e)):("number"==typeof t&&(e=t),r=>r.lift(new mV(n,e)))}class mV{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new vV(t,this.project,this.concurrent))}}class vV extends lu{constructor(t,e,r=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(e)}_innerSub(t){const e=new uu(this),r=this.destination;r.add(e);const i=cu(t,e);i!==e&&r.add(i)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function rc(n=Number.POSITIVE_INFINITY){return En(Ih,n)}function Hm(n,t){return t?Vm(n,t):new Ke(OC(n))}function ic(...n){let t=Number.POSITIVE_INFINITY,e=null,r=n[n.length-1];return au(r)?(e=n.pop(),n.length>1&&"number"==typeof n[n.length-1]&&(t=n.pop())):"number"==typeof r&&(t=n.pop()),null===e&&1===n.length&&n[0]instanceof Ke?n[0]:rc(t)(Hm(n,e))}function Um(){return function(t){return t.lift(new yV(t))}}class yV{constructor(t){this.connectable=t}call(t,e){const{connectable:r}=this;r._refCount++;const i=new _V(t,r),o=e.subscribe(i);return i.closed||(i.connection=r.connect()),o}}class _V extends vt{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:r}=this,i=t._connection;this.connection=null,i&&(!r||i===r)&&i.unsubscribe()}}class LC extends Ke{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new st,t.add(this.source.subscribe(new xV(this.getSubject(),this))),t.closed&&(this._connection=null,t=st.EMPTY)),t}refCount(){return Um()(this)}}const bV=(()=>{const n=LC.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:n._subscribe},_isComplete:{value:n._isComplete,writable:!0},getSubject:{value:n.getSubject},connect:{value:n.connect},refCount:{value:n.refCount}}})();class xV extends FC{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}function DV(){return new be}function lt(n){for(let t in n)if(n[t]===lt)return t;throw Error("Could not find renamed property on target object.")}function jm(n,t){for(const e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function Ue(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Ue).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function Wm(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const SV=lt({__forward_ref__:lt});function bt(n){return n.__forward_ref__=bt,n.toString=function(){return Ue(this())},n}function ye(n){return VC(n)?n():n}function VC(n){return"function"==typeof n&&n.hasOwnProperty(SV)&&n.__forward_ref__===bt}class ds extends Error{constructor(t,e){super(function(n,t){return`${n?`NG0${n}: `:""}${t}`}(t,e)),this.code=t}}function ke(n){return"string"==typeof n?n:null==n?"":String(n)}function nr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():ke(n)}function Rh(n,t){const e=t?` in ${t}`:"";throw new ds("201",`No provider for ${nr(n)} found${e}`)}function Er(n,t){null==n&&function(n,t,e,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${e} ${r} ${t} <=Actual]`))}(t,n,null,"!=")}function K(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Ie(n){return{providers:n.providers||[],imports:n.imports||[]}}function Do(n){return HC(n,Fh)||HC(n,jC)}function HC(n,t){return n.hasOwnProperty(t)?n[t]:null}function UC(n){return n&&(n.hasOwnProperty(zm)||n.hasOwnProperty(kV))?n[zm]:null}const Fh=lt({\u0275prov:lt}),zm=lt({\u0275inj:lt}),jC=lt({ngInjectableDef:lt}),kV=lt({ngInjectorDef:lt});var xe=(()=>((xe=xe||{})[xe.Default=0]="Default",xe[xe.Host=1]="Host",xe[xe.Self=2]="Self",xe[xe.SkipSelf=4]="SkipSelf",xe[xe.Optional=8]="Optional",xe))();let $m;function hs(n){const t=$m;return $m=n,t}function WC(n,t,e){const r=Do(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&xe.Optional?null:void 0!==t?t:void Rh(Ue(n),"Injector")}function fs(n){return{toString:n}.toString()}var jr=(()=>((jr=jr||{})[jr.OnPush=0]="OnPush",jr[jr.Default=1]="Default",jr))(),Zt=(()=>((Zt=Zt||{})[Zt.Emulated=0]="Emulated",Zt[Zt.None=2]="None",Zt[Zt.ShadowDom=3]="ShadowDom",Zt))();const NV="undefined"!=typeof globalThis&&globalThis,PV="undefined"!=typeof window&&window,LV="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ft=NV||"undefined"!=typeof global&&global||PV||LV,du={},yt=[],kh=lt({\u0275cmp:lt}),qm=lt({\u0275dir:lt}),Km=lt({\u0275pipe:lt}),GC=lt({\u0275mod:lt}),BV=lt({\u0275loc:lt}),So=lt({\u0275fac:lt}),oc=lt({__NG_ELEMENT_ID__:lt});let VV=0;function Hn(n){return fs(()=>{const e={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===jr.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||yt,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Zt.Emulated,id:"c",styles:n.styles||yt,_:null,setInput:null,schemas:n.schemas||null,tView:null},i=n.directives,o=n.features,s=n.pipes;return r.id+=VV++,r.inputs=KC(n.inputs,e),r.outputs=KC(n.outputs),o&&o.forEach(a=>a(r)),r.directiveDefs=i?()=>("function"==typeof i?i():i).map(zC):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map($C):null,r})}function zC(n){return Un(n)||function(n){return n[qm]||null}(n)}function $C(n){return function(n){return n[Km]||null}(n)}const qC={};function Ne(n){return fs(()=>{const t={type:n.type,bootstrap:n.bootstrap||yt,declarations:n.declarations||yt,imports:n.imports||yt,exports:n.exports||yt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(qC[n.id]=n.type),t})}function KC(n,t){if(null==n)return du;const e={};for(const r in n)if(n.hasOwnProperty(r)){let i=n[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),e[i]=r,t&&(t[i]=o)}return e}const $=Hn;function gr(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,onDestroy:n.type.prototype.ngOnDestroy||null}}function Un(n){return n[kh]||null}function Wr(n,t){const e=n[GC]||null;if(!e&&!0===t)throw new Error(`Type ${Ue(n)} does not have '\u0275mod' property.`);return e}function Ui(n){return Array.isArray(n)&&"object"==typeof n[1]}function di(n){return Array.isArray(n)&&!0===n[1]}function Qm(n){return 0!=(8&n.flags)}function Lh(n){return 2==(2&n.flags)}function hi(n){return null!==n.template}function $V(n){return 0!=(512&n[2])}function ra(n,t){return n.hasOwnProperty(So)?n[So]:null}class XC{constructor(t,e,r){this.previousValue=t,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function Wt(){return QC}function QC(n){return n.type.prototype.ngOnChanges&&(n.setInput=XV),YV}function YV(){const n=ZC(this),t=null==n?void 0:n.current;if(t){const e=n.previous;if(e===du)n.previous=t;else for(let r in t)e[r]=t[r];n.current=null,this.ngOnChanges(t)}}function XV(n,t,e,r){const i=ZC(n)||function(n,t){return n[JC]=t}(n,{previous:du,current:null}),o=i.current||(i.current={}),s=i.previous,a=this.declaredInputs[e],u=s[a];o[a]=new XC(u&&u.currentValue,t,s===du),n[r]=t}Wt.ngInherit=!0;const JC="__ngSimpleChanges__";function ZC(n){return n[JC]||null}let ev;function Gt(n){return!!n.listen}const nE={createRenderer:(n,t)=>void 0!==ev?ev:"undefined"!=typeof document?document:void 0};function en(n){for(;Array.isArray(n);)n=n[0];return n}function Sr(n,t){return en(t[n.index])}function nv(n,t){return n.data[t]}function Ar(n,t){const e=t[n];return Ui(e)?e:e[0]}function rE(n){return 4==(4&n[2])}function rv(n){return 128==(128&n[2])}function gs(n,t){return null==t?null:n[t]}function iE(n){n[18]=0}function iv(n,t){n[5]+=t;let e=n,r=n[3];for(;null!==r&&(1===t&&1===e[5]||-1===t&&0===e[5]);)r[5]+=t,e=r,r=r[3]}const Ae={lFrame:hE(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function oE(){return Ae.bindingsEnabled}function X(){return Ae.lFrame.lView}function Ze(){return Ae.lFrame.tView}function mn(){let n=sE();for(;null!==n&&64===n.type;)n=n.parent;return n}function sE(){return Ae.lFrame.currentTNode}function ji(n,t){const e=Ae.lFrame;e.currentTNode=n,e.isParent=t}function sv(){return Ae.lFrame.isParent}function Hh(){return Ae.isInCheckNoChangesMode}function Uh(n){Ae.isInCheckNoChangesMode=n}function ir(){const n=Ae.lFrame;let t=n.bindingRootIndex;return-1===t&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function vu(){return Ae.lFrame.bindingIndex++}function h3(n,t){const e=Ae.lFrame;e.bindingIndex=e.bindingRootIndex=n,uv(t)}function uv(n){Ae.lFrame.currentDirectiveIndex=n}function lE(){return Ae.lFrame.currentQueryIndex}function cv(n){Ae.lFrame.currentQueryIndex=n}function p3(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function cE(n,t,e){if(e&xe.SkipSelf){let i=t,o=n;for(;!(i=i.parent,null!==i||e&xe.Host||(i=p3(o),null===i||(o=o[15],10&i.type))););if(null===i)return!1;t=i,n=o}const r=Ae.lFrame=dE();return r.currentTNode=t,r.lView=n,!0}function jh(n){const t=dE(),e=n[1];Ae.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function dE(){const n=Ae.lFrame,t=null===n?null:n.child;return null===t?hE(n):t}function hE(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function fE(){const n=Ae.lFrame;return Ae.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const pE=fE;function Wh(){const n=fE();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function or(){return Ae.lFrame.selectedIndex}function ms(n){Ae.lFrame.selectedIndex=n}function Gh(n,t){for(let e=t.directiveStart,r=t.directiveEnd;e<r;e++){const o=n.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:u,ngAfterViewChecked:l,ngOnDestroy:c}=o;s&&(n.contentHooks||(n.contentHooks=[])).push(-e,s),a&&((n.contentHooks||(n.contentHooks=[])).push(e,a),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,a)),u&&(n.viewHooks||(n.viewHooks=[])).push(-e,u),l&&((n.viewHooks||(n.viewHooks=[])).push(e,l),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,l)),null!=c&&(n.destroyHooks||(n.destroyHooks=[])).push(e,c)}}function zh(n,t,e){gE(n,t,3,e)}function $h(n,t,e,r){(3&n[2])===e&&gE(n,t,e,r)}function dv(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function gE(n,t,e,r){const o=null!=r?r:-1,s=t.length-1;let a=0;for(let u=void 0!==r?65535&n[18]:0;u<s;u++)if("number"==typeof t[u+1]){if(a=t[u],null!=r&&a>=r)break}else t[u]<0&&(n[18]+=65536),(a<o||-1==o)&&(C3(n,e,t,u),n[18]=(4294901760&n[18])+u+2),u++}function C3(n,t,e,r){const i=e[r]<0,o=e[r+1],a=n[i?-e[r]:e[r]];if(i){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{o.call(a)}finally{}}}else try{o.call(a)}finally{}}class cc{constructor(t,e,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function qh(n,t,e){const r=Gt(n);let i=0;for(;i<e.length;){const o=e[i];if("number"==typeof o){if(0!==o)break;i++;const s=e[i++],a=e[i++],u=e[i++];r?n.setAttribute(t,a,u,s):t.setAttributeNS(s,a,u)}else{const s=o,a=e[++i];fv(s)?r&&n.setProperty(t,s,a):r?n.setAttribute(t,s,a):t.setAttribute(s,a),i++}}return i}function mE(n){return 3===n||4===n||6===n}function fv(n){return 64===n.charCodeAt(0)}function Kh(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?e=i:0===e||vE(n,e,i,null,-1===e||2===e?t[++r]:null)}}return n}function vE(n,t,e,r,i){let o=0,s=n.length;if(-1===t)s=-1;else for(;o<n.length;){const a=n[o++];if("number"==typeof a){if(a===t){s=-1;break}if(a>t){s=o-1;break}}}for(;o<n.length;){const a=n[o];if("number"==typeof a)break;if(a===e){if(null===r)return void(null!==i&&(n[o+1]=i));if(r===n[o+1])return void(n[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(n.splice(s,0,t),o=s+1),n.splice(o++,0,e),null!==r&&n.splice(o++,0,r),null!==i&&n.splice(o++,0,i)}function yE(n){return-1!==n}function yu(n){return 32767&n}function _u(n,t){let e=function(n){return n>>16}(n),r=t;for(;e>0;)r=r[15],e--;return r}let pv=!0;function Yh(n){const t=pv;return pv=n,t}let I3=0;function hc(n,t){const e=mv(n,t);if(-1!==e)return e;const r=t[1];r.firstCreatePass&&(n.injectorIndex=t.length,gv(r.data,n),gv(t,null),gv(r.blueprint,null));const i=Xh(n,t),o=n.injectorIndex;if(yE(i)){const s=yu(i),a=_u(i,t),u=a[1].data;for(let l=0;l<8;l++)t[o+l]=a[s+l]|u[s+l]}return t[o+8]=i,o}function gv(n,t){n.push(0,0,0,0,0,0,0,0,t)}function mv(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Xh(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,r=null,i=t;for(;null!==i;){const o=i[1],s=o.type;if(r=2===s?o.declTNode:1===s?i[6]:null,null===r)return-1;if(e++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return-1}function Qh(n,t,e){!function(n,t,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(oc)&&(r=e[oc]),null==r&&(r=e[oc]=I3++);const i=255&r;t.data[n+(i>>5)]|=1<<i}(n,t,e)}function xE(n,t,e){if(e&xe.Optional)return n;Rh(t,"NodeInjector")}function wE(n,t,e,r){if(e&xe.Optional&&void 0===r&&(r=null),0==(e&(xe.Self|xe.Host))){const i=n[9],o=hs(void 0);try{return i?i.get(t,r,e&xe.Optional):WC(t,r,e&xe.Optional)}finally{hs(o)}}return xE(r,t,e)}function CE(n,t,e,r=xe.Default,i){if(null!==n){const o=function(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(oc)?n[oc]:void 0;return"number"==typeof t?t>=0?255&t:F3:t}(e);if("function"==typeof o){if(!cE(t,n,r))return r&xe.Host?xE(i,e,r):wE(t,e,r,i);try{const s=o(r);if(null!=s||r&xe.Optional)return s;Rh(e)}finally{pE()}}else if("number"==typeof o){let s=null,a=mv(n,t),u=-1,l=r&xe.Host?t[16][6]:null;for((-1===a||r&xe.SkipSelf)&&(u=-1===a?Xh(n,t):t[a+8],-1!==u&&SE(r,!1)?(s=t[1],a=yu(u),t=_u(u,t)):a=-1);-1!==a;){const c=t[1];if(DE(o,a,c.data)){const d=k3(a,t,e,s,r,l);if(d!==EE)return d}u=t[a+8],-1!==u&&SE(r,t[1].data[a+8]===l)&&DE(o,a,t)?(s=c,a=yu(u),t=_u(u,t)):a=-1}}}return wE(t,e,r,i)}const EE={};function F3(){return new bu(mn(),X())}function k3(n,t,e,r,i,o){const s=t[1],a=s.data[n+8],c=Jh(a,s,e,null==r?Lh(a)&&pv:r!=s&&0!=(3&a.type),i&xe.Host&&o===a);return null!==c?fc(t,s,c,a):EE}function Jh(n,t,e,r,i){const o=n.providerIndexes,s=t.data,a=1048575&o,u=n.directiveStart,c=o>>20,h=i?a+c:n.directiveEnd;for(let f=r?a:a+c;f<h;f++){const p=s[f];if(f<u&&e===p||f>=u&&p.type===e)return f}if(i){const f=s[u];if(f&&hi(f)&&f.type===e)return u}return null}function fc(n,t,e,r){let i=n[e];const o=t.data;if(function(n){return n instanceof cc}(i)){const s=i;s.resolving&&function(n,t){throw new ds("200",`Circular dependency in DI detected for ${n}`)}(nr(o[e]));const a=Yh(s.canSeeViewProviders);s.resolving=!0;const u=s.injectImpl?hs(s.injectImpl):null;cE(n,r,xe.Default);try{i=n[e]=s.factory(void 0,o,n,r),t.firstCreatePass&&e>=r.directiveStart&&function(n,t,e){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=t.type.prototype;if(r){const s=QC(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,s),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,s)}i&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,i),o&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,o),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,o))}(e,o[e],t)}finally{null!==u&&hs(u),Yh(a),s.resolving=!1,pE()}}return i}function DE(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function SE(n,t){return!(n&xe.Self||n&xe.Host&&t)}class bu{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,r){return CE(this._tNode,this._lView,t,r,e)}}function me(n){return fs(()=>{const t=n.prototype.constructor,e=t[So]||vv(t),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const o=i[So]||vv(i);if(o&&o!==e)return o;i=Object.getPrototypeOf(i)}return o=>new o})}function vv(n){return VC(n)?()=>{const t=vv(ye(n));return t&&t()}:ra(n)}const wu="__parameters__";function oa(n,t,e){return fs(()=>{const r=function(n){return function(...e){if(n){const r=n(...e);for(const i in r)this[i]=r[i]}}}(t);function i(...o){if(this instanceof i)return r.apply(this,o),this;const s=new i(...o);return a.annotation=s,a;function a(u,l,c){const d=u.hasOwnProperty(wu)?u[wu]:Object.defineProperty(u,wu,{value:[]})[wu];for(;d.length<=c;)d.push(null);return(d[c]=d[c]||[]).push(s),u}}return e&&(i.prototype=Object.create(e.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}class re{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=K({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const L3=new re("AnalyzeForEntryComponents"),Zh=Function;function $r(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let r=n[e];Array.isArray(r)?(t===n&&(t=n.slice(0,e)),$r(r,t)):t!==n&&t.push(r)}return t}function Gi(n,t){n.forEach(e=>Array.isArray(e)?Gi(e,t):t(e))}function tf(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function sa(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}const vc={},xv="__NG_DI_FLAG__",Du="ngTempTokenPath",q3=/\n/gm,wv="__source",Cv=lt({provide:String,useValue:lt});let yc;function Su(n){const t=yc;return yc=n,t}function Y3(n,t=xe.Default){if(void 0===yc)throw new Error("inject() must be called from an injection context");return null===yc?WC(n,void 0,t):yc.get(n,t&xe.Optional?null:void 0,t)}function R(n,t=xe.Default){return($m||Y3)(ye(n),t)}const _c=R;function aa(n){const t=[];for(let e=0;e<n.length;e++){const r=ye(n[e]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let i,o=xe.Default;for(let s=0;s<r.length;s++){const a=r[s],u=X3(a);"number"==typeof u?-1===u?i=a.token:o|=u:i=a}t.push(R(i,o))}else t.push(R(r))}return t}function bc(n,t){return n[xv]=t,n.prototype[xv]=t,n}function X3(n){return n[xv]}function FE(n,t,e,r){const i=n[Du];throw t[wv]&&i.unshift(t[wv]),n.message=function(n,t,e,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let i=Ue(t);if(Array.isArray(t))i=t.map(Ue).join(" -> ");else if("object"==typeof t){let o=[];for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):Ue(a)))}i=`{${o.join(", ")}}`}return`${e}${r?"("+r+")":""}[${i}]: ${n.replace(q3,"\n  ")}`}("\n"+n.message,i,e,r),n.ngTokenPath=i,n[Du]=null,n}const Au=bc(oa("Inject",n=>({token:n})),-1),Rn=bc(oa("Optional"),8),Mo=bc(oa("SkipSelf"),4);var Ir=(()=>((Ir=Ir||{})[Ir.Important=1]="Important",Ir[Ir.DashCase=2]="DashCase",Ir))();const BE="__ngContext__";function Wn(n,t){n[BE]=t}function Sv(n){const t=function(n){return n[BE]||null}(n);return t?Array.isArray(t)?t:t.lView:null}function Mv(n,t){return undefined(n,t)}function Cc(n){const t=n[3];return di(t)?t[3]:t}function Iv(n){return zE(n[13])}function Tv(n){return zE(n[4])}function zE(n){for(;null!==n&&!di(n);)n=n[4];return n}function Iu(n,t,e,r,i){if(null!=r){let o,s=!1;di(r)?o=r:Ui(r)&&(s=!0,r=r[0]);const a=en(r);0===n&&null!==e?null==i?QE(t,e,a):ua(t,e,a,i||null,!0):1===n&&null!==e?ua(t,e,a,i||null,!0):2===n?function(n,t,e){const r=uf(n,t);r&&function(n,t,e,r){Gt(n)?n.removeChild(t,e,r):t.removeChild(e)}(n,r,t,e)}(t,a,s):3===n&&t.destroyNode(a),null!=o&&function(n,t,e,r,i){const o=e[7];o!==en(e)&&Iu(t,n,r,o,i);for(let a=10;a<e.length;a++){const u=e[a];Ec(u[1],u,n,t,r,o)}}(t,n,o,e,i)}}function Fv(n,t,e){return Gt(n)?n.createElement(t,e):null===e?n.createElement(t):n.createElementNS(e,t)}function qE(n,t){const e=n[9],r=e.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,iv(i,-1)),e.splice(r,1)}function kv(n,t){if(n.length<=10)return;const e=10+t,r=n[e];if(r){const i=r[17];null!==i&&i!==n&&qE(i,r),t>0&&(n[e-1][4]=r[4]);const o=sa(n,10+t);!function(n,t){Ec(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const s=o[19];null!==s&&s.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function KE(n,t){if(!(256&t[2])){const e=t[11];Gt(e)&&e.destroyNode&&Ec(n,t,e,3,null,null),function(n){let t=n[13];if(!t)return Ov(n[1],n);for(;t;){let e=null;if(Ui(t))e=t[13];else{const r=t[10];r&&(e=r)}if(!e){for(;t&&!t[4]&&t!==n;)Ui(t)&&Ov(t[1],t),t=t[3];null===t&&(t=n),Ui(t)&&Ov(t[1],t),e=t&&t[4]}t=e}}(t)}}function Ov(n,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let r=0;r<e.length;r+=2){const i=t[e[r]];if(!(i instanceof cc)){const o=e[r+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=i[o[s]],u=o[s+1];try{u.call(a)}finally{}}else try{o.call(i)}finally{}}}}(n,t),function(n,t){const e=n.cleanup,r=t[7];let i=-1;if(null!==e)for(let o=0;o<e.length-1;o+=2)if("string"==typeof e[o]){const s=e[o+1],a="function"==typeof s?s(t):en(t[s]),u=r[i=e[o+2]],l=e[o+3];"boolean"==typeof l?a.removeEventListener(e[o],u,l):l>=0?r[i=l]():r[i=-l].unsubscribe(),o+=2}else{const s=r[i=e[o+1]];e[o].call(s)}if(null!==r){for(let o=i+1;o<r.length;o++)r[o]();t[7]=null}}(n,t),1===t[1].type&&Gt(t[11])&&t[11].destroy();const e=t[17];if(null!==e&&di(t[3])){e!==t[3]&&qE(e,t);const r=t[19];null!==r&&r.detachView(n)}}}function YE(n,t,e){return function(n,t,e){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return e[0];if(2&r.flags){const i=n.data[r.directiveStart].encapsulation;if(i===Zt.None||i===Zt.Emulated)return null}return Sr(r,e)}(n,t.parent,e)}function ua(n,t,e,r,i){Gt(n)?n.insertBefore(t,e,r,i):t.insertBefore(e,r,i)}function QE(n,t,e){Gt(n)?n.appendChild(t,e):t.appendChild(e)}function JE(n,t,e,r,i){null!==r?ua(n,t,e,r,i):QE(n,t,e)}function uf(n,t){return Gt(n)?n.parentNode(t):t.parentNode}let df,tD=function(n,t,e){return 40&n.type?Sr(n,e):null};function lf(n,t,e,r){const i=YE(n,r,t),o=t[11],a=function(n,t,e){return tD(n,t,e)}(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(e))for(let u=0;u<e.length;u++)JE(o,i,e[u],a,!1);else JE(o,i,e,a,!1)}function cf(n,t){if(null!==t){const e=t.type;if(3&e)return Sr(t,n);if(4&e)return Pv(-1,n[t.index]);if(8&e){const r=t.child;if(null!==r)return cf(n,r);{const i=n[t.index];return di(i)?Pv(-1,i):en(i)}}if(32&e)return Mv(t,n)()||en(n[t.index]);{const r=rD(n,t);return null!==r?Array.isArray(r)?r[0]:cf(Cc(n[16]),r):cf(n,t.next)}}return null}function rD(n,t){return null!==t?n[16][6].projection[t.projection]:null}function Pv(n,t){const e=10+n+1;if(e<t.length){const r=t[e],i=r[1].firstChild;if(null!==i)return cf(r,i)}return t[7]}function Bv(n,t,e,r,i,o,s){for(;null!=e;){const a=r[e.index],u=e.type;if(s&&0===t&&(a&&Wn(en(a),r),e.flags|=4),64!=(64&e.flags))if(8&u)Bv(n,t,e.child,r,i,o,!1),Iu(t,n,i,a,o);else if(32&u){const l=Mv(e,r);let c;for(;c=l();)Iu(t,n,i,c,o);Iu(t,n,i,a,o)}else 16&u?iD(n,t,r,e,i,o):Iu(t,n,i,a,o);e=s?e.projectionNext:e.next}}function Ec(n,t,e,r,i,o){Bv(e,r,n.firstChild,t,i,o,!1)}function iD(n,t,e,r,i,o){const s=e[16],u=s[6].projection[r.projection];if(Array.isArray(u))for(let l=0;l<u.length;l++)Iu(t,n,i,u[l],o);else Bv(n,t,u,s[3],i,o,!0)}function oD(n,t,e){Gt(n)?n.setAttribute(t,"style",e):t.style.cssText=e}function Vv(n,t,e){Gt(n)?""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e):t.className=e}function la(n){var t;return(null===(t=function(){if(void 0===df&&(df=null,ft.trustedTypes))try{df=ft.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return df}())||void 0===t?void 0:t.createHTML(n))||n}class ca{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class k4 extends ca{getTypeName(){return"HTML"}}class O4 extends ca{getTypeName(){return"Style"}}class N4 extends ca{getTypeName(){return"Script"}}class P4 extends ca{getTypeName(){return"URL"}}class L4 extends ca{getTypeName(){return"ResourceURL"}}function Tr(n){return n instanceof ca?n.changingThisBreaksApplicationSecurity:n}function zi(n,t){const e=lD(n);if(null!=e&&e!==t){if("ResourceURL"===e&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${e} (see https://g.co/ng/security#xss)`)}return e===t}function lD(n){return n instanceof ca&&n.getTypeName()||null}class W4{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(la(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class G4{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const r=this.inertDocument.createElement("body");e.appendChild(r)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=la(t),e;const r=this.inertDocument.createElement("body");return r.innerHTML=la(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(r),r}stripCustomNsAttrs(t){const e=t.attributes;for(let i=e.length-1;0<i;i--){const s=e.item(i).name;("xmlns:ns1"===s||0===s.indexOf("ns1:"))&&t.removeAttribute(s)}let r=t.firstChild;for(;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling}}const $4=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,q4=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Dc(n){return(n=String(n)).match($4)||n.match(q4)?n:"unsafe:"+n}function dD(n){return(n=String(n)).split(",").map(t=>Dc(t.trim())).join(", ")}function $i(n){const t={};for(const e of n.split(","))t[e]=!0;return t}function Sc(...n){const t={};for(const e of n)for(const r in e)e.hasOwnProperty(r)&&(t[r]=!0);return t}const hD=$i("area,br,col,hr,img,wbr"),fD=$i("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),pD=$i("rp,rt"),jv=Sc(hD,Sc(fD,$i("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Sc(pD,$i("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Sc(pD,fD)),Wv=$i("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Gv=$i("srcset"),gD=Sc(Wv,Gv,$i("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),$i("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),K4=$i("script,style,template");class Y4{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,r=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let i=this.checkClobberedElement(e,e.nextSibling);if(i){e=i;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!jv.hasOwnProperty(e))return this.sanitizedSomething=!0,!K4.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const r=t.attributes;for(let i=0;i<r.length;i++){const o=r.item(i),s=o.name,a=s.toLowerCase();if(!gD.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let u=o.value;Wv[a]&&(u=Dc(u)),Gv[a]&&(u=dD(u)),this.buf.push(" ",s,'="',mD(u),'"')}return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();jv.hasOwnProperty(e)&&!hD.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(mD(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const X4=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Q4=/([^\#-~ |!])/g;function mD(n){return n.replace(/&/g,"&amp;").replace(X4,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Q4,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let ff;function vD(n,t){let e=null;try{ff=ff||function(n){const t=new G4(n);return function(){try{return!!(new window.DOMParser).parseFromString(la(""),"text/html")}catch(n){return!1}}()?new W4(t):t}(n);let r=t?String(t):"";e=ff.getInertBodyElement(r);let i=5,o=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=o,o=e.innerHTML,e=ff.getInertBodyElement(r)}while(r!==o);return la((new Y4).sanitizeChildren(zv(e)||e))}finally{if(e){const r=zv(e)||e;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function zv(n){return"content"in n&&function(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var ot=(()=>((ot=ot||{})[ot.NONE=0]="NONE",ot[ot.HTML=1]="HTML",ot[ot.STYLE=2]="STYLE",ot[ot.SCRIPT=3]="SCRIPT",ot[ot.URL=4]="URL",ot[ot.RESOURCE_URL=5]="RESOURCE_URL",ot))();function pf(n){return n.ngOriginalError}function lH(n,...t){n.error(...t)}class fi{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),r=this._findContext(t),i=function(n){return n&&n.ngErrorLogger||lH}(t);i(this._console,"ERROR",t),e&&i(this._console,"ORIGINAL ERROR",e),r&&i(this._console,"ERROR CONTEXT",r)}_findContext(t){return t?function(n){return n.ngDebugContext}(t)||this._findContext(pf(t)):null}_findOriginalError(t){let e=t&&pf(t);for(;e&&pf(e);)e=pf(e);return e||null}}const ED=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ft))();function qi(n){return n instanceof Function?n():n}function SD(n,t,e){let r=n.length;for(;;){const i=n.indexOf(t,e);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const o=t.length;if(i+o===r||n.charCodeAt(i+o)<=32)return i}e=i+1}}const AD="ng-template";function vH(n,t,e){let r=0;for(;r<n.length;){let i=n[r++];if(e&&"class"===i){if(i=n[r],-1!==SD(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<n.length&&"string"==typeof(i=n[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function MD(n){return 4===n.type&&n.value!==AD}function yH(n,t,e){return t===(4!==n.type||e?n.value:AD)}function _H(n,t,e){let r=4;const i=n.attrs||[],o=function(n){for(let t=0;t<n.length;t++)if(mE(n[t]))return t;return n.length}(i);let s=!1;for(let a=0;a<t.length;a++){const u=t[a];if("number"!=typeof u){if(!s)if(4&r){if(r=2|1&r,""!==u&&!yH(n,u,e)||""===u&&1===t.length){if(pi(r))return!1;s=!0}}else{const l=8&r?u:t[++a];if(8&r&&null!==n.attrs){if(!vH(n.attrs,l,e)){if(pi(r))return!1;s=!0}continue}const d=bH(8&r?"class":u,i,MD(n),e);if(-1===d){if(pi(r))return!1;s=!0;continue}if(""!==l){let h;h=d>o?"":i[d+1].toLowerCase();const f=8&r?h:null;if(f&&-1!==SD(f,l,0)||2&r&&l!==h){if(pi(r))return!1;s=!0}}}}else{if(!s&&!pi(r)&&!pi(u))return!1;if(s&&pi(u))continue;s=!1,r=u|1&r}}return pi(r)||s}function pi(n){return 0==(1&n)}function bH(n,t,e,r){if(null===t)return-1;let i=0;if(r||!e){let o=!1;for(;i<t.length;){const s=t[i];if(s===n)return i;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=t[++i];for(;"string"==typeof a;)a=t[++i];continue}if(4===s)break;if(0===s){i+=4;continue}}i+=o?1:2}return-1}return function(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const r=n[e];if("number"==typeof r)return-1;if(r===t)return e;e++}return-1}(t,n)}function ID(n,t,e=!1){for(let r=0;r<t.length;r++)if(_H(n,t[r],e))return!0;return!1}function TD(n,t){return n?":not("+t.trim()+")":t}function DH(n){let t=n[0],e=1,r=2,i="",o=!1;for(;e<n.length;){let s=n[e];if("string"==typeof s)if(2&r){const a=n[++e];i+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""!==i&&!pi(s)&&(t+=TD(o,i),i=""),r=s,o=o||!pi(r);e++}return""!==i&&(t+=TD(o,i)),t}const Te={};function at(n){RD(Ze(),X(),or()+n,Hh())}function RD(n,t,e,r){if(!r)if(3==(3&t[2])){const o=n.preOrderCheckHooks;null!==o&&zh(t,o,e)}else{const o=n.preOrderHooks;null!==o&&$h(t,o,0,e)}ms(e)}function UD(n,t){const e=n.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const i=e[r],o=e[r+1];if(-1!==o){const s=n.data[o];cv(i),s.contentQueries(2,t[o],o)}}}function Mc(n,t,e,r,i,o,s,a,u,l){const c=t.blueprint.slice();return c[0]=i,c[2]=140|r,iE(c),c[3]=c[15]=n,c[8]=e,c[10]=s||n&&n[10],c[11]=a||n&&n[11],c[12]=u||n&&n[12]||null,c[9]=l||n&&n[9]||null,c[6]=o,c[16]=2==t.type?n[16]:c,c}function Ru(n,t,e,r,i){let o=n.data[t];if(null===o)o=function(n,t,e,r,i){const o=sE(),s=sv(),u=n.data[t]=function(n,t,e,r,i,o){return{type:e,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,e,t,r,i);return null===n.firstChild&&(n.firstChild=u),null!==o&&(s?null==o.child&&null!==u.parent&&(o.child=u):null===o.next&&(o.next=u)),u}(n,t,e,r,i),Ae.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=e,o.value=r,o.attrs=i;const s=function(){const n=Ae.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return ji(o,!0),o}function Fu(n,t,e,r){if(0===e)return-1;const i=t.length;for(let o=0;o<e;o++)t.push(r),n.blueprint.push(r),n.data.push(null);return i}function Ic(n,t,e){jh(t);try{const r=n.viewQuery;null!==r&&hy(1,r,e);const i=n.template;null!==i&&jD(n,t,i,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&UD(n,t),n.staticViewQueries&&hy(2,n.viewQuery,e);const o=n.components;null!==o&&function(n,t){for(let e=0;e<t.length;e++)iU(n,t[e])}(t,o)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{t[2]&=-5,Wh()}}function ku(n,t,e,r){const i=t[2];if(256==(256&i))return;jh(t);const o=Hh();try{iE(t),function(n){Ae.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&jD(n,t,e,2,r);const s=3==(3&i);if(!o)if(s){const l=n.preOrderCheckHooks;null!==l&&zh(t,l,null)}else{const l=n.preOrderHooks;null!==l&&$h(t,l,0,null),dv(t,0)}if(function(n){for(let t=Iv(n);null!==t;t=Tv(t)){if(!t[2])continue;const e=t[9];for(let r=0;r<e.length;r++){const i=e[r],o=i[3];0==(1024&i[2])&&iv(o,1),i[2]|=1024}}}(t),function(n){for(let t=Iv(n);null!==t;t=Tv(t))for(let e=10;e<t.length;e++){const r=t[e],i=r[1];rv(r)&&ku(i,r,i.template,r[8])}}(t),null!==n.contentQueries&&UD(n,t),!o)if(s){const l=n.contentCheckHooks;null!==l&&zh(t,l)}else{const l=n.contentHooks;null!==l&&$h(t,l,1),dv(t,1)}!function(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let r=0;r<e.length;r++){const i=e[r];if(i<0)ms(~i);else{const o=i,s=e[++r],a=e[++r];h3(s,o),a(2,t[o])}}}finally{ms(-1)}}(n,t);const a=n.components;null!==a&&function(n,t){for(let e=0;e<t.length;e++)rU(n,t[e])}(t,a);const u=n.viewQuery;if(null!==u&&hy(2,u,r),!o)if(s){const l=n.viewCheckHooks;null!==l&&zh(t,l)}else{const l=n.viewHooks;null!==l&&$h(t,l,2),dv(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),o||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,iv(t[3],-1))}finally{Wh()}}function BH(n,t,e,r){const i=t[10],o=!Hh(),s=rE(t);try{o&&!s&&i.begin&&i.begin(),s&&Ic(n,t,r),ku(n,t,e,r)}finally{o&&!s&&i.end&&i.end()}}function jD(n,t,e,r,i){const o=or(),s=2&r;try{ms(-1),s&&t.length>20&&RD(n,t,20,Hh()),e(r,i)}finally{ms(o)}}function GD(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=yf(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function yf(n,t,e,r,i,o,s,a,u,l){const c=20+r,d=c+i,h=function(n,t){const e=[];for(let r=0;r<t;r++)e.push(r<n?null:Te);return e}(c,d),f="function"==typeof l?l():l;return h[1]={type:n,blueprint:h,template:e,queries:null,viewQuery:a,declTNode:t,data:h.slice().fill(null,c),bindingStartIndex:c,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:u,consts:f,incompleteFirstPass:!1}}function qD(n,t,e,r){const i=function(n){return n[7]||(n[7]=[])}(t);null===e?i.push(r):(i.push(e),n.firstCreatePass&&function(n){return n.cleanup||(n.cleanup=[])}(n).push(r,i.length-1))}function KD(n,t,e){for(let r in n)if(n.hasOwnProperty(r)){const i=n[r];(e=null===e?{}:e).hasOwnProperty(r)?e[r].push(t,i):e[r]=[t,i]}return e}function XD(n,t,e,r,i,o){const s=o.hostBindings;if(s){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const u=~t.index;(function(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(a)!=u&&a.push(u),a.push(r,i,s)}}function QD(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function JD(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function QH(n,t,e){if(e){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)e[t.exportAs[r]]=n;hi(t)&&(e[""]=n)}}function ZD(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function e1(n,t,e,r,i){n.data[r]=i;const o=i.factory||(i.factory=ra(i.type)),s=new cc(o,hi(i),null);n.blueprint[r]=s,e[r]=s,XD(n,t,0,r,Fu(n,e,i.hostVars,Te),i)}function JH(n,t,e){const r=Sr(t,n),i=GD(e),o=n[10],s=_f(n,Mc(n,i,null,e.onPush?64:16,r,t,o,o.createRenderer(r,e),null,null));n[t.index]=s}function ZH(n,t,e,r,i,o){const s=o[t];if(null!==s){const a=r.setInput;for(let u=0;u<s.length;){const l=s[u++],c=s[u++],d=s[u++];null!==a?r.setInput(e,d,l,c):e[c]=d}}}function eU(n,t){let e=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;n.hasOwnProperty(i)&&(null===e&&(e=[]),e.push(i,n[i],t[r+1])),r+=2}else r+=2;else r+=4}return e}function rU(n,t){const e=Ar(t,n);if(rv(e)){const r=e[1];80&e[2]?ku(r,e,r.template,e[8]):e[5]>0&&uy(e)}}function uy(n){for(let r=Iv(n);null!==r;r=Tv(r))for(let i=10;i<r.length;i++){const o=r[i];if(1024&o[2]){const s=o[1];ku(s,o,s.template,o[8])}else o[5]>0&&uy(o)}const e=n[1].components;if(null!==e)for(let r=0;r<e.length;r++){const i=Ar(e[r],n);rv(i)&&i[5]>0&&uy(i)}}function iU(n,t){const e=Ar(t,n),r=e[1];(function(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(r,e),Ic(r,e,e[8])}function _f(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function dy(n,t,e){const r=t[10];r.begin&&r.begin();try{ku(n,t,n.template,e)}catch(i){throw function(n,t){const e=n[9],r=e?e.get(fi,null):null;r&&r.handleError(t)}(t,i),i}finally{r.end&&r.end()}}function n1(n){!function(n){for(let t=0;t<n.components.length;t++){const e=n.components[t],r=Sv(e),i=r[1];BH(i,r,i.template,e)}}(n[8])}function hy(n,t,e){cv(0),t(n,e)}const lU=(()=>Promise.resolve(null))();function u1(n,t,e,r,i){for(let o=0;o<e.length;){const s=e[o++],a=e[o++],u=t[s],l=n.data[s];null!==l.setInput?l.setInput(u,i,r,a):u[a]=i}}function Ro(n,t,e){const r=function(n,t){return en(t[n])}(t,n);!function(n,t,e){Gt(n)?n.setValue(t,e):t.textContent=e}(n[11],r,e)}function bf(n,t,e){let r=e?n.styles:null,i=e?n.classes:null,o=0;if(null!==t)for(let s=0;s<t.length;s++){const a=t[s];"number"==typeof a?o=a:1==o?i=Wm(i,a):2==o&&(r=Wm(r,a+": "+t[++s]+";"))}e?n.styles=r:n.stylesWithoutHost=r,e?n.classes=i:n.classesWithoutHost=i}const Ou=new re("INJECTOR",-1);class l1{get(t,e=vc){if(e===vc){const r=new Error(`NullInjectorError: No provider for ${Ue(t)}!`);throw r.name="NullInjectorError",r}return e}}const Tc=new re("Set Injector scope."),Rc={},hU={};let fy;function c1(){return void 0===fy&&(fy=new l1),fy}function d1(n,t=null,e=null,r){return new pU(n,e,t||c1(),r)}class pU{constructor(t,e,r,i=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const o=[];e&&Gi(e,a=>this.processProvider(a,t,e)),Gi([t],a=>this.processInjectorType(a,[],o)),this.records.set(Ou,Nu(void 0,this));const s=this.records.get(Tc);this.scope=null!=s?s.value:null,this.source=i||("object"==typeof t?null:Ue(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,e=vc,r=xe.Default){this.assertNotDestroyed();const i=Su(this),o=hs(void 0);try{if(!(r&xe.SkipSelf)){let a=this.records.get(t);if(void 0===a){const u=function(n){return"function"==typeof n||"object"==typeof n&&n instanceof re}(t)&&Do(t);a=u&&this.injectableDefInScope(u)?Nu(py(t),Rc):null,this.records.set(t,a)}if(null!=a)return this.hydrate(t,a)}return(r&xe.Self?c1():this.parent).get(t,e=r&xe.Optional&&e===vc?null:e)}catch(s){if("NullInjectorError"===s.name){if((s[Du]=s[Du]||[]).unshift(Ue(t)),i)throw s;return FE(s,t,"R3InjectorError",this.source)}throw s}finally{hs(o),Su(i)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((r,i)=>t.push(Ue(i))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(t,e,r){if(!(t=ye(t)))return!1;let i=UC(t);const o=null==i&&t.ngModule||void 0,s=void 0===o?t:o,a=-1!==r.indexOf(s);if(void 0!==o&&(i=UC(o)),null==i)return!1;if(null!=i.imports&&!a){let c;r.push(s);try{Gi(i.imports,d=>{this.processInjectorType(d,e,r)&&(void 0===c&&(c=[]),c.push(d))})}finally{}if(void 0!==c)for(let d=0;d<c.length;d++){const{ngModule:h,providers:f}=c[d];Gi(f,p=>this.processProvider(p,h,f||yt))}}this.injectorDefTypes.add(s);const u=ra(s)||(()=>new s);this.records.set(s,Nu(u,Rc));const l=i.providers;if(null!=l&&!a){const c=t;Gi(l,d=>this.processProvider(d,c,l))}return void 0!==o&&void 0!==t.providers}processProvider(t,e,r){let i=Pu(t=ye(t))?t:ye(t&&t.provide);const o=function(n,t,e){return f1(n)?Nu(void 0,n.useValue):Nu(function(n,t,e){let r;if(Pu(n)){const i=ye(n);return ra(i)||py(i)}if(f1(n))r=()=>ye(n.useValue);else if(function(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...aa(n.deps||[]));else if(function(n){return!(!n||!n.useExisting)}(n))r=()=>R(ye(n.useExisting));else{const i=ye(n&&(n.useClass||n.provide));if(!function(n){return!!n.deps}(n))return ra(i)||py(i);r=()=>new i(...aa(n.deps))}return r}(n),Rc)}(t);if(Pu(t)||!0!==t.multi)this.records.get(i);else{let s=this.records.get(i);s||(s=Nu(void 0,Rc,!0),s.factory=()=>aa(s.multi),this.records.set(i,s)),i=t,s.multi.push(t)}this.records.set(i,o)}hydrate(t,e){return e.value===Rc&&(e.value=hU,e.value=e.factory()),"object"==typeof e.value&&e.value&&function(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this.onDestroy.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=ye(t.providedIn);return"string"==typeof e?"any"===e||e===this.scope:this.injectorDefTypes.has(e)}}function py(n){const t=Do(n),e=null!==t?t.factory:ra(n);if(null!==e)return e;if(n instanceof re)throw new Error(`Token ${Ue(n)} is missing a \u0275prov definition.`);if(n instanceof Function)return function(n){const t=n.length;if(t>0){const r=function(n,t){const e=[];for(let r=0;r<n;r++)e.push(t);return e}(t,"?");throw new Error(`Can't resolve all parameters for ${Ue(n)}: (${r.join(", ")}).`)}const e=function(n){const t=n&&(n[Fh]||n[jC]);if(t){const e=function(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new Error("unreachable")}function Nu(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function f1(n){return null!==n&&"object"==typeof n&&Cv in n}function Pu(n){return"function"==typeof n}const p1=function(n,t,e){return function(n,t=null,e=null,r){const i=d1(n,t,e,r);return i._resolveInjectorDefTypes(),i}({name:e},t,n,e)};let ct=(()=>{class n{static create(e,r){return Array.isArray(e)?p1(e,r,""):p1(e.providers,e.parent,e.name||"")}}return n.THROW_IF_NOT_FOUND=vc,n.NULL=new l1,n.\u0275prov=K({token:n,providedIn:"any",factory:()=>R(Ou)}),n.__NG_ELEMENT_ID__=-1,n})();function NU(n,t){Gh(Sv(n)[1],mn())}function Q(n){let t=function(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),e=!0;const r=[n];for(;t;){let i;if(hi(n))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(e){r.push(i);const s=n;s.inputs=by(n.inputs),s.declaredInputs=by(n.declaredInputs),s.outputs=by(n.outputs);const a=i.hostBindings;a&&VU(n,a);const u=i.viewQuery,l=i.contentQueries;if(u&&LU(n,u),l&&BU(n,l),jm(n.inputs,i.inputs),jm(n.declaredInputs,i.declaredInputs),jm(n.outputs,i.outputs),hi(i)&&i.data.animation){const c=n.data;c.animation=(c.animation||[]).concat(i.data.animation)}}const o=i.features;if(o)for(let s=0;s<o.length;s++){const a=o[s];a&&a.ngInherit&&a(n),a===Q&&(e=!1)}}t=Object.getPrototypeOf(t)}!function(n){let t=0,e=null;for(let r=n.length-1;r>=0;r--){const i=n[r];i.hostVars=t+=i.hostVars,i.hostAttrs=Kh(i.hostAttrs,e=Kh(e,i.hostAttrs))}}(r)}function by(n){return n===du?{}:n===yt?[]:n}function LU(n,t){const e=n.viewQuery;n.viewQuery=e?(r,i)=>{t(r,i),e(r,i)}:t}function BU(n,t){const e=n.contentQueries;n.contentQueries=e?(r,i,o)=>{t(r,i,o),e(r,i,o)}:t}function VU(n,t){const e=n.hostBindings;n.hostBindings=e?(r,i)=>{t(r,i),e(r,i)}:t}let xf=null;function Lu(){if(!xf){const n=ft.Symbol;if(n&&n.iterator)xf=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const r=t[e];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(xf=r)}}}return xf}class vi{constructor(t){this.wrapped=t}static wrap(t){return new vi(t)}static unwrap(t){return vi.isWrapped(t)?t.wrapped:t}static isWrapped(t){return t instanceof vi}}function kc(n){return!!xy(n)&&(Array.isArray(n)||!(n instanceof Map)&&Lu()in n)}function xy(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Yi(n,t,e){return n[t]=e}function Gn(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}function C(n,t=xe.Default){const e=X();return null===e?R(n,t):CE(mn(),e,ye(n),t)}function pt(n,t,e){const r=X();return Gn(r,vu(),t)&&function(n,t,e,r,i,o,s,a){const u=Sr(t,e);let c,l=t.inputs;!a&&null!=l&&(c=l[r])?(u1(n,e,c,r,i),Lh(t)&&function(n,t){const e=Ar(t,n);16&e[2]||(e[2]|=64)}(e,t.index)):3&t.type&&(r=function(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),i=null!=s?s(i,t.value||"",r):i,Gt(o)?o.setProperty(u,r,i):fv(r)||(u.setProperty?u.setProperty(r,i):u[r]=i))}(Ze(),function(){const n=Ae.lFrame;return nv(n.tView,n.selectedIndex)}(),r,n,t,r[11],e,!1),pt}function Sy(n,t,e,r,i){const s=i?"class":"style";u1(n,e,t.inputs[s],s,r)}function et(n,t,e,r){const i=X(),o=Ze(),s=20+n,a=i[11],u=i[s]=Fv(a,t,Ae.lFrame.currentNamespace),l=o.firstCreatePass?function(n,t,e,r,i,o,s){const a=t.consts,l=Ru(t,n,2,i,gs(a,o));return function(n,t,e,r){let i=!1;if(oE()){const o=function(n,t,e){const r=n.directiveRegistry;let i=null;if(r)for(let o=0;o<r.length;o++){const s=r[o];ID(e,s.selectors,!1)&&(i||(i=[]),Qh(hc(e,t),n,s.type),hi(s)?(JD(n,e),i.unshift(s)):i.push(s))}return i}(n,t,e),s=null===r?null:{"":-1};if(null!==o){i=!0,ZD(e,n.data.length,o.length);for(let c=0;c<o.length;c++){const d=o[c];d.providersResolver&&d.providersResolver(d)}let a=!1,u=!1,l=Fu(n,t,o.length,null);for(let c=0;c<o.length;c++){const d=o[c];e.mergedAttrs=Kh(e.mergedAttrs,d.hostAttrs),e1(n,e,t,l,d),QH(l,d,s),null!==d.contentQueries&&(e.flags|=8),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(e.flags|=128);const h=d.type.prototype;!a&&(h.ngOnChanges||h.ngOnInit||h.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),a=!0),!u&&(h.ngOnChanges||h.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),u=!0),l++}!function(n,t){const r=t.directiveEnd,i=n.data,o=t.attrs,s=[];let a=null,u=null;for(let l=t.directiveStart;l<r;l++){const c=i[l],d=c.inputs,h=null===o||MD(t)?null:eU(d,o);s.push(h),a=KD(d,l,a),u=KD(c.outputs,l,u)}null!==a&&(a.hasOwnProperty("class")&&(t.flags|=16),a.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=s,t.inputs=a,t.outputs=u}(n,e)}s&&function(n,t,e){if(t){const r=n.localNames=[];for(let i=0;i<t.length;i+=2){const o=e[t[i+1]];if(null==o)throw new ds("301",`Export of name '${t[i+1]}' not found!`);r.push(t[i],o)}}}(e,r,s)}e.mergedAttrs=Kh(e.mergedAttrs,e.attrs)}(t,e,l,gs(a,s)),null!==l.attrs&&bf(l,l.attrs,!1),null!==l.mergedAttrs&&bf(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(s,o,i,0,t,e,r):o.data[s];ji(l,!0);const c=l.mergedAttrs;null!==c&&qh(a,u,c);const d=l.classes;null!==d&&Vv(a,u,d);const h=l.styles;null!==h&&oD(a,u,h),64!=(64&l.flags)&&lf(o,i,u,l),0===Ae.lFrame.elementDepthCount&&Wn(u,i),Ae.lFrame.elementDepthCount++,function(n){return 1==(1&n.flags)}(l)&&(function(n,t,e){!oE()||(function(n,t,e,r){const i=e.directiveStart,o=e.directiveEnd;n.firstCreatePass||hc(e,t),Wn(r,t);const s=e.initialInputs;for(let a=i;a<o;a++){const u=n.data[a],l=hi(u);l&&JH(t,e,u);const c=fc(t,n,a,e);Wn(c,t),null!==s&&ZH(0,a-i,c,u,0,s),l&&(Ar(e.index,t)[8]=c)}}(n,t,e,Sr(e,t)),128==(128&e.flags)&&function(n,t,e){const r=e.directiveStart,i=e.directiveEnd,s=e.index,a=Ae.lFrame.currentDirectiveIndex;try{ms(s);for(let u=r;u<i;u++){const l=n.data[u],c=t[u];uv(u),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&QD(l,c)}}finally{ms(-1),uv(a)}}(n,t,e))}(o,i,l),function(n,t,e){if(Qm(t)){const i=t.directiveEnd;for(let o=t.directiveStart;o<i;o++){const s=n.data[o];s.contentQueries&&s.contentQueries(1,e[o],o)}}}(o,l,i)),null!==r&&function(n,t,e=Sr){const r=t.localNames;if(null!==r){let i=t.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?e(t,n):n[s];n[i++]=a}}}(i,l)}function tt(){let n=mn();sv()?Ae.lFrame.isParent=!1:(n=n.parent,ji(n,!1));const t=n;Ae.lFrame.elementDepthCount--;const e=Ze();e.firstCreatePass&&(Gh(e,n),Qm(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function(n){return 0!=(16&n.flags)}(t)&&Sy(e,t,X(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(n){return 0!=(32&n.flags)}(t)&&Sy(e,t,X(),t.stylesWithoutHost,!1)}function tn(n,t,e,r){et(n,t,e,r),tt()}function Nc(n){return!!n&&"function"==typeof n.then}function Z1(n){return!!n&&"function"==typeof n.subscribe}const Sf=Z1;function Ji(n,t=""){const e=X(),r=Ze(),i=n+20,o=r.firstCreatePass?Ru(r,i,1,t,null):r.data[i],s=e[i]=function(n,t){return Gt(n)?n.createText(t):n.createTextNode(t)}(e[11],t);lf(r,e,s,o),ji(o,!1)}function ws(n){return Lc("",n,""),ws}function Lc(n,t,e){const r=X(),i=function(n,t,e,r){return Gn(n,vu(),e)?t+ke(e)+r:Te}(r,n,t,e);return i!==Te&&Ro(r,or(),i),Lc}const ha=void 0;var iW=["en",[["a","p"],["AM","PM"],ha],[["AM","PM"],ha,ha],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ha,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ha,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ha,"{1} 'at' {0}",ha],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(n){const t=Math.floor(Math.abs(n)),e=n.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===e?1:5}];let Yu={};function jS(n){return n in Yu||(Yu[n]=ft.ng&&ft.ng.common&&ft.ng.common.locales&&ft.ng.common.locales[n]),Yu[n]}var ie=(()=>((ie=ie||{})[ie.LocaleId=0]="LocaleId",ie[ie.DayPeriodsFormat=1]="DayPeriodsFormat",ie[ie.DayPeriodsStandalone=2]="DayPeriodsStandalone",ie[ie.DaysFormat=3]="DaysFormat",ie[ie.DaysStandalone=4]="DaysStandalone",ie[ie.MonthsFormat=5]="MonthsFormat",ie[ie.MonthsStandalone=6]="MonthsStandalone",ie[ie.Eras=7]="Eras",ie[ie.FirstDayOfWeek=8]="FirstDayOfWeek",ie[ie.WeekendRange=9]="WeekendRange",ie[ie.DateFormat=10]="DateFormat",ie[ie.TimeFormat=11]="TimeFormat",ie[ie.DateTimeFormat=12]="DateTimeFormat",ie[ie.NumberSymbols=13]="NumberSymbols",ie[ie.NumberFormats=14]="NumberFormats",ie[ie.CurrencyCode=15]="CurrencyCode",ie[ie.CurrencySymbol=16]="CurrencySymbol",ie[ie.CurrencyName=17]="CurrencyName",ie[ie.Currencies=18]="Currencies",ie[ie.Directionality=19]="Directionality",ie[ie.PluralCase=20]="PluralCase",ie[ie.ExtraData=21]="ExtraData",ie))();const If="en-US";let WS=If;function ky(n){Er(n,"Expected localeId to be defined"),"string"==typeof n&&(WS=n.toLowerCase().replace(/_/g,"-"))}class pA{}const mA="ngComponent";class iG{resolveComponentFactory(t){throw function(n){const t=Error(`No component factory found for ${Ue(n)}. Did you add it to @NgModule.entryComponents?`);return t[mA]=n,t}(t)}}let ko=(()=>{class n{}return n.NULL=new iG,n})();function Of(...n){}function Qu(n,t){return new se(Sr(n,t))}const aG=function(){return Qu(mn(),X())};let se=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=aG,n})();function vA(n){return n instanceof se?n.nativeElement:n}class fa{}let bi=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>lG(),n})();const lG=function(){const n=X(),e=Ar(mn().index,n);return function(n){return n[11]}(Ui(e)?e:n)};let Uy=(()=>{class n{}return n.\u0275prov=K({token:n,providedIn:"root",factory:()=>null}),n})();class Oo{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const yA=new Oo("12.2.17");class _A{constructor(){}supports(t){return kc(t)}create(t){return new fG(t)}}const hG=(n,t)=>t;class fG{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||hG}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,r=this._removalsHead,i=0,o=null;for(;e||r;){const s=!r||e&&e.currentIndex<xA(r,i,o)?e:r,a=xA(s,i,o),u=s.currentIndex;if(s===r)i--,r=r._nextRemoved;else if(e=e._next,null==s.previousIndex)i++;else{o||(o=[]);const l=a-i,c=u-i;if(l!=c){for(let h=0;h<l;h++){const f=h<o.length?o[h]:o[h]=0,p=f+h;c<=p&&p<l&&(o[h]=f+1)}o[s.previousIndex]=c-l}}a!==u&&t(s,a,u)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!kc(t))throw new Error(`Error trying to diff '${Ue(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i,o,s,e=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let a=0;a<this.length;a++)o=t[a],s=this._trackByFn(a,o),null!==e&&Object.is(e.trackById,s)?(r&&(e=this._verifyReinsertion(e,o,s,a)),Object.is(e.item,o)||this._addIdentityChange(e,o)):(e=this._mismatch(e,o,s,a),r=!0),e=e._next}else i=0,function(n,t){if(Array.isArray(n))for(let e=0;e<n.length;e++)t(n[e]);else{const e=n[Lu()]();let r;for(;!(r=e.next()).done;)t(r.value)}}(t,a=>{s=this._trackByFn(i,a),null!==e&&Object.is(e.trackById,s)?(r&&(e=this._verifyReinsertion(e,a,s,i)),Object.is(e.item,a)||this._addIdentityChange(e,a)):(e=this._mismatch(e,a,s,i),r=!0),e=e._next,i++}),this.length=i;return this._truncate(e),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,r,i){let o;return null===t?o=this._itTail:(o=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,o,i)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,o,i)):t=this._addAfter(new pG(e,r),o,i),t}_verifyReinsertion(t,e,r,i){let o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==o?t=this._reinsertAfter(o,t._prev,i):t.currentIndex!=i&&(t.currentIndex=i,this._addToMoves(t,i)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const i=t._prevRemoved,o=t._nextRemoved;return null===i?this._removalsHead=o:i._nextRemoved=o,null===o?this._removalsTail=i:o._prevRemoved=i,this._insertAfter(t,e,r),this._addToMoves(t,r),t}_moveAfter(t,e,r){return this._unlink(t),this._insertAfter(t,e,r),this._addToMoves(t,r),t}_addAfter(t,e,r){return this._insertAfter(t,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,r){const i=null===e?this._itHead:e._next;return t._next=i,t._prev=e,null===i?this._itTail=t:i._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new bA),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,r=t._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new bA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class pG{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class gG{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const e=t._prevDup,r=t._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class bA{constructor(){this.map=new Map}put(t){const e=t.trackById;let r=this.map.get(e);r||(r=new gG,this.map.set(e,r)),r.add(t)}get(t,e){const i=this.map.get(t);return i?i.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function xA(n,t,e){const r=n.previousIndex;if(null===r)return r;let i=0;return e&&r<e.length&&(i=e[r]),r+t+i}class wA{constructor(){}supports(t){return t instanceof Map||xy(t)}create(){return new mG}}class mG{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||xy(t)))throw new Error(`Error trying to diff '${Ue(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(r,i)=>{if(e&&e.key===i)this._maybeAddToChanges(e,r),this._appendAfter=e,e=e._next;else{const o=this._getOrCreateRecordForKey(i,r);e=this._insertBeforeOrAppend(e,o)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let r=e;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const r=t._prev;return e._next=t,e._prev=r,t._prev=e,r&&(r._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const i=this._records.get(t);this._maybeAddToChanges(i,e);const o=i._prev,s=i._next;return o&&(o._next=s),s&&(s._prev=o),i._next=null,i._prev=null,i}const r=new vG(t);return this._records.set(t,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(r=>e(t[r],r))}}class vG{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function CA(){return new pa([new _A])}let pa=(()=>{class n{constructor(e){this.factories=e}static create(e,r){if(null!=r){const i=r.factories.slice();e=e.concat(i)}return new n(e)}static extend(e){return{provide:n,useFactory:r=>n.create(e,r||CA()),deps:[[n,new Mo,new Rn]]}}find(e){const r=this.factories.find(i=>i.supports(e));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(n){return n.name||typeof n}(e)}'`)}}return n.\u0275prov=K({token:n,providedIn:"root",factory:CA}),n})();function EA(){return new Cs([new wA])}let Cs=(()=>{class n{constructor(e){this.factories=e}static create(e,r){if(r){const i=r.factories.slice();e=e.concat(i)}return new n(e)}static extend(e){return{provide:n,useFactory:r=>n.create(e,r||EA()),deps:[[n,new Mo,new Rn]]}}find(e){const r=this.factories.find(i=>i.supports(e));if(r)return r;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return n.\u0275prov=K({token:n,providedIn:"root",factory:EA}),n})();function Nf(n,t,e,r,i=!1){for(;null!==e;){const o=t[e.index];if(null!==o&&r.push(en(o)),di(o))for(let a=10;a<o.length;a++){const u=o[a],l=u[1].firstChild;null!==l&&Nf(u[1],u,l,r)}const s=e.type;if(8&s)Nf(n,t,e.child,r);else if(32&s){const a=Mv(e,t);let u;for(;u=a();)r.push(u)}else if(16&s){const a=rD(t,e);if(Array.isArray(a))r.push(...a);else{const u=Cc(t[16]);Nf(u[1],u,a,r,!0)}}e=i?e.projectionNext:e.next}return r}class Wc{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return Nf(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(di(t)){const e=t[8],r=e?e.indexOf(this):-1;r>-1&&(kv(t,r),sa(e,r))}this._attachedToViewContainer=!1}KE(this._lView[1],this._lView)}onDestroy(t){qD(this._lView[1],this._lView,null,t)}markForCheck(){!function(n){for(;n;){n[2]|=64;const t=Cc(n);if($V(n)&&!t)return n;n=t}}(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){dy(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(n,t,e){Uh(!0);try{dy(n,t,e)}finally{Uh(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(n,t){Ec(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}}class _G extends Wc{constructor(t){super(t),this._view=t}detectChanges(){n1(this._view)}checkNoChanges(){!function(n){Uh(!0);try{n1(n)}finally{Uh(!1)}}(this._view)}get context(){return null}}const xG=function(n){return function(n,t,e){if(Lh(n)&&!e){const r=Ar(n.index,t);return new Wc(r,r)}return 47&n.type?new Wc(t[16],t):null}(mn(),X(),16==(16&n))};let Zi=(()=>{class n{}return n.__NG_ELEMENT_ID__=xG,n})();const EG=[new wA],SG=new pa([new _A]),AG=new Cs(EG),IG=function(){return Pf(mn(),X())};let Xr=(()=>{class n{}return n.__NG_ELEMENT_ID__=IG,n})();const TG=Xr,RG=class extends TG{constructor(t,e,r){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=r}createEmbeddedView(t){const e=this._declarationTContainer.tViews,r=Mc(this._declarationLView,e,t,16,null,e.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(r[19]=o.createEmbeddedView(e)),Ic(e,r,t),new Wc(r)}};function Pf(n,t){return 4&n.type?new RG(t,n,Qu(n,t)):null}class eo{}class DA{}const OG=function(){return MA(mn(),X())};let Fn=(()=>{class n{}return n.__NG_ELEMENT_ID__=OG,n})();const PG=Fn,SA=class extends PG{constructor(t,e,r){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=r}get element(){return Qu(this._hostTNode,this._hostLView)}get injector(){return new bu(this._hostTNode,this._hostLView)}get parentInjector(){const t=Xh(this._hostTNode,this._hostLView);if(yE(t)){const e=_u(t,this._hostLView),r=yu(t);return new bu(e[1].data[r+8],e)}return new bu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=AA(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,r){const i=t.createEmbeddedView(e||{});return this.insert(i,r),i}createComponent(t,e,r,i,o){const s=r||this.parentInjector;if(!o&&null==t.ngModule&&s){const u=s.get(eo,null);u&&(o=u)}const a=t.create(s,i,void 0,o);return this.insert(a.hostView,e),a}insert(t,e){const r=t._lView,i=r[1];if(function(n){return di(n[3])}(r)){const c=this.indexOf(t);if(-1!==c)this.detach(c);else{const d=r[3],h=new SA(d,d[6],d[3]);h.detach(h.indexOf(t))}}const o=this._adjustIndex(e),s=this._lContainer;!function(n,t,e,r){const i=10+r,o=e.length;r>0&&(e[i-1][4]=t),r<o-10?(t[4]=e[i],tf(e,10+r,t)):(e.push(t),t[4]=null),t[3]=e;const s=t[17];null!==s&&e!==s&&function(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(s,t);const a=t[19];null!==a&&a.insertView(n),t[2]|=128}(i,r,s,o);const a=Pv(o,s),u=r[11],l=uf(u,s[7]);return null!==l&&function(n,t,e,r,i,o){r[0]=i,r[6]=t,Ec(n,r,e,1,i,o)}(i,s[6],u,r,l,a),t.attachToViewContainerRef(),tf(jy(s),o,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=AA(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),r=kv(this._lContainer,e);r&&(sa(jy(this._lContainer),e),KE(r[1],r))}detach(t){const e=this._adjustIndex(t,-1),r=kv(this._lContainer,e);return r&&null!=sa(jy(this._lContainer),e)?new Wc(r):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function AA(n){return n[8]}function jy(n){return n[8]||(n[8]=[])}function MA(n,t){let e;const r=t[n.index];if(di(r))e=r;else{let i;if(8&n.type)i=en(r);else{const o=t[11];i=o.createComment("");const s=Sr(n,t);ua(o,uf(o,s),i,function(n,t){return Gt(n)?n.nextSibling(t):t.nextSibling}(o,s),!1)}t[n.index]=e=function(n,t,e,r){return new Array(n,!0,!1,t,null,0,r,e,null,null)}(r,t,i,n),_f(t,e)}return new SA(e,n,t)}const tl={};class KA extends ko{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Un(t);return new XA(e,this.ngModule)}}function YA(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}const Fz=new re("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>ED});class XA extends pA{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function(n){return n.map(DH).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return YA(this.componentDef.inputs)}get outputs(){return YA(this.componentDef.outputs)}create(t,e,r,i){const o=(i=i||this.ngModule)?function(n,t){return{get:(e,r,i)=>{const o=n.get(e,tl,i);return o!==tl||r===tl?o:t.get(e,r,i)}}}(t,i.injector):t,s=o.get(fa,nE),a=o.get(Uy,null),u=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",c=r?function(n,t,e){if(Gt(n))return n.selectRootElement(t,e===Zt.ShadowDom);let r="string"==typeof t?n.querySelector(t):t;return r.textContent="",r}(u,r,this.componentDef.encapsulation):Fv(s.createRenderer(null,this.componentDef),l,function(n){const t=n.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),d=this.componentDef.onPush?576:528,h=function(n,t){return{components:[],scheduler:n||ED,clean:lU,playerHandler:t||null,flags:0}}(),f=yf(0,null,null,1,0,null,null,null,null,null),p=Mc(null,f,h,d,null,null,s,u,a,o);let m,g;jh(p);try{const v=function(n,t,e,r,i,o){const s=e[1];e[20]=n;const u=Ru(s,20,2,"#host",null),l=u.mergedAttrs=t.hostAttrs;null!==l&&(bf(u,l,!0),null!==n&&(qh(i,n,l),null!==u.classes&&Vv(i,n,u.classes),null!==u.styles&&oD(i,n,u.styles)));const c=r.createRenderer(n,t),d=Mc(e,GD(t),null,t.onPush?64:16,e[20],u,r,c,o||null,null);return s.firstCreatePass&&(Qh(hc(u,e),s,t.type),JD(s,u),ZD(u,e.length,1)),_f(e,d),e[20]=d}(c,this.componentDef,p,s,u);if(c)if(r)qh(u,c,["ng-version",yA.full]);else{const{attrs:y,classes:b}=function(n){const t=[],e=[];let r=1,i=2;for(;r<n.length;){let o=n[r];if("string"==typeof o)2===i?""!==o&&t.push(o,n[++r]):8===i&&e.push(o);else{if(!pi(i))break;i=o}r++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);y&&qh(u,c,y),b&&b.length>0&&Vv(u,c,b.join(" "))}if(g=nv(f,20),void 0!==e){const y=g.projection=[];for(let b=0;b<this.ngContentSelectors.length;b++){const _=e[b];y.push(null!=_?Array.from(_):null)}}m=function(n,t,e,r,i){const o=e[1],s=function(n,t,e){const r=mn();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),e1(n,r,t,Fu(n,t,1,null),e));const i=fc(t,n,r.directiveStart,r);Wn(i,t);const o=Sr(r,t);return o&&Wn(o,t),i}(o,e,t);if(r.components.push(s),n[8]=s,i&&i.forEach(u=>u(s,t)),t.contentQueries){const u=mn();t.contentQueries(1,s,u.directiveStart)}const a=mn();return!o.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(ms(a.index),XD(e[1],a,0,a.directiveStart,a.directiveEnd,t),QD(t,s)),s}(v,this.componentDef,p,h,[NU]),Ic(f,p,null)}finally{Wh()}return new Nz(this.componentType,m,Qu(g,p),p,g)}}class Nz extends class{}{constructor(t,e,r,i,o){super(),this.location=r,this._rootLView=i,this._tNode=o,this.instance=e,this.hostView=this.changeDetectorRef=new _G(i),this.componentType=t}get injector(){return new bu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}const nl=new Map;class Bz extends eo{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new KA(this);const r=Wr(t),i=function(n){return n[BV]||null}(t);i&&ky(i),this._bootstrapComponents=qi(r.bootstrap),this._r3Injector=d1(t,e,[{provide:eo,useValue:this},{provide:ko,useValue:this.componentFactoryResolver}],Ue(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,e=ct.THROW_IF_NOT_FOUND,r=xe.Default){return t===ct||t===eo||t===Ou?this:this._r3Injector.get(t,e,r)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class t_ extends DA{constructor(t){super(),this.moduleType=t,null!==Wr(t)&&function(n){const t=new Set;!function e(r){const i=Wr(r,!0),o=i.id;null!==o&&(function(n,t,e){if(t&&t!==e)throw new Error(`Duplicate module registered for ${n} - ${Ue(t)} vs ${Ue(t.name)}`)}(o,nl.get(o),r),nl.set(o,r));const s=qi(i.imports);for(const a of s)t.has(a)||(t.add(a),e(a))}(n)}(t)}create(t){return new Bz(this.moduleType,t)}}function n_(n,t,e){const r=ir()+n,i=X();return i[r]===Te?Yi(i,r,e?t.call(e):t()):function(n,t){return n[t]}(i,r)}function eM(n,t,e,r,i,o){const s=t+e;return Gn(n,s,i)?Yi(n,s+1,o?r.call(o,i):r(i)):function(n,t){const e=n[t];return e===Te?void 0:e}(n,s+1)}function Jc(n,t){const e=Ze();let r;const i=n+20;e.firstCreatePass?(r=function(n,t){if(t)for(let e=t.length-1;e>=0;e--){const r=t[e];if(n===r.name)return r}throw new ds("302",`The pipe '${n}' could not be found!`)}(t,e.pipeRegistry),e.data[i]=r,r.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(i,r.onDestroy)):r=e.data[i];const o=r.factory||(r.factory=ra(r.type)),s=hs(C);try{const a=Yh(!1),u=o();return Yh(a),function(n,t,e,r){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=r}(e,X(),i,u),u}finally{hs(s)}}function Zc(n,t,e){const r=n+20,i=X(),o=function(n,t){return n[t]}(i,r);return function(n,t){vi.isWrapped(t)&&(t=vi.unwrap(t),n[Ae.lFrame.bindingIndex]=Te);return t}(i,function(n,t){return n[1].data[t].pure}(i,r)?eM(i,ir(),t,o.transform,e,o):o.transform(e))}function r_(n){return t=>{setTimeout(n,void 0,t)}}const ut=class extends be{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,r){var i,o,s;let a=t,u=e||(()=>null),l=r;if(t&&"object"==typeof t){const d=t;a=null===(i=d.next)||void 0===i?void 0:i.bind(d),u=null===(o=d.error)||void 0===o?void 0:o.bind(d),l=null===(s=d.complete)||void 0===s?void 0:s.bind(d)}this.__isAsync&&(u=r_(u),a&&(a=r_(a)),l&&(l=r_(l)));const c=super.subscribe({next:a,error:u,complete:l});return t instanceof st&&t.add(c),c}};function Zz(){return this._results[Lu()]()}class Uf{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Lu(),r=Uf.prototype;r[e]||(r[e]=Zz)}get changes(){return this._changes||(this._changes=new ut)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const r=this;r.dirty=!1;const i=$r(t);(this._changesDetected=!function(n,t,e){if(n.length!==t.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],o=t[r];if(e&&(i=e(i),o=e(o)),o!==i)return!1}return!0}(r._results,i,e))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class i_{constructor(t){this.queryList=t,this.matches=null}clone(){return new i_(this.queryList)}setDirty(){this.queryList.setDirty()}}class o_{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const r=null!==t.contentQueries?t.contentQueries[0]:e.length,i=[];for(let o=0;o<r;o++){const s=e.getByIndex(o);i.push(this.queries[s.indexInDeclarationView].clone())}return new o_(i)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==lM(t,e).matches&&this.queries[e].setDirty()}}class oM{constructor(t,e,r=null){this.predicate=t,this.flags=e,this.read=r}}class s_{constructor(t=[]){this.queries=t}elementStart(t,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let r=0;r<this.length;r++){const i=null!==e?e.length:0,o=this.getByIndex(r).embeddedTView(t,i);o&&(o.indexInDeclarationView=r,null!==e?e.push(o):e=[o])}return null!==e?new s_(e):null}template(t,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class a_{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new a_(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==e;)r=r.parent;return e===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];this.matchTNodeWithReadOption(t,e,n$(e,o)),this.matchTNodeWithReadOption(t,e,Jh(e,t,o,!1,!1))}else r===Xr?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Jh(e,t,r,!1,!1))}matchTNodeWithReadOption(t,e,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===se||i===Fn||i===Xr&&4&e.type)this.addMatch(e.index,-2);else{const o=Jh(e,t,i,!1,!1);null!==o&&this.addMatch(e.index,o)}else this.addMatch(e.index,r)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function n$(n,t){const e=n.localNames;if(null!==e)for(let r=0;r<e.length;r+=2)if(e[r]===t)return e[r+1];return null}function i$(n,t,e,r){return-1===e?function(n,t){return 11&n.type?Qu(n,t):4&n.type?Pf(n,t):null}(t,n):-2===e?function(n,t,e){return e===se?Qu(t,n):e===Xr?Pf(t,n):e===Fn?MA(t,n):void 0}(n,t,r):fc(n,n[1],e,t)}function sM(n,t,e,r){const i=t[19].queries[r];if(null===i.matches){const o=n.data,s=e.matches,a=[];for(let u=0;u<s.length;u+=2){const l=s[u];a.push(l<0?null:i$(t,o[l],s[u+1],e.metadata.read))}i.matches=a}return i.matches}function u_(n,t,e,r){const i=n.queries.getByIndex(e),o=i.matches;if(null!==o){const s=sM(n,t,i,e);for(let a=0;a<o.length;a+=2){const u=o[a];if(u>0)r.push(s[a/2]);else{const l=o[a+1],c=t[-u];for(let d=10;d<c.length;d++){const h=c[d];h[17]===h[3]&&u_(h[1],h,l,r)}if(null!==c[9]){const d=c[9];for(let h=0;h<d.length;h++){const f=d[h];u_(f[1],f,l,r)}}}}}return r}function rn(n){const t=X(),e=Ze(),r=lE();cv(r+1);const i=lM(e,r);if(n.dirty&&rE(t)===(2==(2&i.metadata.flags))){if(null===i.matches)n.reset([]);else{const o=i.crossesNgTemplate?u_(e,t,r,[]):sM(e,t,i,r);n.reset(o,vA),n.notifyOnChanges()}return!0}return!1}function No(n,t,e){const r=Ze();r.firstCreatePass&&(function(n,t,e){null===n.queries&&(n.queries=new s_),n.queries.track(new a_(t,e))}(r,new oM(n,t,e),-1),2==(2&t)&&(r.staticViewQueries=!0)),function(n,t,e){const r=new Uf(4==(4&e));qD(n,t,r,r.destroy),null===t[19]&&(t[19]=new o_),t[19].queries.push(new i_(r))}(r,X(),t)}function lM(n,t){return n.queries.getByIndex(t)}const rd=new re("Application Initializer");let il=(()=>{class n{constructor(e){this.appInits=e,this.resolve=Of,this.reject=Of,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const e=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const o=this.appInits[i]();if(Nc(o))e.push(o);else if(Sf(o)){const s=new Promise((a,u)=>{o.subscribe({complete:a,error:u})});e.push(s)}}Promise.all(e).then(()=>{r()}).catch(i=>{this.reject(i)}),0===e.length&&r(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(R(rd,8))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const id=new re("AppId"),N$={provide:id,useFactory:function(){return`${p_()}${p_()}${p_()}`},deps:[]};function p_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const AM=new re("Platform Initializer"),Yn=new re("Platform ID"),g_=new re("appBootstrapListener");let Gf=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const Po=new re("LocaleId"),MM=new re("DefaultCurrencyCode");class L${constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}const m_=function(n){return new t_(n)},B$=m_,V$=function(n){return Promise.resolve(m_(n))},IM=function(n){const t=m_(n),r=qi(Wr(n).declarations).reduce((i,o)=>{const s=Un(o);return s&&i.push(new XA(s)),i},[]);return new L$(t,r)},H$=IM,U$=function(n){return Promise.resolve(IM(n))};let va=(()=>{class n{constructor(){this.compileModuleSync=B$,this.compileModuleAsync=V$,this.compileModuleAndAllComponentsSync=H$,this.compileModuleAndAllComponentsAsync=U$}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const G$=(()=>Promise.resolve(0))();function v_(n){"undefined"==typeof Zone?G$.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class ve{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ut(!1),this.onMicrotaskEmpty=new ut(!1),this.onStable=new ut(!1),this.onError=new ut(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&e,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function(){let n=ft.requestAnimationFrame,t=ft.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(n){const t=()=>{!function(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(ft,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,__(n),n.isCheckStableRunning=!0,y_(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),__(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,i,o,s,a)=>{try{return TM(n),e.invokeTask(i,o,s,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||n.shouldCoalesceRunChangeDetection)&&t(),RM(n)}},onInvoke:(e,r,i,o,s,a,u)=>{try{return TM(n),e.invoke(i,o,s,a,u)}finally{n.shouldCoalesceRunChangeDetection&&t(),RM(n)}},onHasTask:(e,r,i,o)=>{e.hasTask(i,o),r===i&&("microTask"==o.change?(n._hasPendingMicrotasks=o.microTask,__(n),y_(n)):"macroTask"==o.change&&(n.hasPendingMacrotasks=o.macroTask))},onHandleError:(e,r,i,o)=>(e.handleError(i,o),n.runOutsideAngular(()=>n.onError.emit(o)),!1)})}(i)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ve.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ve.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,i){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+i,t,$$,Of,Of);try{return o.runTask(s,e,r)}finally{o.cancelTask(s)}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}}const $$={};function y_(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function __(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function TM(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function RM(n){n._nesting--,y_(n)}class Y${constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ut,this.onMicrotaskEmpty=new ut,this.onStable=new ut,this.onError=new ut}run(t,e,r){return t.apply(e,r)}runGuarded(t,e,r){return t.apply(e,r)}runOutsideAngular(t){return t()}runTask(t,e,r,i){return t.apply(e,r)}}let b_=(()=>{class n{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ve.assertNotInAngularZone(),v_(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())v_(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,i){let o=-1;r&&r>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:o,updateCb:i})}whenStable(e,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,r,i){return[]}}return n.\u0275fac=function(e){return new(e||n)(R(ve))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),FM=(()=>{class n{constructor(){this._applications=new Map,x_.addToWindow(this)}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return x_.findTestabilityInTree(this,e,r)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();class X${addToWindow(t){}findTestabilityInTree(t,e,r){return null}}let x_=new X$,kM=!0,OM=!1;function w_(){return OM=!0,kM}let Ci;const NM=new re("AllowMultipleToken");class C_{constructor(t,e){this.name=t,this.token=e}}function PM(n,t,e=[]){const r=`Platform: ${t}`,i=new re(r);return(o=[])=>{let s=LM();if(!s||s.injector.get(NM,!1))if(n)n(e.concat(o).concat({provide:i,useValue:!0}));else{const a=e.concat(o).concat({provide:i,useValue:!0},{provide:Tc,useValue:"platform"});!function(n){if(Ci&&!Ci.destroyed&&!Ci.injector.get(NM,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Ci=n.get(BM);const t=n.get(AM,null);t&&t.forEach(e=>e())}(ct.create({providers:a,name:r}))}return function(n){const t=LM();if(!t)throw new Error("No platform exists!");if(!t.injector.get(n,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function LM(){return Ci&&!Ci.destroyed?Ci:null}let BM=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const a=function(n,t){let e;return e="noop"===n?new Y$:("zone.js"===n?void 0:n)||new ve({enableLongStackTrace:w_(),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),e}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),u=[{provide:ve,useValue:a}];return a.run(()=>{const l=ct.create({providers:u,parent:this.injector,name:e.moduleType.name}),c=e.create(l),d=c.injector.get(fi,null);if(!d)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return a.runOutsideAngular(()=>{const h=a.onError.subscribe({next:f=>{d.handleError(f)}});c.onDestroy(()=>{E_(this._modules,c),h.unsubscribe()})}),function(n,t,e){try{const r=e();return Nc(r)?r.catch(i=>{throw t.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw t.runOutsideAngular(()=>n.handleError(r)),r}}(d,a,()=>{const h=c.injector.get(il);return h.runInitializers(),h.donePromise.then(()=>(ky(c.injector.get(Po,If)||If),this._moduleDoBootstrap(c),c))})})}bootstrapModule(e,r=[]){const i=VM({},r);return function(n,t,e){const r=new t_(e);return Promise.resolve(r)}(0,0,e).then(o=>this.bootstrapModuleFactory(o,i))}_moduleDoBootstrap(e){const r=e.injector.get(ya);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${Ue(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(R(ct))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function VM(n,t){return Array.isArray(t)?t.reduce(VM,n):Object.assign(Object.assign({},n),t)}let ya=(()=>{class n{constructor(e,r,i,o,s){this._zone=e,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=o,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new Ke(l=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{l.next(this._stable),l.complete()})}),u=new Ke(l=>{let c;this._zone.runOutsideAngular(()=>{c=this._zone.onStable.subscribe(()=>{ve.assertNotInAngularZone(),v_(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,l.next(!0))})})});const d=this._zone.onUnstable.subscribe(()=>{ve.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{l.next(!1)}))});return()=>{c.unsubscribe(),d.unsubscribe()}});this.isStable=ic(a,u.pipe(n=>Um()(function(n,t){return function(r){let i;i="function"==typeof n?n:function(){return n};const o=Object.create(r,bV);return o.source=r,o.subjectFactory=i,o}}(DV)(n))))}bootstrap(e,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let i;i=e instanceof pA?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(i.componentType);const o=function(n){return n.isBoundToModule}(i)?void 0:this._injector.get(eo),a=i.create(ct.NULL,[],r||i.selector,o),u=a.location.nativeElement,l=a.injector.get(b_,null),c=l&&a.injector.get(FM);return l&&c&&c.registerApplication(u,l),a.onDestroy(()=>{this.detachView(a.hostView),E_(this.components,a),c&&c.unregisterApplication(u)}),this._loadComponent(a),a}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;E_(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(g_,[]).concat(this._bootstrapListeners).forEach(i=>i(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(e){return new(e||n)(R(ve),R(ct),R(fi),R(ko),R(il))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function E_(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}class $f{}class d8{}const h8={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let f8=(()=>{class n{constructor(e,r){this._compiler=e,this._config=r||h8}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[r,i]=e.split("#");return void 0===i&&(i="default"),Co(805)(r).then(o=>o[i]).then(o=>WM(o,r,i)).then(o=>this._compiler.compileModuleAsync(o))}loadFactory(e){let[r,i]=e.split("#"),o="NgFactory";return void 0===i&&(i="default",o=""),Co(805)(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(s=>s[i+o]).then(s=>WM(s,r,i))}}return n.\u0275fac=function(e){return new(e||n)(R(va),R(d8,8))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function WM(n,t,e){if(!n)throw new Error(`Cannot find '${e}' in '${t}'`);return n}const C8=PM(null,"core",[{provide:Yn,useValue:"unknown"},{provide:BM,deps:[ct]},{provide:FM,deps:[]},{provide:Gf,deps:[]}]),M8=[{provide:ya,useClass:ya,deps:[ve,ct,fi,ko,il]},{provide:Fz,deps:[ve],useFactory:function(n){let t=[];return n.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:il,useClass:il,deps:[[new Rn,rd]]},{provide:va,useClass:va,deps:[]},N$,{provide:pa,useFactory:function(){return SG},deps:[]},{provide:Cs,useFactory:function(){return AG},deps:[]},{provide:Po,useFactory:function(n){return ky(n=n||"undefined"!=typeof $localize&&$localize.locale||If),n},deps:[[new Au(Po),new Rn,new Mo]]},{provide:MM,useValue:"USD"}];let T8=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(R(ya))},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:M8}),n})(),np=null;function to(){return np}const ae=new re("DocumentToken");let xa=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({factory:I5,token:n,providedIn:"platform"}),n})();function I5(){return R(fI)}const T5=new re("Location Initialized");let fI=(()=>{class n extends xa{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return to().getBaseHref(this._doc)}onPopState(e){const r=to().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){const r=to().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,r,i){pI()?this._history.pushState(e,r,i):this.location.hash=i}replaceState(e,r,i){pI()?this._history.replaceState(e,r,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({factory:R5,token:n,providedIn:"platform"}),n})();function pI(){return!!window.history.pushState}function R5(){return new fI(R(ae))}function V_(n,t){if(0==n.length)return t;if(0==t.length)return n;let e=0;return n.endsWith("/")&&e++,t.startsWith("/")&&e++,2==e?n+t.substring(1):1==e?n+t:n+"/"+t}function gI(n){const t=n.match(/#|\?|$/),e=t&&t.index||n.length;return n.slice(0,e-("/"===n[e-1]?1:0))+n.slice(e)}function Bo(n){return n&&"?"!==n[0]?"?"+n:n}let al=(()=>{class n{historyGo(e){throw new Error("Not implemented")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({factory:F5,token:n,providedIn:"root"}),n})();function F5(n){const t=R(ae).location;return new mI(R(xa),t&&t.origin||"")}const H_=new re("appBaseHref");let mI=(()=>{class n extends al{constructor(e,r){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return V_(this._baseHref,e)}path(e=!1){const r=this._platformLocation.pathname+Bo(this._platformLocation.search),i=this._platformLocation.hash;return i&&e?`${r}${i}`:r}pushState(e,r,i,o){const s=this.prepareExternalUrl(i+Bo(o));this._platformLocation.pushState(e,r,s)}replaceState(e,r,i,o){const s=this.prepareExternalUrl(i+Bo(o));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var r,i;null===(i=(r=this._platformLocation).historyGo)||void 0===i||i.call(r,e)}}return n.\u0275fac=function(e){return new(e||n)(R(xa),R(H_,8))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),k5=(()=>{class n extends al{constructor(e,r){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(e){const r=V_(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,i,o){let s=this.prepareExternalUrl(i+Bo(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(e,r,s)}replaceState(e,r,i,o){let s=this.prepareExternalUrl(i+Bo(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var r,i;null===(i=(r=this._platformLocation).historyGo)||void 0===i||i.call(r,e)}}return n.\u0275fac=function(e){return new(e||n)(R(xa),R(H_,8))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),ul=(()=>{class n{constructor(e,r){this._subject=new ut,this._urlChangeListeners=[],this._platformStrategy=e;const i=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=gI(vI(i)),this._platformStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Bo(r))}normalize(e){return n.stripTrailingSlash(function(n,t){return n&&t.startsWith(n)?t.substring(n.length):t}(this._baseHref,vI(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,r="",i=null){this._platformStrategy.pushState(i,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Bo(r)),i)}replaceState(e,r="",i=null){this._platformStrategy.replaceState(i,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Bo(r)),i)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var r,i;null===(i=(r=this._platformStrategy).historyGo)||void 0===i||i.call(r,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}))}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(i=>i(e,r))}subscribe(e,r,i){return this._subject.subscribe({next:e,error:r,complete:i})}}return n.\u0275fac=function(e){return new(e||n)(R(al),R(xa))},n.normalizeQueryParams=Bo,n.joinWithSlash=V_,n.stripTrailingSlash=gI,n.\u0275prov=K({factory:O5,token:n,providedIn:"root"}),n})();function O5(){return new ul(R(al),R(xa))}function vI(n){return n.replace(/\/index.html$/,"")}var sn=(()=>((sn=sn||{})[sn.Zero=0]="Zero",sn[sn.One=1]="One",sn[sn.Two=2]="Two",sn[sn.Few=3]="Few",sn[sn.Many=4]="Many",sn[sn.Other=5]="Other",sn))();const j5=function(n){return function(n){const t=function(n){return n.toLowerCase().replace(/_/g,"-")}(n);let e=jS(t);if(e)return e;const r=t.split("-")[0];if(e=jS(r),e)return e;if("en"===r)return iW;throw new Error(`Missing locale data for the locale "${n}".`)}(n)[ie.PluralCase]};class hp{}let v6=(()=>{class n extends hp{constructor(e){super(),this.locale=e}getPluralCategory(e,r){switch(j5(r||this.locale)(e)){case sn.Zero:return"zero";case sn.One:return"one";case sn.Two:return"two";case sn.Few:return"few";case sn.Many:return"many";default:return"other"}}}return n.\u0275fac=function(e){return new(e||n)(R(Po))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function SI(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const r=e.indexOf("="),[i,o]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(i.trim()===t)return decodeURIComponent(o)}return null}let mp=(()=>{class n{constructor(e,r,i){this._ngEl=e,this._differs=r,this._renderer=i,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,r){const[i,o]=e.split(".");null!=(r=null!=r&&o?`${r}${o}`:r)?this._renderer.setStyle(this._ngEl.nativeElement,i,r):this._renderer.removeStyle(this._ngEl.nativeElement,i)}_applyChanges(e){e.forEachRemovedItem(r=>this._setStyle(r.key,null)),e.forEachAddedItem(r=>this._setStyle(r.key,r.currentValue)),e.forEachChangedItem(r=>this._setStyle(r.key,r.currentValue))}}return n.\u0275fac=function(e){return new(e||n)(C(se),C(Cs),C(bi))},n.\u0275dir=$({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),n})();class S6{createSubscription(t,e){return t.subscribe({next:e,error:r=>{throw r}})}dispose(t){t.unsubscribe()}onDestroy(t){t.unsubscribe()}}class A6{createSubscription(t,e){return t.then(e,r=>{throw r})}dispose(t){}onDestroy(t){}}const M6=new A6,I6=new S6;let X_=(()=>{class n{constructor(e){this._ref=e,this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,r=>this._updateLatestValue(e,r))}_selectStrategy(e){if(Nc(e))return M6;if(Z1(e))return I6;throw function(n,t){return Error(`InvalidPipeArgument: '${t}' for pipe '${Ue(n)}'`)}(n,e)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,r){e===this._obj&&(this._latestValue=r,this._ref.markForCheck())}}return n.\u0275fac=function(e){return new(e||n)(C(Zi,16))},n.\u0275pipe=gr({name:"async",type:n,pure:!1}),n})(),ll=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[{provide:hp,useClass:v6}]}),n})();const FI="browser";function wa(n){return n===FI}function cl(n){return"server"===n}let kI=(()=>{class n{}return n.\u0275prov=K({token:n,providedIn:"root",factory:()=>new K6(R(ae),window)}),n})();class K6{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const e=function(n,t){const e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const o=i.shadowRoot;if(o){const s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}i=r.nextNode()}}return null}(this.document,t);e&&(this.scrollToElement(e),this.attemptFocus(e))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),r=e.left+this.window.pageXOffset,i=e.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(r-o[0],i-o[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=OI(this.window.history)||OI(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function OI(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class NI{}class Z_ extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(n){np||(np=n)}(new Z_)}onAndCancel(t,e,r){return t.addEventListener(e,r,!1),()=>{t.removeEventListener(e,r,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=(dd=dd||document.querySelector("base"),dd?dd.getAttribute("href"):null);return null==e?null:function(n){vp=vp||document.createElement("a"),vp.setAttribute("href",n);const t=vp.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){dd=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return SI(document.cookie,t)}}let vp,dd=null;const PI=new re("TRANSITION_ID"),eq=[{provide:rd,useFactory:function(n,t,e){return()=>{e.get(il).donePromise.then(()=>{const r=to(),i=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let o=0;o<i.length;o++)r.remove(i[o])})}},deps:[PI,ae,ct],multi:!0}];class eb{static init(){!function(n){x_=n}(new eb)}addToWindow(t){ft.getAngularTestability=(r,i=!0)=>{const o=t.findTestabilityInTree(r,i);if(null==o)throw new Error("Could not find testability for element.");return o},ft.getAllAngularTestabilities=()=>t.getAllTestabilities(),ft.getAllAngularRootElements=()=>t.getAllRootElements(),ft.frameworkStabilizers||(ft.frameworkStabilizers=[]),ft.frameworkStabilizers.push(r=>{const i=ft.getAllAngularTestabilities();let o=i.length,s=!1;const a=function(u){s=s||u,o--,0==o&&r(s)};i.forEach(function(u){u.whenStable(a)})})}findTestabilityInTree(t,e,r){if(null==e)return null;const i=t.getTestability(e);return null!=i?i:r?to().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}}let tq=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const hd=new re("EventManagerPlugins");let _p=(()=>{class n{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(i=>i.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,r,i){return this._findPluginFor(r).addEventListener(e,r,i)}addGlobalEventListener(e,r,i){return this._findPluginFor(r).addGlobalEventListener(e,r,i)}getZone(){return this._zone}_findPluginFor(e){const r=this._eventNameToPlugin.get(e);if(r)return r;const i=this._plugins;for(let o=0;o<i.length;o++){const s=i[o];if(s.supports(e))return this._eventNameToPlugin.set(e,s),s}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(R(hd),R(ve))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();class tb{constructor(t){this._doc=t}addGlobalEventListener(t,e,r){const i=to().getGlobalEventTarget(this._doc,t);if(!i)throw new Error(`Unsupported event target ${i} for event ${e}`);return this.addEventListener(i,e,r)}}let BI=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const r=new Set;e.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),fd=(()=>{class n extends BI{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,r,i){e.forEach(o=>{const s=this._doc.createElement("style");s.textContent=o,i.push(r.appendChild(s))})}addHost(e){const r=[];this._addStylesToHost(this._stylesSet,e,r),this._hostNodes.set(e,r)}removeHost(e){const r=this._hostNodes.get(e);r&&r.forEach(VI),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(e,i,r)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(VI))}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function VI(n){to().remove(n)}const nb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},rb=/%COMP%/g;function bp(n,t,e){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?bp(n,i,e):(i=i.replace(rb,n),e.push(i))}return e}function jI(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let xp=(()=>{class n{constructor(e,r,i){this.eventManager=e,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new ib(e)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;switch(r.encapsulation){case Zt.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new mq(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(e),i}case 1:case Zt.ShadowDom:return new vq(this.eventManager,this.sharedStylesHost,e,r);default:if(!this.rendererByCompId.has(r.id)){const i=bp(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(R(_p),R(fd),R(id))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();class ib{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(nb[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,r){t&&t.insertBefore(e,r)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return e||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,i){if(i){e=i+":"+e;const o=nb[i];o?t.setAttributeNS(o,e,r):t.setAttribute(e,r)}else t.setAttribute(e,r)}removeAttribute(t,e,r){if(r){const i=nb[r];i?t.removeAttributeNS(i,e):t.removeAttribute(`${r}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,r,i){i&(Ir.DashCase|Ir.Important)?t.style.setProperty(e,r,i&Ir.Important?"important":""):t.style[e]=r}removeStyle(t,e,r){r&Ir.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,r){t[e]=r}setValue(t,e){t.nodeValue=e}listen(t,e,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,jI(r)):this.eventManager.addEventListener(t,e,jI(r))}}class mq extends ib{constructor(t,e,r,i){super(t),this.component=r;const o=bp(i+"-"+r.id,r.styles,[]);e.addStyles(o),this.contentAttr=function(n){return"_ngcontent-%COMP%".replace(rb,n)}(i+"-"+r.id),this.hostAttr=function(n){return"_nghost-%COMP%".replace(rb,n)}(i+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const r=super.createElement(t,e);return super.setAttribute(r,this.contentAttr,""),r}}class vq extends ib{constructor(t,e,r,i){super(t),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=bp(i.id,i.styles,[]);for(let s=0;s<o.length;s++){const a=document.createElement("style");a.textContent=o[s],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let yq=(()=>{class n extends tb{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,i){return e.addEventListener(r,i,!1),()=>this.removeEventListener(e,r,i)}removeEventListener(e,r,i){return e.removeEventListener(r,i)}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const zI=["alt","control","meta","shift"],Dq={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},$I={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Sq={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let Aq=(()=>{class n extends tb{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,r,i){const o=n.parseEventName(r),s=n.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>to().onAndCancel(e,o.domEventName,s))}static parseEventName(e){const r=e.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const o=n._normalizeKey(r.pop());let s="";if(zI.forEach(u=>{const l=r.indexOf(u);l>-1&&(r.splice(l,1),s+=u+".")}),s+=o,0!=r.length||0===o.length)return null;const a={};return a.domEventName=i,a.fullKey=s,a}static getEventFullKey(e){let r="",i=function(n){let t=n.key;if(null==t){if(t=n.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===n.location&&$I.hasOwnProperty(t)&&(t=$I[t]))}return Dq[t]||t}(e);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),zI.forEach(o=>{o!=i&&Sq[o](e)&&(r+=o+".")}),r+=i,r}static eventCallback(e,r,i){return o=>{n.getEventFullKey(o)===e&&i.runGuarded(()=>r(o))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),Ca=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({factory:function(){return R(sb)},token:n,providedIn:"root"}),n})(),sb=(()=>{class n extends Ca{constructor(e){super(),this._doc=e}sanitize(e,r){if(null==r)return null;switch(e){case ot.NONE:return r;case ot.HTML:return zi(r,"HTML")?Tr(r):vD(this._doc,String(r)).toString();case ot.STYLE:return zi(r,"Style")?Tr(r):r;case ot.SCRIPT:if(zi(r,"Script"))return Tr(r);throw new Error("unsafe value used in a script context");case ot.URL:return lD(r),zi(r,"URL")?Tr(r):Dc(String(r));case ot.RESOURCE_URL:if(zi(r,"ResourceURL"))return Tr(r);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return function(n){return new k4(n)}(e)}bypassSecurityTrustStyle(e){return function(n){return new O4(n)}(e)}bypassSecurityTrustScript(e){return function(n){return new N4(n)}(e)}bypassSecurityTrustUrl(e){return function(n){return new P4(n)}(e)}bypassSecurityTrustResourceUrl(e){return function(n){return new L4(n)}(e)}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({factory:function(){return function(n){return new sb(n.get(ae))}(R(Ou))},token:n,providedIn:"root"}),n})();const kq=[{provide:Yn,useValue:FI},{provide:AM,useValue:function(){Z_.makeCurrent(),eb.init()},multi:!0},{provide:ae,useFactory:function(){return function(n){ev=n}(document),document},deps:[]}],Nq=PM(C8,"browser",kq),Pq=[[],{provide:Tc,useValue:"root"},{provide:fi,useFactory:function(){return new fi},deps:[]},{provide:hd,useClass:yq,multi:!0,deps:[ae,ve,Yn]},{provide:hd,useClass:Aq,multi:!0,deps:[ae]},[],{provide:xp,useClass:xp,deps:[_p,fd,id]},{provide:fa,useExisting:xp},{provide:BI,useExisting:fd},{provide:fd,useClass:fd,deps:[ae]},{provide:b_,useClass:b_,deps:[ve]},{provide:_p,useClass:_p,deps:[hd,ve]},{provide:NI,useClass:tq,deps:[]},[]];let ab=(()=>{class n{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:n,providers:[{provide:id,useValue:e.appId},{provide:PI,useExisting:id},eq]}}}return n.\u0275fac=function(e){return new(e||n)(R(n,12))},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:Pq,imports:[ll,T8]}),n})();"undefined"!=typeof window&&window;class cr extends be{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Js;return this._value}next(t){super.next(this._value=t)}}function _e(...n){let t=n[n.length-1];return au(t)?(n.pop(),Vm(n,t)):Hm(n)}const YI=(()=>{function n(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return n.prototype=Object.create(Error.prototype),n})(),Ea=new Ke(n=>n.complete());function wp(n){return n?function(n){return new Ke(t=>n.schedule(()=>t.complete()))}(n):Ea}function Mi(n){return t=>0===n?wp():t.lift(new Jq(n))}class Jq{constructor(t){if(this.total=t,this.total<0)throw new YI}call(t,e){return e.subscribe(new Zq(t,this.total))}}class Zq extends vt{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))}}function Rt(n){return t=>t.lift(new iK(n))}class iK{constructor(t){this.notifier=t}call(t,e){const r=new oK(t),i=cu(this.notifier,new uu(r));return i&&!r.seenValue?(r.add(i),e.subscribe(r)):r}}class oK extends lu{constructor(t){super(t),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function Cp(n){return Array.isArray(n)?n:[n]}function un(n){return null==n?"":"string"==typeof n?n:`${n}px`}let cb;try{cb="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(n){cb=!1}let Sa,mt=(()=>{class n{constructor(e){this._platformId=e,this.isBrowser=this._platformId?wa(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!cb)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(e){return new(e||n)(R(Yn))},n.\u0275prov=K({factory:function(){return new n(R(Yn))},token:n,providedIn:"root"}),n})(),pd=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({}),n})();function eT(){if(null==Sa){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Sa=!1,Sa;if("scrollBehavior"in document.documentElement.style)Sa=!0;else{const n=Element.prototype.scrollTo;Sa=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return Sa}function Aa(n){return n.composedPath?n.composedPath()[0]:n.target}function hb(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}class dK extends st{constructor(t,e){super()}schedule(t,e=0){return this}}class Dp extends dK{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this}requestAsyncId(t,e,r=0){return setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,e,r=0){if(null!==r&&this.delay===r&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(t,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i,r=!1;try{this.work(t)}catch(o){r=!0,i=!!o&&o||new Error(o)}if(r)return this.unsubscribe(),i}_unsubscribe(){const t=this.id,e=this.scheduler,r=e.actions,i=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&r.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let tT=(()=>{class n{constructor(e,r=n.now){this.SchedulerAction=e,this.now=r}schedule(e,r=0,i){return new this.SchedulerAction(this,e).schedule(i,r)}}return n.now=()=>Date.now(),n})();class Ii extends tT{constructor(t,e=tT.now){super(t,()=>Ii.delegate&&Ii.delegate!==this?Ii.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,r){return Ii.delegate&&Ii.delegate!==this?Ii.delegate.schedule(t,e,r):super.schedule(t,e,r)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let r;this.active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,r){for(;t=e.shift();)t.unsubscribe();throw r}}}const yd=new Ii(Dp);let fb=(()=>{class n{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({factory:function(){return new n},token:n,providedIn:"root"}),n})(),iT=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[fb]}),n})();"undefined"!=typeof Element&&Element;const xT="cdk-high-contrast-black-on-white",wT="cdk-high-contrast-white-on-black",gb="cdk-high-contrast-active";let CT=(()=>{class n{constructor(e,r){this._platform=e,this._document=r}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const r=this._document.defaultView||window,i=r&&r.getComputedStyle?r.getComputedStyle(e):null,o=(i&&i.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(e),o){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(gb),e.remove(xT),e.remove(wT),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?(e.add(gb),e.add(xT)):2===r&&(e.add(gb),e.add(wT))}}}return n.\u0275fac=function(e){return new(e||n)(R(mt),R(ae))},n.\u0275prov=K({factory:function(){return new n(R(mt),R(ae))},token:n,providedIn:"root"}),n})(),BK=(()=>{class n{constructor(e){e._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(e){return new(e||n)(R(CT))},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[pd,iT]]}),n})();const ET=new re("cdk-dir-doc",{providedIn:"root",factory:function(){return _c(ae)}});let ro=(()=>{class n{constructor(e){if(this.value="ltr",this.change=new ut,e){const i=e.documentElement?e.documentElement.dir:null,o=(e.body?e.body.dir:null)||i;this.value="ltr"===o||"rtl"===o?o:"ltr"}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(e){return new(e||n)(R(ET,8))},n.\u0275prov=K({factory:function(){return new n(R(ET,8))},token:n,providedIn:"root"}),n})(),fl=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({}),n})();const DT=new Oo("12.2.13");class ST{}const Uo="*";function AT(n,t=null){return{type:2,steps:n,options:t}}function Fr(n){return{type:6,styles:n,offset:null}}function MT(n){Promise.resolve(null).then(n)}class pl{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){MT(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(r=>r()),e.length=0}}class IT{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,r=0,i=0;const o=this.players.length;0==o?MT(()=>this._onFinish()):this.players.forEach(s=>{s.onDone(()=>{++e==o&&this._onFinish()}),s.onDestroy(()=>{++r==o&&this._onDestroy()}),s.onStart(()=>{++i==o&&this._onStart()})}),this.totalTime=this.players.reduce((s,a)=>Math.max(s,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(r=>{const i=r.totalTime?Math.min(1,e/r.totalTime):1;r.setPosition(i)})}getPosition(){const t=this.players.reduce((e,r)=>null===e||r.totalTime>e.totalTime?r:e,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(r=>r()),e.length=0}}function TT(){return"undefined"!=typeof window&&void 0!==window.document}function yb(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function As(n){switch(n.length){case 0:return new pl;case 1:return n[0];default:return new IT(n)}}function RT(n,t,e,r,i={},o={}){const s=[],a=[];let u=-1,l=null;if(r.forEach(c=>{const d=c.offset,h=d==u,f=h&&l||{};Object.keys(c).forEach(p=>{let m=p,g=c[p];if("offset"!==p)switch(m=t.normalizePropertyName(m,s),g){case"!":g=i[p];break;case Uo:g=o[p];break;default:g=t.normalizeStyleValue(p,m,g,s)}f[m]=g}),h||a.push(f),l=f,u=d}),s.length){const c="\n - ";throw new Error(`Unable to animate due to the following errors:${c}${s.join(c)}`)}return a}function _b(n,t,e,r){switch(t){case"start":n.onStart(()=>r(e&&bb(e,"start",n)));break;case"done":n.onDone(()=>r(e&&bb(e,"done",n)));break;case"destroy":n.onDestroy(()=>r(e&&bb(e,"destroy",n)))}}function bb(n,t,e){const r=e.totalTime,o=xb(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,null==r?n.totalTime:r,!!e.disabled),s=n._data;return null!=s&&(o._data=s),o}function xb(n,t,e,r,i="",o=0,s){return{element:n,triggerName:t,fromState:e,toState:r,phaseName:i,totalTime:o,disabled:!!s}}function kr(n,t,e){let r;return n instanceof Map?(r=n.get(t),r||n.set(t,r=e)):(r=n[t],r||(r=n[t]=e)),r}function FT(n){const t=n.indexOf(":");return[n.substring(1,t),n.substr(t+1)]}let wb=(n,t)=>!1,Cb=(n,t)=>!1,kT=(n,t,e)=>[];const OT=yb();(OT||"undefined"!=typeof Element)&&(wb=TT()?(n,t)=>{for(;t&&t!==document.documentElement;){if(t===n)return!0;t=t.parentNode||t.host}return!1}:(n,t)=>n.contains(t),Cb=(()=>{if(OT||Element.prototype.matches)return(n,t)=>n.matches(t);{const n=Element.prototype,t=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector;return t?(e,r)=>t.apply(e,[r]):Cb}})(),kT=(n,t,e)=>{let r=[];if(e){const i=n.querySelectorAll(t);for(let o=0;o<i.length;o++)r.push(i[o])}else{const i=n.querySelector(t);i&&r.push(i)}return r});let Ma=null,NT=!1;function Eb(n){Ma||(Ma=("undefined"!=typeof document?document.body:null)||{},NT=!!Ma.style&&"WebkitAppearance"in Ma.style);let t=!0;return Ma.style&&!function(n){return"ebkit"==n.substring(1,6)}(n)&&(t=n in Ma.style,!t&&NT&&(t="Webkit"+n.charAt(0).toUpperCase()+n.substr(1)in Ma.style)),t}const Db=Cb,Sb=wb,Ab=kT;function PT(n){const t={};return Object.keys(n).forEach(e=>{const r=e.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=n[e]}),t}let LT=(()=>{class n{validateStyleProperty(e){return Eb(e)}matchesElement(e,r){return Db(e,r)}containsElement(e,r){return Sb(e,r)}query(e,r,i){return Ab(e,r,i)}computeStyle(e,r,i){return i||""}animate(e,r,i,o,s,a=[],u){return new pl(i,o)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),Mb=(()=>{class n{}return n.NOOP=new LT,n})();const Ib="ng-enter",Ip="ng-leave",Tp="ng-trigger",Rp=".ng-trigger",VT="ng-animating",Tb=".ng-animating";function Ia(n){if("number"==typeof n)return n;const t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:Rb(parseFloat(t[1]),t[2])}function Rb(n,t){return"s"===t?1e3*n:n}function Fp(n,t,e){return n.hasOwnProperty("duration")?n:function(n,t,e){let i,o=0,s="";if("string"==typeof n){const a=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return t.push(`The provided timing value "${n}" is invalid.`),{duration:0,delay:0,easing:""};i=Rb(parseFloat(a[1]),a[2]);const u=a[3];null!=u&&(o=Rb(parseFloat(u),a[4]));const l=a[5];l&&(s=l)}else i=n;if(!e){let a=!1,u=t.length;i<0&&(t.push("Duration values below 0 are not allowed for this animation step."),a=!0),o<0&&(t.push("Delay values below 0 are not allowed for this animation step."),a=!0),a&&t.splice(u,0,`The provided timing value "${n}" is invalid.`)}return{duration:i,delay:o,easing:s}}(n,t,e)}function gl(n,t={}){return Object.keys(n).forEach(e=>{t[e]=n[e]}),t}function Ms(n,t,e={}){if(t)for(let r in n)e[r]=n[r];else gl(n,e);return e}function UT(n,t,e){return e?t+":"+e+";":""}function jT(n){let t="";for(let e=0;e<n.style.length;e++){const r=n.style.item(e);t+=UT(0,r,n.style.getPropertyValue(r))}for(const e in n.style)n.style.hasOwnProperty(e)&&!e.startsWith("_")&&(t+=UT(0,YK(e),n.style[e]));n.setAttribute("style",t)}function io(n,t,e){n.style&&(Object.keys(t).forEach(r=>{const i=kb(r);e&&!e.hasOwnProperty(r)&&(e[r]=n.style[i]),n.style[i]=t[r]}),yb()&&jT(n))}function Ta(n,t){n.style&&(Object.keys(t).forEach(e=>{const r=kb(e);n.style[r]=""}),yb()&&jT(n))}function Cd(n){return Array.isArray(n)?1==n.length?n[0]:AT(n):n}const Fb=new RegExp("{{\\s*(.+?)\\s*}}","g");function WT(n){let t=[];if("string"==typeof n){let e;for(;e=Fb.exec(n);)t.push(e[1]);Fb.lastIndex=0}return t}function kp(n,t,e){const r=n.toString(),i=r.replace(Fb,(o,s)=>{let a=t[s];return t.hasOwnProperty(s)||(e.push(`Please provide a value for the animation param ${s}`),a=""),a.toString()});return i==r?n:i}function Op(n){const t=[];let e=n.next();for(;!e.done;)t.push(e.value),e=n.next();return t}const KK=/-+([a-z0-9])/g;function kb(n){return n.replace(KK,(...t)=>t[1].toUpperCase())}function YK(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function GT(n,t){return 0===n||0===t}function zT(n,t,e){const r=Object.keys(e);if(r.length&&t.length){let o=t[0],s=[];if(r.forEach(a=>{o.hasOwnProperty(a)||s.push(a),o[a]=e[a]}),s.length)for(var i=1;i<t.length;i++){let a=t[i];s.forEach(function(u){a[u]=Ob(n,u)})}}return t}function Or(n,t,e){switch(t.type){case 7:return n.visitTrigger(t,e);case 0:return n.visitState(t,e);case 1:return n.visitTransition(t,e);case 2:return n.visitSequence(t,e);case 3:return n.visitGroup(t,e);case 4:return n.visitAnimate(t,e);case 5:return n.visitKeyframes(t,e);case 6:return n.visitStyle(t,e);case 8:return n.visitReference(t,e);case 9:return n.visitAnimateChild(t,e);case 10:return n.visitAnimateRef(t,e);case 11:return n.visitQuery(t,e);case 12:return n.visitStagger(t,e);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function Ob(n,t){return window.getComputedStyle(n)[t]}function XK(n,t){const e=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(r=>function(n,t,e){if(":"==n[0]){const u=function(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,r)=>parseFloat(r)>parseFloat(e);case":decrement":return(e,r)=>parseFloat(r)<parseFloat(e);default:return t.push(`The transition alias value "${n}" is not supported`),"* => *"}}(n,e);if("function"==typeof u)return void t.push(u);n=u}const r=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return e.push(`The provided transition expression "${n}" is not supported`),t;const i=r[1],o=r[2],s=r[3];t.push($T(i,s));"<"==o[0]&&!("*"==i&&"*"==s)&&t.push($T(s,i))}(r,e,t)):e.push(n),e}const Pp=new Set(["true","1"]),Lp=new Set(["false","0"]);function $T(n,t){const e=Pp.has(n)||Lp.has(n),r=Pp.has(t)||Lp.has(t);return(i,o)=>{let s="*"==n||n==i,a="*"==t||t==o;return!s&&e&&"boolean"==typeof i&&(s=i?Pp.has(n):Lp.has(n)),!a&&r&&"boolean"==typeof o&&(a=o?Pp.has(t):Lp.has(t)),s&&a}}const ZK=new RegExp("s*:selfs*,?","g");function Nb(n,t,e){return new e7(n).build(t,e)}class e7{constructor(t){this._driver=t}build(t,e){const r=new r7(e);return this._resetContextStyleTimingState(r),Or(this,Cd(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles={},t.collectedStyles[""]={},t.currentTime=0}visitTrigger(t,e){let r=e.queryCount=0,i=e.depCount=0;const o=[],s=[];return"@"==t.name.charAt(0)&&e.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),t.definitions.forEach(a=>{if(this._resetContextStyleTimingState(e),0==a.type){const u=a,l=u.name;l.toString().split(/\s*,\s*/).forEach(c=>{u.name=c,o.push(this.visitState(u,e))}),u.name=l}else if(1==a.type){const u=this.visitTransition(a,e);r+=u.queryCount,i+=u.depCount,s.push(u)}else e.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:t.name,states:o,transitions:s,queryCount:r,depCount:i,options:null}}visitState(t,e){const r=this.visitStyle(t.styles,e),i=t.options&&t.options.params||null;if(r.containsDynamicStyles){const o=new Set,s=i||{};if(r.styles.forEach(a=>{if(Bp(a)){const u=a;Object.keys(u).forEach(l=>{WT(u[l]).forEach(c=>{s.hasOwnProperty(c)||o.add(c)})})}}),o.size){const a=Op(o.values());e.errors.push(`state("${t.name}", ...) must define default values for all the following style substitutions: ${a.join(", ")}`)}}return{type:0,name:t.name,style:r,options:i?{params:i}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const r=Or(this,Cd(t.animation),e);return{type:1,matchers:XK(t.expr,e.errors),animation:r,queryCount:e.queryCount,depCount:e.depCount,options:Ra(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(r=>Or(this,r,e)),options:Ra(t.options)}}visitGroup(t,e){const r=e.currentTime;let i=0;const o=t.steps.map(s=>{e.currentTime=r;const a=Or(this,s,e);return i=Math.max(i,e.currentTime),a});return e.currentTime=i,{type:3,steps:o,options:Ra(t.options)}}visitAnimate(t,e){const r=function(n,t){let e=null;if(n.hasOwnProperty("duration"))e=n;else if("number"==typeof n)return Pb(Fp(n,t).duration,0,"");const r=n;if(r.split(/\s+/).some(o=>"{"==o.charAt(0)&&"{"==o.charAt(1))){const o=Pb(0,0,"");return o.dynamic=!0,o.strValue=r,o}return e=e||Fp(r,t),Pb(e.duration,e.delay,e.easing)}(t.timings,e.errors);e.currentAnimateTimings=r;let i,o=t.styles?t.styles:Fr({});if(5==o.type)i=this.visitKeyframes(o,e);else{let s=t.styles,a=!1;if(!s){a=!0;const l={};r.easing&&(l.easing=r.easing),s=Fr(l)}e.currentTime+=r.duration+r.delay;const u=this.visitStyle(s,e);u.isEmptyStep=a,i=u}return e.currentAnimateTimings=null,{type:4,timings:r,style:i,options:null}}visitStyle(t,e){const r=this._makeStyleAst(t,e);return this._validateStyleAst(r,e),r}_makeStyleAst(t,e){const r=[];Array.isArray(t.styles)?t.styles.forEach(s=>{"string"==typeof s?s==Uo?r.push(s):e.errors.push(`The provided style string value ${s} is not allowed.`):r.push(s)}):r.push(t.styles);let i=!1,o=null;return r.forEach(s=>{if(Bp(s)){const a=s,u=a.easing;if(u&&(o=u,delete a.easing),!i)for(let l in a)if(a[l].toString().indexOf("{{")>=0){i=!0;break}}}),{type:6,styles:r,easing:o,offset:t.offset,containsDynamicStyles:i,options:null}}_validateStyleAst(t,e){const r=e.currentAnimateTimings;let i=e.currentTime,o=e.currentTime;r&&o>0&&(o-=r.duration+r.delay),t.styles.forEach(s=>{"string"!=typeof s&&Object.keys(s).forEach(a=>{if(!this._driver.validateStyleProperty(a))return void e.errors.push(`The provided animation property "${a}" is not a supported CSS property for animations`);const u=e.collectedStyles[e.currentQuerySelector],l=u[a];let c=!0;l&&(o!=i&&o>=l.startTime&&i<=l.endTime&&(e.errors.push(`The CSS property "${a}" that exists between the times of "${l.startTime}ms" and "${l.endTime}ms" is also being animated in a parallel animation between the times of "${o}ms" and "${i}ms"`),c=!1),o=l.startTime),c&&(u[a]={startTime:o,endTime:i}),e.options&&function(n,t,e){const r=t.params||{},i=WT(n);i.length&&i.forEach(o=>{r.hasOwnProperty(o)||e.push(`Unable to resolve the local animation param ${o} in the given list of values`)})}(s[a],e.options,e.errors)})})}visitKeyframes(t,e){const r={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push("keyframes() must be placed inside of a call to animate()"),r;let o=0;const s=[];let a=!1,u=!1,l=0;const c=t.steps.map(v=>{const y=this._makeStyleAst(v,e);let b=null!=y.offset?y.offset:function(n){if("string"==typeof n)return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(Bp(e)&&e.hasOwnProperty("offset")){const r=e;t=parseFloat(r.offset),delete r.offset}});else if(Bp(n)&&n.hasOwnProperty("offset")){const e=n;t=parseFloat(e.offset),delete e.offset}return t}(y.styles),_=0;return null!=b&&(o++,_=y.offset=b),u=u||_<0||_>1,a=a||_<l,l=_,s.push(_),y});u&&e.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),a&&e.errors.push("Please ensure that all keyframe offsets are in order");const d=t.steps.length;let h=0;o>0&&o<d?e.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==o&&(h=1/(d-1));const f=d-1,p=e.currentTime,m=e.currentAnimateTimings,g=m.duration;return c.forEach((v,y)=>{const b=h>0?y==f?1:h*y:s[y],_=b*g;e.currentTime=p+m.delay+_,m.duration=_,this._validateStyleAst(v,e),v.offset=b,r.styles.push(v)}),r}visitReference(t,e){return{type:8,animation:Or(this,Cd(t.animation),e),options:Ra(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:Ra(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:Ra(t.options)}}visitQuery(t,e){const r=e.currentQuerySelector,i=t.options||{};e.queryCount++,e.currentQuery=t;const[o,s]=function(n){const t=!!n.split(/\s*,\s*/).find(e=>":self"==e);return t&&(n=n.replace(ZK,"")),n=n.replace(/@\*/g,Rp).replace(/@\w+/g,e=>Rp+"-"+e.substr(1)).replace(/:animating/g,Tb),[n,t]}(t.selector);e.currentQuerySelector=r.length?r+" "+o:o,kr(e.collectedStyles,e.currentQuerySelector,{});const a=Or(this,Cd(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=r,{type:11,selector:o,limit:i.limit||0,optional:!!i.optional,includeSelf:s,animation:a,originalSelector:t.selector,options:Ra(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push("stagger() can only be used inside of query()");const r="full"===t.timings?{duration:0,delay:0,easing:"full"}:Fp(t.timings,e.errors,!0);return{type:12,animation:Or(this,Cd(t.animation),e),timings:r,options:null}}}class r7{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function Bp(n){return!Array.isArray(n)&&"object"==typeof n}function Ra(n){return n?(n=gl(n)).params&&(n.params=function(n){return n?gl(n):null}(n.params)):n={},n}function Pb(n,t,e){return{duration:n,delay:t,easing:e}}function Lb(n,t,e,r,i,o,s=null,a=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:r,duration:i,delay:o,totalTime:i+o,easing:s,subTimeline:a}}class Vp{constructor(){this._map=new Map}consume(t){let e=this._map.get(t);return e?this._map.delete(t):e=[],e}append(t,e){let r=this._map.get(t);r||this._map.set(t,r=[]),r.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const u7=new RegExp(":enter","g"),c7=new RegExp(":leave","g");function Bb(n,t,e,r,i,o={},s={},a,u,l=[]){return(new d7).buildKeyframes(n,t,e,r,i,o,s,a,u,l)}class d7{buildKeyframes(t,e,r,i,o,s,a,u,l,c=[]){l=l||new Vp;const d=new Vb(t,e,l,i,o,c,[]);d.options=u,d.currentTimeline.setStyles([s],null,d.errors,u),Or(this,r,d);const h=d.timelines.filter(f=>f.containsAnimation());if(h.length&&Object.keys(a).length){const f=h[h.length-1];f.allowOnlyTimelineStyles()||f.setStyles([a],null,d.errors,u)}return h.length?h.map(f=>f.buildKeyframes()):[Lb(e,[],[],[],0,0,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const r=e.subInstructions.consume(e.element);if(r){const i=e.createSubContext(t.options),o=e.currentTimeline.currentTime,s=this._visitSubInstructions(r,i,i.options);o!=s&&e.transformIntoNewTimeline(s)}e.previousNode=t}visitAnimateRef(t,e){const r=e.createSubContext(t.options);r.transformIntoNewTimeline(),this.visitReference(t.animation,r),e.transformIntoNewTimeline(r.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,r){let o=e.currentTimeline.currentTime;const s=null!=r.duration?Ia(r.duration):null,a=null!=r.delay?Ia(r.delay):null;return 0!==s&&t.forEach(u=>{const l=e.appendInstructionToTimeline(u,s,a);o=Math.max(o,l.duration+l.delay)}),o}visitReference(t,e){e.updateOptions(t.options,!0),Or(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const r=e.subContextCount;let i=e;const o=t.options;if(o&&(o.params||o.delay)&&(i=e.createSubContext(o),i.transformIntoNewTimeline(),null!=o.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=Hp);const s=Ia(o.delay);i.delayNextStep(s)}t.steps.length&&(t.steps.forEach(s=>Or(this,s,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const r=[];let i=e.currentTimeline.currentTime;const o=t.options&&t.options.delay?Ia(t.options.delay):0;t.steps.forEach(s=>{const a=e.createSubContext(t.options);o&&a.delayNextStep(o),Or(this,s,a),i=Math.max(i,a.currentTimeline.currentTime),r.push(a.currentTimeline)}),r.forEach(s=>e.currentTimeline.mergeTimelineCollectedStyles(s)),e.transformIntoNewTimeline(i),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const r=t.strValue;return Fp(e.params?kp(r,e.params,e.errors):r,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const r=e.currentAnimateTimings=this._visitTiming(t.timings,e),i=e.currentTimeline;r.delay&&(e.incrementTime(r.delay),i.snapshotCurrentStyles());const o=t.style;5==o.type?this.visitKeyframes(o,e):(e.incrementTime(r.duration),this.visitStyle(o,e),i.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const r=e.currentTimeline,i=e.currentAnimateTimings;!i&&r.getCurrentStyleProperties().length&&r.forwardFrame();const o=i&&i.easing||t.easing;t.isEmptyStep?r.applyEmptyStep(o):r.setStyles(t.styles,o,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const r=e.currentAnimateTimings,i=e.currentTimeline.duration,o=r.duration,a=e.createSubContext().currentTimeline;a.easing=r.easing,t.styles.forEach(u=>{a.forwardTime((u.offset||0)*o),a.setStyles(u.styles,u.easing,e.errors,e.options),a.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(a),e.transformIntoNewTimeline(i+o),e.previousNode=t}visitQuery(t,e){const r=e.currentTimeline.currentTime,i=t.options||{},o=i.delay?Ia(i.delay):0;o&&(6===e.previousNode.type||0==r&&e.currentTimeline.getCurrentStyleProperties().length)&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=Hp);let s=r;const a=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!i.optional,e.errors);e.currentQueryTotal=a.length;let u=null;a.forEach((l,c)=>{e.currentQueryIndex=c;const d=e.createSubContext(t.options,l);o&&d.delayNextStep(o),l===e.element&&(u=d.currentTimeline),Or(this,t.animation,d),d.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,d.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(s),u&&(e.currentTimeline.mergeTimelineCollectedStyles(u),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const r=e.parentContext,i=e.currentTimeline,o=t.timings,s=Math.abs(o.duration),a=s*(e.currentQueryTotal-1);let u=s*e.currentQueryIndex;switch(o.duration<0?"reverse":o.easing){case"reverse":u=a-u;break;case"full":u=r.currentStaggerTime}const c=e.currentTimeline;u&&c.delayNextStep(u);const d=c.currentTime;Or(this,t.animation,e),e.previousNode=t,r.currentStaggerTime=i.currentTime-d+(i.startTime-r.currentTimeline.startTime)}}const Hp={};class Vb{constructor(t,e,r,i,o,s,a,u){this._driver=t,this.element=e,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=o,this.errors=s,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Hp,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new Up(this._driver,e,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const r=t;let i=this.options;null!=r.duration&&(i.duration=Ia(r.duration)),null!=r.delay&&(i.delay=Ia(r.delay));const o=r.params;if(o){let s=i.params;s||(s=this.options.params={}),Object.keys(o).forEach(a=>{(!e||!s.hasOwnProperty(a))&&(s[a]=kp(o[a],s,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const r=t.params={};Object.keys(e).forEach(i=>{r[i]=e[i]})}}return t}createSubContext(t=null,e,r){const i=e||this.element,o=new Vb(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(t),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}transformIntoNewTimeline(t){return this.previousNode=Hp,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,r){const i={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=r?r:0)+t.delay,easing:""},o=new h7(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,i,t.stretchStartingKeyframe);return this.timelines.push(o),i}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,r,i,o,s){let a=[];if(i&&a.push(this.element),t.length>0){t=(t=t.replace(u7,"."+this._enterClassName)).replace(c7,"."+this._leaveClassName);let l=this._driver.query(this.element,t,1!=r);0!==r&&(l=r<0?l.slice(l.length+r,l.length):l.slice(0,r)),a.push(...l)}return!o&&0==a.length&&s.push(`\`query("${e}")\` returned zero elements. (Use \`query("${e}", { optional: true })\` if you wish to allow this.)`),a}}class Up{constructor(t,e,r,i){this._driver=t,this.element=e,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new Up(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles[t]=e,this._globalTimelineStyles[t]=e,this._styleSummary[t]={time:this.currentTime,value:e}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&(this._previousKeyframe.easing=t),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||Uo,this._currentKeyframe[e]=Uo}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,r,i){e&&(this._previousKeyframe.easing=e);const o=i&&i.params||{},s=function(n,t){const e={};let r;return n.forEach(i=>{"*"===i?(r=r||Object.keys(t),r.forEach(o=>{e[o]=Uo})):Ms(i,!1,e)}),e}(t,this._globalTimelineStyles);Object.keys(s).forEach(a=>{const u=kp(s[a],o,r);this._pendingStyles[a]=u,this._localTimelineStyles.hasOwnProperty(a)||(this._backFill[a]=this._globalTimelineStyles.hasOwnProperty(a)?this._globalTimelineStyles[a]:Uo),this._updateStyle(a,u)})}applyStylesToKeyframe(){const t=this._pendingStyles,e=Object.keys(t);0!=e.length&&(this._pendingStyles={},e.forEach(r=>{this._currentKeyframe[r]=t[r]}),Object.keys(this._localTimelineStyles).forEach(r=>{this._currentKeyframe.hasOwnProperty(r)||(this._currentKeyframe[r]=this._localTimelineStyles[r])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(t=>{const e=this._localTimelineStyles[t];this._pendingStyles[t]=e,this._updateStyle(t,e)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){Object.keys(t._styleSummary).forEach(e=>{const r=this._styleSummary[e],i=t._styleSummary[e];(!r||i.time>r.time)&&this._updateStyle(e,i.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,r=1===this._keyframes.size&&0===this.duration;let i=[];this._keyframes.forEach((a,u)=>{const l=Ms(a,!0);Object.keys(l).forEach(c=>{const d=l[c];"!"==d?t.add(c):d==Uo&&e.add(c)}),r||(l.offset=u/this.duration),i.push(l)});const o=t.size?Op(t.values()):[],s=e.size?Op(e.values()):[];if(r){const a=i[0],u=gl(a);a.offset=0,u.offset=1,i=[a,u]}return Lb(this.element,i,o,s,this.duration,this.startTime,this.easing,!1)}}class h7 extends Up{constructor(t,e,r,i,o,s,a=!1){super(t,e,s.delay),this.keyframes=r,this.preStyleProps=i,this.postStyleProps=o,this._stretchStartingKeyframe=a,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:r,easing:i}=this.timings;if(this._stretchStartingKeyframe&&e){const o=[],s=r+e,a=e/s,u=Ms(t[0],!1);u.offset=0,o.push(u);const l=Ms(t[0],!1);l.offset=YT(a),o.push(l);const c=t.length-1;for(let d=1;d<=c;d++){let h=Ms(t[d],!1);h.offset=YT((e+h.offset*r)/s),o.push(h)}r=s,e=0,i="",t=o}return Lb(this.element,t,this.preStyleProps,this.postStyleProps,r,e,i,!0)}}function YT(n,t=3){const e=Math.pow(10,t-1);return Math.round(n*e)/e}class Hb{}class p7 extends Hb{normalizePropertyName(t,e){return kb(t)}normalizeStyleValue(t,e,r,i){let o="";const s=r.toString().trim();if(g7[e]&&0!==r&&"0"!==r)if("number"==typeof r)o="px";else{const a=r.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&i.push(`Please provide a CSS unit value for ${t}:${r}`)}return s+o}}const g7=(()=>function(n){const t={};return n.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function XT(n,t,e,r,i,o,s,a,u,l,c,d,h){return{type:0,element:n,triggerName:t,isRemovalTransition:i,fromState:e,fromStyles:o,toState:r,toStyles:s,timelines:a,queriedElements:u,preStyleProps:l,postStyleProps:c,totalTime:d,errors:h}}const Ub={};class QT{constructor(t,e,r){this._triggerName=t,this.ast=e,this._stateStyles=r}match(t,e,r,i){return function(n,t,e,r,i){return n.some(o=>o(t,e,r,i))}(this.ast.matchers,t,e,r,i)}buildStyles(t,e,r){const i=this._stateStyles["*"],o=this._stateStyles[t],s=i?i.buildStyles(e,r):{};return o?o.buildStyles(e,r):s}build(t,e,r,i,o,s,a,u,l,c){const d=[],h=this.ast.options&&this.ast.options.params||Ub,p=this.buildStyles(r,a&&a.params||Ub,d),m=u&&u.params||Ub,g=this.buildStyles(i,m,d),v=new Set,y=new Map,b=new Map,_="void"===i,x={params:Object.assign(Object.assign({},h),m)},w=c?[]:Bb(t,e,this.ast.animation,o,s,p,g,x,l,d);let M=0;if(w.forEach(S=>{M=Math.max(S.duration+S.delay,M)}),d.length)return XT(e,this._triggerName,r,i,_,p,g,[],[],y,b,M,d);w.forEach(S=>{const I=S.element,N=kr(y,I,{});S.preStyleProps.forEach(W=>N[W]=!0);const O=kr(b,I,{});S.postStyleProps.forEach(W=>O[W]=!0),I!==e&&v.add(I)});const T=Op(v.values());return XT(e,this._triggerName,r,i,_,p,g,w,T,y,b,M)}}class y7{constructor(t,e,r){this.styles=t,this.defaultParams=e,this.normalizer=r}buildStyles(t,e){const r={},i=gl(this.defaultParams);return Object.keys(t).forEach(o=>{const s=t[o];null!=s&&(i[o]=s)}),this.styles.styles.forEach(o=>{if("string"!=typeof o){const s=o;Object.keys(s).forEach(a=>{let u=s[a];u.length>1&&(u=kp(u,i,e));const l=this.normalizer.normalizePropertyName(a,e);u=this.normalizer.normalizeStyleValue(a,l,u,e),r[l]=u})}}),r}}class b7{constructor(t,e,r){this.name=t,this.ast=e,this._normalizer=r,this.transitionFactories=[],this.states={},e.states.forEach(i=>{this.states[i.name]=new y7(i.style,i.options&&i.options.params||{},r)}),JT(this.states,"true","1"),JT(this.states,"false","0"),e.transitions.forEach(i=>{this.transitionFactories.push(new QT(t,i,this.states))}),this.fallbackTransition=function(n,t,e){return new QT(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(s,a)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,r,i){return this.transitionFactories.find(s=>s.match(t,e,r,i))||null}matchStyles(t,e,r){return this.fallbackTransition.buildStyles(t,e,r)}}function JT(n,t,e){n.hasOwnProperty(t)?n.hasOwnProperty(e)||(n[e]=n[t]):n.hasOwnProperty(e)&&(n[t]=n[e])}const w7=new Vp;class C7{constructor(t,e,r){this.bodyNode=t,this._driver=e,this._normalizer=r,this._animations={},this._playersById={},this.players=[]}register(t,e){const r=[],i=Nb(this._driver,e,r);if(r.length)throw new Error(`Unable to build the animation due to the following errors: ${r.join("\n")}`);this._animations[t]=i}_buildPlayer(t,e,r){const i=t.element,o=RT(0,this._normalizer,0,t.keyframes,e,r);return this._driver.animate(i,o,t.duration,t.delay,t.easing,[],!0)}create(t,e,r={}){const i=[],o=this._animations[t];let s;const a=new Map;if(o?(s=Bb(this._driver,e,o,Ib,Ip,{},{},r,w7,i),s.forEach(c=>{const d=kr(a,c.element,{});c.postStyleProps.forEach(h=>d[h]=null)})):(i.push("The requested animation doesn't exist or has already been destroyed"),s=[]),i.length)throw new Error(`Unable to create the animation due to the following errors: ${i.join("\n")}`);a.forEach((c,d)=>{Object.keys(c).forEach(h=>{c[h]=this._driver.computeStyle(d,h,Uo)})});const l=As(s.map(c=>{const d=a.get(c.element);return this._buildPlayer(c,{},d)}));return this._playersById[t]=l,l.onDestroy(()=>this.destroy(t)),this.players.push(l),l}destroy(t){const e=this._getPlayer(t);e.destroy(),delete this._playersById[t];const r=this.players.indexOf(e);r>=0&&this.players.splice(r,1)}_getPlayer(t){const e=this._playersById[t];if(!e)throw new Error(`Unable to find the timeline player referenced by ${t}`);return e}listen(t,e,r,i){const o=xb(e,"","","");return _b(this._getPlayer(t),r,o,i),()=>{}}command(t,e,r,i){if("register"==r)return void this.register(t,i[0]);if("create"==r)return void this.create(t,e,i[0]||{});const o=this._getPlayer(t);switch(r){case"play":o.play();break;case"pause":o.pause();break;case"reset":o.reset();break;case"restart":o.restart();break;case"finish":o.finish();break;case"init":o.init();break;case"setPosition":o.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(t)}}}const ZT="ng-animate-queued",eR="ng-animate-disabled",tR=".ng-animate-disabled",A7=[],nR={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},M7={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ni="__ng_removed";class jb{constructor(t,e=""){this.namespaceId=e;const r=t&&t.hasOwnProperty("value");if(this.value=function(n){return null!=n?n:null}(r?t.value:t),r){const o=gl(t);delete o.value,this.options=o}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const r=this.options.params;Object.keys(e).forEach(i=>{null==r[i]&&(r[i]=e[i])})}}}const Ed="void",Wb=new jb(Ed);class I7{constructor(t,e,r){this.id=t,this.hostElement=e,this._engine=r,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,ri(e,this._hostClassName)}listen(t,e,r,i){if(!this._triggers.hasOwnProperty(e))throw new Error(`Unable to listen on the animation trigger event "${r}" because the animation trigger "${e}" doesn't exist!`);if(null==r||0==r.length)throw new Error(`Unable to listen on the animation trigger "${e}" because the provided event is undefined!`);if(!function(n){return"start"==n||"done"==n}(r))throw new Error(`The provided animation trigger event "${r}" for the animation trigger "${e}" is not supported!`);const o=kr(this._elementListeners,t,[]),s={name:e,phase:r,callback:i};o.push(s);const a=kr(this._engine.statesByElement,t,{});return a.hasOwnProperty(e)||(ri(t,Tp),ri(t,Tp+"-"+e),a[e]=Wb),()=>{this._engine.afterFlush(()=>{const u=o.indexOf(s);u>=0&&o.splice(u,1),this._triggers[e]||delete a[e]})}}register(t,e){return!this._triggers[t]&&(this._triggers[t]=e,!0)}_getTrigger(t){const e=this._triggers[t];if(!e)throw new Error(`The provided animation trigger "${t}" has not been registered!`);return e}trigger(t,e,r,i=!0){const o=this._getTrigger(e),s=new Gb(this.id,e,t);let a=this._engine.statesByElement.get(t);a||(ri(t,Tp),ri(t,Tp+"-"+e),this._engine.statesByElement.set(t,a={}));let u=a[e];const l=new jb(r,this.id);if(!(r&&r.hasOwnProperty("value"))&&u&&l.absorbOptions(u.options),a[e]=l,u||(u=Wb),l.value!==Ed&&u.value===l.value){if(!function(n,t){const e=Object.keys(n),r=Object.keys(t);if(e.length!=r.length)return!1;for(let i=0;i<e.length;i++){const o=e[i];if(!t.hasOwnProperty(o)||n[o]!==t[o])return!1}return!0}(u.params,l.params)){const m=[],g=o.matchStyles(u.value,u.params,m),v=o.matchStyles(l.value,l.params,m);m.length?this._engine.reportError(m):this._engine.afterFlush(()=>{Ta(t,g),io(t,v)})}return}const h=kr(this._engine.playersByElement,t,[]);h.forEach(m=>{m.namespaceId==this.id&&m.triggerName==e&&m.queued&&m.destroy()});let f=o.matchTransition(u.value,l.value,t,l.params),p=!1;if(!f){if(!i)return;f=o.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:f,fromState:u,toState:l,player:s,isFallbackTransition:p}),p||(ri(t,ZT),s.onStart(()=>{ml(t,ZT)})),s.onDone(()=>{let m=this.players.indexOf(s);m>=0&&this.players.splice(m,1);const g=this._engine.playersByElement.get(t);if(g){let v=g.indexOf(s);v>=0&&g.splice(v,1)}}),this.players.push(s),h.push(s),s}deregister(t){delete this._triggers[t],this._engine.statesByElement.forEach((e,r)=>{delete e[t]}),this._elementListeners.forEach((e,r)=>{this._elementListeners.set(r,e.filter(i=>i.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(r=>r.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){const r=this._engine.driver.query(t,Rp,!0);r.forEach(i=>{if(i[ni])return;const o=this._engine.fetchNamespacesByElement(i);o.size?o.forEach(s=>s.triggerLeaveAnimation(i,e,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>r.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(t,e,r,i){const o=this._engine.statesByElement.get(t);if(o){const s=[];if(Object.keys(o).forEach(a=>{if(this._triggers[a]){const u=this.trigger(t,a,Ed,i);u&&s.push(u)}}),s.length)return this._engine.markElementAsRemoved(this.id,t,!0,e),r&&As(s).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t),r=this._engine.statesByElement.get(t);if(e&&r){const i=new Set;e.forEach(o=>{const s=o.name;if(i.has(s))return;i.add(s);const u=this._triggers[s].fallbackTransition,l=r[s]||Wb,c=new jb(Ed),d=new Gb(this.id,s,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:s,transition:u,fromState:l,toState:c,player:d,isFallbackTransition:!0})})}}removeNode(t,e){const r=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let i=!1;if(r.totalAnimations){const o=r.players.length?r.playersByQueriedElement.get(t):[];if(o&&o.length)i=!0;else{let s=t;for(;s=s.parentNode;)if(r.statesByElement.get(s)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(t),i)r.markElementAsRemoved(this.id,t,!1,e);else{const o=t[ni];(!o||o===nR)&&(r.afterFlush(()=>this.clearElementCache(t)),r.destroyInnerAnimations(t),r._onRemovalComplete(t,e))}}insertNode(t,e){ri(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(r=>{const i=r.player;if(i.destroyed)return;const o=r.element,s=this._elementListeners.get(o);s&&s.forEach(a=>{if(a.name==r.triggerName){const u=xb(o,r.triggerName,r.fromState.value,r.toState.value);u._data=t,_b(r.player,a.phase,u,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):e.push(r)}),this._queue=[],e.sort((r,i)=>{const o=r.transition.ast.depCount,s=i.transition.ast.depCount;return 0==o||0==s?o-s:this._engine.driver.containsElement(r.element,i.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(r=>r.element===t)||e,e}}class T7{constructor(t,e,r){this.bodyNode=t,this.driver=e,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,o)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(r=>{r.queued&&t.push(r)})}),t}createNamespace(t,e){const r=new I7(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(r,e):(this.newHostElements.set(e,r),this.collectEnterElement(e)),this._namespaceLookup[t]=r}_balanceNamespaceList(t,e){const r=this._namespaceList.length-1;if(r>=0){let i=!1;for(let o=r;o>=0;o--)if(this.driver.containsElement(this._namespaceList[o].hostElement,e)){this._namespaceList.splice(o+1,0,t),i=!0;break}i||this._namespaceList.splice(0,0,t)}else this._namespaceList.push(t);return this.namespacesByHostElement.set(e,t),t}register(t,e){let r=this._namespaceLookup[t];return r||(r=this.createNamespace(t,e)),r}registerTrigger(t,e,r){let i=this._namespaceLookup[t];i&&i.register(e,r)&&this.totalAnimations++}destroy(t,e){if(!t)return;const r=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(r.hostElement),delete this._namespaceLookup[t];const i=this._namespaceList.indexOf(r);i>=0&&this._namespaceList.splice(i,1)}),this.afterFlushAnimationsDone(()=>r.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,r=this.statesByElement.get(t);if(r){const i=Object.keys(r);for(let o=0;o<i.length;o++){const s=r[i[o]].namespaceId;if(s){const a=this._fetchNamespace(s);a&&e.add(a)}}}return e}trigger(t,e,r,i){if(jp(e)){const o=this._fetchNamespace(t);if(o)return o.trigger(e,r,i),!0}return!1}insertNode(t,e,r,i){if(!jp(e))return;const o=e[ni];if(o&&o.setForRemoval){o.setForRemoval=!1,o.setForMove=!0;const s=this.collectedLeaveElements.indexOf(e);s>=0&&this.collectedLeaveElements.splice(s,1)}if(t){const s=this._fetchNamespace(t);s&&s.insertNode(e,r)}i&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),ri(t,eR)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),ml(t,eR))}removeNode(t,e,r,i){if(jp(e)){const o=t?this._fetchNamespace(t):null;if(o?o.removeNode(e,i):this.markElementAsRemoved(t,e,!1,i),r){const s=this.namespacesByHostElement.get(e);s&&s.id!==t&&s.removeNode(e,i)}}else this._onRemovalComplete(e,i)}markElementAsRemoved(t,e,r,i){this.collectedLeaveElements.push(e),e[ni]={namespaceId:t,setForRemoval:i,hasAnimation:r,removedBeforeQueried:!1}}listen(t,e,r,i,o){return jp(e)?this._fetchNamespace(t).listen(e,r,i,o):()=>{}}_buildInstruction(t,e,r,i,o){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,r,i,t.fromState.options,t.toState.options,e,o)}destroyInnerAnimations(t){let e=this.driver.query(t,Rp,!0);e.forEach(r=>this.destroyActiveAnimationsForElement(r)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,Tb,!0),e.forEach(r=>this.finishActiveQueriedAnimationOnElement(r)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(r=>{r.queued?r.markedForDestroy=!0:r.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(r=>r.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return As(this.players).onDone(()=>t());t()})}processLeaveNode(t){const e=t[ni];if(e&&e.setForRemoval){if(t[ni]=nR,e.namespaceId){this.destroyInnerAnimations(t);const r=this._fetchNamespace(e.namespaceId);r&&r.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}this.driver.matchesElement(t,tR)&&this.markElementAsDisabled(t,!1),this.driver.query(t,tR,!0).forEach(r=>{this.markElementAsDisabled(r,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((r,i)=>this._balanceNamespaceList(r,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let r=0;r<this.collectedEnterElements.length;r++)ri(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const r=[];try{e=this._flushAnimations(r,t)}finally{for(let i=0;i<r.length;i++)r[i]()}}else for(let r=0;r<this.collectedLeaveElements.length;r++)this.processLeaveNode(this.collectedLeaveElements[r]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(r=>r()),this._flushFns=[],this._whenQuietFns.length){const r=this._whenQuietFns;this._whenQuietFns=[],e.length?As(e).onDone(()=>{r.forEach(i=>i())}):r.forEach(i=>i())}}reportError(t){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${t.join("\n")}`)}_flushAnimations(t,e){const r=new Vp,i=[],o=new Map,s=[],a=new Map,u=new Map,l=new Map,c=new Set;this.disabledNodes.forEach(P=>{c.add(P);const L=this.driver.query(P,".ng-animate-queued",!0);for(let B=0;B<L.length;B++)c.add(L[B])});const d=this.bodyNode,h=Array.from(this.statesByElement.keys()),f=oR(h,this.collectedEnterElements),p=new Map;let m=0;f.forEach((P,L)=>{const B=Ib+m++;p.set(L,B),P.forEach(U=>ri(U,B))});const g=[],v=new Set,y=new Set;for(let P=0;P<this.collectedLeaveElements.length;P++){const L=this.collectedLeaveElements[P],B=L[ni];B&&B.setForRemoval&&(g.push(L),v.add(L),B.hasAnimation?this.driver.query(L,".ng-star-inserted",!0).forEach(U=>v.add(U)):y.add(L))}const b=new Map,_=oR(h,Array.from(v));_.forEach((P,L)=>{const B=Ip+m++;b.set(L,B),P.forEach(U=>ri(U,B))}),t.push(()=>{f.forEach((P,L)=>{const B=p.get(L);P.forEach(U=>ml(U,B))}),_.forEach((P,L)=>{const B=b.get(L);P.forEach(U=>ml(U,B))}),g.forEach(P=>{this.processLeaveNode(P)})});const x=[],w=[];for(let P=this._namespaceList.length-1;P>=0;P--)this._namespaceList[P].drainQueuedTransitions(e).forEach(B=>{const U=B.player,q=B.element;if(x.push(U),this.collectedEnterElements.length){const Ee=q[ni];if(Ee&&Ee.setForMove)return void U.destroy()}const J=!d||!this.driver.containsElement(d,q),ne=b.get(q),he=p.get(q),fe=this._buildInstruction(B,r,he,ne,J);if(fe.errors&&fe.errors.length)w.push(fe);else{if(J)return U.onStart(()=>Ta(q,fe.fromStyles)),U.onDestroy(()=>io(q,fe.toStyles)),void i.push(U);if(B.isFallbackTransition)return U.onStart(()=>Ta(q,fe.fromStyles)),U.onDestroy(()=>io(q,fe.toStyles)),void i.push(U);fe.timelines.forEach(Ee=>Ee.stretchStartingKeyframe=!0),r.append(q,fe.timelines),s.push({instruction:fe,player:U,element:q}),fe.queriedElements.forEach(Ee=>kr(a,Ee,[]).push(U)),fe.preStyleProps.forEach((Ee,je)=>{const We=Object.keys(Ee);if(We.length){let Le=u.get(je);Le||u.set(je,Le=new Set),We.forEach(It=>Le.add(It))}}),fe.postStyleProps.forEach((Ee,je)=>{const We=Object.keys(Ee);let Le=l.get(je);Le||l.set(je,Le=new Set),We.forEach(It=>Le.add(It))})}});if(w.length){const P=[];w.forEach(L=>{P.push(`@${L.triggerName} has failed due to:\n`),L.errors.forEach(B=>P.push(`- ${B}\n`))}),x.forEach(L=>L.destroy()),this.reportError(P)}const M=new Map,T=new Map;s.forEach(P=>{const L=P.element;r.has(L)&&(T.set(L,L),this._beforeAnimationBuild(P.player.namespaceId,P.instruction,M))}),i.forEach(P=>{const L=P.element;this._getPreviousPlayers(L,!1,P.namespaceId,P.triggerName,null).forEach(U=>{kr(M,L,[]).push(U),U.destroy()})});const S=g.filter(P=>aR(P,u,l)),I=new Map;iR(I,this.driver,y,l,Uo).forEach(P=>{aR(P,u,l)&&S.push(P)});const O=new Map;f.forEach((P,L)=>{iR(O,this.driver,new Set(P),u,"!")}),S.forEach(P=>{const L=I.get(P),B=O.get(P);I.set(P,Object.assign(Object.assign({},L),B))});const W=[],G=[],z={};s.forEach(P=>{const{element:L,player:B,instruction:U}=P;if(r.has(L)){if(c.has(L))return B.onDestroy(()=>io(L,U.toStyles)),B.disabled=!0,B.overrideTotalTime(U.totalTime),void i.push(B);let q=z;if(T.size>1){let ne=L;const he=[];for(;ne=ne.parentNode;){const fe=T.get(ne);if(fe){q=fe;break}he.push(ne)}he.forEach(fe=>T.set(fe,q))}const J=this._buildAnimation(B.namespaceId,U,M,o,O,I);if(B.setRealPlayer(J),q===z)W.push(B);else{const ne=this.playersByElement.get(q);ne&&ne.length&&(B.parentPlayer=As(ne)),i.push(B)}}else Ta(L,U.fromStyles),B.onDestroy(()=>io(L,U.toStyles)),G.push(B),c.has(L)&&i.push(B)}),G.forEach(P=>{const L=o.get(P.element);if(L&&L.length){const B=As(L);P.setRealPlayer(B)}}),i.forEach(P=>{P.parentPlayer?P.syncPlayerEvents(P.parentPlayer):P.destroy()});for(let P=0;P<g.length;P++){const L=g[P],B=L[ni];if(ml(L,Ip),B&&B.hasAnimation)continue;let U=[];if(a.size){let J=a.get(L);J&&J.length&&U.push(...J);let ne=this.driver.query(L,Tb,!0);for(let he=0;he<ne.length;he++){let fe=a.get(ne[he]);fe&&fe.length&&U.push(...fe)}}const q=U.filter(J=>!J.destroyed);q.length?O7(this,L,q):this.processLeaveNode(L)}return g.length=0,W.forEach(P=>{this.players.push(P),P.onDone(()=>{P.destroy();const L=this.players.indexOf(P);this.players.splice(L,1)}),P.play()}),W}elementContainsData(t,e){let r=!1;const i=e[ni];return i&&i.setForRemoval&&(r=!0),this.playersByElement.has(e)&&(r=!0),this.playersByQueriedElement.has(e)&&(r=!0),this.statesByElement.has(e)&&(r=!0),this._fetchNamespace(t).elementContainsData(e)||r}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,r,i,o){let s=[];if(e){const a=this.playersByQueriedElement.get(t);a&&(s=a)}else{const a=this.playersByElement.get(t);if(a){const u=!o||o==Ed;a.forEach(l=>{l.queued||!u&&l.triggerName!=i||s.push(l)})}}return(r||i)&&(s=s.filter(a=>!(r&&r!=a.namespaceId||i&&i!=a.triggerName))),s}_beforeAnimationBuild(t,e,r){const o=e.element,s=e.isRemovalTransition?void 0:t,a=e.isRemovalTransition?void 0:e.triggerName;for(const u of e.timelines){const l=u.element,c=l!==o,d=kr(r,l,[]);this._getPreviousPlayers(l,c,s,a,e.toState).forEach(f=>{const p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),d.push(f)})}Ta(o,e.fromStyles)}_buildAnimation(t,e,r,i,o,s){const a=e.triggerName,u=e.element,l=[],c=new Set,d=new Set,h=e.timelines.map(p=>{const m=p.element;c.add(m);const g=m[ni];if(g&&g.removedBeforeQueried)return new pl(p.duration,p.delay);const v=m!==u,y=function(n){const t=[];return sR(n,t),t}((r.get(m)||A7).map(M=>M.getRealPlayer())).filter(M=>!!M.element&&M.element===m),b=o.get(m),_=s.get(m),x=RT(0,this._normalizer,0,p.keyframes,b,_),w=this._buildPlayer(p,x,y);if(p.subTimeline&&i&&d.add(m),v){const M=new Gb(t,a,m);M.setRealPlayer(w),l.push(M)}return w});l.forEach(p=>{kr(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function(n,t,e){let r;if(n instanceof Map){if(r=n.get(t),r){if(r.length){const i=r.indexOf(e);r.splice(i,1)}0==r.length&&n.delete(t)}}else if(r=n[t],r){if(r.length){const i=r.indexOf(e);r.splice(i,1)}0==r.length&&delete n[t]}return r}(this.playersByQueriedElement,p.element,p))}),c.forEach(p=>ri(p,VT));const f=As(h);return f.onDestroy(()=>{c.forEach(p=>ml(p,VT)),io(u,e.toStyles)}),d.forEach(p=>{kr(i,p,[]).push(f)}),f}_buildPlayer(t,e,r){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,r):new pl(t.duration,t.delay)}}class Gb{constructor(t,e,r){this.namespaceId=t,this.triggerName=e,this.element=r,this._player=new pl,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,Object.keys(this._queuedCallbacks).forEach(e=>{this._queuedCallbacks[e].forEach(r=>_b(t,e,void 0,r))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){kr(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function jp(n){return n&&1===n.nodeType}function rR(n,t){const e=n.style.display;return n.style.display=null!=t?t:"none",e}function iR(n,t,e,r,i){const o=[];e.forEach(u=>o.push(rR(u)));const s=[];r.forEach((u,l)=>{const c={};u.forEach(d=>{const h=c[d]=t.computeStyle(l,d,i);(!h||0==h.length)&&(l[ni]=M7,s.push(l))}),n.set(l,c)});let a=0;return e.forEach(u=>rR(u,o[a++])),s}function oR(n,t){const e=new Map;if(n.forEach(a=>e.set(a,[])),0==t.length)return e;const i=new Set(t),o=new Map;function s(a){if(!a)return 1;let u=o.get(a);if(u)return u;const l=a.parentNode;return u=e.has(l)?l:i.has(l)?1:s(l),o.set(a,u),u}return t.forEach(a=>{const u=s(a);1!==u&&e.get(u).push(a)}),e}const Wp="$$classes";function ri(n,t){if(n.classList)n.classList.add(t);else{let e=n[Wp];e||(e=n[Wp]={}),e[t]=!0}}function ml(n,t){if(n.classList)n.classList.remove(t);else{let e=n[Wp];e&&delete e[t]}}function O7(n,t,e){As(e).onDone(()=>n.processLeaveNode(t))}function sR(n,t){for(let e=0;e<n.length;e++){const r=n[e];r instanceof IT?sR(r.players,t):t.push(r)}}function aR(n,t,e){const r=e.get(n);if(!r)return!1;let i=t.get(n);return i?r.forEach(o=>i.add(o)):t.set(n,r),e.delete(n),!0}class Gp{constructor(t,e,r){this.bodyNode=t,this._driver=e,this._normalizer=r,this._triggerCache={},this.onRemovalComplete=(i,o)=>{},this._transitionEngine=new T7(t,e,r),this._timelineEngine=new C7(t,e,r),this._transitionEngine.onRemovalComplete=(i,o)=>this.onRemovalComplete(i,o)}registerTrigger(t,e,r,i,o){const s=t+"-"+i;let a=this._triggerCache[s];if(!a){const u=[],l=Nb(this._driver,o,u);if(u.length)throw new Error(`The animation trigger "${i}" has failed to build due to the following errors:\n - ${u.join("\n - ")}`);a=function(n,t,e){return new b7(n,t,e)}(i,l,this._normalizer),this._triggerCache[s]=a}this._transitionEngine.registerTrigger(e,i,a)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,r,i){this._transitionEngine.insertNode(t,e,r,i)}onRemove(t,e,r,i){this._transitionEngine.removeNode(t,e,i||!1,r)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,r,i){if("@"==r.charAt(0)){const[o,s]=FT(r);this._timelineEngine.command(o,e,s,i)}else this._transitionEngine.trigger(t,e,r,i)}listen(t,e,r,i,o){if("@"==r.charAt(0)){const[s,a]=FT(r);return this._timelineEngine.listen(s,e,a,o)}return this._transitionEngine.listen(t,e,r,i,o)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function uR(n,t){let e=null,r=null;return Array.isArray(t)&&t.length?(e=zb(t[0]),t.length>1&&(r=zb(t[t.length-1]))):t&&(e=zb(t)),e||r?new L7(n,e,r):null}let L7=(()=>{class n{constructor(e,r,i){this._element=e,this._startStyles=r,this._endStyles=i,this._state=0;let o=n.initialStylesByElement.get(e);o||n.initialStylesByElement.set(e,o={}),this._initialStyles=o}start(){this._state<1&&(this._startStyles&&io(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(io(this._element,this._initialStyles),this._endStyles&&(io(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Ta(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ta(this._element,this._endStyles),this._endStyles=null),io(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function zb(n){let t=null;const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=e[r];B7(i)&&(t=t||{},t[i]=n[i])}return t}function B7(n){return"display"===n||"position"===n}const lR="animation",cR="animationend";class U7{constructor(t,e,r,i,o,s,a){this._element=t,this._name=e,this._duration=r,this._delay=i,this._easing=o,this._fillMode=s,this._onDoneFn=a,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=u=>this._handleCallback(u)}apply(){(function(n,t){const e=qb(n,"").trim();let r=0;e.length&&(function(n,t){let e=0;for(let r=0;r<n.length;r++)","===n.charAt(r)&&e++;return e}(e)+1,t=`${e}, ${t}`),zp(n,"",t)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),fR(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){dR(this._element,this._name,"paused")}resume(){dR(this._element,this._name,"running")}setPosition(t){const e=hR(this._element,this._name);this._position=t*this._duration,zp(this._element,"Delay",`-${this._position}ms`,e)}getPosition(){return this._position}_handleCallback(t){const e=t._ngTestManualTimestamp||Date.now(),r=1e3*parseFloat(t.elapsedTime.toFixed(3));t.animationName==this._name&&Math.max(e-this._startTime,0)>=this._delay&&r>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),fR(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(n,t){const r=qb(n,"").split(","),i=$b(r,t);i>=0&&(r.splice(i,1),zp(n,"",r.join(",")))}(this._element,this._name))}}function dR(n,t,e){zp(n,"PlayState",e,hR(n,t))}function hR(n,t){const e=qb(n,"");return e.indexOf(",")>0?$b(e.split(","),t):$b([e],t)}function $b(n,t){for(let e=0;e<n.length;e++)if(n[e].indexOf(t)>=0)return e;return-1}function fR(n,t,e){e?n.removeEventListener(cR,t):n.addEventListener(cR,t)}function zp(n,t,e,r){const i=lR+t;if(null!=r){const o=n.style[i];if(o.length){const s=o.split(",");s[r]=e,e=s.join(",")}}n.style[i]=e}function qb(n,t){return n.style[lR+t]||""}class pR{constructor(t,e,r,i,o,s,a,u){this.element=t,this.keyframes=e,this.animationName=r,this._duration=i,this._delay=o,this._finalStyles=a,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=i+o,this._buildStyler()}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(t=>t()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(t){this._styler.setPosition(t)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new U7(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(r=>r()),e.length=0}beforeDestroy(){this.init();const t={};if(this.hasStarted()){const e=this._state>=3;Object.keys(this._finalStyles).forEach(r=>{"offset"!=r&&(t[r]=e?this._finalStyles[r]:Ob(this.element,r))})}this.currentSnapshot=t}}class q7 extends pl{constructor(t,e){super(),this.element=t,this._startingStyles={},this.__initialized=!1,this._styles=PT(e)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(t=>{this._startingStyles[t]=this.element.style[t]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(t=>this.element.style.setProperty(t,this._styles[t])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(t=>{const e=this._startingStyles[t];e?this.element.style.setProperty(t,e):this.element.style.removeProperty(t)}),this._startingStyles=null,super.destroy())}}class mR{constructor(){this._count=0}validateStyleProperty(t){return Eb(t)}matchesElement(t,e){return Db(t,e)}containsElement(t,e){return Sb(t,e)}query(t,e,r){return Ab(t,e,r)}computeStyle(t,e,r){return window.getComputedStyle(t)[e]}buildKeyframeElement(t,e,r){r=r.map(a=>PT(a));let i=`@keyframes ${e} {\n`,o="";r.forEach(a=>{o=" ";const u=parseFloat(a.offset);i+=`${o}${100*u}% {\n`,o+=" ",Object.keys(a).forEach(l=>{const c=a[l];switch(l){case"offset":return;case"easing":return void(c&&(i+=`${o}animation-timing-function: ${c};\n`));default:return void(i+=`${o}${l}: ${c};\n`)}}),i+=`${o}}\n`}),i+="}\n";const s=document.createElement("style");return s.textContent=i,s}animate(t,e,r,i,o,s=[],a){const u=s.filter(g=>g instanceof pR),l={};GT(r,i)&&u.forEach(g=>{let v=g.currentSnapshot;Object.keys(v).forEach(y=>l[y]=v[y])});const c=function(n){let t={};return n&&(Array.isArray(n)?n:[n]).forEach(r=>{Object.keys(r).forEach(i=>{"offset"==i||"easing"==i||(t[i]=r[i])})}),t}(e=zT(t,e,l));if(0==r)return new q7(t,c);const d="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(t,d,e);(function(n){var t;const e=null===(t=n.getRootNode)||void 0===t?void 0:t.call(n);return"undefined"!=typeof ShadowRoot&&e instanceof ShadowRoot?e:document.head})(t).appendChild(h);const p=uR(t,e),m=new pR(t,e,d,r,i,o,c,p);return m.onDestroy(()=>function(n){n.parentNode.removeChild(n)}(h)),m}}class yR{constructor(t,e,r,i){this.element=t,this.keyframes=e,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(t,e,r){return t.animate(e,r)}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(e=>{"offset"!=e&&(t[e]=this._finished?this._finalKeyframe[e]:Ob(this.element,e))}),this.currentSnapshot=t}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(r=>r()),e.length=0}}class J7{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(_R().toString()),this._cssKeyframesDriver=new mR}validateStyleProperty(t){return Eb(t)}matchesElement(t,e){return Db(t,e)}containsElement(t,e){return Sb(t,e)}query(t,e,r){return Ab(t,e,r)}computeStyle(t,e,r){return window.getComputedStyle(t)[e]}overrideWebAnimationsSupport(t){this._isNativeImpl=t}animate(t,e,r,i,o,s=[],a){if(!a&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(t,e,r,i,o,s);const c={duration:r,delay:i,fill:0==i?"both":"forwards"};o&&(c.easing=o);const d={},h=s.filter(p=>p instanceof yR);GT(r,i)&&h.forEach(p=>{let m=p.currentSnapshot;Object.keys(m).forEach(g=>d[g]=m[g])});const f=uR(t,e=zT(t,e=e.map(p=>Ms(p,!1)),d));return new yR(t,e,c,f)}}function _R(){return TT()&&Element.prototype.animate||{}}let e9=(()=>{class n extends ST{constructor(e,r){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(r.body,{id:"0",encapsulation:Zt.None,styles:[],data:{animation:[]}})}build(e){const r=this._nextAnimationId.toString();this._nextAnimationId++;const i=Array.isArray(e)?AT(e):e;return bR(this._renderer,null,r,"register",[i]),new t9(r,this._renderer)}}return n.\u0275fac=function(e){return new(e||n)(R(fa),R(ae))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();class t9 extends class{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new n9(this._id,t,e||{},this._renderer)}}class n9{constructor(t,e,r,i){this.id=t,this.element=e,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return bR(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){var t,e;return null!==(e=null===(t=this._renderer.engine.players[+this.id])||void 0===t?void 0:t.getPosition())&&void 0!==e?e:0}}function bR(n,t,e,r,i){return n.setProperty(t,`@@${e}:${r}`,i)}const xR="@.disabled";let r9=(()=>{class n{constructor(e,r,i){this.delegate=e,this.engine=r,this._zone=i,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),r.onRemovalComplete=(o,s)=>{s&&s.parentNode(o)&&s.removeChild(o.parentNode,o)}}createRenderer(e,r){const o=this.delegate.createRenderer(e,r);if(!(e&&r&&r.data&&r.data.animation)){let c=this._rendererCache.get(o);return c||(c=new wR("",o,this.engine),this._rendererCache.set(o,c)),c}const s=r.id,a=r.id+"-"+this._currentId;this._currentId++,this.engine.register(a,e);const u=c=>{Array.isArray(c)?c.forEach(u):this.engine.registerTrigger(s,a,e,c.name,c)};return r.data.animation.forEach(u),new i9(this,a,o,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,r,i){e>=0&&e<this._microtaskId?this._zone.run(()=>r(i)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(o=>{const[s,a]=o;s(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([r,i]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(e){return new(e||n)(R(fa),R(Gp),R(ve))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();class wR{constructor(t,e,r){this.namespaceId=t,this.delegate=e,this.engine=r,this.destroyNode=this.delegate.destroyNode?i=>e.destroyNode(i):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,r,i=!0){this.delegate.insertBefore(t,e,r),this.engine.onInsert(this.namespaceId,e,t,i)}removeChild(t,e,r){this.engine.onRemove(this.namespaceId,e,this.delegate,r)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,r,i){this.delegate.setAttribute(t,e,r,i)}removeAttribute(t,e,r){this.delegate.removeAttribute(t,e,r)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,r,i){this.delegate.setStyle(t,e,r,i)}removeStyle(t,e,r){this.delegate.removeStyle(t,e,r)}setProperty(t,e,r){"@"==e.charAt(0)&&e==xR?this.disableAnimations(t,!!r):this.delegate.setProperty(t,e,r)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,r){return this.delegate.listen(t,e,r)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class i9 extends wR{constructor(t,e,r,i){super(e,r,i),this.factory=t,this.namespaceId=e}setProperty(t,e,r){"@"==e.charAt(0)?"."==e.charAt(1)&&e==xR?this.disableAnimations(t,r=void 0===r||!!r):this.engine.process(this.namespaceId,t,e.substr(1),r):this.delegate.setProperty(t,e,r)}listen(t,e,r){if("@"==e.charAt(0)){const i=function(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(t);let o=e.substr(1),s="";return"@"!=o.charAt(0)&&([o,s]=function(n){const t=n.indexOf(".");return[n.substring(0,t),n.substr(t+1)]}(o)),this.engine.listen(this.namespaceId,i,o,s,a=>{this.factory.scheduleListenerCallback(a._data||-1,r,a)})}return this.delegate.listen(t,e,r)}}let a9=(()=>{class n extends Gp{constructor(e,r,i){super(e.body,r,i)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(e){return new(e||n)(R(ae),R(Mb),R(Hb))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const Fa=new re("AnimationModuleType"),CR=[{provide:ST,useClass:e9},{provide:Hb,useFactory:function(){return new p7}},{provide:Gp,useClass:a9},{provide:fa,useFactory:function(n,t,e){return new r9(n,t,e)},deps:[xp,Gp,ve]}],ER=[{provide:Mb,useFactory:function(){return"function"==typeof _R()?new J7:new mR}},{provide:Fa,useValue:"BrowserAnimations"},...CR],DR=[{provide:Mb,useClass:LT},{provide:Fa,useValue:"NoopAnimations"},...CR];let d9=(()=>{class n{static withConfig(e){return{ngModule:n,providers:e.disableAnimations?DR:ER}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:ER,imports:[ab]}),n})();const SR=new Oo("12.2.13"),y9=new re("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}});let ka,On=(()=>{class n{constructor(e,r,i){this._hasDoneGlobalChecks=!1,this._document=i,e._applyBodyHighContrastModeCssClasses(),this._sanityChecks=r,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!(!w_()||hb())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const e=this._document.createElement("div");e.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(e);const r=getComputedStyle(e);r&&"none"!==r.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(e)}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&SR.full!==DT.full&&console.warn("The Angular Material version ("+SR.full+") does not match the Angular CDK version ("+DT.full+").\nPlease ensure the versions of these two packages exactly match.")}}return n.\u0275fac=function(e){return new(e||n)(R(CT),R(y9,8),R(ae))},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[fl],fl]}),n})();try{ka="undefined"!=typeof Intl}catch(n){ka=!1}let IR=(()=>{class n{isErrorState(e,r){return!!(e&&e.invalid&&(e.touched||r&&r.submitted))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({factory:function(){return new n},token:n,providedIn:"root"}),n})(),kR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[On,pd],On]}),n})(),UR=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[kR,On],On]}),n})();function K9({error:n,subscriber:t}){t.error(n)}function Is(){}function ln(n,t,e){return function(i){return i.lift(new Y9(n,t,e))}}class Y9{constructor(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}call(t,e){return e.subscribe(new X9(t,this.nextOrObserver,this.error,this.complete))}}class X9 extends vt{constructor(t,e,r,i){super(t),this._tapNext=Is,this._tapError=Is,this._tapComplete=Is,this._tapError=r||Is,this._tapComplete=i||Is,Hi(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||Is,this._tapError=e.error||Is,this._tapComplete=e.complete||Is)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}function Ts(n){return function(e){const r=new Q9(n),i=e.lift(r);return r.caught=i}}class Q9{constructor(t){this.selector=t}call(t,e){return e.subscribe(new J9(t,this.selector,this.caught))}}class J9 extends lu{constructor(t,e,r){super(t),this.selector=e,this.caught=r}error(t){if(!this.isStopped){let e;try{e=this.selector(t,this.caught)}catch(o){return void super.error(o)}this._unsubscribeAndRecycle();const r=new uu(this);this.add(r);const i=cu(e,r);i!==r&&this.add(i)}}}class Z9{constructor(t){this.callback=t}call(t,e){return e.subscribe(new eY(t,this.callback))}}class eY extends vt{constructor(t,e){super(t),this.add(new st(e))}}function vl(n,t){return En(n,t,1)}function vr(n,t){return function(r){return r.lift(new tY(n,t))}}class tY{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new nY(t,this.predicate,this.thisArg))}}class nY extends vt{constructor(t,e,r){super(t),this.predicate=e,this.thisArg=r,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}e&&this.destination.next(t)}}class zR{}class $R{}class jo{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const r=e.indexOf(":");if(r>0){const i=e.slice(0,r),o=i.toLowerCase(),s=e.slice(r+1).trim();this.maybeSetNormalizedName(i,o),this.headers.has(o)?this.headers.get(o).push(s):this.headers.set(o,[s])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let r=t[e];const i=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(i,r),this.maybeSetNormalizedName(e,i))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof jo?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new jo;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof jo?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(t.name,e);const i=("a"===t.op?this.headers.get(e):void 0)||[];i.push(...r),this.headers.set(e,i);break;case"d":const o=t.value;if(o){let s=this.headers.get(e);if(!s)return;s=s.filter(a=>-1===o.indexOf(a)),0===s.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class rY{encodeKey(t){return qR(t)}encodeValue(t){return qR(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const oY=/%(\d[a-f0-9])/gi,sY={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function qR(n){return encodeURIComponent(n).replace(oY,(t,e)=>{var r;return null!==(r=sY[e])&&void 0!==r?r:t})}function KR(n){return`${n}`}class Rs{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new rY,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{const o=i.indexOf("="),[s,a]=-1==o?[t.decodeKey(i),""]:[t.decodeKey(i.slice(0,o)),t.decodeValue(i.slice(o+1))],u=e.get(s)||[];u.push(a),e.set(s,u)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const r=t.fromObject[e];this.map.set(e,Array.isArray(r)?r:[r])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(r=>{const i=t[r];Array.isArray(i)?i.forEach(o=>{e.push({param:r,value:o,op:"a"})}):e.push({param:r,value:i,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Rs({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(KR(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let r=this.map.get(t.param)||[];const i=r.indexOf(KR(t.value));-1!==i&&r.splice(i,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class aY{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}keys(){return this.map.keys()}}function YR(n){return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer}function XR(n){return"undefined"!=typeof Blob&&n instanceof Blob}function QR(n){return"undefined"!=typeof FormData&&n instanceof FormData}class Sd{constructor(t,e,r,i){let o;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,o=i):o=r,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params)),this.headers||(this.headers=new jo),this.context||(this.context=new aY),this.params){const s=this.params.toString();if(0===s.length)this.urlWithParams=e;else{const a=e.indexOf("?");this.urlWithParams=e+(-1===a?"?":a<e.length-1?"&":"")+s}}else this.params=new Rs,this.urlWithParams=e}serializeBody(){return null===this.body?null:YR(this.body)||XR(this.body)||QR(this.body)||function(n){return"undefined"!=typeof URLSearchParams&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Rs?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||QR(this.body)?null:XR(this.body)?this.body.type||null:YR(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Rs?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var e;const r=t.method||this.method,i=t.url||this.url,o=t.responseType||this.responseType,s=void 0!==t.body?t.body:this.body,a=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,u=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let l=t.headers||this.headers,c=t.params||this.params;const d=null!==(e=t.context)&&void 0!==e?e:this.context;return void 0!==t.setHeaders&&(l=Object.keys(t.setHeaders).reduce((h,f)=>h.set(f,t.setHeaders[f]),l)),t.setParams&&(c=Object.keys(t.setParams).reduce((h,f)=>h.set(f,t.setParams[f]),c)),new Sd(r,i,s,{params:c,headers:l,context:d,reportProgress:u,responseType:o,withCredentials:a})}}var cn=(()=>((cn=cn||{})[cn.Sent=0]="Sent",cn[cn.UploadProgress=1]="UploadProgress",cn[cn.ResponseHeader=2]="ResponseHeader",cn[cn.DownloadProgress=3]="DownloadProgress",cn[cn.Response=4]="Response",cn[cn.User=5]="User",cn))();class Xb{constructor(t,e=200,r="OK"){this.headers=t.headers||new jo,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class Qb extends Xb{constructor(t={}){super(t),this.type=cn.ResponseHeader}clone(t={}){return new Qb({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Xp extends Xb{constructor(t={}){super(t),this.type=cn.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Xp({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class JR extends Xb{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function Jb(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let yl=(()=>{class n{constructor(e){this.handler=e}request(e,r,i={}){let o;if(e instanceof Sd)o=e;else{let u,l;u=i.headers instanceof jo?i.headers:new jo(i.headers),i.params&&(l=i.params instanceof Rs?i.params:new Rs({fromObject:i.params})),o=new Sd(e,r,void 0!==i.body?i.body:null,{headers:u,context:i.context,params:l,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials})}const s=_e(o).pipe(vl(u=>this.handler.handle(u)));if(e instanceof Sd||"events"===i.observe)return s;const a=s.pipe(vr(u=>u instanceof Xp));switch(i.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return a.pipe(Se(u=>{if(null!==u.body&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return a.pipe(Se(u=>{if(null!==u.body&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return a.pipe(Se(u=>{if(null!==u.body&&"string"!=typeof u.body)throw new Error("Response is not a string.");return u.body}));default:return a.pipe(Se(u=>u.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:(new Rs).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,i={}){return this.request("PATCH",e,Jb(i,r))}post(e,r,i={}){return this.request("POST",e,Jb(i,r))}put(e,r,i={}){return this.request("PUT",e,Jb(i,r))}}return n.\u0275fac=function(e){return new(e||n)(R(zR))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();class ZR{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const Zb=new re("HTTP_INTERCEPTORS");let cY=(()=>{class n{intercept(e,r){return r.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const dY=/^\)\]\}',?\n/;let eF=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Ke(r=>{const i=this.xhrFactory.build();if(i.open(e.method,e.urlWithParams),e.withCredentials&&(i.withCredentials=!0),e.headers.forEach((f,p)=>i.setRequestHeader(f,p.join(","))),e.headers.has("Accept")||i.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const f=e.detectContentTypeHeader();null!==f&&i.setRequestHeader("Content-Type",f)}if(e.responseType){const f=e.responseType.toLowerCase();i.responseType="json"!==f?f:"text"}const o=e.serializeBody();let s=null;const a=()=>{if(null!==s)return s;const f=1223===i.status?204:i.status,p=i.statusText||"OK",m=new jo(i.getAllResponseHeaders()),g=function(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(i)||e.url;return s=new Qb({headers:m,status:f,statusText:p,url:g}),s},u=()=>{let{headers:f,status:p,statusText:m,url:g}=a(),v=null;204!==p&&(v=void 0===i.response?i.responseText:i.response),0===p&&(p=v?200:0);let y=p>=200&&p<300;if("json"===e.responseType&&"string"==typeof v){const b=v;v=v.replace(dY,"");try{v=""!==v?JSON.parse(v):null}catch(_){v=b,y&&(y=!1,v={error:_,text:v})}}y?(r.next(new Xp({body:v,headers:f,status:p,statusText:m,url:g||void 0})),r.complete()):r.error(new JR({error:v,headers:f,status:p,statusText:m,url:g||void 0}))},l=f=>{const{url:p}=a(),m=new JR({error:f,status:i.status||0,statusText:i.statusText||"Unknown Error",url:p||void 0});r.error(m)};let c=!1;const d=f=>{c||(r.next(a()),c=!0);let p={type:cn.DownloadProgress,loaded:f.loaded};f.lengthComputable&&(p.total=f.total),"text"===e.responseType&&!!i.responseText&&(p.partialText=i.responseText),r.next(p)},h=f=>{let p={type:cn.UploadProgress,loaded:f.loaded};f.lengthComputable&&(p.total=f.total),r.next(p)};return i.addEventListener("load",u),i.addEventListener("error",l),i.addEventListener("timeout",l),i.addEventListener("abort",l),e.reportProgress&&(i.addEventListener("progress",d),null!==o&&i.upload&&i.upload.addEventListener("progress",h)),i.send(o),r.next({type:cn.Sent}),()=>{i.removeEventListener("error",l),i.removeEventListener("abort",l),i.removeEventListener("load",u),i.removeEventListener("timeout",l),e.reportProgress&&(i.removeEventListener("progress",d),null!==o&&i.upload&&i.upload.removeEventListener("progress",h)),i.readyState!==i.DONE&&i.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(R(NI))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const ex=new re("XSRF_COOKIE_NAME"),tx=new re("XSRF_HEADER_NAME");class tF{}let fY=(()=>{class n{constructor(e,r,i){this.doc=e,this.platform=r,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=SI(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(R(ae),R(Yn),R(ex))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),nx=(()=>{class n{constructor(e,r){this.tokenService=e,this.headerName=r}intercept(e,r){const i=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return r.handle(e);const o=this.tokenService.getToken();return null!==o&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,o)})),r.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(R(tF),R(tx))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),pY=(()=>{class n{constructor(e,r){this.backend=e,this.injector=r,this.chain=null}handle(e){if(null===this.chain){const r=this.injector.get(Zb,[]);this.chain=r.reduceRight((i,o)=>new ZR(i,o),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(R($R),R(ct))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),gY=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:nx,useClass:cY}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:ex,useValue:e.cookieName}:[],e.headerName?{provide:tx,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[nx,{provide:Zb,useExisting:nx,multi:!0},{provide:tF,useClass:fY},{provide:ex,useValue:"XSRF-TOKEN"},{provide:tx,useValue:"X-XSRF-TOKEN"}]}),n})(),mY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[yl,{provide:zR,useClass:pY},eF,{provide:$R,useExisting:eF}],imports:[[gY.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),n})(),AY=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[On],On]}),n})();function Ad(n,t,e,r){return Hi(e)&&(r=e,e=void 0),r?Ad(n,t,e).pipe(Se(i=>su(i)?r(...i):r(i))):new Ke(i=>{aF(n,t,function(s){i.next(arguments.length>1?Array.prototype.slice.call(arguments):s)},i,e)})}function aF(n,t,e,r,i){let o;if(function(n){return n&&"function"==typeof n.addEventListener&&"function"==typeof n.removeEventListener}(n)){const s=n;n.addEventListener(t,e,i),o=()=>s.removeEventListener(t,e,i)}else if(function(n){return n&&"function"==typeof n.on&&"function"==typeof n.off}(n)){const s=n;n.on(t,e),o=()=>s.off(t,e)}else if(function(n){return n&&"function"==typeof n.addListener&&"function"==typeof n.removeListener}(n)){const s=n;n.addListener(t,e),o=()=>s.removeListener(t,e)}else{if(!n||!n.length)throw new TypeError("Invalid event target");for(let s=0,a=n.length;s<a;s++)aF(n[s],t,e,r,i)}r.add(o)}new class extends Ii{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let r,i=-1,o=e.length;t=t||e.shift();do{if(r=t.execute(t.state,t.delay))break}while(++i<o&&(t=e.shift()));if(this.active=!1,r){for(;++i<o&&(t=e.shift());)t.unsubscribe();throw r}}}(class extends Dp{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,r=0){return null!==r&&r>0?super.requestAsyncId(t,e,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(()=>t.flush(null))))}recycleAsyncId(t,e,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(t,e,r);0===t.actions.length&&(cancelAnimationFrame(e),t.scheduled=void 0)}});let OY=1;const NY=Promise.resolve(),Zp={};function uF(n){return n in Zp&&(delete Zp[n],!0)}const lF={setImmediate(n){const t=OY++;return Zp[t]=!0,NY.then(()=>uF(t)&&n()),t},clearImmediate(n){uF(n)}};new class extends Ii{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let r,i=-1,o=e.length;t=t||e.shift();do{if(r=t.execute(t.state,t.delay))break}while(++i<o&&(t=e.shift()));if(this.active=!1,r){for(;++i<o&&(t=e.shift());)t.unsubscribe();throw r}}}(class extends Dp{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,r=0){return null!==r&&r>0?super.requestAsyncId(t,e,r):(t.actions.push(this),t.scheduled||(t.scheduled=lF.setImmediate(t.flush.bind(t,null))))}recycleAsyncId(t,e,r=0){if(null!==r&&r>0||null===r&&this.delay>0)return super.recycleAsyncId(t,e,r);0===t.actions.length&&(lF.clearImmediate(e),t.scheduled=void 0)}});class HY{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new UY(t,this.durationSelector))}}class UY extends lu{constructor(t,e){super(t),this.durationSelector=e,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){let e;try{const{durationSelector:i}=this;e=i(t)}catch(i){return this.destination.error(i)}const r=cu(e,new uu(this));!r||r.closed?this.clearThrottle():this.add(this.throttled=r)}}clearThrottle(){const{value:t,hasValue:e,throttled:r}=this;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),e&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function rx(n){return!su(n)&&n-parseFloat(n)+1>=0}function WY(n){const{index:t,period:e,subscriber:r}=n;if(r.next(t),!r.closed){if(-1===e)return r.complete();n.index=t+1,this.schedule(n,e)}}function eg(n,t=yd){return function(n){return function(e){return e.lift(new HY(n))}}(()=>function(n=0,t,e){let r=-1;return rx(t)?r=Number(t)<1?1:Number(t):au(t)&&(e=t),au(e)||(e=yd),new Ke(i=>{const o=rx(n)?n:+n-e.now();return e.schedule(WY,o,{index:0,period:r,subscriber:i})})}(n,t))}function tg(...n){return rc(1)(_e(...n))}function Wo(...n){const t=n[n.length-1];return au(t)?(n.pop(),e=>tg(n,e,t)):e=>tg(n,e)}function yr(n,t){return"function"==typeof t?e=>e.pipe(yr((r,i)=>Jt(n(r,i)).pipe(Se((o,s)=>t(r,o,i,s))))):e=>e.lift(new KY(n))}class KY{constructor(t){this.project=t}call(t,e){return e.subscribe(new YY(t,this.project))}}class YY extends lu{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const r=this.index++;try{e=this.project(t,r)}catch(i){return void this.destination.error(i)}this._innerSub(e)}_innerSub(t){const e=this.innerSubscription;e&&e.unsubscribe();const r=new uu(this),i=this.destination;i.add(r),this.innerSubscription=cu(t,r),this.innerSubscription!==r&&i.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;(!t||t.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}const JY=new class extends Ii{}(class extends Dp{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,r=0){return null!==r&&r>0||null===r&&this.delay>0?super.requestAsyncId(t,e,r):t.flush(this)}});class ii{constructor(t,e,r){this.kind=t,this.value=e,this.error=r,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,r){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return r&&r()}}accept(t,e,r){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,r)}toObservable(){switch(this.kind){case"N":return _e(this.value);case"E":return function(n,t){return new Ke(t?e=>t.schedule(K9,0,{error:n,subscriber:e}):e=>e.error(n))}(this.error);case"C":return wp()}throw new Error("unexpected notification kind value")}static createNext(t){return void 0!==t?new ii("N",t):ii.undefinedValueNotification}static createError(t){return new ii("E",void 0,t)}static createComplete(){return ii.completeNotification}}ii.completeNotification=new ii("C"),ii.undefinedValueNotification=new ii("N",void 0);class ng extends vt{constructor(t,e,r=0){super(t),this.scheduler=e,this.delay=r}static dispatch(t){const{notification:e,destination:r}=t;e.observe(r),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(ng.dispatch,this.delay,new eX(t,this.destination)))}_next(t){this.scheduleMessage(ii.createNext(t))}_error(t){this.scheduleMessage(ii.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(ii.createComplete()),this.unsubscribe()}}class eX{constructor(t,e){this.notification=t,this.destination=e}}class tX extends be{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,r){super(),this.scheduler=r,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new nX(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,r=e?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;let s;if(this.closed)throw new Js;if(this.isStopped||this.hasError?s=st.EMPTY:(this.observers.push(t),s=new RC(this,t)),i&&t.add(t=new ng(t,i)),e)for(let a=0;a<o&&!t.closed;a++)t.next(r[a]);else for(let a=0;a<o&&!t.closed;a++)t.next(r[a].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),s}_getNow(){return(this.scheduler||JY).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,r=this._windowTime,i=this._events,o=i.length;let s=0;for(;s<o&&!(t-i[s].time<r);)s++;return o>e&&(s=Math.max(s,o-e)),s>0&&i.splice(0,s),i}}class nX{constructor(t,e){this.time=t,this.value=e}}function _l(n,t,e){let r;return r=n&&"object"==typeof n?n:{bufferSize:n,windowTime:t,refCount:!1,scheduler:e},i=>i.lift(function({bufferSize:n=Number.POSITIVE_INFINITY,windowTime:t=Number.POSITIVE_INFINITY,refCount:e,scheduler:r}){let i,s,o=0,a=!1,u=!1;return function(c){let d;o++,!i||a?(a=!1,i=new tX(n,t,r),d=i.subscribe(this),s=c.subscribe({next(h){i.next(h)},error(h){a=!0,i.error(h)},complete(){u=!0,s=void 0,i.complete()}}),u&&(s=void 0)):d=i.subscribe(this),this.add(()=>{o--,d.unsubscribe(),d=void 0,s&&!u&&e&&0===o&&(s.unsubscribe(),s=void 0,i=void 0)})}}(r))}let bl=(()=>{class n{constructor(e,r,i){this._ngZone=e,this._platform=r,this._scrolled=new be,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=i}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const r=this.scrollContainers.get(e);r&&(r.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Ke(r=>{this._globalSubscription||this._addGlobalListener();const i=e>0?this._scrolled.pipe(eg(e)).subscribe(r):this._scrolled.subscribe(r);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):_e()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,r)=>this.deregister(r)),this._scrolled.complete()}ancestorScrolled(e,r){const i=this.getAncestorScrollContainers(e);return this.scrolled(r).pipe(vr(o=>!o||i.indexOf(o)>-1))}getAncestorScrollContainers(e){const r=[];return this.scrollContainers.forEach((i,o)=>{this._scrollableContainsElement(o,e)&&r.push(o)}),r}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,r){let i=function(n){return n instanceof se?n.nativeElement:n}(r),o=e.getElementRef().nativeElement;do{if(i==o)return!0}while(i=i.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Ad(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(e){return new(e||n)(R(ve),R(mt),R(ae,8))},n.\u0275prov=K({factory:function(){return new n(R(ve),R(mt),R(ae,8))},token:n,providedIn:"root"}),n})(),Md=(()=>{class n{constructor(e,r,i){this._platform=e,this._change=new be,this._changeListener=o=>{this._change.next(o)},this._document=i,r.runOutsideAngular(()=>{if(e.isBrowser){const o=this._getWindow();o.addEventListener("resize",this._changeListener),o.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:r,height:i}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+i,right:e.left+r,height:i,width:r}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,r=this._getWindow(),i=e.documentElement,o=i.getBoundingClientRect();return{top:-o.top||e.body.scrollTop||r.scrollY||i.scrollTop||0,left:-o.left||e.body.scrollLeft||r.scrollX||i.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(eg(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(e){return new(e||n)(R(mt),R(ve),R(ae,8))},n.\u0275prov=K({factory:function(){return new n(R(mt),R(ve),R(ae,8))},token:n,providedIn:"root"}),n})(),ix=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({}),n})(),gF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[fl,pd,ix],fl,ix]}),n})();class ox{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class mF extends ox{constructor(t,e,r,i){super(),this.component=t,this.viewContainerRef=e,this.injector=r,this.componentFactoryResolver=i}}class sx extends ox{constructor(t,e,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class vX extends ox{constructor(t){super(),this.element=t instanceof se?t.nativeElement:t}}class yX extends class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof mF?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof sx?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof vX?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(t,e,r,i,o){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=r,this._defaultInjector=i,this.attachDomPortal=s=>{const a=s.element,u=this._document.createComment("dom-portal");a.parentNode.insertBefore(u,a),this.outletElement.appendChild(a),this._attachedPortal=s,super.setDisposeFn(()=>{u.parentNode&&u.parentNode.replaceChild(a,u)})},this._document=o}attachComponentPortal(t){const r=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let i;return t.viewContainerRef?(i=t.viewContainerRef.createComponent(r,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>i.destroy())):(i=r.create(t.injector||this._defaultInjector),this._appRef.attachView(i.hostView),this.setDisposeFn(()=>{this._appRef.detachView(i.hostView),i.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(i)),this._attachedPortal=t,i}attachTemplatePortal(t){let e=t.viewContainerRef,r=e.createEmbeddedView(t.templateRef,t.context);return r.rootNodes.forEach(i=>this.outletElement.appendChild(i)),r.detectChanges(),this.setDisposeFn(()=>{let i=e.indexOf(r);-1!==i&&e.remove(i)}),this._attachedPortal=t,r}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let yF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({}),n})();const _F=eT();class wX{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=un(-this._previousScrollPosition.left),t.style.top=un(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,r=t.style,i=this._document.body.style,o=r.scrollBehavior||"",s=i.scrollBehavior||"";this._isEnabled=!1,r.left=this._previousHTMLStyles.left,r.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),_F&&(r.scrollBehavior=i.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),_F&&(r.scrollBehavior=o,i.scrollBehavior=s)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,r=this._viewportRuler.getViewportSize();return e.scrollHeight>r.height||e.scrollWidth>r.width}}class CX{constructor(t,e,r,i){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=r,this._config=i,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class bF{enable(){}disable(){}attach(){}}function ux(n,t){return t.some(e=>n.bottom<e.top||n.top>e.bottom||n.right<e.left||n.left>e.right)}function xF(n,t){return t.some(e=>n.top<e.top||n.bottom>e.bottom||n.left<e.left||n.right>e.right)}class EX{constructor(t,e,r,i){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=r,this._config=i,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:r,height:i}=this._viewportRuler.getViewportSize();ux(e,[{width:r,height:i,bottom:i,right:r,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let DX=(()=>{class n{constructor(e,r,i,o){this._scrollDispatcher=e,this._viewportRuler=r,this._ngZone=i,this.noop=()=>new bF,this.close=s=>new CX(this._scrollDispatcher,this._ngZone,this._viewportRuler,s),this.block=()=>new wX(this._viewportRuler,this._document),this.reposition=s=>new EX(this._scrollDispatcher,this._viewportRuler,this._ngZone,s),this._document=o}}return n.\u0275fac=function(e){return new(e||n)(R(bl),R(Md),R(ve),R(ae))},n.\u0275prov=K({factory:function(){return new n(R(bl),R(Md),R(ve),R(ae))},token:n,providedIn:"root"}),n})();class wF{constructor(t){if(this.scrollStrategy=new bF,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const r of e)void 0!==t[r]&&(this[r]=t[r])}}}class SX{constructor(t,e,r,i,o){this.offsetX=r,this.offsetY=i,this.panelClass=o,this.originX=t.originX,this.originY=t.originY,this.overlayX=e.overlayX,this.overlayY=e.overlayY}}class AX{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}let CF=(()=>{class n{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const r=this._attachedOverlays.indexOf(e);r>-1&&this._attachedOverlays.splice(r,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({factory:function(){return new n(R(ae))},token:n,providedIn:"root"}),n})(),MX=(()=>{class n extends CF{constructor(e){super(e),this._keydownListener=r=>{const i=this._attachedOverlays;for(let o=i.length-1;o>-1;o--)if(i[o]._keydownEvents.observers.length>0){i[o]._keydownEvents.next(r);break}}}add(e){super.add(e),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(e){return new(e||n)(R(ae))},n.\u0275prov=K({factory:function(){return new n(R(ae))},token:n,providedIn:"root"}),n})(),IX=(()=>{class n extends CF{constructor(e,r){super(e),this._platform=r,this._cursorStyleIsSet=!1,this._pointerDownListener=i=>{this._pointerDownEventTarget=Aa(i)},this._clickListener=i=>{const o=Aa(i),s="click"===i.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:o;this._pointerDownEventTarget=null;const a=this._attachedOverlays.slice();for(let u=a.length-1;u>-1;u--){const l=a[u];if(!(l._outsidePointerEvents.observers.length<1)&&l.hasAttached()){if(l.overlayElement.contains(o)||l.overlayElement.contains(s))break;l._outsidePointerEvents.next(i)}}}}add(e){if(super.add(e),!this._isAttached){const r=this._document.body;r.addEventListener("pointerdown",this._pointerDownListener,!0),r.addEventListener("click",this._clickListener,!0),r.addEventListener("auxclick",this._clickListener,!0),r.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=r.style.cursor,r.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return n.\u0275fac=function(e){return new(e||n)(R(ae),R(mt))},n.\u0275prov=K({factory:function(){return new n(R(ae),R(mt))},token:n,providedIn:"root"}),n})(),lx=(()=>{class n{constructor(e,r){this._platform=r,this._document=e}ngOnDestroy(){const e=this._containerElement;e&&e.parentNode&&e.parentNode.removeChild(e)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||hb()){const i=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let o=0;o<i.length;o++)i[o].parentNode.removeChild(i[o])}const r=this._document.createElement("div");r.classList.add(e),hb()?r.setAttribute("platform","test"):this._platform.isBrowser||r.setAttribute("platform","server"),this._document.body.appendChild(r),this._containerElement=r}}return n.\u0275fac=function(e){return new(e||n)(R(ae),R(mt))},n.\u0275prov=K({factory:function(){return new n(R(ae),R(mt))},token:n,providedIn:"root"}),n})();class TX{constructor(t,e,r,i,o,s,a,u,l){this._portalOutlet=t,this._host=e,this._pane=r,this._config=i,this._ngZone=o,this._keyboardDispatcher=s,this._document=a,this._location=u,this._outsideClickDispatcher=l,this._backdropElement=null,this._backdropClick=new be,this._attachments=new be,this._detachments=new be,this._locationChanges=st.EMPTY,this._backdropClickHandler=c=>this._backdropClick.next(c),this._keydownEvents=new be,this._outsidePointerEvents=new be,i.scrollStrategy&&(this._scrollStrategy=i.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=i.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){let e=this._portalOutlet.attach(t);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Mi(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign(Object.assign({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Object.assign(Object.assign({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=un(this._config.width),t.height=un(this._config.height),t.minWidth=un(this._config.minWidth),t.minHeight=un(this._config.minHeight),t.maxWidth=un(this._config.maxWidth),t.maxHeight=un(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(!t)return;let e;const r=()=>{t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",r),this._disposeBackdrop(t)),this._config.backdropClass&&this._toggleClasses(t,this._config.backdropClass,!1),clearTimeout(e)};t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",r)}),t.style.pointerEvents="none",e=this._ngZone.runOutsideAngular(()=>setTimeout(r,500))}_toggleClasses(t,e,r){const i=t.classList;Cp(e).forEach(o=>{o&&(r?i.add(o):i.remove(o))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(Rt(ic(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.parentNode&&t.parentNode.removeChild(t),this._backdropElement===t&&(this._backdropElement=null))}}const EF="cdk-overlay-connected-position-bounding-box",RX=/([A-Za-z%]+)$/;class DF{constructor(t,e,r,i,o){this._viewportRuler=e,this._document=r,this._platform=i,this._overlayContainer=o,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new be,this._resizeSubscription=st.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){this._validatePositions(),t.hostElement.classList.add(EF),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const t=this._originRect,e=this._overlayRect,r=this._viewportRect,i=[];let o;for(let s of this._preferredPositions){let a=this._getOriginPoint(t,s),u=this._getOverlayPoint(a,e,s),l=this._getOverlayFit(u,e,r,s);if(l.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(s,a);this._canFitWithFlexibleDimensions(l,u,r)?i.push({position:s,origin:a,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(a,s)}):(!o||o.overlayFit.visibleArea<l.visibleArea)&&(o={overlayFit:l,overlayPoint:u,originPoint:a,position:s,overlayRect:e})}if(i.length){let s=null,a=-1;for(const u of i){const l=u.boundingBoxRect.width*u.boundingBoxRect.height*(u.position.weight||1);l>a&&(a=l,s=u)}return this._isPushed=!1,void this._applyPosition(s.position,s.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(o.position,o.originPoint);this._applyPosition(o.position,o.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Na(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(EF),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const t=this._lastPosition||this._preferredPositions[0],e=this._getOriginPoint(this._originRect,t);this._applyPosition(t,e)}}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e){let r,i;if("center"==e.originX)r=t.left+t.width/2;else{const o=this._isRtl()?t.right:t.left,s=this._isRtl()?t.left:t.right;r="start"==e.originX?o:s}return i="center"==e.originY?t.top+t.height/2:"top"==e.originY?t.top:t.bottom,{x:r,y:i}}_getOverlayPoint(t,e,r){let i,o;return i="center"==r.overlayX?-e.width/2:"start"===r.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,o="center"==r.overlayY?-e.height/2:"top"==r.overlayY?0:-e.height,{x:t.x+i,y:t.y+o}}_getOverlayFit(t,e,r,i){const o=AF(e);let{x:s,y:a}=t,u=this._getOffset(i,"x"),l=this._getOffset(i,"y");u&&(s+=u),l&&(a+=l);let h=0-a,f=a+o.height-r.height,p=this._subtractOverflows(o.width,0-s,s+o.width-r.width),m=this._subtractOverflows(o.height,h,f),g=p*m;return{visibleArea:g,isCompletelyWithinViewport:o.width*o.height===g,fitsInViewportVertically:m===o.height,fitsInViewportHorizontally:p==o.width}}_canFitWithFlexibleDimensions(t,e,r){if(this._hasFlexibleDimensions){const i=r.bottom-e.y,o=r.right-e.x,s=SF(this._overlayRef.getConfig().minHeight),a=SF(this._overlayRef.getConfig().minWidth),l=t.fitsInViewportHorizontally||null!=a&&a<=o;return(t.fitsInViewportVertically||null!=s&&s<=i)&&l}return!1}_pushOverlayOnScreen(t,e,r){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const i=AF(e),o=this._viewportRect,s=Math.max(t.x+i.width-o.width,0),a=Math.max(t.y+i.height-o.height,0),u=Math.max(o.top-r.top-t.y,0),l=Math.max(o.left-r.left-t.x,0);let c=0,d=0;return c=i.width<=o.width?l||-s:t.x<this._viewportMargin?o.left-r.left-t.x:0,d=i.height<=o.height?u||-a:t.y<this._viewportMargin?o.top-r.top-t.y:0,this._previousPushAmount={x:c,y:d},{x:t.x+c,y:t.y+d}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const r=this._getScrollVisibility(),i=new AX(t,r);this._positionChanges.next(i)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let r,i=t.overlayY;r="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let o=0;o<e.length;o++)e[o].style.transformOrigin=`${r} ${i}`}_calculateBoundingBoxRect(t,e){const r=this._viewportRect,i=this._isRtl();let o,s,a,c,d,h;if("top"===e.overlayY)s=t.y,o=r.height-s+this._viewportMargin;else if("bottom"===e.overlayY)a=r.height-t.y+2*this._viewportMargin,o=r.height-a+this._viewportMargin;else{const f=Math.min(r.bottom-t.y+r.top,t.y),p=this._lastBoundingBoxSize.height;o=2*f,s=t.y-f,o>p&&!this._isInitialRender&&!this._growAfterOpen&&(s=t.y-p/2)}if("end"===e.overlayX&&!i||"start"===e.overlayX&&i)h=r.width-t.x+this._viewportMargin,c=t.x-this._viewportMargin;else if("start"===e.overlayX&&!i||"end"===e.overlayX&&i)d=t.x,c=r.right-t.x;else{const f=Math.min(r.right-t.x+r.left,t.x),p=this._lastBoundingBoxSize.width;c=2*f,d=t.x-f,c>p&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.x-p/2)}return{top:s,left:d,bottom:a,right:h,width:c,height:o}}_setBoundingBoxStyles(t,e){const r=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(r.height=Math.min(r.height,this._lastBoundingBoxSize.height),r.width=Math.min(r.width,this._lastBoundingBoxSize.width));const i={};if(this._hasExactPosition())i.top=i.left="0",i.bottom=i.right=i.maxHeight=i.maxWidth="",i.width=i.height="100%";else{const o=this._overlayRef.getConfig().maxHeight,s=this._overlayRef.getConfig().maxWidth;i.height=un(r.height),i.top=un(r.top),i.bottom=un(r.bottom),i.width=un(r.width),i.left=un(r.left),i.right=un(r.right),i.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",i.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",o&&(i.maxHeight=un(o)),s&&(i.maxWidth=un(s))}this._lastBoundingBoxSize=r,Na(this._boundingBox.style,i)}_resetBoundingBoxStyles(){Na(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Na(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const r={},i=this._hasExactPosition(),o=this._hasFlexibleDimensions,s=this._overlayRef.getConfig();if(i){const c=this._viewportRuler.getViewportScrollPosition();Na(r,this._getExactOverlayY(e,t,c)),Na(r,this._getExactOverlayX(e,t,c))}else r.position="static";let a="",u=this._getOffset(e,"x"),l=this._getOffset(e,"y");u&&(a+=`translateX(${u}px) `),l&&(a+=`translateY(${l}px)`),r.transform=a.trim(),s.maxHeight&&(i?r.maxHeight=un(s.maxHeight):o&&(r.maxHeight="")),s.maxWidth&&(i?r.maxWidth=un(s.maxWidth):o&&(r.maxWidth="")),Na(this._pane.style,r)}_getExactOverlayY(t,e,r){let i={top:"",bottom:""},o=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,r));let s=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return o.y-=s,"bottom"===t.overlayY?i.bottom=this._document.documentElement.clientHeight-(o.y+this._overlayRect.height)+"px":i.top=un(o.y),i}_getExactOverlayX(t,e,r){let s,i={left:"",right:""},o=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,r)),s=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===s?i.right=this._document.documentElement.clientWidth-(o.x+this._overlayRect.width)+"px":i.left=un(o.x),i}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),r=this._scrollables.map(i=>i.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:xF(t,r),isOriginOutsideView:ux(t,r),isOverlayClipped:xF(e,r),isOverlayOutsideView:ux(e,r)}}_subtractOverflows(t,...e){return e.reduce((r,i)=>r-Math.max(i,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,r=this._viewportRuler.getViewportScrollPosition();return{top:r.top+this._viewportMargin,left:r.left+this._viewportMargin,right:r.left+t-this._viewportMargin,bottom:r.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Cp(t).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof se)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const e=t.width||0,r=t.height||0;return{top:t.y,bottom:t.y+r,left:t.x,right:t.x+e,height:r,width:e}}}function Na(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function SF(n){if("number"!=typeof n&&null!=n){const[t,e]=n.split(RX);return e&&"px"!==e?null:parseFloat(t)}return n||null}function AF(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}class FX{constructor(t,e,r,i,o,s,a){this._preferredPositions=[],this._positionStrategy=new DF(r,i,o,s,a).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(t,e),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(t){this._overlayRef=t,this._positionStrategy.attach(t),this._direction&&(t.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(t){this._positionStrategy.withScrollableContainers(t)}withFallbackPosition(t,e,r,i){const o=new SX(t,e,r,i);return this._preferredPositions.push(o),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(t){return this._overlayRef?this._overlayRef.setDirection(t):this._direction=t,this}withOffsetX(t){return this._positionStrategy.withDefaultOffsetX(t),this}withOffsetY(t){return this._positionStrategy.withDefaultOffsetY(t),this}withLockedPosition(t){return this._positionStrategy.withLockedPosition(t),this}withPositions(t){return this._preferredPositions=t.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(t){return this._positionStrategy.setOrigin(t),this}}const MF="cdk-global-overlay-wrapper";class kX{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(MF),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._rightOffset="",this._leftOffset=t,this._justifyContent="flex-start",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._leftOffset="",this._rightOffset=t,this._justifyContent="flex-end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._justifyContent="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,r=this._overlayRef.getConfig(),{width:i,height:o,maxWidth:s,maxHeight:a}=r,u=!("100%"!==i&&"100vw"!==i||s&&"100%"!==s&&"100vw"!==s),l=!("100%"!==o&&"100vh"!==o||a&&"100%"!==a&&"100vh"!==a);t.position=this._cssPosition,t.marginLeft=u?"0":this._leftOffset,t.marginTop=l?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=this._rightOffset,u?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems=l?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,r=e.style;e.classList.remove(MF),r.justifyContent=r.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let OX=(()=>{class n{constructor(e,r,i,o){this._viewportRuler=e,this._document=r,this._platform=i,this._overlayContainer=o}global(){return new kX}connectedTo(e,r,i){return new FX(r,i,e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(e){return new DF(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(e){return new(e||n)(R(Md),R(ae),R(mt),R(lx))},n.\u0275prov=K({factory:function(){return new n(R(Md),R(ae),R(mt),R(lx))},token:n,providedIn:"root"}),n})(),NX=0,xl=(()=>{class n{constructor(e,r,i,o,s,a,u,l,c,d,h){this.scrollStrategies=e,this._overlayContainer=r,this._componentFactoryResolver=i,this._positionBuilder=o,this._keyboardDispatcher=s,this._injector=a,this._ngZone=u,this._document=l,this._directionality=c,this._location=d,this._outsideClickDispatcher=h}create(e){const r=this._createHostElement(),i=this._createPaneElement(r),o=this._createPortalOutlet(i),s=new wF(e);return s.direction=s.direction||this._directionality.value,new TX(o,r,i,s,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(e){const r=this._document.createElement("div");return r.id="cdk-overlay-"+NX++,r.classList.add("cdk-overlay-pane"),e.appendChild(r),r}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(ya)),new yX(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(e){return new(e||n)(R(DX),R(lx),R(ko),R(OX),R(MX),R(ct),R(ve),R(ae),R(ro),R(ul),R(IX))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const BX={provide:new re("cdk-connected-overlay-scroll-strategy"),deps:[xl],useFactory:function(n){return()=>n.scrollStrategies.reposition()}};let TF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[xl,BX],imports:[[fl,yF,gF],gF]}),n})();class VX extends vt{notifyNext(t,e,r,i,o){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class HX extends vt{constructor(t,e,r){super(),this.parent=t,this.outerValue=e,this.outerIndex=r,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function UX(n,t,e,r,i=new HX(n,e,r)){if(!i.closed)return t instanceof Ke?t.subscribe(i):Bm(t)(i)}const RF={};class jX{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new WX(t,this.resultSelector))}}class WX extends VX{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(RF),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let r=0;r<e;r++)this.add(UX(this,t[r],void 0,r))}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,r){const i=this.values,s=this.toRespond?i[r]===RF?--this.toRespond:this.toRespond:0;i[r]=e,0===s&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(r){return void this.destination.error(r)}this.destination.next(e)}}const JX={provide:new re("mat-tooltip-scroll-strategy"),deps:[xl],useFactory:function(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}};let iQ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[JX],imports:[[BK,ll,TF,On],On,ix]}),n})(),dx=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[ll,On,iT],On]}),n})(),YF=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[pd]]}),n})(),Rk=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({}),n})();const Sx=new re("NgModelWithFormControlWarning");let Kk=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[Rk]]}),n})(),CJ=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:Sx,useValue:e.warnOnNgModelWithFormControl}]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[Kk]}),n})(),MJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[IR],imports:[[YF,dx,On],YF,dx]}),n})(),NJ=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[TF,yF,ll,UR,On],On]}),n})();const gg=(()=>{function n(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return n.prototype=Object.create(Error.prototype),n})();function Xk(n){return new Ke(t=>{let e;try{e=n()}catch(i){return void t.error(i)}return(e?Jt(e):wp()).subscribe(t)})}function Fx(n,t){let e=!1;return arguments.length>=2&&(e=!0),function(i){return i.lift(new LJ(n,t,e))}}class LJ{constructor(t,e,r=!1){this.accumulator=t,this.seed=e,this.hasSeed=r}call(t,e){return e.subscribe(new BJ(t,this.accumulator,this.seed,this.hasSeed))}}class BJ extends vt{constructor(t,e,r,i){super(t),this.accumulator=e,this._seed=r,this.hasSeed=i,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let r;try{r=this.accumulator(this.seed,t,e)}catch(i){this.destination.error(i)}this.seed=r,this.destination.next(r)}}function kx(n){return function(e){return 0===n?wp():e.lift(new VJ(n))}}class VJ{constructor(t){if(this.total=t,this.total<0)throw new YI}call(t,e){return e.subscribe(new HJ(t,this.total))}}class HJ extends vt{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,r=this.total,i=this.count++;e.length<r?e.push(t):e[i%r]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const r=this.count>=this.total?this.total:this.count,i=this.ring;for(let o=0;o<r;o++){const s=e++%r;t.next(i[s])}}t.complete()}}function Qk(n=WJ){return t=>t.lift(new UJ(n))}class UJ{constructor(t){this.errorFactory=t}call(t,e){return e.subscribe(new jJ(t,this.errorFactory))}}class jJ extends vt{constructor(t,e){super(t),this.errorFactory=e,this.hasValue=!1}_next(t){this.hasValue=!0,this.destination.next(t)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)}}}function WJ(){return new gg}function Jk(n=null){return t=>t.lift(new GJ(n))}class GJ{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new zJ(t,this.defaultValue))}}class zJ extends vt{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function El(n,t){const e=arguments.length>=2;return r=>r.pipe(n?vr((i,o)=>n(i,o,r)):Ih,Mi(1),e?Jk(t):Qk(()=>new gg))}class zo{constructor(t,e){this.id=t,this.url=e}}class Ox extends zo{constructor(t,e,r="imperative",i=null){super(t,e),this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class kd extends zo{constructor(t,e,r){super(t,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Zk extends zo{constructor(t,e,r){super(t,e),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class qJ extends zo{constructor(t,e,r){super(t,e),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Nx extends zo{constructor(t,e,r,i){super(t,e),this.urlAfterRedirects=r,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class KJ extends zo{constructor(t,e,r,i){super(t,e),this.urlAfterRedirects=r,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class YJ extends zo{constructor(t,e,r,i,o){super(t,e),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class XJ extends zo{constructor(t,e,r,i){super(t,e),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class QJ extends zo{constructor(t,e,r,i){super(t,e),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class eO{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class tO{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class JJ{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZJ{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eZ{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tZ{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class nO{constructor(t,e,r){this.routerEvent=t,this.position=e,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const ze="primary";class nZ{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Dl(n){return new nZ(n)}const rO="ngNavigationCancelingError";function Px(n){const t=Error("NavigationCancelingError: "+n);return t[rO]=!0,t}function iZ(n,t,e){const r=e.path.split("/");if(r.length>n.length||"full"===e.pathMatch&&(t.hasChildren()||r.length<n.length))return null;const i={};for(let o=0;o<r.length;o++){const s=r[o],a=n[o];if(s.startsWith(":"))i[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function so(n,t){const e=n?Object.keys(n):void 0,r=t?Object.keys(t):void 0;if(!e||!r||e.length!=r.length)return!1;let i;for(let o=0;o<e.length;o++)if(i=e[o],!iO(n[i],t[i]))return!1;return!0}function iO(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;const e=[...n].sort(),r=[...t].sort();return e.every((i,o)=>r[o]===i)}return n===t}function oO(n){return Array.prototype.concat.apply([],n)}function sO(n){return n.length>0?n[n.length-1]:null}function Nn(n,t){for(const e in n)n.hasOwnProperty(e)&&t(n[e],e)}function ao(n){return Sf(n)?n:Nc(n)?Jt(Promise.resolve(n)):_e(n)}const aZ={exact:function lO(n,t,e){if(!Ba(n.segments,t.segments)||!mg(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!n.children[r]||!lO(n.children[r],t.children[r],e))return!1;return!0},subset:cO},aO={exact:function(n,t){return so(n,t)},subset:function(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>iO(n[e],t[e]))},ignored:()=>!0};function uO(n,t,e){return aZ[e.paths](n.root,t.root,e.matrixParams)&&aO[e.queryParams](n.queryParams,t.queryParams)&&!("exact"===e.fragment&&n.fragment!==t.fragment)}function cO(n,t,e){return dO(n,t,t.segments,e)}function dO(n,t,e,r){if(n.segments.length>e.length){const i=n.segments.slice(0,e.length);return!(!Ba(i,e)||t.hasChildren()||!mg(i,e,r))}if(n.segments.length===e.length){if(!Ba(n.segments,e)||!mg(n.segments,e,r))return!1;for(const i in t.children)if(!n.children[i]||!cO(n.children[i],t.children[i],r))return!1;return!0}{const i=e.slice(0,n.segments.length),o=e.slice(n.segments.length);return!!(Ba(n.segments,i)&&mg(n.segments,i,r)&&n.children[ze])&&dO(n.children[ze],t,o,r)}}function mg(n,t,e){return t.every((r,i)=>aO[e](n[i].parameters,r.parameters))}class La{constructor(t,e,r){this.root=t,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Dl(this.queryParams)),this._queryParamMap}toString(){return hZ.serialize(this)}}class Qe{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Nn(e,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return vg(this)}}class Od{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Dl(this.parameters)),this._parameterMap}toString(){return gO(this)}}function Ba(n,t){return n.length===t.length&&n.every((e,r)=>e.path===t[r].path)}class Lx{}class hO{parse(t){const e=new xZ(t);return new La(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){const e=`/${Nd(t.root,!0)}`,r=function(n){const t=Object.keys(n).map(e=>{const r=n[e];return Array.isArray(r)?r.map(i=>`${yg(e)}=${yg(i)}`).join("&"):`${yg(e)}=${yg(r)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(t.queryParams),i="string"==typeof t.fragment?`#${function(n){return encodeURI(n)}(t.fragment)}`:"";return`${e}${r}${i}`}}const hZ=new hO;function vg(n){return n.segments.map(t=>gO(t)).join("/")}function Nd(n,t){if(!n.hasChildren())return vg(n);if(t){const e=n.children[ze]?Nd(n.children[ze],!1):"",r=[];return Nn(n.children,(i,o)=>{o!==ze&&r.push(`${o}:${Nd(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}{const e=function(n,t){let e=[];return Nn(n.children,(r,i)=>{i===ze&&(e=e.concat(t(r,i)))}),Nn(n.children,(r,i)=>{i!==ze&&(e=e.concat(t(r,i)))}),e}(n,(r,i)=>i===ze?[Nd(n.children[ze],!1)]:[`${i}:${Nd(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[ze]?`${vg(n)}/${e[0]}`:`${vg(n)}/(${e.join("//")})`}}function fO(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function yg(n){return fO(n).replace(/%3B/gi,";")}function Bx(n){return fO(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function _g(n){return decodeURIComponent(n)}function pO(n){return _g(n.replace(/\+/g,"%20"))}function gO(n){return`${Bx(n.path)}${function(n){return Object.keys(n).map(t=>`;${Bx(t)}=${Bx(n[t])}`).join("")}(n.parameters)}`}const mZ=/^[^\/()?;=#]+/;function bg(n){const t=n.match(mZ);return t?t[0]:""}const vZ=/^[^=?&#]+/,_Z=/^[^?&#]+/;class xZ{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Qe([],{}):new Qe([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(r[ze]=new Qe(t,e)),r}parseSegment(){const t=bg(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new Od(_g(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=bg(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const i=bg(this.remaining);i&&(r=i,this.capture(r))}t[_g(e)]=_g(r)}parseQueryParam(t){const e=function(n){const t=n.match(vZ);return t?t[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const s=function(n){const t=n.match(_Z);return t?t[0]:""}(this.remaining);s&&(r=s,this.capture(r))}const i=pO(e),o=pO(r);if(t.hasOwnProperty(i)){let s=t[i];Array.isArray(s)||(s=[s],t[i]=s),s.push(o)}else t[i]=o}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=bg(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error(`Cannot parse url '${this.url}'`);let o;r.indexOf(":")>-1?(o=r.substr(0,r.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=ze);const s=this.parseChildren();e[o]=1===Object.keys(s).length?s[ze]:new Qe([],s),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class mO{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=Vx(t,this._root);return e?e.children.map(r=>r.value):[]}firstChild(t){const e=Vx(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=Hx(t,this._root);return e.length<2?[]:e[e.length-2].children.map(i=>i.value).filter(i=>i!==t)}pathFromRoot(t){return Hx(t,this._root).map(e=>e.value)}}function Vx(n,t){if(n===t.value)return t;for(const e of t.children){const r=Vx(n,e);if(r)return r}return null}function Hx(n,t){if(n===t.value)return[t];for(const e of t.children){const r=Hx(n,e);if(r.length)return r.unshift(t),r}return[]}class $o{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Pd(n){const t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}class vO extends mO{constructor(t,e){super(t),this.snapshot=e,Ux(this,t)}toString(){return this.snapshot.toString()}}function yO(n,t){const e=function(n,t){const s=new xg([],{},{},"",{},ze,t,null,n.root,-1,{});return new bO("",new $o(s,[]))}(n,t),r=new cr([new Od("",{})]),i=new cr({}),o=new cr({}),s=new cr({}),a=new cr(""),u=new Sl(r,i,s,a,o,ze,t,e.root);return u.snapshot=e.root,new vO(new $o(u,[]),e)}class Sl{constructor(t,e,r,i,o,s,a,u){this.url=t,this.params=e,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this._futureSnapshot=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Se(t=>Dl(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Se(t=>Dl(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function _O(n,t="emptyOnly"){const e=n.pathFromRoot;let r=0;if("always"!==t)for(r=e.length-1;r>=1;){const i=e[r],o=e[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(o.component)break;r--}}return function(n){return n.reduce((t,e)=>({params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign({},t.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(e.slice(r))}class xg{constructor(t,e,r,i,o,s,a,u,l,c,d){this.url=t,this.params=e,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this.routeConfig=u,this._urlSegment=l,this._lastPathIndex=c,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Dl(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Dl(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class bO extends mO{constructor(t,e){super(e),this.url=t,Ux(this,e)}toString(){return xO(this._root)}}function Ux(n,t){t.value._routerState=n,t.children.forEach(e=>Ux(n,e))}function xO(n){const t=n.children.length>0?` { ${n.children.map(xO).join(", ")} } `:"";return`${n.value}${t}`}function jx(n){if(n.snapshot){const t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,so(t.queryParams,e.queryParams)||n.queryParams.next(e.queryParams),t.fragment!==e.fragment&&n.fragment.next(e.fragment),so(t.params,e.params)||n.params.next(e.params),function(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!so(n[e],t[e]))return!1;return!0}(t.url,e.url)||n.url.next(e.url),so(t.data,e.data)||n.data.next(e.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function Wx(n,t){const e=so(n.params,t.params)&&function(n,t){return Ba(n,t)&&n.every((e,r)=>so(e.parameters,t[r].parameters))}(n.url,t.url);return e&&!(!n.parent!=!t.parent)&&(!n.parent||Wx(n.parent,t.parent))}function wg(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){const r=e.value;r._futureSnapshot=t.value;const i=function(n,t,e){return t.children.map(r=>{for(const i of e.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return wg(n,r,i);return wg(n,r)})}(n,t,e);return new $o(r,i)}{if(n.shouldAttach(t.value)){const o=n.retrieve(t.value);if(null!==o){const s=o.route;return wO(t,s),s}}const r=function(n){return new Sl(new cr(n.url),new cr(n.params),new cr(n.queryParams),new cr(n.fragment),new cr(n.data),n.outlet,n.component,n)}(t.value),i=t.children.map(o=>wg(n,o));return new $o(r,i)}}function wO(n,t){if(n.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(n.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=n.value;for(let e=0;e<n.children.length;++e)wO(n.children[e],t.children[e])}function Cg(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Ld(n){return"object"==typeof n&&null!=n&&n.outlets}function Gx(n,t,e,r,i){let o={};return r&&Nn(r,(s,a)=>{o[a]=Array.isArray(s)?s.map(u=>`${u}`):`${s}`}),new La(e.root===n?t:CO(e.root,n,t),o,i)}function CO(n,t,e){const r={};return Nn(n.children,(i,o)=>{r[o]=i===t?e:CO(i,t,e)}),new Qe(n.segments,r)}class EO{constructor(t,e,r){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=r,t&&r.length>0&&Cg(r[0]))throw new Error("Root segment cannot have matrix parameters");const i=r.find(Ld);if(i&&i!==sO(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class zx{constructor(t,e,r){this.segmentGroup=t,this.processChildren=e,this.index=r}}function DO(n,t,e){if(n||(n=new Qe([],{})),0===n.segments.length&&n.hasChildren())return Eg(n,t,e);const r=function(n,t,e){let r=0,i=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=e.length)return o;const s=n.segments[i],a=e[r];if(Ld(a))break;const u=`${a}`,l=r<e.length-1?e[r+1]:null;if(i>0&&void 0===u)break;if(u&&l&&"object"==typeof l&&void 0===l.outlets){if(!AO(u,l,s))return o;r+=2}else{if(!AO(u,{},s))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(n,t,e),i=e.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const o=new Qe(n.segments.slice(0,r.pathIndex),{});return o.children[ze]=new Qe(n.segments.slice(r.pathIndex),n.children),Eg(o,0,i)}return r.match&&0===i.length?new Qe(n.segments,{}):r.match&&!n.hasChildren()?$x(n,t,e):r.match?Eg(n,0,i):$x(n,t,e)}function Eg(n,t,e){if(0===e.length)return new Qe(n.segments,{});{const r=function(n){return Ld(n[0])?n[0].outlets:{[ze]:n}}(e),i={};return Nn(r,(o,s)=>{"string"==typeof o&&(o=[o]),null!==o&&(i[s]=DO(n.children[s],t,o))}),Nn(n.children,(o,s)=>{void 0===r[s]&&(i[s]=o)}),new Qe(n.segments,i)}}function $x(n,t,e){const r=n.segments.slice(0,t);let i=0;for(;i<e.length;){const o=e[i];if(Ld(o)){const u=kZ(o.outlets);return new Qe(r,u)}if(0===i&&Cg(e[0])){r.push(new Od(n.segments[t].path,SO(e[0]))),i++;continue}const s=Ld(o)?o.outlets[ze]:`${o}`,a=i<e.length-1?e[i+1]:null;s&&a&&Cg(a)?(r.push(new Od(s,SO(a))),i+=2):(r.push(new Od(s,{})),i++)}return new Qe(r,{})}function kZ(n){const t={};return Nn(n,(e,r)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[r]=$x(new Qe([],{}),0,e))}),t}function SO(n){const t={};return Nn(n,(e,r)=>t[r]=`${e}`),t}function AO(n,t,e){return n==e.path&&so(t,e.parameters)}class NZ{constructor(t,e,r,i){this.routeReuseStrategy=t,this.futureState=e,this.currState=r,this.forwardEvent=i}activate(t){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,t),jx(this.futureState.root),this.activateChildRoutes(e,r,t)}deactivateChildRoutes(t,e,r){const i=Pd(e);t.children.forEach(o=>{const s=o.value.outlet;this.deactivateRoutes(o,i[s],r),delete i[s]}),Nn(i,(o,s)=>{this.deactivateRouteAndItsChildren(o,r)})}deactivateRoutes(t,e,r){const i=t.value,o=e?e.value:null;if(i===o)if(i.component){const s=r.getContext(i.outlet);s&&this.deactivateChildRoutes(t,e,s.children)}else this.deactivateChildRoutes(t,e,r);else o&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const r=e.getContext(t.value.outlet);if(r&&r.outlet){const i=r.outlet.detach(),o=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:i,route:t,contexts:o})}}deactivateRouteAndOutlet(t,e){const r=e.getContext(t.value.outlet),i=r&&t.value.component?r.children:e,o=Pd(t);for(const s of Object.keys(o))this.deactivateRouteAndItsChildren(o[s],i);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,e,r){const i=Pd(e);t.children.forEach(o=>{this.activateRoutes(o,i[o.value.outlet],r),this.forwardEvent(new tZ(o.value.snapshot))}),t.children.length&&this.forwardEvent(new ZJ(t.value.snapshot))}activateRoutes(t,e,r){const i=t.value,o=e?e.value:null;if(jx(i),i===o)if(i.component){const s=r.getOrCreateContext(i.outlet);this.activateChildRoutes(t,e,s.children)}else this.activateChildRoutes(t,e,r);else if(i.component){const s=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),MO(a.route)}else{const a=function(n){for(let t=n.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(i.snapshot),u=a?a.module.componentFactoryResolver:null;s.attachRef=null,s.route=i,s.resolver=u,s.outlet&&s.outlet.activateWith(i,u),this.activateChildRoutes(t,null,s.children)}}else this.activateChildRoutes(t,null,r)}}function MO(n){jx(n.value),n.children.forEach(MO)}class qx{constructor(t,e){this.routes=t,this.module=e}}function Ns(n){return"function"==typeof n}function Va(n){return n instanceof La}const Bd=Symbol("INITIAL_VALUE");function Vd(){return yr(n=>function(...n){let t,e;return au(n[n.length-1])&&(e=n.pop()),"function"==typeof n[n.length-1]&&(t=n.pop()),1===n.length&&su(n[0])&&(n=n[0]),Hm(n,e).lift(new jX(t))}(n.map(t=>t.pipe(Mi(1),Wo(Bd)))).pipe(Fx((t,e)=>{let r=!1;return e.reduce((i,o,s)=>i!==Bd?i:(o===Bd&&(r=!0),r||!1!==o&&s!==e.length-1&&!Va(o)?i:o),t)},Bd),vr(t=>t!==Bd),Se(t=>Va(t)?t:!0===t),Mi(1)))}let IO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Hn({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,r){1&e&&tn(0,"router-outlet")},directives:function(){return[ew]},encapsulation:2}),n})();function TO(n,t=""){for(let e=0;e<n.length;e++){const r=n[e];jZ(r,WZ(t,r))}}function jZ(n,t){n.children&&TO(n.children,t)}function WZ(n,t){return t?n||t.path?n&&!t.path?`${n}/`:!n&&t.path?t.path:`${n}/${t.path}`:"":n}function Kx(n){const t=n.children&&n.children.map(Kx),e=t?Object.assign(Object.assign({},n),{children:t}):Object.assign({},n);return!e.component&&(t||e.loadChildren)&&e.outlet&&e.outlet!==ze&&(e.component=IO),e}function oi(n){return n.outlet||ze}function RO(n,t){const e=n.filter(r=>oi(r)===t);return e.push(...n.filter(r=>oi(r)!==t)),e}const FO={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Dg(n,t,e){var r;if(""===t.path)return"full"===t.pathMatch&&(n.hasChildren()||e.length>0)?Object.assign({},FO):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const o=(t.matcher||iZ)(e,n,t);if(!o)return Object.assign({},FO);const s={};Nn(o.posParams,(u,l)=>{s[l]=u.path});const a=o.consumed.length>0?Object.assign(Object.assign({},s),o.consumed[o.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:o.consumed,lastChild:o.consumed.length,parameters:a,positionalParamSegments:null!==(r=o.posParams)&&void 0!==r?r:{}}}function Sg(n,t,e,r,i="corrected"){if(e.length>0&&function(n,t,e){return e.some(r=>Ag(n,t,r)&&oi(r)!==ze)}(n,e,r)){const s=new Qe(t,function(n,t,e,r){const i={};i[ze]=r,r._sourceSegment=n,r._segmentIndexShift=t.length;for(const o of e)if(""===o.path&&oi(o)!==ze){const s=new Qe([],{});s._sourceSegment=n,s._segmentIndexShift=t.length,i[oi(o)]=s}return i}(n,t,r,new Qe(e,n.children)));return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:[]}}if(0===e.length&&function(n,t,e){return e.some(r=>Ag(n,t,r))}(n,e,r)){const s=new Qe(n.segments,function(n,t,e,r,i,o){const s={};for(const a of r)if(Ag(n,e,a)&&!i[oi(a)]){const u=new Qe([],{});u._sourceSegment=n,u._segmentIndexShift="legacy"===o?n.segments.length:t.length,s[oi(a)]=u}return Object.assign(Object.assign({},i),s)}(n,t,e,r,n.children,i));return s._sourceSegment=n,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:e}}const o=new Qe(n.segments,n.children);return o._sourceSegment=n,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:e}}function Ag(n,t,e){return(!(n.hasChildren()||t.length>0)||"full"!==e.pathMatch)&&""===e.path}function kO(n,t,e,r){return!!(oi(n)===r||r!==ze&&Ag(t,e,n))&&("**"===n.path||Dg(t,n,e).matched)}function OO(n,t,e){return 0===t.length&&!n.children[e]}class Hd{constructor(t){this.segmentGroup=t||null}}class NO{constructor(t){this.urlTree=t}}function Mg(n){return new Ke(t=>t.error(new Hd(n)))}function PO(n){return new Ke(t=>t.error(new NO(n)))}function KZ(n){return new Ke(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${n}'`)))}class QZ{constructor(t,e,r,i,o){this.configLoader=e,this.urlSerializer=r,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(eo)}apply(){const t=Sg(this.urlTree.root,[],[],this.config).segmentGroup,e=new Qe(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,e,ze).pipe(Se(o=>this.createUrlTree(Yx(o),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ts(o=>{if(o instanceof NO)return this.allowRedirects=!1,this.match(o.urlTree);throw o instanceof Hd?this.noMatchError(o):o}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,ze).pipe(Se(i=>this.createUrlTree(Yx(i),t.queryParams,t.fragment))).pipe(Ts(i=>{throw i instanceof Hd?this.noMatchError(i):i}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,r){const i=t.segments.length>0?new Qe([],{[ze]:t}):t;return new La(i,e,r)}expandSegmentGroup(t,e,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,e,r).pipe(Se(o=>new Qe([],o))):this.expandSegment(t,r,e,r.segments,i,!0)}expandChildren(t,e,r){const i=[];for(const o of Object.keys(r.children))"primary"===o?i.unshift(o):i.push(o);return Jt(i).pipe(vl(o=>{const s=r.children[o],a=RO(e,o);return this.expandSegmentGroup(t,a,s,o).pipe(Se(u=>({segment:u,outlet:o})))}),Fx((o,s)=>(o[s.outlet]=s.segment,o),{}),function(n,t){const e=arguments.length>=2;return r=>r.pipe(n?vr((i,o)=>n(i,o,r)):Ih,kx(1),e?Jk(t):Qk(()=>new gg))}())}expandSegment(t,e,r,i,o,s){return Jt(r).pipe(vl(a=>this.expandSegmentAgainstRoute(t,e,r,a,i,o,s).pipe(Ts(l=>{if(l instanceof Hd)return _e(null);throw l}))),El(a=>!!a),Ts((a,u)=>{if(a instanceof gg||"EmptyError"===a.name){if(OO(e,i,o))return _e(new Qe([],{}));throw new Hd(e)}throw a}))}expandSegmentAgainstRoute(t,e,r,i,o,s,a){return kO(i,e,o,s)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,e,i,o,s):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,r,i,o,s):Mg(e):Mg(e)}expandSegmentAgainstRouteUsingRedirect(t,e,r,i,o,s){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,i,s):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,i,o,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,r,i){const o=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?PO(o):this.lineralizeSegments(r,o).pipe(En(s=>{const a=new Qe(s,{});return this.expandSegment(t,a,e,s,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,r,i,o,s){const{matched:a,consumedSegments:u,lastChild:l,positionalParamSegments:c}=Dg(e,i,o);if(!a)return Mg(e);const d=this.applyRedirectCommands(u,i.redirectTo,c);return i.redirectTo.startsWith("/")?PO(d):this.lineralizeSegments(i,d).pipe(En(h=>this.expandSegment(t,e,r,h.concat(o.slice(l)),s,!1)))}matchSegmentAgainstRoute(t,e,r,i,o){if("**"===r.path)return r.loadChildren?(r._loadedConfig?_e(r._loadedConfig):this.configLoader.load(t.injector,r)).pipe(Se(h=>(r._loadedConfig=h,new Qe(i,{})))):_e(new Qe(i,{}));const{matched:s,consumedSegments:a,lastChild:u}=Dg(e,r,i);if(!s)return Mg(e);const l=i.slice(u);return this.getChildConfig(t,r,i).pipe(En(d=>{const h=d.module,f=d.routes,{segmentGroup:p,slicedSegments:m}=Sg(e,a,l,f),g=new Qe(p.segments,p.children);if(0===m.length&&g.hasChildren())return this.expandChildren(h,f,g).pipe(Se(_=>new Qe(a,_)));if(0===f.length&&0===m.length)return _e(new Qe(a,{}));const v=oi(r)===o;return this.expandSegment(h,g,f,m,v?ze:o,!0).pipe(Se(b=>new Qe(a.concat(b.segments),b.children)))}))}getChildConfig(t,e,r){return e.children?_e(new qx(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?_e(e._loadedConfig):this.runCanLoadGuards(t.injector,e,r).pipe(En(i=>i?this.configLoader.load(t.injector,e).pipe(Se(o=>(e._loadedConfig=o,o))):function(n){return new Ke(t=>t.error(Px(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`)))}(e))):_e(new qx([],t))}runCanLoadGuards(t,e,r){const i=e.canLoad;if(!i||0===i.length)return _e(!0);const o=i.map(s=>{const a=t.get(s);let u;if(function(n){return n&&Ns(n.canLoad)}(a))u=a.canLoad(e,r);else{if(!Ns(a))throw new Error("Invalid CanLoad guard");u=a(e,r)}return ao(u)});return _e(o).pipe(Vd(),ln(s=>{if(!Va(s))return;const a=Px(`Redirecting to "${this.urlSerializer.serialize(s)}"`);throw a.url=s,a}),Se(s=>!0===s))}lineralizeSegments(t,e){let r=[],i=e.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return _e(r);if(i.numberOfChildren>1||!i.children[ze])return KZ(t.redirectTo);i=i.children[ze]}}applyRedirectCommands(t,e,r){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,r)}applyRedirectCreatreUrlTree(t,e,r,i){const o=this.createSegmentGroup(t,e.root,r,i);return new La(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const r={};return Nn(t,(i,o)=>{if("string"==typeof i&&i.startsWith(":")){const a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(t,e,r,i){const o=this.createSegments(t,e.segments,r,i);let s={};return Nn(e.children,(a,u)=>{s[u]=this.createSegmentGroup(t,a,r,i)}),new Qe(o,s)}createSegments(t,e,r,i){return e.map(o=>o.path.startsWith(":")?this.findPosParam(t,o,i):this.findOrReturn(o,r))}findPosParam(t,e,r){const i=r[e.path.substring(1)];if(!i)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return i}findOrReturn(t,e){let r=0;for(const i of e){if(i.path===t.path)return e.splice(r),i;r++}return t}}function Yx(n){const t={};for(const r of Object.keys(n.children)){const o=Yx(n.children[r]);(o.segments.length>0||o.hasChildren())&&(t[r]=o)}return function(n){if(1===n.numberOfChildren&&n.children[ze]){const t=n.children[ze];return new Qe(n.segments.concat(t.segments),t.children)}return n}(new Qe(n.segments,t))}class LO{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Ig{constructor(t,e){this.component=t,this.route=e}}function eee(n,t,e){const r=n._root;return Ud(r,t?t._root:null,e,[r.value])}function Tg(n,t,e){const r=function(n){if(!n)return null;for(let t=n.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:e).get(n)}function Ud(n,t,e,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=Pd(t);return n.children.forEach(s=>{(function(n,t,e,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=n.value,s=t?t.value:null,a=e?e.getContext(n.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const u=function(n,t,e){if("function"==typeof e)return e(n,t);switch(e){case"pathParamsChange":return!Ba(n.url,t.url);case"pathParamsOrQueryParamsChange":return!Ba(n.url,t.url)||!so(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Wx(n,t)||!so(n.queryParams,t.queryParams);default:return!Wx(n,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new LO(r)):(o.data=s.data,o._resolvedData=s._resolvedData),Ud(n,t,o.component?a?a.children:null:e,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Ig(a.outlet.component,s))}else s&&jd(t,a,i),i.canActivateChecks.push(new LO(r)),Ud(n,null,o.component?a?a.children:null:e,r,i)})(s,o[s.value.outlet],e,r.concat([s.value]),i),delete o[s.value.outlet]}),Nn(o,(s,a)=>jd(s,e.getContext(a),i)),i}function jd(n,t,e){const r=Pd(n),i=n.value;Nn(r,(o,s)=>{jd(o,i.component?t?t.children.getContext(s):null:t,e)}),e.canDeactivateChecks.push(new Ig(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class fee{}function BO(n){return new Ke(t=>t.error(n))}class gee{constructor(t,e,r,i,o,s){this.rootComponentType=t,this.config=e,this.urlTree=r,this.url=i,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=s}recognize(){const t=Sg(this.urlTree.root,[],[],this.config.filter(s=>void 0===s.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,ze);if(null===e)return null;const r=new xg([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},ze,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new $o(r,e),o=new bO(this.url,i);return this.inheritParamsAndData(o._root),o}inheritParamsAndData(t){const e=t.value,r=_O(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),t.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(t,e,r){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,r)}processChildren(t,e){const r=[];for(const o of Object.keys(e.children)){const s=e.children[o],a=RO(t,o),u=this.processSegmentGroup(a,s,o);if(null===u)return null;r.push(...u)}const i=VO(r);return function(n){n.sort((t,e)=>t.value.outlet===ze?-1:e.value.outlet===ze?1:t.value.outlet.localeCompare(e.value.outlet))}(i),i}processSegment(t,e,r,i){for(const o of t){const s=this.processSegmentAgainstRoute(o,e,r,i);if(null!==s)return s}return OO(e,r,i)?[]:null}processSegmentAgainstRoute(t,e,r,i){if(t.redirectTo||!kO(t,e,r,i))return null;let o,s=[],a=[];if("**"===t.path){const f=r.length>0?sO(r).parameters:{};o=new xg(r,f,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,jO(t),oi(t),t.component,t,HO(e),UO(e)+r.length,WO(t))}else{const f=Dg(e,t,r);if(!f.matched)return null;s=f.consumedSegments,a=r.slice(f.lastChild),o=new xg(s,f.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,jO(t),oi(t),t.component,t,HO(e),UO(e)+s.length,WO(t))}const u=function(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(t),{segmentGroup:l,slicedSegments:c}=Sg(e,s,a,u.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution);if(0===c.length&&l.hasChildren()){const f=this.processChildren(u,l);return null===f?null:[new $o(o,f)]}if(0===u.length&&0===c.length)return[new $o(o,[])];const d=oi(t)===i,h=this.processSegment(u,l,c,d?ze:i);return null===h?null:[new $o(o,h)]}}function yee(n){const t=n.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function VO(n){const t=[],e=new Set;for(const r of n){if(!yee(r)){t.push(r);continue}const i=t.find(o=>r.value.routeConfig===o.value.routeConfig);void 0!==i?(i.children.push(...r.children),e.add(i)):t.push(r)}for(const r of e){const i=VO(r.children);t.push(new $o(r.value,i))}return t.filter(r=>!e.has(r))}function HO(n){let t=n;for(;t._sourceSegment;)t=t._sourceSegment;return t}function UO(n){let t=n,e=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,e+=t._segmentIndexShift?t._segmentIndexShift:0;return e-1}function jO(n){return n.data||{}}function WO(n){return n.resolve||{}}function Xx(n){return yr(t=>{const e=n(t);return e?Jt(e).pipe(Se(()=>t)):_e(t)})}class See extends class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const Qx=new re("ROUTES");class GO{constructor(t,e,r,i){this.loader=t,this.compiler=e,this.onLoadStartListener=r,this.onLoadEndListener=i}load(t,e){if(e._loader$)return e._loader$;this.onLoadStartListener&&this.onLoadStartListener(e);const i=this.loadModuleFactory(e.loadChildren).pipe(Se(o=>{this.onLoadEndListener&&this.onLoadEndListener(e);const s=o.create(t);return new qx(oO(s.injector.get(Qx,void 0,xe.Self|xe.Optional)).map(Kx),s)}),Ts(o=>{throw e._loader$=void 0,o}));return e._loader$=new LC(i,()=>new be).pipe(Um()),e._loader$}loadModuleFactory(t){return"string"==typeof t?Jt(this.loader.load(t)):ao(t()).pipe(En(e=>e instanceof DA?_e(e):Jt(this.compiler.compileModuleAsync(e))))}}class Aee{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Al,this.attachRef=null}}class Al{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const r=this.getOrCreateContext(t);r.outlet=e,this.contexts.set(t,r)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new Aee,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}class Iee{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function Tee(n){throw n}function Ree(n,t,e){return t.parse("/")}function zO(n,t){return _e(null)}const Fee={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},kee={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let hr=(()=>{class n{constructor(e,r,i,o,s,a,u,l){this.rootComponentType=e,this.urlSerializer=r,this.rootContexts=i,this.location=o,this.config=l,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new be,this.errorHandler=Tee,this.malformedUriErrorHandler=Ree,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:zO,afterPreactivation:zO},this.urlHandlingStrategy=new Iee,this.routeReuseStrategy=new See,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=s.get(eo),this.console=s.get(Gf);const h=s.get(ve);this.isNgZoneEnabled=h instanceof ve&&ve.isInAngularZone(),this.resetConfig(l),this.currentUrlTree=new La(new Qe([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new GO(a,u,f=>this.triggerEvent(new eO(f)),f=>this.triggerEvent(new tO(f))),this.routerState=yO(this.currentUrlTree,this.rootComponentType),this.transitions=new cr({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const r=this.events;return e.pipe(vr(i=>0!==i.id),Se(i=>Object.assign(Object.assign({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),yr(i=>{let o=!1,s=!1;return _e(i).pipe(ln(a=>{this.currentNavigation={id:a.id,initialUrl:a.currentRawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),yr(a=>{const u=this.browserUrlTree.toString(),l=!this.navigated||a.extractedUrl.toString()!==u||u!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||l)&&this.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return Rg(a.source)&&(this.browserUrlTree=a.extractedUrl),_e(a).pipe(yr(d=>{const h=this.transitions.getValue();return r.next(new Ox(d.id,this.serializeUrl(d.extractedUrl),d.source,d.restoredState)),h!==this.transitions.getValue()?Ea:Promise.resolve(d)}),function(n,t,e,r){return yr(i=>function(n,t,e,r,i){return new QZ(n,t,e,r,i).apply()}(n,t,e,i.extractedUrl,r).pipe(Se(o=>Object.assign(Object.assign({},i),{urlAfterRedirects:o}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),ln(d=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:d.urlAfterRedirects})}),function(n,t,e,r,i){return En(o=>function(n,t,e,r,i="emptyOnly",o="legacy"){try{const s=new gee(n,t,e,r,i,o).recognize();return null===s?BO(new fee):_e(s)}catch(s){return BO(s)}}(n,t,o.urlAfterRedirects,e(o.urlAfterRedirects),r,i).pipe(Se(s=>Object.assign(Object.assign({},o),{targetSnapshot:s}))))}(this.rootComponentType,this.config,d=>this.serializeUrl(d),this.paramsInheritanceStrategy,this.relativeLinkResolution),ln(d=>{"eager"===this.urlUpdateStrategy&&(d.extras.skipLocationChange||this.setBrowserUrl(d.urlAfterRedirects,d),this.browserUrlTree=d.urlAfterRedirects);const h=new Nx(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);r.next(h)}));if(l&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:h,extractedUrl:f,source:p,restoredState:m,extras:g}=a,v=new Ox(h,this.serializeUrl(f),p,m);r.next(v);const y=yO(f,this.rootComponentType).snapshot;return _e(Object.assign(Object.assign({},a),{targetSnapshot:y,urlAfterRedirects:f,extras:Object.assign(Object.assign({},g),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=a.rawUrl,this.browserUrlTree=a.urlAfterRedirects,a.resolve(null),Ea}),Xx(a=>{const{targetSnapshot:u,id:l,extractedUrl:c,rawUrl:d,extras:{skipLocationChange:h,replaceUrl:f}}=a;return this.hooks.beforePreactivation(u,{navigationId:l,appliedUrlTree:c,rawUrlTree:d,skipLocationChange:!!h,replaceUrl:!!f})}),ln(a=>{const u=new KJ(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot);this.triggerEvent(u)}),Se(a=>Object.assign(Object.assign({},a),{guards:eee(a.targetSnapshot,a.currentSnapshot,this.rootContexts)})),function(n,t){return En(e=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=e;return 0===s.length&&0===o.length?_e(Object.assign(Object.assign({},e),{guardsResult:!0})):function(n,t,e,r){return Jt(n).pipe(En(i=>function(n,t,e,r,i){const o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?_e(o.map(a=>{const u=Tg(a,t,i);let l;if(function(n){return n&&Ns(n.canDeactivate)}(u))l=ao(u.canDeactivate(n,t,e,r));else{if(!Ns(u))throw new Error("Invalid CanDeactivate guard");l=ao(u(n,t,e,r))}return l.pipe(El())})).pipe(Vd()):_e(!0)}(i.component,i.route,e,t,r)),El(i=>!0!==i,!0))}(s,r,i,n).pipe(En(a=>a&&function(n){return"boolean"==typeof n}(a)?function(n,t,e,r){return Jt(t).pipe(vl(i=>tg(function(n,t){return null!==n&&t&&t(new JJ(n)),_e(!0)}(i.route.parent,r),function(n,t){return null!==n&&t&&t(new eZ(n)),_e(!0)}(i.route,r),function(n,t,e){const r=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>function(n){const t=n.routeConfig?n.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:n,guards:t}:null}(s)).filter(s=>null!==s).map(s=>Xk(()=>_e(s.guards.map(u=>{const l=Tg(u,s.node,e);let c;if(function(n){return n&&Ns(n.canActivateChild)}(l))c=ao(l.canActivateChild(r,n));else{if(!Ns(l))throw new Error("Invalid CanActivateChild guard");c=ao(l(r,n))}return c.pipe(El())})).pipe(Vd())));return _e(o).pipe(Vd())}(n,i.path,e),function(n,t,e){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return _e(!0);const i=r.map(o=>Xk(()=>{const s=Tg(o,t,e);let a;if(function(n){return n&&Ns(n.canActivate)}(s))a=ao(s.canActivate(t,n));else{if(!Ns(s))throw new Error("Invalid CanActivate guard");a=ao(s(t,n))}return a.pipe(El())}));return _e(i).pipe(Vd())}(n,i.route,e))),El(i=>!0!==i,!0))}(r,o,n,t):_e(a)),Se(a=>Object.assign(Object.assign({},e),{guardsResult:a})))})}(this.ngModule.injector,a=>this.triggerEvent(a)),ln(a=>{if(Va(a.guardsResult)){const l=Px(`Redirecting to "${this.serializeUrl(a.guardsResult)}"`);throw l.url=a.guardsResult,l}const u=new YJ(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.triggerEvent(u)}),vr(a=>!!a.guardsResult||(this.restoreHistory(a),this.cancelNavigationTransition(a,""),!1)),Xx(a=>{if(a.guards.canActivateChecks.length)return _e(a).pipe(ln(u=>{const l=new XJ(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(u.urlAfterRedirects),u.targetSnapshot);this.triggerEvent(l)}),yr(u=>{let l=!1;return _e(u).pipe(function(n,t){return En(e=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=e;if(!i.length)return _e(e);let o=0;return Jt(i).pipe(vl(s=>function(n,t,e,r){return function(n,t,e,r){const i=Object.keys(n);if(0===i.length)return _e({});const o={};return Jt(i).pipe(En(s=>function(n,t,e,r){const i=Tg(n,t,r);return ao(i.resolve?i.resolve(t,e):i(t,e))}(n[s],t,e,r).pipe(ln(a=>{o[s]=a}))),kx(1),En(()=>Object.keys(o).length===i.length?_e(o):Ea))}(n._resolve,n,t,r).pipe(Se(o=>(n._resolvedData=o,n.data=Object.assign(Object.assign({},n.data),_O(n,e).resolve),null)))}(s.route,r,n,t)),ln(()=>o++),kx(1),En(s=>o===i.length?_e(e):Ea))})}(this.paramsInheritanceStrategy,this.ngModule.injector),ln({next:()=>l=!0,complete:()=>{l||(this.restoreHistory(u),this.cancelNavigationTransition(u,"At least one route resolver didn't emit any value."))}}))}),ln(u=>{const l=new QJ(u.id,this.serializeUrl(u.extractedUrl),this.serializeUrl(u.urlAfterRedirects),u.targetSnapshot);this.triggerEvent(l)}))}),Xx(a=>{const{targetSnapshot:u,id:l,extractedUrl:c,rawUrl:d,extras:{skipLocationChange:h,replaceUrl:f}}=a;return this.hooks.afterPreactivation(u,{navigationId:l,appliedUrlTree:c,rawUrlTree:d,skipLocationChange:!!h,replaceUrl:!!f})}),Se(a=>{const u=function(n,t,e){const r=wg(n,t._root,e?e._root:void 0);return new vO(r,t)}(this.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return Object.assign(Object.assign({},a),{targetRouterState:u})}),ln(a=>{this.currentUrlTree=a.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),this.routerState=a.targetRouterState,"deferred"===this.urlUpdateStrategy&&(a.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,a),this.browserUrlTree=a.urlAfterRedirects)}),((n,t,e)=>Se(r=>(new NZ(t,r.targetRouterState,r.currentRouterState,e).activate(n),r)))(this.rootContexts,this.routeReuseStrategy,a=>this.triggerEvent(a)),ln({next(){o=!0},complete(){o=!0}}),function(n){return t=>t.lift(new Z9(n))}(()=>{var a;if(!o&&!s){const u=`Navigation ID ${i.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(i),this.cancelNavigationTransition(i,u)):this.cancelNavigationTransition(i,u)}(null===(a=this.currentNavigation)||void 0===a?void 0:a.id)===i.id&&(this.currentNavigation=null)}),Ts(a=>{if(s=!0,function(n){return n&&n[rO]}(a)){const u=Va(a.url);u||(this.navigated=!0,this.restoreHistory(i,!0));const l=new Zk(i.id,this.serializeUrl(i.extractedUrl),a.message);r.next(l),u?setTimeout(()=>{const c=this.urlHandlingStrategy.merge(a.url,this.rawUrlTree),d={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Rg(i.source)};this.scheduleNavigation(c,"imperative",null,d,{resolve:i.resolve,reject:i.reject,promise:i.promise})},0):i.resolve(!1)}else{this.restoreHistory(i,!0);const u=new qJ(i.id,this.serializeUrl(i.extractedUrl),a);r.next(u);try{i.resolve(this.errorHandler(a))}catch(l){i.reject(l)}}return Ea}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const r=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,r)&&setTimeout(()=>{const{source:i,state:o,urlTree:s}=r,a={replaceUrl:!0};if(o){const u=Object.assign({},o);delete u.navigationId,delete u.\u0275routerPageId,0!==Object.keys(u).length&&(a.state=u)}this.scheduleNavigation(s,i,o,a)},0),this.lastLocationChangeInfo=r}))}extractLocationChangeInfoFromEvent(e){var r;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(r=e.state)||void 0===r?void 0:r.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,r){if(!e)return!0;const i=r.urlTree.toString()===e.urlTree.toString();return r.transitionId!==e.transitionId||!i||!("hashchange"===r.source&&"popstate"===e.source||"popstate"===r.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){TO(e),this.config=e.map(Kx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,r={}){const{relativeTo:i,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:u}=r,l=i||this.routerState.root,c=u?this.currentUrlTree.fragment:s;let d=null;switch(a){case"merge":d=Object.assign(Object.assign({},this.currentUrlTree.queryParams),o);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=o||null}return null!==d&&(d=this.removeEmptyProps(d)),function(n,t,e,r,i){if(0===e.length)return Gx(t.root,t.root,t,r,i);const o=function(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new EO(!0,0,n);let t=0,e=!1;const r=n.reduce((i,o,s)=>{if("object"==typeof o&&null!=o){if(o.outlets){const a={};return Nn(o.outlets,(u,l)=>{a[l]="string"==typeof u?u.split("/"):u}),[...i,{outlets:a}]}if(o.segmentPath)return[...i,o.segmentPath]}return"string"!=typeof o?[...i,o]:0===s?(o.split("/").forEach((a,u)=>{0==u&&"."===a||(0==u&&""===a?e=!0:".."===a?t++:""!=a&&i.push(a))}),i):[...i,o]},[]);return new EO(e,t,r)}(e);if(o.toRoot())return Gx(t.root,new Qe([],{}),t,r,i);const s=function(n,t,e){if(n.isAbsolute)return new zx(t.root,!0,0);if(-1===e.snapshot._lastPathIndex){const o=e.snapshot._urlSegment;return new zx(o,o===t.root,0)}const r=Cg(n.commands[0])?0:1;return function(n,t,e){let r=n,i=t,o=e;for(;o>i;){if(o-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new zx(r,!1,i-o)}(e.snapshot._urlSegment,e.snapshot._lastPathIndex+r,n.numberOfDoubleDots)}(o,t,n),a=s.processChildren?Eg(s.segmentGroup,s.index,o.commands):DO(s.segmentGroup,s.index,o.commands);return Gx(s.segmentGroup,a,t,r,i)}(l,this.currentUrlTree,e,d,null!=c?c:null)}navigateByUrl(e,r={skipLocationChange:!1}){const i=Va(e)?e:this.parseUrl(e),o=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(o,"imperative",null,r)}navigate(e,r={skipLocationChange:!1}){return function(n){for(let t=0;t<n.length;t++){const e=n[t];if(null==e)throw new Error(`The requested path contains ${e} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let r;try{r=this.urlSerializer.parse(e)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,e)}return r}isActive(e,r){let i;if(i=!0===r?Object.assign({},Fee):!1===r?Object.assign({},kee):r,Va(e))return uO(this.currentUrlTree,e,i);const o=this.parseUrl(e);return uO(this.currentUrlTree,o,i)}removeEmptyProps(e){return Object.keys(e).reduce((r,i)=>{const o=e[i];return null!=o&&(r[i]=o),r},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new kd(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,r,i,o,s){var a,u;if(this.disposed)return Promise.resolve(!1);const l=this.getTransition(),c=Rg(r)&&l&&!Rg(l.source),f=(this.lastSuccessfulId===l.id||this.currentNavigation?l.rawUrl:l.urlAfterRedirects).toString()===e.toString();if(c&&f)return Promise.resolve(!0);let p,m,g;s?(p=s.resolve,m=s.reject,g=s.promise):g=new Promise((b,_)=>{p=b,m=_});const v=++this.navigationId;let y;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),y=i&&i.\u0275routerPageId?i.\u0275routerPageId:o.replaceUrl||o.skipLocationChange?null!==(a=this.browserPageId)&&void 0!==a?a:0:(null!==(u=this.browserPageId)&&void 0!==u?u:0)+1):y=0,this.setTransition({id:v,targetPageId:y,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:o,resolve:p,reject:m,promise:g,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),g.catch(b=>Promise.reject(b))}setBrowserUrl(e,r){const i=this.urlSerializer.serialize(e),o=Object.assign(Object.assign({},r.extras.state),this.generateNgRouterState(r.id,r.targetPageId));this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl?this.location.replaceState(i,"",o):this.location.go(i,"",o)}restoreHistory(e,r=!1){var i,o;if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(i=this.currentNavigation)||void 0===i?void 0:i.finalUrl)||0===s?this.currentUrlTree===(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)&&0===s&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(s)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,r){const i=new Zk(e.id,this.serializeUrl(e.extractedUrl),r);this.triggerEvent(i),e.resolve(!1)}generateNgRouterState(e,r){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}}return n.\u0275fac=function(e){return new(e||n)(R(Zh),R(Lx),R(Al),R(ul),R(ct),R($f),R(va),R(void 0))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function Rg(n){return"imperative"!==n}let ew=(()=>{class n{constructor(e,r,i,o,s){this.parentContexts=e,this.location=r,this.resolver=i,this.changeDetector=s,this.activated=null,this._activatedRoute=null,this.activateEvents=new ut,this.deactivateEvents=new ut,this.name=o||ze,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const s=(r=r||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),a=this.parentContexts.getOrCreateContext(this.name).children,u=new Lee(e,a,this.location.injector);this.activated=this.location.createComponent(s,this.location.length,u),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(e){return new(e||n)(C(Al),C(Fn),C(ko),function(n){return function(n,t){if("class"===t)return n.classes;if("style"===t)return n.styles;const e=n.attrs;if(e){const r=e.length;let i=0;for(;i<r;){const o=e[i];if(mE(o))break;if(0===o)i+=2;else if("number"==typeof o)for(i++;i<r&&"string"==typeof e[i];)i++;else{if(o===t)return e[i+1];i+=2}}}return null}(mn(),n)}("name"),C(Zi))},n.\u0275dir=$({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),n})();class Lee{constructor(t,e,r){this.route=t,this.childContexts=e,this.parent=r}get(t,e){return t===Sl?this.route:t===Al?this.childContexts:this.parent.get(t,e)}}class $O{}class qO{preload(t,e){return _e(null)}}let KO=(()=>{class n{constructor(e,r,i,o,s){this.router=e,this.injector=o,this.preloadingStrategy=s,this.loader=new GO(r,i,l=>e.triggerEvent(new eO(l)),l=>e.triggerEvent(new tO(l)))}setUpPreloading(){this.subscription=this.router.events.pipe(vr(e=>e instanceof kd),vl(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(eo);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){const i=[];for(const o of r)if(o.loadChildren&&!o.canLoad&&o._loadedConfig){const s=o._loadedConfig;i.push(this.processRoutes(s.module,s.routes))}else o.loadChildren&&!o.canLoad?i.push(this.preloadConfig(e,o)):o.children&&i.push(this.processRoutes(e,o.children));return Jt(i).pipe(rc(),Se(o=>{}))}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>(r._loadedConfig?_e(r._loadedConfig):this.loader.load(e.injector,r)).pipe(En(o=>(r._loadedConfig=o,this.processRoutes(o.module,o.routes)))))}}return n.\u0275fac=function(e){return new(e||n)(R(hr),R($f),R(va),R(ct),R($O))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})(),tw=(()=>{class n{constructor(e,r,i={}){this.router=e,this.viewportScroller=r,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Ox?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof kd&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof nO&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.router.triggerEvent(new nO(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(R(hr),R(kI),R(void 0))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const Ha=new re("ROUTER_CONFIGURATION"),YO=new re("ROUTER_FORROOT_GUARD"),Vee=[ul,{provide:Lx,useClass:hO},{provide:hr,useFactory:function(n,t,e,r,i,o,s,a={},u,l){const c=new hr(null,n,t,e,r,i,o,oO(s));return u&&(c.urlHandlingStrategy=u),l&&(c.routeReuseStrategy=l),function(n,t){n.errorHandler&&(t.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(t.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(t.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(t.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(t.urlUpdateStrategy=n.urlUpdateStrategy)}(a,c),a.enableTracing&&c.events.subscribe(d=>{var h,f;null===(h=console.group)||void 0===h||h.call(console,`Router Event: ${d.constructor.name}`),console.log(d.toString()),console.log(d),null===(f=console.groupEnd)||void 0===f||f.call(console)}),c},deps:[Lx,Al,ul,ct,$f,va,Qx,Ha,[class{},new Rn],[class{},new Rn]]},Al,{provide:Sl,useFactory:function(n){return n.routerState.root},deps:[hr]},{provide:$f,useClass:f8},KO,qO,class{preload(t,e){return e().pipe(Ts(()=>_e(null)))}},{provide:Ha,useValue:{enableTracing:!1}}];function Hee(){return new C_("Router",hr)}let XO=(()=>{class n{constructor(e,r){}static forRoot(e,r){return{ngModule:n,providers:[Vee,QO(e),{provide:YO,useFactory:Wee,deps:[[hr,new Rn,new Mo]]},{provide:Ha,useValue:r||{}},{provide:al,useFactory:jee,deps:[xa,[new Au(H_),new Rn],Ha]},{provide:tw,useFactory:Uee,deps:[hr,kI,Ha]},{provide:$O,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:qO},{provide:C_,multi:!0,useFactory:Hee},[nw,{provide:rd,multi:!0,useFactory:qee,deps:[nw]},{provide:JO,useFactory:Kee,deps:[nw]},{provide:g_,multi:!0,useExisting:JO}]]}}static forChild(e){return{ngModule:n,providers:[QO(e)]}}}return n.\u0275fac=function(e){return new(e||n)(R(YO,8),R(hr,8))},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({}),n})();function Uee(n,t,e){return e.scrollOffset&&t.setOffset(e.scrollOffset),new tw(n,t,e)}function jee(n,t,e={}){return e.useHash?new k5(n,t):new mI(n,t)}function Wee(n){return"guarded"}function QO(n){return[{provide:L3,multi:!0,useValue:n},{provide:Qx,multi:!0,useValue:n}]}let nw=(()=>{class n{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new be}appInitializer(){return this.injector.get(T5,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const i=new Promise(a=>r=a),o=this.injector.get(hr),s=this.injector.get(Ha);return"disabled"===s.initialNavigation?(o.setUpLocationChangeListener(),r(!0)):"enabled"===s.initialNavigation||"enabledBlocking"===s.initialNavigation?(o.hooks.afterPreactivation=()=>this.initNavigation?_e(null):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),o.initialNavigation()):r(!0),i})}bootstrapListener(e){const r=this.injector.get(Ha),i=this.injector.get(KO),o=this.injector.get(tw),s=this.injector.get(hr),a=this.injector.get(ya);e===a.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&s.initialNavigation(),i.setUpPreloading(),o.init(),s.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(e){return new(e||n)(R(ct))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();function qee(n){return n.appInitializer.bind(n)}function Kee(n){return n.bootstrapListener.bind(n)}const JO=new re("Router Initializer");function ZO(n){return function(e){return e.lift(new Xee(n))}}class Xee{constructor(t){this.closingNotifier=t}call(t,e){return e.subscribe(new Qee(t,this.closingNotifier))}}class Qee extends lu{constructor(t,e){super(t),this.buffer=[],this.add(cu(e,new uu(this)))}_next(t){this.buffer.push(t)}notifyNext(){const t=this.buffer;this.buffer=[],this.destination.next(t)}}function e2(n,t,e,r,i,o,s){try{var a=n[o](s),u=a.value}catch(l){return void e(l)}a.done?t(u):Promise.resolve(u).then(r,i)}function t2(n){return function(){var t=this,e=arguments;return new Promise(function(r,i){var o=n.apply(t,e);function s(u){e2(o,r,i,s,a,"next",u)}function a(u){e2(o,r,i,s,a,"throw",u)}s(void 0)})}}function n2(n=0,t=yd){return(!rx(n)||n<0)&&(n=0),(!t||"function"!=typeof t.schedule)&&(t=yd),new Ke(e=>(e.add(t.schedule(Jee,n,{subscriber:e,counter:0,period:n})),e))}function Jee(n){const{subscriber:t,counter:e,period:r}=n;t.next(e),this.schedule({subscriber:t,counter:e+1,period:r},r)}var r2=function(n,t){return(r2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])})(n,t)};function Ti(n,t){function e(){this.constructor=n}r2(n,t),n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}function le(n,t,e,r){return new(e||(e=Promise))(function(i,o){function s(l){try{u(r.next(l))}catch(c){o(c)}}function a(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new e(function(c){c(l.value)}).then(s,a)}u((r=r.apply(n,t||[])).next())})}function ce(n,t){var e,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,r=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){s=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(6===c[0]&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=t.call(n,s)}catch(d){c=[6,d],r=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var Zee=function(){function n(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},n.prototype.registerFlag=function(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},null!=this.urlFlags[t]){var i=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+i+"."),this.set(t,i)}},n.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},n.prototype.getNumber=function(t){return this.get(t)},n.prototype.getBool=function(t){return this.get(t)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},n.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},n.prototype.setFlags=function(t){this.flags=Object.assign({},t)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,i=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return ete(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0];t.urlFlags[a]=function(l,c){if("true"===(c=c.toLowerCase())||"false"===c)return"true"===c;if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(a,s[1])})}},n}();function ete(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function j(){return o2}var o2=null,Il=new Map,Wd=new Map;function s2(n,t){var e=rw(n,t);return Il.get(e)}function a2(n){for(var t=Il.entries(),e=[];;){var r=t.next(),o=r.value;if(r.done)break;var a=o[1];o[0].split("_")[0]===n&&e.push(a)}return e}function u2(n){var t=n.kernelName,e=n.backendName,r=rw(t,e);if(Il.has(r))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");Il.set(r,n)}function nte(n){var t=n.kernelName;Wd.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Wd.set(t,n)}function rw(n,t){return t+"_"+n}function l2(n){for(var t=n.length,e=0,r=0;t>0;)r=Math.random()*t|0,e=n[--t],n[t]=n[r],n[r]=e}function Fg(n,t,e){return Math.max(n,Math.min(t,e))}function iw(n){return n%2==0?n:n+1}function c2(n){for(var t=0,e=0;e<n.length;e++)t+=n[e];return t}function D(n,t){if(!n)throw new Error("string"==typeof t?t:t())}function nt(n,t,e){void 0===e&&(e=""),D(dn(n,t),function(){return e+" Shapes "+n+" and "+t+" must match"})}function Ua(n){D(null!=n,function(){return"The input to the tensor constructor must be a non-null value."})}function qo(n,t,e){if(void 0===t&&(t=[]),void 0===e&&(e=!1),null==t&&(t=[]),Array.isArray(n)||Pn(n)&&!e)for(var r=0;r<n.length;++r)qo(n[r],t,e);else t.push(n);return t}function de(n){if(0===n.length)return 1;for(var t=n[0],e=1;e<n.length;e++)t*=n[e];return t}function dn(n,t){if(n===t)return!0;if(null==n||null==t||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function Pt(n){return n%1==0}function d2(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function kg(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function ja(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function ow(n,t,e){return void 0===t&&(t=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(n())r();else{o++;var a=t(o);null!=e&&o>=e?i():setTimeout(s,a)}};s()})}function h2(n,t){for(var e=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)e*=n[i];else if(-1===n[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(-1===r){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+n);return n}if(0===e)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var o=n.slice();return o[r]=t/e,o}function hn(n,t){var e=t.length;return D((n=null==n?t.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+n}),D(n.every(function(r){return Pt(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?e+r:r})}function Ps(n,t){for(var e=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||i?null:hn(t,n).sort(),s=0,a=0;a<n.length;++a){if(null!=o){if(o[s]===a&&1!==n[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(null==o[s]||o[s]>a)&&1===n[a]&&(e.push(n[a]),r.push(a)),o[s]<=a&&s++}1!==n[a]&&(e.push(n[a]),r.push(a))}return{newShape:e,keptDims:r}}function Tl(n,t){var e=null;if(null==n||"float32"===n)e=new Float32Array(t);else if("int32"===n)e=new Int32Array(t);else{if("bool"!==n)throw new Error("Unknown data type "+n);e=new Uint8Array(t)}return e}function Gd(n,t){var e=null;if(null==n||"float32"===n)e=new Float32Array(t);else if("int32"===n)e=new Int32Array(t);else if("bool"===n)e=new Uint8Array(t);else{if("string"!==n)throw new Error("Unknown data type "+n);e=new Array(t)}return e}function f2(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function p2(n){return"bool"===n||"complex64"===n||"float32"===n||"int32"===n||"string"===n}function g2(n,t){return!("complex64"===t||"float32"===t&&"complex64"!==n||"int32"===t&&"float32"!==n&&"complex64"!==n||"bool"===t&&"bool"===n)}function Pn(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function sw(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function m2(n){if(null==n)return 0;var t=0;return n.forEach(function(e){return t+=e.length}),t}function Ls(n){return"string"==typeof n||n instanceof String}function v2(n){return"boolean"==typeof n}function y2(n){return"number"==typeof n}function Rl(n){return Array.isArray(n)?Rl(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":y2(n)?"float32":Ls(n)?"string":v2(n)?"bool":"float32"}function Bs(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Og(n,t){for(var e=t;e<n;++e)if(n%e==0)return e;return n}function Ri(n){var t=n.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=n[t-1];for(var r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function aw(n,t,e){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=qo(n)),e&&f2(n,t),s=t,(o=n)instanceof Float32Array&&"float32"===s||o instanceof Int32Array&&"int32"===s||o instanceof Uint8Array&&"bool"===s)return n;var o,s;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(n);if("int32"===t)return new Int32Array(n);if("bool"===t){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)0!==Math.round(n[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function uw(n,t){if(0===n.length)return t[0];var e=n.reduce(function(r,i){return r*i});if(0===e)return[];if(e!==t.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(1===o.length)for(var u=o[0],l=0;l<u;l++)a[l]=s[i+l];else{u=o[0];var c=o.slice(1),d=c.reduce(function(h,f){return h*f});for(l=0;l<u;l++)a[l]=r(i+l*d,c,s)}return a}(0,n,t)}function lw(n,t){for(var e=Fl(n,t),r=0;r<e.length;r++)e[r]=1;return e}function Fl(n,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(n);if("int32"===t)return new Int32Array(n);if("bool"===t)return new Uint8Array(n);throw new Error("Unknown data type "+t)}function Fi(){return j().platform.now()}function cw(n){n.forEach(function(t){D(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function _2(n,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",j().platform.encode(n,t)}function zd(n,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",j().platform.decode(n,t)}function dw(n,t,e){if(0===t)return 0;if(1===t)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=e[i]*n[i];return r}function b2(n,t,e){if(0===t)return[];if(1===t)return[n];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(n/e[i]),n-=r[i]*e[i];return r[r.length-1]=n,r}Object.freeze({shuffle:l2,clamp:Fg,nearestLargerEven:iw,sum:c2,randUniform:function(n,t){var e=Math.random();return t*e+(1-e)*n},distSquared:function(n,t){for(var e=0,r=0;r<n.length;r++){var i=Number(n[r])-Number(t[r]);e+=i*i}return e},assert:D,assertShapesMatch:nt,assertNonNull:Ua,flatten:qo,sizeFromShape:de,isScalarShape:function(n){return 0===n.length},arraysEqual:dn,isInt:Pt,tanh:d2,sizeToSquarishShape:kg,createShuffledIndices:function(n){for(var t=new Uint32Array(n),e=0;e<n;++e)t[e]=e;return l2(t),t},rightPad:ja,repeatedTry:ow,inferFromImplicitShape:h2,parseAxisParam:hn,squeezeShape:Ps,getTypedArrayFromDType:Tl,getArrayFromDType:Gd,checkConversionForErrors:f2,isValidDtype:p2,hasEncodingLoss:g2,isTypedArray:Pn,bytesPerElement:sw,bytesFromStringArray:m2,isString:Ls,isBoolean:v2,isNumber:y2,inferDtype:Rl,isFunction:Bs,nearestDivisor:Og,computeStrides:Ri,toTypedArray:aw,toNestedArray:uw,makeOnesTypedArray:lw,makeZerosTypedArray:Fl,now:Fi,assertNonNegativeIntegerDimensions:cw,fetch:function(n,t){return j().platform.fetch(n,t)},encodeString:_2,decodeString:zd,locToIndex:dw,indexToLoc:b2});var rte=function(){function n(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new ite)}return n.prototype.profileKernel=function(t,e,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(l,c,d){if("float32"!==c)return!1;for(var h=0;h<l.length;h++){var f=l[h];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+d+"'"),!0}})(u,a.dtype,t),s.then(function(l){var c="";null!=l.getExtraProfileInfo&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(t,a,u,l.kernelMs,e,c)})})}),i},n}(),ite=function(){function n(){}return n.prototype.logKernelProfile=function(t,e,r,i,o,s){var a="number"==typeof i?ja(i+"ms",9):i.error,u=ja(t,25),l=e.rank,c=e.size,d=ja(e.shape.toString(),14),h="";for(var f in o){var p=o[f].shape||e.shape,m=p.length;h+=f+": "+m+"D "+(m>0?p:"")+" "}console.log("%c"+u+"\t%c"+a+"\t%c"+l+"D "+d+"\t%c"+c+"\t%c"+h+"\t%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function qd(n,t,e){return ja(Array.isArray(n)?parseFloat(n[0].toFixed(7))+" + "+parseFloat(n[1].toFixed(7))+"j":Ls(n)?"'"+n+"'":"bool"===e?w2(n):parseFloat(n.toFixed(7)).toString(),t)}function w2(n){return 0===n?"false":"true"}function Kd(n){for(var t=[],e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var Yd=function(){function n(t,e,r){var i=this;if(this.dtype=e,this.shape=t.slice(),this.size=de(t),null!=r){var o=r.length;D(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Gd(e,this.size),this.strides=Ri(t)}return n.prototype.set=function(t){for(var e=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];0===r.length&&(r=[0]),D(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(r);this.values[o]=t},n.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var r=0,i=0,o=t;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},n.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},n.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return uo().makeTensor(this.values,this.shape,this.dtype)},n}(),uo=null,H=null,C2=null,Ct=function(){function n(t,e,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=de(t),this.strides=Ri(t),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),D(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},n.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},n.prototype.as4D=function(t,e,r,i){return this.throwIfDisposed(),this.reshape([t,e,r,i])},n.prototype.as5D=function(t,e,r,i,o){return this.throwIfDisposed(),this.reshape([t,e,r,i,o])},n.prototype.asType=function(t){return this.throwIfDisposed(),H.cast(this,t)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return le(this,void 0,void 0,function(){var t;return ce(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,H.buffer(this.shape,this.dtype,t)]}})})},n.prototype.bufferSync=function(){return H.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return le(this,void 0,void 0,function(){var t;return ce(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,uw(this.shape,t)]}})})},n.prototype.arraySync=function(){return uw(this.shape,this.dataSync())},n.prototype.data=function(){return le(this,void 0,void 0,function(){var t,e;return ce(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=uo().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=r.sent();try{return[2,e.map(function(i){return zd(i)})]}catch(i){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var t=uo().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(e){return zd(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},n.prototype.bytes=function(){return le(this,void 0,void 0,function(){var t;return ce(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,uo().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(uo().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(t){return void 0===t&&(t=!1),H.print(this,t)},n.prototype.reshape=function(t){return this.throwIfDisposed(),H.reshape(this,t)},n.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},n.prototype.expandDims=function(t){return void 0===t&&(t=0),H.expandDims(this,t)},n.prototype.cumsum=function(t,e,r){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===r&&(r=!1),H.cumsum(this,t,e,r)},n.prototype.squeeze=function(t){return this.throwIfDisposed(),H.squeeze(this,t)},n.prototype.clone=function(){return this.throwIfDisposed(),H.clone(this)},n.prototype.oneHot=function(t,e,r){return this.throwIfDisposed(),H.oneHot(this,t,e,r)},n.prototype.toString=function(t){return void 0===t&&(t=!1),function(n,t,e,r){var i=Ri(t),o=function(l,c,d,h){var f=de(c),p=h[h.length-1],m=new Array(p).fill(0),g=c.length,v="complex64"===d?Kd(l):l;if(g>1)for(var y=0;y<f/p;y++)for(var b=y*p,_=0;_<p;_++)m[_]=Math.max(m[_],qd(v[b+_],0,d).length);return m}(n,t,e,i),s=t.length,a=function l(c,d,h,f,p,m){void 0===m&&(m=!0);var g="complex64"===h?2:1,v=d[0],y=d.length;if(0===y)return"complex64"===h?[qd(Kd(c)[0],0,h)]:"bool"===h?[w2(c[0])]:[c[0].toString()];if(1===y){if(v>20){var _=Array.from(c.slice(0,3*g)),x=Array.from(c.slice((v-3)*g,v*g));return"complex64"===h&&(_=Kd(_),x=Kd(x)),["["+_.map(function(z,P){return qd(z,p[P],h)}).join(", ")+", ..., "+x.map(function(z,P){return qd(z,p[v-3+P],h)}).join(", ")+"]"]}return["["+("complex64"===h?Kd(c):Array.from(c)).map(function(z,P){return qd(z,p[P],h)}).join(", ")+"]"]}var w=d.slice(1),M=f.slice(1),T=f[0]*g,S=[];if(v>20){for(var I=0;I<3;I++){var N=(O=I*T)+T;S.push.apply(S,l(c.slice(O,N),w,h,M,p,!1))}for(S.push("..."),I=v-3;I<v;I++)N=(O=I*T)+T,S.push.apply(S,l(c.slice(O,N),w,h,M,p,I===v-1))}else for(I=0;I<v;I++){var O;N=(O=I*T)+T,S.push.apply(S,l(c.slice(O,N),w,h,M,p,I===v-1))}var W=2===y?",":"";for(S[0]="["+S[0]+W,I=1;I<S.length-1;I++)S[I]=" "+S[I]+W;var G=",\n";for(I=2;I<y;I++)G+="\n";return S[S.length-1]=" "+S[S.length-1]+"]"+(m?"":G),S}(n,t,e,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+s),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(a.map(function(l){return"    "+l}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},n.prototype.tile=function(t){return this.throwIfDisposed(),H.tile(this,t)},n.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),H.gather(this,t,e)},n.prototype.matMul=function(t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),H.matMul(this,t,e,r)},n.prototype.dot=function(t){return this.throwIfDisposed(),H.dot(this,t)},n.prototype.norm=function(t,e,r){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),H.norm(this,t,e,r)},n.prototype.slice=function(t,e){return this.throwIfDisposed(),H.slice(this,t,e)},n.prototype.reverse=function(t){return this.throwIfDisposed(),H.reverse(this,t)},n.prototype.concat=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),H.concat([this].concat(t),e)},n.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),H.split(this,t,e)},n.prototype.stack=function(t,e){return void 0===e&&(e=0),H.stack([this,t],e)},n.prototype.unstack=function(t){return void 0===t&&(t=0),H.unstack(this,t)},n.prototype.pad=function(t,e){return void 0===e&&(e=0),H.pad(this,t,e)},n.prototype.batchNormalization=function(t,e,r,i,o){return void 0===r&&(r=.001),C2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,i,r)},n.prototype.batchNorm=function(t,e,r,i,o){return void 0===o&&(o=.001),this.throwIfDisposed(),H.batchNorm(this,t,e,r,i,o)},n.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.all(this,t,e)},n.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.any(this,t,e)},n.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.logSumExp(this,t,e)},n.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.sum(this,t,e)},n.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.prod(this,t,e)},n.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.mean(this,t,e)},n.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.min(this,t,e)},n.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),H.max(this,t,e)},n.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),H.argMin(this,t)},n.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),H.argMax(this,t)},n.prototype.cast=function(t){return this.throwIfDisposed(),H.cast(this,t)},n.prototype.add=function(t){return this.throwIfDisposed(),H.add(this,t)},n.prototype.addStrict=function(t){return this.throwIfDisposed(),H.addStrict(this,t)},n.prototype.atan2=function(t){return this.throwIfDisposed(),H.atan2(this,t)},n.prototype.sub=function(t){return this.throwIfDisposed(),H.sub(this,t)},n.prototype.subStrict=function(t){return this.throwIfDisposed(),H.subStrict(this,t)},n.prototype.pow=function(t){return this.throwIfDisposed(),H.pow(this,t)},n.prototype.powStrict=function(t){return this.throwIfDisposed(),H.powStrict(this,t)},n.prototype.mul=function(t){return this.throwIfDisposed(),H.mul(this,t)},n.prototype.mulStrict=function(t){return this.throwIfDisposed(),H.mulStrict(this,t)},n.prototype.div=function(t){return this.throwIfDisposed(),H.div(this,t)},n.prototype.divNoNan=function(t){return this.throwIfDisposed(),H.divNoNan(this,t)},n.prototype.floorDiv=function(t){return this.throwIfDisposed(),H.floorDiv(this,t)},n.prototype.divStrict=function(t){return this.throwIfDisposed(),H.divStrict(this,t)},n.prototype.minimum=function(t){return this.throwIfDisposed(),H.minimum(this,t)},n.prototype.minimumStrict=function(t){return this.throwIfDisposed(),H.minimumStrict(this,t)},n.prototype.maximum=function(t){return this.throwIfDisposed(),H.maximum(this,t)},n.prototype.maximumStrict=function(t){return this.throwIfDisposed(),H.maximumStrict(this,t)},n.prototype.mod=function(t){return this.throwIfDisposed(),H.mod(this,t)},n.prototype.modStrict=function(t){return this.throwIfDisposed(),H.modStrict(this,t)},n.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),H.squaredDifferenceStrict(this,t)},n.prototype.transpose=function(t){return this.throwIfDisposed(),H.transpose(this,t)},n.prototype.notEqual=function(t){return this.throwIfDisposed(),H.notEqual(this,t)},n.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),H.notEqualStrict(this,t)},n.prototype.less=function(t){return this.throwIfDisposed(),H.less(this,t)},n.prototype.lessStrict=function(t){return this.throwIfDisposed(),H.lessStrict(this,t)},n.prototype.equal=function(t){return this.throwIfDisposed(),H.equal(this,t)},n.prototype.equalStrict=function(t){return this.throwIfDisposed(),H.equalStrict(this,t)},n.prototype.lessEqual=function(t){return this.throwIfDisposed(),H.lessEqual(this,t)},n.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),H.lessEqualStrict(this,t)},n.prototype.greater=function(t){return this.throwIfDisposed(),H.greater(this,t)},n.prototype.greaterStrict=function(t){return this.throwIfDisposed(),H.greaterStrict(this,t)},n.prototype.greaterEqual=function(t){return this.throwIfDisposed(),H.greaterEqual(this,t)},n.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),H.greaterEqualStrict(this,t)},n.prototype.logicalAnd=function(t){return this.throwIfDisposed(),H.logicalAnd(this,t)},n.prototype.logicalOr=function(t){return this.throwIfDisposed(),H.logicalOr(this,t)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),H.logicalNot(this)},n.prototype.logicalXor=function(t){return this.throwIfDisposed(),H.logicalXor(this,t)},n.prototype.where=function(t,e){return this.throwIfDisposed(),H.where(t,this,e)},n.prototype.neg=function(){return this.throwIfDisposed(),H.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),H.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),H.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),H.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),H.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),H.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),H.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),H.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),H.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),H.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),H.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),H.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),H.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),H.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),H.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),H.abs(this)},n.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),H.clipByValue(this,t,e)},n.prototype.relu=function(){return this.throwIfDisposed(),H.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),H.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),H.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),H.selu(this)},n.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),H.leakyRelu(this,t)},n.prototype.prelu=function(t){return this.throwIfDisposed(),H.prelu(this,t)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),H.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),H.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),H.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),H.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),H.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),H.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),H.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),H.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),H.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),H.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),H.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),H.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),H.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),H.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),H.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),H.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),H.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),H.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),H.round(this)},n.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),H.step(this,t)},n.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),H.softmax(this,t)},n.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),H.logSoftmax(this,t)},n.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),H.image.resizeBilinear(this,t,e)},n.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),H.image.resizeNearestNeighbor(this,t,e)},n.prototype.conv1d=function(t,e,r,i,o,s){return void 0===i&&(i="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),H.conv1d(this,t,e,r,i,o,s)},n.prototype.conv2d=function(t,e,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),H.conv2d(this,t,e,r,i,o,s)},n.prototype.conv2dTranspose=function(t,e,r,i,o){return this.throwIfDisposed(),H.conv2dTranspose(this,t,e,r,i,o)},n.prototype.depthwiseConv2D=function(t,e,r,i,o,s){return void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),H.depthwiseConv2d(this,t,e,r,i,o,s)},n.prototype.separableConv2d=function(t,e,r,i,o,s){return void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC"),this.throwIfDisposed(),H.separableConv2d(this,t,e,r,i,o,s)},n.prototype.avgPool=function(t,e,r,i){return this.throwIfDisposed(),H.avgPool(this,t,e,r,i)},n.prototype.maxPool=function(t,e,r,i){return this.throwIfDisposed(),H.maxPool(this,t,e,r,i)},n.prototype.localResponseNormalization=function(t,e,r,i){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===i&&(i=.5),H.localResponseNormalization(this,t,e,r,i)},n.prototype.pool=function(t,e,r,i,o){return this.throwIfDisposed(),H.pool(this,t,e,r,i,o)},n.prototype.variable=function(t,e,r){return void 0===t&&(t=!0),this.throwIfDisposed(),uo().makeVariable(this,t,e,r)},n.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),H.unsortedSegmentSum(this,t,e)},n.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),H.batchToSpaceND(this,t,e)},n.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),H.spaceToBatchND(this,t,e)},n.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),H.topk(this,t,e)},n.prototype.stridedSlice=function(t,e,r,i,o,s,a,u){return void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),this.throwIfDisposed(),H.stridedSlice(this,t,e,r,i,o,s,a,u)},n.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),H.depthToSpace(this,t,e)},n.prototype.fft=function(){return this.throwIfDisposed(),H.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),H.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),H.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),H.spectral.irfft(this)},n}();Object.defineProperty(Ct,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var E2,fw,pw,gw,mw,kl=function(n){function t(e,r,i,o){var s=n.call(this,e.shape,e.dtype,e.dataId,o)||this;return s.trainable=r,s.name=i,s}return Ti(t,n),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!dn(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");uo().disposeTensor(this),this.dataId=e.dataId,uo().incRef(this,null)},t.prototype.dispose=function(){uo().disposeVariable(this),this.isDisposedInternal=!0},t}(Ct);Object.defineProperty(kl,Symbol.hasInstance,{value:function(n){return n instanceof Ct&&null!=n.assign&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(E2||(E2={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(fw||(fw={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(pw||(pw={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(gw||(gw={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(mw||(mw={}));var ste={float32:gw,int32:fw,bool:pw,complex64:mw};function Mn(n,t){if("string"===n||"string"===t){if("string"===n&&"string"===t)return"string";throw new Error("Can not upcast "+n+" with "+t)}return ste[n][t]}function vw(n){return Mn(n,"int32")}function Ft(n,t){if(n.dtype===t.dtype)return[n,t];var e=Mn(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function D2(n,t){D(n.dtype===t.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"})}function yw(n){var t=[];return function e(r,i,o){if(null!=r){if(r instanceof Ct)return void i.push(r);if(s=r,Array.isArray(s)||"object"==typeof s){var s,a=r;for(var u in a){var l=a[u];o.has(l)||(o.add(l),e(l,i,o))}}}}(n,t,new Set),t}Object.freeze({makeTypesMatch:Ft,assertTypesMatch:D2,isTensorInList:function(n,t){return t.some(function(e){return e.id===n.id})},getTensorsInContainer:yw});var _w,S2=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},n}(),ate=function(){function n(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new S2}return n.prototype.ready=function(){return le(this,void 0,void 0,function(){var t,e,r;return ce(this,function(i){switch(i.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,i.label=1;case 1:return e<t.length?[4,this.initializeBackend(r=t[e]).success]:[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(t){return t in this.registry||t in this.registryFactory&&!this.initializeBackend(t).asyncInit?this.registry[t]:null},n.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},n.prototype.registerBackend=function(t,e,r){return void 0===r&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:r},!0)},n.prototype.setBackend=function(t){return le(this,void 0,void 0,function(){var e,r,i;return ce(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new rte(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var t=this;a2(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},n.prototype.disposeRegisteredKernels=function(t){var e=this;a2(t).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[t])})},n.prototype.initializeBackend=function(t){var e=this,r=this.registryFactory[t];if(null==r)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<e.pendingBackendInitId||(e.registry[t]=a,e.pendingBackendInit=null,0))}).catch(function(a){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(a.stack||a.message),1))});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[t]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+t+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return t.registryFactory[r].priority-t.registryFactory[e].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var r=t[e],i=this.initializeBackend(r),s=i.asyncInit;if(s||i.success)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(t,e){var r=this.state.tensorInfo.get(e),i=r.backend,o=this.readSync(e);i.disposeData(e),r.backend=t,t.move(e,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(t,e){var r,i=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(t,e,r){t();try{var i=r();return e(),i}catch(o){throw e(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype);return this.addTapeNode(this.state.activeScope.name,{x:t},[e],function(i){return{x:function(){return i.toFloat()}}},[]),e},n.prototype.runKernel=function(t,e,r,i,o){return this.runKernelFunc(null,e,null,t,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(t,e,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+="complex64"===u.dtype?3:1});var a=i-e-o-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+t+"'")},n.prototype.runKernelFunc=function(t,e,r,i,o,s,a){var u,l=this;void 0===s&&(s=[]),void 0===a&&(a=[]);var c=[],d=this.isTapeOn();null==i&&(i=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=function(y){d&&(c=y.map(function(b){return l.keep(l.clone(b))}))},p=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,v=s2(i,this.backendName);return h=null!=v?function(){var y=l.backend.numDataIds();g=v.kernelFunc({inputs:e,attrs:o,backend:l.backend});var b=Array.isArray(g)?g:[g];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,y,b);var _=b.map(function(w){return l.makeTensorFromDataId(w.dataId,w.shape,w.dtype)}),x=_.filter(function(w,M){return a[M]});return f((s||[]).slice().concat(x)),_}:function(){var y=l.backend.numDataIds();g=l.tidy(function(){return t(l.backend,f)});var b=Array.isArray(g)?g:[g];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,y,b),b},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,e,function(){return h()}):h()}),d&&this.addTapeNode(i,e,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(y){return e[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(g)?u:u[0]},n.prototype.makeTensor=function(t,e,r,i){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");i=i||this.backend;var o=t;"string"===(r=r||"float32")&&Ls(t[0])&&(o=t.map(function(c){return _2(c)}));var s=i.write(o,e,r),a=new Ct(e,r,s,this.nextTensorId());if(this.incRef(a,i),"string"===r){var u=this.state.tensorInfo.get(s),l=m2(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return a},n.prototype.makeTensorFromDataId=function(t,e,r,i){var o=new Ct(e,r=r||"float32",t,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(t,e,r,i){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=i&&i!==t.dtype&&(t=t.asType(i));var o=new kl(t,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(t,e){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var i=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(i=t.size*sw(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof kl||this.track(t)},n.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[t])},n.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},n.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},n.prototype.profile=function(t){return le(this,void 0,void 0,function(){var e,r;return ce(this,function(i){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},n.prototype.addTapeNode=function(t,e,r,i,o){var s=this,a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:r,saved:o},u=function(n){return Wd.get(n)}(t);null!=u&&(i=u.gradFunc),null!=i&&(a.gradient=function(l){return l=l.map(function(c,d){if(null==c){var h=r[d],f=Fl(h.size,h.dtype);return s.makeTensor(f,h.shape,h.dtype)}return c}),i(l.length>1?l:l[0],o)}),this.state.activeTape.push(a)},n.prototype.keep=function(t){return t.kept=!0,t},n.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},n.prototype.endScope=function(t){for(var e=this,r=yw(t),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||e.track(u)})},n.prototype.gradients=function(t,e,r,i){var o=this;if(void 0===i&&(i=!1),D(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});D(s instanceof Ct,function(){return"The result y returned by f() must be a tensor."});var a=function(u,l,c){for(var d={},h={},f=0;f<l.length;f++)d[l[f].id]=!0;for(f=0;f<u.length;f++){var p=(w=u[f]).inputs;for(var m in p){for(var g=p[m],v=!1,y=0;y<l.length;y++)if(d[g.id]){w.outputs.forEach(function(I){return d[I.id]=!0}),v=!0,h[w.id]=!0;break}if(v)break}}var b={};b[c.id]=!0;var _={};for(f=u.length-1;f>=0;f--)for(p=(w=u[f]).inputs,y=0;y<w.outputs.length;y++)if(b[w.outputs[y].id]){for(var m in p)b[p[m].id]=!0,_[w.id]=!0;break}var x=[];for(f=0;f<u.length;f++){var w;if(h[(w=u[f]).id]&&_[w.id]){var M={};for(var m in w.inputs){var T=w.inputs[m];d[T.id]&&(M[m]=T)}var S=Object.assign({},w);S.inputs=M,S.outputs=w.outputs,x.push(S)}}return x}(this.state.activeTape,e,s);if(!i&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[s.id]=null==r?(l=lw(de(u=s.shape),"float32"),F.makeTensor(l,u,"float32")):r,function(h,f,p){for(var m=function(v){var y=f[v],b=[];if(y.outputs.forEach(function(M){var T=h[M.id];b.push(null!=T?T:null)}),null==y.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var _=y.gradient(b),x=function(M){if(!(M in _))throw new Error("Cannot backprop through input "+M+". Available gradients found: "+Object.keys(_)+".");var T=o.tidy(function(){return _[M]()});if("float32"!==T.dtype)throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+M+" must have 'float32' dtype, but has '"+T.dtype+"'");var S=y.inputs[M];if(!dn(T.shape,S.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+M+"' has shape '"+T.shape+"', which does not match the shape of the input '"+S.shape+"'");if(null==h[S.id])h[S.id]=T;else{var I=h[S.id];h[S.id]=I.add(T),I.dispose()}};for(var w in y.inputs)x(w)},g=f.length-1;g>=0;g--)m(g)}(c,a);var d=e.map(function(h){return c[h.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(h){for(var f=0,p=h.saved;f<p.length;f++)p[f].dispose()}),o.state.activeTape=null),{value:s,grads:d}})},n.prototype.customGrad=function(t){var e=this;return D(Bs(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];D(i.every(function(a){return a instanceof Ct}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),e.runKernelFunc(function(a,u){return D((r=t.apply(void 0,i.concat([u]))).value instanceof Ct,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),D(Bs(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];D(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),D(c.every(function(h){return h instanceof Ct}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return c.forEach(function(h,f){d[f]=function(){return h}}),d})}},n.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},n.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},n.prototype.time=function(t){return le(this,void 0,void 0,function(){var e,r;return ce(this,function(i){switch(i.label){case 0:return e=Fi(),[4,this.backend.time(t)];case 1:return(r=i.sent()).wallMs=Fi()-e,[2,r]}})})},n.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new S2,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),F=function(){var n=function(){if(null==_w){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}_w=e}return _w}();if(null==n._tfengine){var t=new Zee(n);n._tfengine=new ate(t)}return o2=n._tfengine.ENV,uo=function(){return n._tfengine},n._tfengine}();function A2(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Ko=j();Ko.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ko.registerFlag("IS_BROWSER",function(){return A2()}),Ko.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Ko.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ko.registerFlag("PROD",function(){return!1}),Ko.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ko.getBool("DEBUG")}),Ko.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ko.registerFlag("IS_TEST",function(){return!1});var Xd,Nr,Pr,Wa={},bw={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function M2(n,t){Wa[n]=t}function lo(n){n in Wa||(Wa[n]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if("undefined"!=typeof OffscreenCanvas&&2===i)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Wa[e]},!1),1===e?r.getContext("webgl",bw)||r.getContext("experimental-webgl",bw):r.getContext("webgl2",bw)}(n));var t=Wa[n];return t.isContextLost()?(delete Wa[n],lo(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Wa[n])}function Ng(n,t){return[t,n]}function Qd(n){var t=de(n);return kg(Math.ceil(t/4))}function Jd(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function xw(n,t){var e,r,i,o,s,a,u,l,c,d=n;return 2===j().getNumber("WEBGL_VERSION")?(e=d.R32F,r=d.R16F,i=d.RGBA16F,o=d.RGBA32F,s=d.RED,a=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(e=n.RGBA,r=n.RGBA,i=n.RGBA,o=d.RGBA,s=n.RGBA,a=4,u=4,l=null!=t?t.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function ue(n,t,e){var r=e();return t&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+T2(i,o))}(n),r}function I2(n){return!!(j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||5.96e-8<Math.abs(n)&&Math.abs(n)<65504)}function T2(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Zd(n,t,e){return Yo(n,t,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function R2(n,t,e){var r=Yo(n,t,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ue(n,t,function(){return n.shaderSource(r,e)}),ue(n,t,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function F2(n,t,e){var r=Yo(n,t,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ue(n,t,function(){return n.shaderSource(r,e)}),ue(n,t,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw function(i,o){var s=cte.exec(o);if(null==s)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split("\n"),l=u.length.toString().length+2,c=u.map(function(g,v){return ja((v+1).toString(),l)+g}),d=0,h=0;h<c.length;h++)d=Math.max(c[h].length,d);var f=c.slice(0,a-1),p=c.slice(a-1,a),m=c.slice(a);console.log(f.join("\n")),console.log(o.split("\n")[0]),console.log("%c "+ja(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join("\n"))}(e,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Xd||(Xd={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(Nr||(Nr={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Pr||(Pr={}));var Pg,Lg,cte=/ERROR: [0-9]+:([0-9]+):/g;function k2(n,t){return Yo(n,t,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function O2(n,t,e){if(ue(n,t,function(){return n.linkProgram(e)}),!1===n.getProgramParameter(e,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Bg(n,t,e){if(ue(n,t,function(){return n.validateProgram(e)}),!1===n.getProgramParameter(e,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function N2(n,t,e){var r=Yo(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return ue(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),ue(n,t,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function P2(n,t,e){var r=Yo(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return ue(n,t,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),ue(n,t,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function L2(n,t){return Yo(n,t,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function B2(n,t){var e=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var r="["+n+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e)throw r="["+n+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function V2(n,t){return Yo(n,t,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ww(n,t,e,r,i,o,s,a){var u=n.getAttribLocation(e,r);return-1!==u&&(ue(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),ue(n,t,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,s,a)}),ue(n,t,function(){return n.enableVertexAttribArray(u)}),!0)}function H2(n,t,e,r){z2(n,r),ue(n,t,function(){return n.activeTexture(n.TEXTURE0+r)}),ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function U2(n,t,e,r){return Yo(n,t,function(){return n.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function j2(n,t,e){return n.getUniformLocation(t,e)}function W2(n,t,e,r,i,o){ue(n,t,function(){return H2(n,t,r,o)}),ue(n,t,function(){return n.uniform1i(i,o)})}function Vg(n,t,e,r){ue(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),ue(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function Cw(n,t,e){ue(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),ue(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function eh(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+G2(n,t))}function G2(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Yo(n,t,e,r){var i=ue(n,t,function(){return e()});if(null==i)throw new Error(r);return i}function z2(n,t){var e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function th(n,t){return void 0===t&&(t=2),de(n.slice(0,n.length-t))}function nh(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Hg(n){var t=[1,1,1];return 0===n.length||1===n.length&&1===n[0]||(t=[th(n)].concat(nh(n))),t}function $2(n,t){var e;void 0===t&&(t=!1);var r=j().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(n=n.map(function(l,c){return c>=n.length-2?iw(n[c]):n[c]})).length&&(n=[2,n[0]])),2!==n.length){var i=Ps(n);n=i.newShape}var o=de(n);if(n.length<=1&&o<=r)return[1,o];if(2===n.length&&n[0]<=r&&n[1]<=r)return n;if(3===n.length&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(t){var s=th(n),a=2,u=2;return n.length&&(a=(e=nh(n))[0],u=e[1]),kg(o=s*(a/2)*(u/2)).map(function(l){return 2*l})}return kg(o)}function Ug(n){return n%2==0}function rh(n,t){if(dn(n=n.slice(-2),t=t.slice(-2))||!n.length||!t.length||0===n[0]||0===n[1]||0===t[0]||0===t[1])return!0;if(n.length!==t.length){var e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||Ug(e)&&Ug(r)&&(1===n[0]||1===t[0]))return!0}return n[1]===t[1]&&Ug(n[0])&&Ug(t[0])}function q2(n){if(null==Pg){var t=lo(n);Pg=t.getParameter(t.MAX_TEXTURE_SIZE)}return Pg}function K2(n){if(null==Lg){var t=lo(n);Lg=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Lg)}function Y2(n){if(0===n)return 0;var t=lo(n);return Lr(t,"EXT_disjoint_timer_query_webgl2")&&2===n?2:Lr(t,"EXT_disjoint_timer_query")?1:0}function Lr(n,t){return null!=n.getExtension(t)}function Ew(n){try{if(null!=lo(n))return!0}catch(t){return!1}return!1}function X2(n){if(0===n)return!1;var t=lo(n);if(1===n){if(!Lr(t,"OES_texture_float"))return!1}else if(!Lr(t,"EXT_color_buffer_float"))return!1;return Dw(t)}function Q2(n){if(0===n)return!1;var t=lo(n);if(1!==n){if(Lr(t,"EXT_color_buffer_float"))return Dw(t);if(Lr(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=xw(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),u}(t,e)}return!1}return!!Lr(t,"OES_texture_float")&&!!Lr(t,"WEBGL_color_buffer_float")&&Dw(t)}function Dw(n){var t=xw(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(r),i}function J2(n){return 2===n&&null!=lo(n).fenceSync}var dte=Object.freeze({callAndCheck:ue,canBeRepresented:I2,getWebGLErrorMessage:T2,getExtensionOrThrow:Zd,createVertexShader:R2,createFragmentShader:F2,createProgram:k2,linkProgram:O2,validateProgram:Bg,createStaticVertexBuffer:N2,createStaticIndexBuffer:P2,getNumChannels:function(){return 2===j().getNumber("WEBGL_VERSION")?1:4},createTexture:L2,validateTextureSize:B2,createFramebuffer:V2,bindVertexBufferToProgramAttribute:ww,bindTextureUnit:H2,unbindTextureUnit:function(n,t,e){z2(n,e),ue(n,t,function(){return n.activeTexture(n.TEXTURE0+e)}),ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:U2,getProgramUniformLocation:j2,bindTextureToProgramUniformSampler:W2,bindCanvasToFramebuffer:function(n,t){ue(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),ue(n,t,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),ue(n,t,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})},bindColorTextureToFramebuffer:Vg,unbindColorTextureFromFramebuffer:Cw,validateFramebuffer:eh,getFramebufferErrorMessage:G2,getBatchDim:th,getRowsCols:nh,getShapeAs3D:Hg,getTextureShapeFromLogicalShape:$2,isReshapeFree:rh,getWebGLMaxTextureSize:q2,resetMaxTextureSize:function(){Pg=null},resetMaxTexturesInShader:function(){Lg=null},getMaxTexturesInShader:K2,getWebGLDisjointQueryTimerVersion:Y2,hasExtension:Lr,isWebGLVersionEnabled:Ew,isCapableOfRenderingToFloatTexture:X2,isDownloadFloatTextureEnabled:Q2,isWebGLFenceEnabled:J2}),De=j();function Z2(n){j().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function oe(n,t){return F.tidy(n,t)}function _r(n){yw(n).forEach(function(t){return t.dispose()})}function jg(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];j().getBool("IS_TEST")||console.warn.apply(console,n)}function co(n,t){var e=n;if(Pn(n))return"string"===t?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(e)||Pn(e)&&"string"!==t;)r.push(e.length),e=e[0];return Array.isArray(n)&&j().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],Array.isArray(o)||Pn(o)){D(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),D(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var u=s.slice(1),l=0;l<o.length;++l)i(o[l],u,a.concat(l))}else D(0===s.length,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"})}(n,r,[]),r}function eN(n,t,e,r){if(null!=n&&("numeric"!==n&&n!==t||"numeric"===n&&"string"===t))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+n+" tensor, but got "+t+" tensor")}function E(n,t,e,r){if(void 0===r&&(r="numeric"),n instanceof Ct)return eN(r,n.dtype,t,e),n;var i=Rl(n);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),eN(r,i,t,e),null==n||!Pn(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var s=co(n,i);Pn(n)||Array.isArray(n)||(n=[n]);var a="string"!==i?aw(n,i,j().getBool("DEBUG")):qo(n,[],!0);return F.makeTensor(a,s,i)}function ih(n,t,e,r){if(void 0===r&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return E(i,t+"["+o+"]",e)},r)}function Sw(n,t){for(var e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function tN(n,t,e){for(var r=n.length+t.length,i=[],o=0,s=0,a=0;a<r;a++)-1===e.indexOf(a)?i.push(n[o++]):i.push(t[s++]);return i}function Ln(n,t){for(var e=[],r=n.length,i=0;i<r;i++)-1===t.indexOf(i)&&e.push(n[i]);return[e,t.map(function(o){return n[o]})]}function fr(n,t){return tN(n,t.map(function(e){return 1}),t)}function br(n,t,e){D(Sw(t,e),function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function ki(n,t){if(Sw(n,t))return null;for(var e=[],r=0;r<t;++r)-1===n.indexOf(r)&&e.push(r);return n.forEach(function(i){return e.push(i)}),e}function Wg(n){return n.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Oi(n,t){for(var e=[],r=t-n;r<t;++r)e.push(r);return e}function nN(n,t){var e=n[0].length;n.forEach(function(i,o){D(i.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+e+")"})}),D(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=n[0];n.forEach(function(i,o){for(var s=0;s<e;s++)D(s===t||i[s]===r[s],function(){return"Error in concat"+e+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Ga(n,t){for(var e=n[0].slice(),r=1;r<n.length;r++)e[t]+=n[r][t];return e}function k(n){var t=Object.keys(n);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];F.startScope(e);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),F.endScope(a),a}catch(u){throw F.endScope(null),u}};return Object.defineProperty(i,"name",{value:e,configurable:!0}),i}De.registerFlag("HAS_WEBGL",function(){return De.getNumber("WEBGL_VERSION")>0}),De.registerFlag("WEBGL_VERSION",function(){return Ew(2)?2:Ew(1)?1:0}),De.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===De.get("WEBGL_VERSION")}),De.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),De.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),De.registerFlag("WEBGL_PACK",function(){return De.getBool("HAS_WEBGL")}),De.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_CLIP",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),De.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_REDUCE",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_LAZILY_UNPACK",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_CONV_IM2COL",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return q2(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return K2(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=De.getNumber("WEBGL_VERSION");return 0===n?0:Y2(n)}),De.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return De.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),De.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return X2(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!De.getBool("WEBGL_FORCE_F16_TEXTURES")&&De.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),De.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Q2(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return J2(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return De.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),C2=Z2;var Bn=k({complex_:function(n,t){var e=E(n,"real","complex"),r=E(t,"imag","complex");return nt(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),F.runKernelFunc(function(i){return i.complex(e,r)},{$real:e,$imag:r})}}),si=k({real_:function(n){var t=E(n,"input","real");return F.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),ho=k({imag_:function(n){var t=E(n,"input","imag");return F.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Vn(n,t,e){return Vs(n,t,co(n,e),e)}function Vs(n,t,e,r){if(null==r&&(r=Rl(n)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Pn(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){cw(t);var i=de(t),o=de(e);D(i===o,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<e.length;++s){var u=s!==e.length-1||e[s]!==de(t.slice(s));D(e[s]===t[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return Pn(n)||Array.isArray(n)||(n=[n]),t=t||e,n="string"!==r?aw(n,r,j().getBool("DEBUG")):qo(n,[],!0),F.makeTensor(n,t,r)}function ee(n,t){if((Pn(n)&&"string"!==t||Array.isArray(n))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Pn(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Vs(n,[],[],t)}function fn(n,t){Ua(n);var e=co(n,t);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Vs(n,null,e,t)}function Hs(n,t,e){if(Ua(n),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=co(n,e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Vs(n,t,r,e)}function Aw(n,t,e){if(Ua(n),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=co(n,e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Vs(n,t,r,e)}function xr(n,t,e){if(Ua(n),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=co(n,e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Vs(n,t,r,e)}function Ol(n,t){if(void 0===t&&(t="float32"),"complex64"===t){var e=Ol(n,"float32"),r=At(n,"float32");return Bn(e,r)}var i=lw(de(n),t);return F.makeTensor(i,n,t)}function At(n,t){if(void 0===t&&(t="float32"),"complex64"===t){var e=At(n,"float32"),r=At(n,"float32");return Bn(e,r)}var i=Fl(de(n),t);return F.makeTensor(i,n,t)}function fo(n,t,e){return F.runKernelFunc(function(r){return r.fill(n,t,e)},{})}function Gg(n,t,e,r){if(void 0===e&&(e=1),void 0===r&&(r="float32"),0===e)throw new Error("Cannot have a step of zero");if(n===t||n<t&&e<0||t<n&&e>1)return At([0],r);var i=Fl(Math.abs(Math.ceil((t-n)/e)),r);t<n&&1===e&&(e=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+e;return fn(i,r)}var rN=k({onesLike_:function(n){var t=E(n,"x","onesLike");if("complex64"===t.dtype){var e=rN(si(t)),r=rt(ho(t));return Bn(e,r)}return F.runKernelFunc(function(i){return i.onesLike(t)},{$x:t},function(i,o){return{$x:function(){return rt(i)}}})}}),rt=k({zerosLike_:function(n){var t=E(n,"x","zerosLike");return F.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,r){return{$x:function(){return rt(e)}}})}}),bn=k({concat_:function(n,t){void 0===t&&(t=0),D(n.length>=1,function(){return"Pass at least one tensor to concat"});var e=ih(n,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(a){if("complex64"!==a.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+a.dtype+". ")}),t=hn(t,e[0].shape)[0];var r=Ga(e.map(function(a){return a.shape}),t);if(0===de(r))return Vn([],r);if(1===(e=e.filter(function(a){return a.size>0})).length)return e[0];var i=e.map(function(a){return a.shape});return nN(i,t),F.runKernelFunc(function(a){return a.concat(e,t)},e,function(a){var u=i.map(function(l){return l[t]});return Mw(a,u,t).map(function(l){return function(){return l}})},"Concat",{axis:t})}}),vte=k({concat1d_:function(n){return bn(n,0)}}),yte=k({concat2d_:function(n,t){return bn(n,t)}}),_te=k({concat3d_:function(n,t){return bn(n,t)}}),bte=k({concat4d_:function(n,t){return bn(n,t)}}),Mw=k({split_:function(n,t,e){void 0===e&&(e=0);var r,i=E(n,"x","split");return e=hn(e,i.shape)[0],"number"==typeof t?(D(i.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(i.shape[e]/t)):(D(i.shape[e]===t.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),F.runKernelFunc(function(o){return o.split(i,r,e)},{$x:i},function(o){return{$x:function(){return bn(o,e)}}})}});function za(n,t){return n(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis||"undefined"!=typeof window||"undefined"!=typeof global&&global;var xte=za(function(n){!function(t,e,r){function i(a){var u,l=this,c=(u=4022871197,function(d){d=d.toString();for(var h=0;h<d.length;h++){var f=.02519603282416938*(u+=d.charCodeAt(h));f-=u=f>>>0,u=(f*=u)>>>0,u+=4294967296*(f-=u)}return 2.3283064365386963e-10*(u>>>0)});l.next=function(){var d=2091639*l.s0+2.3283064365386963e-10*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=0|d)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var l=new i(a),c=u&&u.state,d=l.next;return d.int32=function(){return 4294967296*l.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&("object"==typeof c&&o(c,l),d.state=function(){return o(l,{})}),d}e&&e.exports?e.exports=s:this.alea=s}(0,n)}),wte=za(function(n){!function(t,e,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do{var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===h);return h},d.int32=l.next,d.quick=d,c&&("object"==typeof c&&o(c,l),d.state=function(){return o(l,{})}),d}e&&e.exports?e.exports=s:this.xor128=s}(0,n)}),Cte=za(function(n){!function(t,e,r){function i(a){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do{var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===h);return h},d.int32=l.next,d.quick=d,c&&("object"==typeof c&&o(c,l),d.state=function(){return o(l,{})}),d}e&&e.exports?e.exports=s:this.xorwow=s}(0,n)}),Ete=za(function(n){!function(t,e,r){function i(a){var u=this;u.next=function(){var l,c,d=u.x,h=u.i;return l=d[h],c=(l^=l>>>7)^l<<24,c^=(l=d[h+1&7])^l>>>10,c^=(l=d[h+3&7])^l>>>3,c^=(l=d[h+4&7])^l<<7,l=d[h+7&7],c^=(l^=l<<13)^l<<9,d[h]=c,u.i=h+1&7,c},function(l,c){var d,h=[];if(c===(0|c))h[0]=c;else for(c=""+c,d=0;d<c.length;++d)h[7&d]=h[7&d]<<15^c.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&0===h[d];++d);for(8==d&&(h[7]=-1),l.x=h,l.i=0,d=256;d>0;--d)l.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){null==a&&(a=+new Date);var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do{var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===h);return h},d.int32=l.next,d.quick=d,c&&(c.x&&o(c,l),d.state=function(){return o(l,{})}),d}e&&e.exports?e.exports=s:this.xorshift7=s}(0,n)}),Dte=za(function(n){!function(t,e,r){function i(a){var u=this;u.next=function(){var l,c,d=u.w,h=u.X,f=u.i;return u.w=d=d+1640531527|0,c=h[f+34&127],l=h[f=f+1&127],c^=c<<13,l^=l<<17,c=h[f]=(c^=c>>>15)^(l^=l>>>12),u.i=f,c+(d^d>>>16)|0},function(l,c){var d,h,f,p,m,g=[],v=128;for(c===(0|c)?(h=c,c=null):(c+="\0",h=0,v=Math.max(v,c.length)),f=0,p=-32;p<v;++p)c&&(h^=c.charCodeAt((p+32)%c.length)),0===p&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(f=0==(d=g[127&p]^=h+(m=m+1640531527|0))?f+1:0);for(f>=128&&(g[127&(c&&c.length||0)]=-1),f=127,p=512;p>0;--p)h=g[f+34&127],d=g[f=f+1&127],h^=h<<13,d^=d<<17,g[f]=(h^=h>>>15)^(d^=d>>>12);l.w=m,l.X=g,l.i=f}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){null==a&&(a=+new Date);var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do{var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===h);return h},d.int32=l.next,d.quick=d,c&&(c.X&&o(c,l),d.state=function(){return o(l,{})}),d}e&&e.exports?e.exports=s:this.xor4096=s}(0,n)}),Ste=za(function(n){!function(t,e,r){function i(a){var u=this,l="";u.next=function(){var d=u.b,h=u.c,f=u.d,p=u.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^h,u.c=h=h-f|0,u.d=f<<16^h>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):l+=a;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do{var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/(1<<21)}while(0===h);return h},d.int32=l.next,d.quick=d,c&&("object"==typeof c&&o(c,l),d.state=function(){return o(l,{})}),d}e&&e.exports?e.exports=s:this.tychei=s}(0,n)}),$a=za(function(n){!function(t,e){var r,i=this,o=256,a="random",u=e.pow(o,6),l=e.pow(2,52),c=2*l,d=255;function h(v,y,b){var _=[],x=m(function T(S,I){var N,O=[],W=typeof S;if(I&&"object"==W)for(N in S)try{O.push(T(S[N],I-1))}catch(G){}return O.length?O:"string"==W?S:S+"\0"}((y=1==y?{entropy:!0}:y||{}).entropy?[v,g(t)]:null==v?function(){try{var T;return r&&(T=r.randomBytes)?T=T(o):(T=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(T)),g(T)}catch(N){var S=i.navigator,I=S&&S.plugins;return[+new Date,i,I,i.screen,g(t)]}}():v,3),_),w=new f(_),M=function(){for(var T=w.g(6),S=u,I=0;T<l;)T=(T+I)*o,S*=o,I=w.g(1);for(;T>=c;)T/=2,S/=2,I>>>=1;return(T+I)/S};return M.int32=function(){return 0|w.g(4)},M.quick=function(){return w.g(4)/4294967296},M.double=M,m(g(w.S),t),(y.pass||b||function(T,S,I,N){return N&&(N.S&&p(N,w),T.state=function(){return p(w,{})}),I?(e[a]=T,S):T})(M,x,"global"in y?y.global:this==e,y.state)}function f(v){var y,b=v.length,_=this,x=0,w=_.i=_.j=0,M=_.S=[];for(b||(v=[b++]);x<o;)M[x]=x++;for(x=0;x<o;x++)M[x]=M[w=d&w+v[x%b]+(y=M[x])],M[w]=y;(_.g=function(T){for(var S,I=0,N=_.i,O=_.j,W=_.S;T--;)S=W[N=d&N+1],I=I*o+W[d&(W[N]=W[O=d&O+S])+(W[O]=S)];return _.i=N,_.j=O,I})(o)}function p(v,y){return y.i=v.i,y.j=v.j,y.S=v.S.slice(),y}function m(v,y){for(var b,_=v+"",x=0;x<_.length;)y[d&x]=d&(b^=19*y[d&x])+_.charCodeAt(x++);return g(y)}function g(v){return String.fromCharCode.apply(0,v)}if(e["seed"+a]=h,m(e.random(),t),n.exports){n.exports=h;try{r=Co(902)}catch(v){}}}([],Math)});$a.alea=xte,$a.xor128=wte,$a.xorwow=Cte,$a.xorshift7=Ete,$a.xor4096=Dte,$a.tychei=Ste;var zg=$a.alea,Iw=function(){function n(t,e,r,i,o){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=zg(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s}while(a>=1||0===a);var u=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(e)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},n.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},n.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},n}(),Ate=function(){function n(t,e,r,i){this.alpha=t,this.beta=1/e,this.dtype=r;var o=i||Math.random();this.randu=zg(o.toString()),this.randn=new Iw(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var t,e,r,i,o,s;;){do{i=this.randn.nextValue(),s=1+this.c*i}while(s<=0);if(e=1-.331*(t=i*i)*t,r=.5*t+this.d*(1-(s*=s*s)+Math.log(s)),(o=this.randu())<e||Math.log(o)<r)break}return s*=1/this.beta*this.d,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},n}(),Mte=function(){function n(t,e,r,i){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=r,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=zg(i)}return n.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Oe(n,t,e){return void 0===t&&(t="float32"),t=t||"float32",cw(n),new Yd(n,t,e)}var iN=k({batchToSpaceND_:function(n,t,e){var r=E(n,"x","batchToSpaceND"),i=t.reduce(function(o,s){return o*s});return D(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),D(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),D(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i}),F.runKernelFunc(function(o){return o.batchToSpaceND(r,t,e)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(t,e)}}})}}),Tte=k({broadcastTo_:function(n,t){var e=E(n,"broadcastTo","x"),r=e.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var i=e.shape.slice();i.length<t.length;)i.unshift(1);e=e.reshape(i)}for(var o=Array.from(t),s=t.length-1;s>=0;s--)if(e.shape[s]===t[s])o[s]=1;else if(1!==e.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var a=o.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return 0===a.length?e.clone():F.runKernelFunc(function(u){return u.tile(e,o)},{input:e},function(u){return{input:function(){return u.sum(a,!0)}}})}}),Rte=k({cast_:function(n,t){var e=E(n,"x","cast");if(!p2(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==e.dtype||"string"!==t&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return F.runKernelFunc(function(i){return i.cast(e,t)},{x:e},function(i){return{x:function(){return i.clone()}}},"Cast",{dtype:t})}}),Fte=k({clone_:function(n){var t=E(n,"x","clone",null);return F.runKernelFunc(function(){return F.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),kte=k({cumsum_:function(n,t,e,r){void 0===t&&(t=0),void 0===e&&(e=!1),void 0===r&&(r=!1);var i=E(n,"x","cumsum"),o=ki([t|=0],i.rank),s=i;null!=o&&(s=i.transpose(o));var a=Oi(1,i.rank)[0],u=F.runKernelFunc(function(l){return l.cumsum(s,a,e,r)},{permutedX:s},function(l){return{permutedX:function(){return l.cumsum(t,e,!r)}}});return null!=o&&(u=u.transpose(o)),u}}),Ote=k({depthToSpace_:function(n,t,e){void 0===e&&(e="NHWC");var r=E(n,"x","depthToSpace"),i="NHWC"===e?r.shape[1]:r.shape[2],o="NHWC"===e?r.shape[2]:r.shape[3],s="NHWC"===e?r.shape[3]:r.shape[1];return D(i*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),D(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),D(s%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+s+" for depthToSpace with input shape "+r.shape}),F.runKernelFunc(function(a){return a.depthToSpace(r,t,e)},{$x:r})}}),ai=k({expandDims_:function(n,t){void 0===t&&(t=0);var e=E(n,"x","expandDims",null);D(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return t<0&&(D(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),r.splice(t,0,1),Ni(e,r)}}),oN=k({eye_:function(n,t,e,r){void 0===r&&(r="float32"),null==t&&(t=n);for(var i=Oe([n,t],r),o=n<=t?n:t,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(n,t);if(null==e)return a;if(1===e.length)return Nl(ai(a,0),[e[0],1,1]);if(2===e.length)return Nl(ai(ai(a,0),0),[e[0],e[1],1,1]);if(3===e.length)return Nl(ai(ai(ai(a,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Nte=k({multinomial_:function(n,t,e,r){void 0===r&&(r=!1);var i=E(n,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);e=e||Math.random();var a=1===s?i.as2D(1,-1):i,u=F.runKernelFunc(function(l){return l.multinomial(a,r,t,e)},{logits2D:a});return 1===s?u.as1D():u}}),Tw=k({oneHot_:function(n,t,e,r){if(void 0===e&&(e=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=E(n,"indices","oneHot","int32"),o=i.shape.concat([t]);return i=i.flatten(),F.runKernelFunc(function(s){return s.oneHot(i,t,e,r)},{$indices:i},function(s){return{$indices:function(){return At(i.shape,"float32")}}}).reshape(o)}}),qa=k({pad_:function(n,t,e){void 0===e&&(e=0);var r=E(n,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return F.runKernelFunc(function(o){return o.pad(r,t,e)},{x:r},function(o){var s=t.map(function(a){return a[0]});return{x:function(){return o.slice(s,r.shape)}}},"PadV2",{paddings:t,constantValue:e})}}),Pte=k({pad1d_:function(n,t,e){return void 0===e&&(e=0),D(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),qa(n,[t],e)}}),Lte=k({pad2d_:function(n,t,e){return void 0===e&&(e=0),D(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),qa(n,t,e)}}),Bte=k({pad3d_:function(n,t,e){return void 0===e&&(e=0),D(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),qa(n,t,e)}}),Vte=k({pad4d_:function(n,t,e){return void 0===e&&(e=0),D(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),qa(n,t,e)}}),Hte=k({rand_:function(n,t,e){var r=de(n),i=null;if(null==e||"float32"===e)i=new Float32Array(r);else if("int32"===e)i=new Int32Array(r);else{if("bool"!==e)throw new Error("Unknown data type "+e);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=t();return F.makeTensor(i,n,e)}}),Ute=k({randomNormal_:function(n,t,e,r,i){if(void 0===t&&(t=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new Iw(t,e,r,!1,i),s=Oe(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),jte=k({randomGamma_:function(n,t,e,r,i){if(void 0===e&&(e=1),void 0===r&&(r="float32"),null==e&&(e=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new Ate(t,e,r,i),s=Oe(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),sN=k({randomUniform_:function(n,t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===r&&(r="float32");for(var o=Oe(n,r),s=new Mte(t,e,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),Ni=k({reshape_:function(n,t){var e=E(n,"x","reshape",null);return t=h2(t,e.size),D(e.size===de(t),function(){return"new shape and old shape must have the same number of elements."}),F.runKernelFunc(function(i){return i.reshape(e,t)},{x:e},function(i){return{x:function(){return i.reshape(e.shape)}}},"Reshape",{shape:t})}}),aN=k({spaceToBatchND_:function(n,t,e){var r=E(n,"x","spaceToBatchND");return D(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),D(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),D(r.shape.reduce(function(i,o,s){return s>0&&s<=t.length?i&&(o+e[s-1][0]+e[s-1][1])%t[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),F.runKernelFunc(function(i){return i.spaceToBatchND(r,t,e)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(t,e)}}})}}),uN=k({squeeze_:function(n,t){var e=E(n,"x","squeeze");return Ni(e,Ps(e.shape,t).newShape)}}),Br=k({stack_:function(n,t){void 0===t&&(t=0);var e=ih(n,"tensors","stack");if(D(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(t);var i=e[0].shape,o=e[0].dtype;D(t<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(a){nt(i,a.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(a){D(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=e.map(function(a){return a.expandDims(t)});return bn(s,t)}}),Nl=k({tile_:function(n,t){var e=E(n,"x","tile",null);return D(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."}),F.runKernelFunc(function(o,s){var a=o.tile(e,t);return s([e]),a},{x:e},function(o,s){var a=s[0];return{x:function(){var u=rt(a);if(1===a.rank)for(var l=0;l<t[0];++l)u=u.add(o.slice([l*a.shape[0]],[a.shape[0]]));else if(2===a.rank)for(l=0;l<t[0];++l)for(var c=0;c<t[1];++c)u=u.add(o.slice([l*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(3===a.rank)for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(var d=0;d<t[2];++d)u=u.add(o.slice([l*a.shape[0],c*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(4!==a.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(d=0;d<t[2];++d)for(var h=0;h<t[3];++h)u=u.add(o.slice([l*a.shape[0],c*a.shape[1],d*a.shape[2],h*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return u}}},"Tile",{reps:t},[e])}}),Wte=k({truncatedNormal_:function(n,t,e,r,i){if(void 0===t&&(t=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new Iw(t,e,r,!0,i),s=Oe(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),xn=k({unstack_:function(n,t){void 0===t&&(t=0),t=t||0;var e=E(n,"x","unstack");return D(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length),F.runKernelFunc(function(i){return i.unstack(e,t)},{x:e},function(i){return{x:function(){return Br(i,t)}}},"Unpack",{axis:t})}});function $g(n,t,e,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(n[0]/e),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=t.length,s=0;s<o;++s)i=i.concat([n[s+1]/t[s],t[s]]);i=i.concat(n.slice(o+1))}return i}function qg(n,t,e){void 0===e&&(e=!0);var r=[];if(e){r.push(t);for(var i=t+1;i<n;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<n;++i)i>=2*t+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function Kg(n,t,e,r){void 0===r&&(r=!0);var i=[];i.push(r?n[0]/e:n[0]*e);for(var o=1;o<n.length;++o)i.push(o<=t.length?r?t[o-1]*n[o]:n[o]/t[o-1]:n[o]);return i}function lN(n,t){for(var e=[0],r=0;r<t;++r)e.push(n[r][0]);return e}function cN(n,t,e){for(var r=n.slice(0,1),i=0;i<e;++i)r.push(n[i+1]-t[i][0]-t[i][1]);return r}function Rw(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var e=t.shape,r=e[e.length-1],i=1,o=0;o<e.length-1;++o)i*=e[o];var s=n.shape,a=e.slice();a.pop();var u=1;for(o=r;o<n.rank;++o)u*=s[o],a.push(s[o]);var l=Ri(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[a,i,u,l]}function Yg(n){return n<=30?n:Og(n,Math.floor(Math.sqrt(n)))}function dN(n,t,e){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(e.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(e.rank-i))throw new Error(o+" Output shape length < "+(r+(e.rank-i)));if(e.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var s=0;s<i;++s)if(e.shape[s]!==t.shape[s])throw new Error(o+" updates.shape["+s+"] ("+e.shape[s]+") != indices.shape["+s+"] ("+t.shape[s]+").");for(s=0;s<e.rank-i;++s)if(e.shape[s+i]!==n[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+e.shape[s+i]+") != shape["+(s+i)+"] ("+n[s+i]+")")}function hN(n,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}dN(e,t,n)}function oh(n,t,e){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,o=e.length,s=1,a=i;a<o;++a)s*=e[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:de(t.shape)/u,sliceSize:s,strides:Ri(e.slice(0,i)).concat([1]),outputSize:de(e)}}function fN(n,t,e){D(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."}),D(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of size "+e+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){D(t[o]+e[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(t[o]+e[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function kw(n){for(var t=[],e=0;n>0;)1&n&&t.push(e),n/=2,e++;return t}function Xg(n,t,e){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((t[i]-n[i])/e[i]);return r}function pN(n,t,e,r,i){var o=t[i];(n&1<<i||null==o)&&(o=(e[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),Fg(0,o,a-1)}function gN(n,t,e,r,i){var o=t[i],s=e[i]||1;(n&1<<i||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),s>0?Fg(0,o,a):Fg(-1,o,a-1)}function Ow(n,t,e){for(var r=e.length,i=0;i<e.length;i++)if(e[i]>1){r=i;break}for(i=r+1;i<e.length;i++)if(t[i]>0||e[i]!==n[i])return!1;return!0}function Nw(n,t){for(var e=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function Qg(n){return F.customGrad(n)}Object.freeze({prepareAndValidate:Rw}),Object.freeze({validateUpdateShape:dN,validateInput:hN,calculateShapes:oh}),Object.freeze({assertParamsValid:fN,maskToAxes:kw,computeOutShape:Xg,startForAxis:pN,stopForAxis:gN,isSliceContinous:Ow,computeFlatOffset:Nw});var Xo=k({softmax_:function(n,t){void 0===t&&(t=-1);var e=E(n,"logits","softmax","float32");if(-1===t&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return F.runKernelFunc(function(r,i){var o=r.softmax(e,t);return i([o]),o},{logits:e},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([t],!0).mul(o))}}},"Softmax",{dim:t},[],[!0])}}),$te=k({logSoftmax_:function(n,t){void 0===t&&(t=-1);var e=E(n,"logits","logSoftmax");if(-1===t&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Qg(function(r,i){var o=r.max(t,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(t,!0).log());return i([a]),{value:a,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(e)}}),mN=function(){function n(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},n.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},n.prototype.has=function(t){return this.data.has(t)},n.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),vN=function(){function n(){}return n.prototype.time=function(t){return V("time")},n.prototype.read=function(t){return V("read")},n.prototype.readSync=function(t){return V("readSync")},n.prototype.numDataIds=function(){return V("numDataIds")},n.prototype.disposeData=function(t){return V("disposeData")},n.prototype.write=function(t,e,r){return V("write")},n.prototype.move=function(t,e,r,i){return V("move")},n.prototype.memory=function(){return V("memory")},n.prototype.floatPrecision=function(){return V("floatPrecision")},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.batchMatMul=function(t,e,r,i){return V("batchMatMul")},n.prototype.fusedBatchMatMul=function(t){return V("fusedBatchMatMul")},n.prototype.slice=function(t,e,r){return V("slice")},n.prototype.stridedSlice=function(t,e,r,i){return V("stridedSlice")},n.prototype.unstack=function(t,e){return V("unstack")},n.prototype.reverse=function(t,e){return V("reverse")},n.prototype.concat=function(t,e){return V("concat")},n.prototype.neg=function(t){return V("neg")},n.prototype.add=function(t,e){return V("add")},n.prototype.addN=function(t){return V("addN")},n.prototype.subtract=function(t,e){return V("subtract")},n.prototype.multiply=function(t,e){return V("multiply")},n.prototype.realDivide=function(t,e){return V("realDivide")},n.prototype.floorDiv=function(t,e){return V("floorDiv")},n.prototype.sum=function(t,e){return V("sum")},n.prototype.prod=function(t,e){return V("prod")},n.prototype.unsortedSegmentSum=function(t,e,r){return V("unsortedSegmentSum")},n.prototype.argMin=function(t,e){return V("argMin")},n.prototype.argMax=function(t,e){return V("argMax")},n.prototype.equal=function(t,e){return V("equal")},n.prototype.notEqual=function(t,e){return V("notEqual")},n.prototype.less=function(t,e){return V("less")},n.prototype.lessEqual=function(t,e){return V("lessEqual")},n.prototype.greater=function(t,e){return V("greater")},n.prototype.greaterEqual=function(t,e){return V("greaterEqual")},n.prototype.logicalNot=function(t){return V("logicalNot")},n.prototype.logicalAnd=function(t,e){return V("logicalAnd")},n.prototype.logicalOr=function(t,e){return V("logicalOr")},n.prototype.where=function(t){return V("where")},n.prototype.select=function(t,e,r){return V("select")},n.prototype.topk=function(t,e,r){return V("topk")},n.prototype.min=function(t,e){return V("min")},n.prototype.minimum=function(t,e){return V("minimum")},n.prototype.mod=function(t,e){return V("mod")},n.prototype.max=function(t,e){return V("max")},n.prototype.maximum=function(t,e){return V("maximum")},n.prototype.all=function(t,e){return V("all")},n.prototype.any=function(t,e){return V("any")},n.prototype.squaredDifference=function(t,e){return V("squaredDifference")},n.prototype.ceil=function(t){return V("ceil")},n.prototype.floor=function(t){return V("floor")},n.prototype.round=function(t){return V("round")},n.prototype.sign=function(t){return V("sign")},n.prototype.isNaN=function(t){return V("isNaN")},n.prototype.isInf=function(t){return V("isInf")},n.prototype.isFinite=function(t){return V("isFinite")},n.prototype.pow=function(t,e){return V("pow")},n.prototype.exp=function(t){return V("exp")},n.prototype.expm1=function(t){return V("expm1")},n.prototype.softmax=function(t,e){return V("softmax")},n.prototype.log=function(t){return V("log")},n.prototype.log1p=function(t){return V("log1p")},n.prototype.sqrt=function(t){return V("sqrt")},n.prototype.rsqrt=function(t){return V("rsqrt")},n.prototype.square=function(t){return V("square")},n.prototype.reciprocal=function(t){return V("reciprocal")},n.prototype.relu=function(t){return V("relu")},n.prototype.relu6=function(t){return V("relu6")},n.prototype.prelu=function(t,e){return V("prelu")},n.prototype.elu=function(t){return V("elu")},n.prototype.eluDer=function(t,e){return V("eluDer")},n.prototype.selu=function(t){return V("selu")},n.prototype.int=function(t){return V("int")},n.prototype.clip=function(t,e,r){return V("clip")},n.prototype.abs=function(t){return V("abs")},n.prototype.complexAbs=function(t){return V("complexAbs")},n.prototype.sigmoid=function(t){return V("sigmoid")},n.prototype.softplus=function(t){return V("softplus")},n.prototype.sin=function(t){return V("sin")},n.prototype.cos=function(t){return V("cos")},n.prototype.tan=function(t){return V("tan")},n.prototype.asin=function(t){return V("asin")},n.prototype.acos=function(t){return V("acos")},n.prototype.atan=function(t){return V("atan")},n.prototype.atan2=function(t,e){return V("atan2")},n.prototype.sinh=function(t){return V("sinh")},n.prototype.cosh=function(t){return V("cosh")},n.prototype.tanh=function(t){return V("tanh")},n.prototype.asinh=function(t){return V("asinh")},n.prototype.acosh=function(t){return V("acosh")},n.prototype.atanh=function(t){return V("atanh")},n.prototype.erf=function(t){return V("erf")},n.prototype.step=function(t,e){return V("step")},n.prototype.fusedConv2d=function(t){return V("fusedConv2d")},n.prototype.conv2d=function(t,e,r){return V("conv2d")},n.prototype.conv2dDerInput=function(t,e,r){return V("conv2dDerInput")},n.prototype.conv2dDerFilter=function(t,e,r){return V("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(t){return V("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(t,e,r){return V("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(t,e,r){return V("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){return V("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(t,e,r){return V("conv3d")},n.prototype.conv3dDerInput=function(t,e,r){return V("conv3dDerInput")},n.prototype.conv3dDerFilter=function(t,e,r){return V("conv3dDerFilter")},n.prototype.maxPool=function(t,e){return V("maxPool")},n.prototype.maxPoolBackprop=function(t,e,r,i){return V("maxPoolBackprop")},n.prototype.avgPool=function(t,e){return V("avgPool")},n.prototype.avgPoolBackprop=function(t,e,r){return V("avgPoolBackprop")},n.prototype.avgPool3d=function(t,e){return V("avgPool3d")},n.prototype.avgPool3dBackprop=function(t,e,r){return V("avgPool3dBackprop")},n.prototype.maxPool3d=function(t,e){return V("maxPool3d")},n.prototype.maxPool3dBackprop=function(t,e,r,i){return V("maxPool3dBackprop")},n.prototype.reshape=function(t,e){return V("reshape")},n.prototype.cast=function(t,e){return V("cast")},n.prototype.tile=function(t,e){return V("tile")},n.prototype.pad=function(t,e,r){return V("pad")},n.prototype.transpose=function(t,e){return V("transpose")},n.prototype.gather=function(t,e,r){return V("gather")},n.prototype.gatherND=function(t,e){return V("gatherND")},n.prototype.scatterND=function(t,e,r){return V("scatterND")},n.prototype.batchToSpaceND=function(t,e,r){return V("batchToSpaceND")},n.prototype.spaceToBatchND=function(t,e,r){return V("spaceToBatchND")},n.prototype.resizeBilinear=function(t,e,r,i){return V("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(t,e,r){return V("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(t,e,r,i){return V("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){return V("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(t,e,r,i,o,s){return V("batchNormalization")},n.prototype.localResponseNormalization4D=function(t,e,r,i,o){return V("localResponseNormalization4D")},n.prototype.LRNGrad=function(t,e,r,i,o,s,a){return V("LRNGrad")},n.prototype.multinomial=function(t,e,r,i){return V("multinomial")},n.prototype.oneHot=function(t,e,r,i){return V("oneHot")},n.prototype.cumsum=function(t,e,r,i){return V("cumsum")},n.prototype.nonMaxSuppression=function(t,e,r,i,o){return V("nonMaxSuppression")},n.prototype.fft=function(t){return V("fft")},n.prototype.ifft=function(t){return V("ifft")},n.prototype.complex=function(t,e){return V("complex")},n.prototype.real=function(t){return V("real")},n.prototype.imag=function(t){return V("imag")},n.prototype.cropAndResize=function(t,e,r,i,o,s){return V("cropAndResize")},n.prototype.depthToSpace=function(t,e,r){return V("depthToSpace")},n.prototype.split=function(t,e,r){return V("split")},n.prototype.sparseToDense=function(t,e,r,i){return V("sparseToDense")},n.prototype.diag=function(t){return V("diag")},n.prototype.fill=function(t,e,r){return V("fill")},n.prototype.onesLike=function(t){return V("onesLike")},n.prototype.zerosLike=function(t){return V("zerosLike")},n.prototype.linspace=function(t,e,r){return V("linspace")},n.prototype.dispose=function(){return V("dispose")},n}();function V(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Qo(n,t){for(var e=n.length,r=[],i=0;i<e;i++){var o=e-1-i;(t[t.length-1-i]||1)>1&&1===(n[o]||1)&&r.unshift(o)}return r}function pn(n,t){for(var e=[],r=0;r<t.length;r++){var i=n[n.length-r-1],o=t.length-r-1;(null==i||1===i&&t[o]>1)&&e.unshift(o)}return e}function $e(n,t){for(var e=[],r=Math.max(n.length,t.length),i=0;i<r;i++){var o=n[n.length-i-1];null==o&&(o=1);var s=t[t.length-i-1];if(null==s&&(s=1),1===o)e.unshift(s);else if(1===s)e.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");e.unshift(o)}}return e}function Pl(n,t,e,r,i,o,s){void 0===s&&(s="channelsLast");var a,u=Zg(t),l=u[0],c=u[1];if("channelsLast"===s)a=[l,c,n[3],n[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);a=[l,c,n[1],n[1]]}return Us(n,a,e,r,i,o,!1,s)}function sh(n,t,e,r,i,o,s){void 0===s&&(s="NDHWC");var a,u,l=Lw(t),c=l[0],d=l[1],h=l[2];if("NDHWC"===s)u="channelsLast",a=[c,d,h,n[4],n[4]];else{if("NCDHW"!==s)throw new Error("Unknown dataFormat "+s);u="channelsFirst",a=[c,d,h,n[1],n[1]]}return ah(n,a,e,r,i,!1,u,o)}function Us(n,t,e,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],h=u[3];if("channelsLast"===a)l=n[0],c=n[1],d=n[2],h=n[3];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);l=n[0],h=n[1],c=n[2],d=n[3]}var f,p=t[0],m=t[1],g=t[3],v=Zg(e),y=v[0],b=v[1],_=Zg(r),x=_[0],w=_[1],M=Ll(p,x),T=Ll(m,w),S=function(G,z,P,L,B,U,q,J){var ne,he,fe;if("number"==typeof G){ne={top:G,bottom:G,left:G,right:G,type:0===G?"VALID":"NUMBER"};var He=function(Je,_t,ht,qt,Ht){null==qt&&(qt=Pw(Je,_t,ht));var bo=Je[1],xo=uh((Je[0]-_t+2*qt)/ht+1,Ht);D(Pt(xo),function(){return"The output # of rows ("+xo+") must be an integer. Change the stride and/or zero pad parameters"});var Ur=uh((bo-_t+2*qt)/ht+1,Ht);return D(Pt(Ur),function(){return"The output # of columns ("+Ur+") must be an integer. Change the stride and/or zero pad parameters"}),[xo,Ur]}([z,P],U,L,G,J);he=He[0],fe=He[1]}else if("same"===G){he=Math.ceil(z/L),fe=Math.ceil(P/B);var Ee=Math.max(0,(he-1)*L+U-z),je=Math.max(0,(fe-1)*B+q-P),We=Math.floor(Ee/2),Le=Ee-We,It=Math.floor(je/2);ne={top:We,bottom:Le,left:It,right:je-It,type:"SAME"}}else{if("valid"!==G)throw Error("Unknown padding parameter: "+G);ne={top:0,bottom:0,left:0,right:0,type:"VALID"},he=Math.ceil((z-U+1)/L),fe=Math.ceil((P-q+1)/B)}return{padInfo:ne,outHeight:he,outWidth:fe}}(i,c,d,y,b,M,T,o),N=S.outHeight,O=S.outWidth,W=s?g*h:g;return"channelsFirst"===a?f=[l,W,N,O]:"channelsLast"===a&&(f=[l,N,O,W]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:d,inChannels:h,outHeight:N,outWidth:O,outChannels:W,padInfo:S.padInfo,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:M,effectiveFilterWidth:T,dilationHeight:x,dilationWidth:w,inShape:n,outShape:f,filterShape:t}}function ah(n,t,e,r,i,o,s,a){void 0===o&&(o=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],h=u[3],f=u[4];if("channelsLast"===s)l=n[0],c=n[1],d=n[2],h=n[3],f=n[4];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=n[0],f=n[1],c=n[2],d=n[3],h=n[4]}var p,m=t[0],g=t[1],v=t[2],y=t[4],b=Lw(e),_=b[0],x=b[1],w=b[2],M=Lw(r),T=M[0],S=M[1],I=M[2],N=Ll(m,T),O=Ll(g,S),W=Ll(v,I),G=function(q,J,ne,he,fe,He,Ee,je,We,Le,It){var Je,_t,ht,qt;if("number"==typeof q){Je={top:q,bottom:q,left:q,right:q,front:q,back:q,type:0===q?"VALID":"NUMBER"};var Ht=function(Zl,ls,wC,ec,wo,CC){null==wo&&(wo=Pw(Zl,ls,ec));var Yde=Zl[1],Xde=Zl[2],EC=uh((Zl[0]-ls+2*wo)/ec+1,CC);D(Pt(EC),function(){return"The output # of depths ("+EC+") must be an integer. Change the stride and/or zero pad parameters"});var DC=uh((Yde-ls+2*wo)/ec+1,CC);D(Pt(DC),function(){return"The output # of rows ("+DC+") must be an integer. Change the stride and/or zero pad parameters"});var SC=uh((Xde-ls+2*wo)/ec+1,CC);return D(Pt(SC),function(){return"The output # of columns ("+SC+") must be an integer. Change the stride and/or zero pad parameters"}),[EC,DC,SC,1]}([J,ne,he,1],je,0,fe,q,It);_t=Ht[0],ht=Ht[1],qt=Ht[2]}else if("same"===q){var Ut=((_t=Math.ceil(J/fe))-1)*fe+je-J,bo=((ht=Math.ceil(ne/He))-1)*He+We-ne,xo=((qt=Math.ceil(he/Ee))-1)*Ee+Le-he,Ur=Math.floor(Ut/2),Jl=Ut-Ur,as=Math.floor(bo/2),Qs=bo-as,us=Math.floor(xo/2);Je={top:as,bottom:Qs,left:us,right:xo-us,front:Ur,back:Jl,type:"SAME"}}else{if("valid"!==q)throw Error("Unknown padding parameter: "+q);Je={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},_t=Math.ceil((J-je+1)/fe),ht=Math.ceil((ne-We+1)/He),qt=Math.ceil((he-Le+1)/Ee)}return{padInfo:Je,outDepth:_t,outHeight:ht,outWidth:qt}}(i,c,d,h,_,x,w,N,O,W,a),P=G.outDepth,L=G.outHeight,B=G.outWidth,U=o?y*f:y;return"channelsFirst"===s?p=[l,U,P,L,B]:"channelsLast"===s&&(p=[l,P,L,B,U]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:d,inWidth:h,inChannels:f,outDepth:P,outHeight:L,outWidth:B,outChannels:U,padInfo:G.padInfo,strideDepth:_,strideHeight:x,strideWidth:w,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:N,effectiveFilterHeight:O,effectiveFilterWidth:W,dilationDepth:T,dilationHeight:S,dilationWidth:I,inShape:n,outShape:p,filterShape:t}}function Pw(n,t,e,r){void 0===r&&(r=1);var i=Ll(t,r);return Math.floor((n[0]*(e-1)-e+i)/2)}function Zg(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function Lw(n){return"number"==typeof n?[n,n,n]:n}function Ll(n,t){return t<=1?n:n+(n-1)*(t-1)}function uh(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function Ka(n){var t=Zg(n);return 1===t[0]&&1===t[1]&&1===t[2]}function pr(n,t){return Ka(n)||Ka(t)}function em(n){if("NHWC"===n)return"channelsLast";if("NCHW"===n)return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function Bw(n,t,e){if("complex64"===t){if("complex64"===n.dtype)return n.clone();var r=At(n.shape),i=n.toFloat(),o=e.complex(i,r);return r.dispose(),i.dispose(),o}if(!g2(n.dtype,t))return F.makeTensorFromDataId(n.dataId,n.shape,t);if("complex64"===n.dtype){var s=e.real(n);return o=s.cast(t),s.dispose(),o}if("int32"===t)return e.int(n);if("bool"===t){var a=ee(0,n.dtype);return o=e.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+t)}function tm(n,t){return F.makeTensorFromDataId(n.dataId,t,n.dtype)}function Vw(n,t,e){var r=(t-n)/(e-1),i=Fl(e,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return fn(i,"float32")}function Hw(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var e=new Float32Array(2*n.length),r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function yN(n,t){return{real:n[2*t],imag:n[2*t+1]}}function qte(n,t,e,r){n[2*r]=t,n[2*r+1]=e}function Kte(n,t,e){var r=(e?2:-2)*Math.PI*(n/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Yte(n,t,e){var r=function(u,l,c){for(var d=0,h=u.length,f=0,p=!1;d<h;){var m=c(l,u[f=d+(h-d>>>1)]);m>0?d=f+1:(h=f,p=!m)}return p?d:-d-1}(n,t,e||Xte);n.splice(r<0?-(r+1):r,0,t)}function Xte(n,t){return n>t?1:n<t?-1:0}function Uw(n,t,e,r,i){return _N(n,t,e,r,i,0).selectedIndices}function jw(n,t,e,r,i,o){var s=_N(n,t,e,r,i,o,!0);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function _N(n,t,e,r,i,o,s,a){void 0===s&&(s=!1),void 0===a&&(a=!1);for(var u=Array.from(t).map(function(_,x){return{score:_,boxIndex:x,suppressBeginIndex:0}}).filter(function(_){return _.score>i}).sort(bN),l=o>0?-.5/o:0,c=[],d=[];c.length<e&&u.length>0;){var h=u.pop(),f=h.score,p=h.boxIndex,m=h.suppressBeginIndex;if(f<i)break;for(var g=!1,v=c.length-1;v>=m;--v){var y=Qte(n,p,c[v]);if(y>=r){g=!0;break}if(h.score=h.score*Jte(r,l,y),h.score<=i)break}h.suppressBeginIndex=c.length,g||(h.score===f?(c.push(p),d.push(h.score)):h.score>i&&Yte(u,h,bN))}var b=c.length;return a&&(c.fill(0,b),d.fill(0,b)),{selectedIndices:fn(c,"int32"),selectedScores:fn(d,"float32"),numValidOutputs:ee(b,"int32")}}function Qte(n,t,e){var r=n.subarray(4*t,4*t+4),i=n.subarray(4*e,4*e+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(a-o)*(u-s),p=(d-l)*(h-c);if(f<=0||p<=0)return 0;var m=Math.max(o,l),g=Math.max(s,c),v=Math.min(a,d),y=Math.min(u,h),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(f+p-b)}function Jte(n,t,e){var r=Math.exp(t*e*e);return e<=n?r:0}function bN(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function xN(n,t,e){var r=new Array(n.rank).fill(0),i=n.shape.slice();return t.map(function(o){i[e]=o;var s=n.slice(r,i);return r[e]+=o,s})}function wN(n,t){for(var e=new Array(n.rank),r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];var i=Oe(e,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(n.rank),a=0;a<s.length;a++)s[a]=o[a]%n.shape[a];var u=n.locToIndex(s);i.values[r]=n.values[u]}return i.toTensor()}function CN(n,t,e,r,i){for(var o=t[t.length-1],s=[n.length/o,o],a=s[0],u=s[1],l=Tl(e,a*r),c=Tl("int32",a*r),d=0;d<a;d++){for(var h=d*u,f=n.subarray(h,h+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(_,x){return x.value-_.value});var g=d*r,v=l.subarray(g,g+r),y=c.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[Vn(l,b,e),Vn(c,b,"int32")]}function Ww(n,t){for(var e=[],r=0;r<t.length;r++)t[r]&&e.push(r);var i=Oe(n,"int32"),o=Oe([e.length,n.length],"int32");for(r=0;r<e.length;r++){var s=i.indexToLoc(e[r]);o.values.set(s,r*n.length)}return o.toTensor()}Object.freeze({castTensor:Bw,reshapeTensor:tm,linspaceImpl:Vw,upcastType:Mn,axesAreInnerMostDims:Sw,combineLocations:tN,computeOutAndReduceShapes:Ln,expandShapeToKeepDim:fr,assertAxesAreInnerMostDims:br,getAxesPermutation:ki,getUndoAxesPermutation:Wg,getInnerMostAxes:Oi,getBroadcastDims:Qo,getReductionAxes:pn,assertAndGetBroadcastShape:$e,assertParamsConsistent:nN,computeOutShape:Ga,computePool2DInfo:Pl,computePool3DInfo:sh,computeConv2DInfo:Us,computeConv3DInfo:ah,computeDefaultPad:Pw,tupleValuesAreOne:Ka,eitherStridesOrDilationsAreOne:pr,convertConv2DDataFormat:em,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Yg});var Zte=function(n,t){this.outputShape=[],this.outputShape=n,this.variableNames=t.map(function(i,o){return"T"+o});var e=[];this.variableNames.forEach(function(i){e.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},ene=function(n,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=t.map(function(i,o){return"T"+o});var e=[];this.variableNames.forEach(function(i){e.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},tne=function(n,t,e){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,s=Math.ceil(n.inSize/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===t?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function EN(n,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return n+"."+e})}function wr(n,t){return 1===t?[n]:EN(n,t)}function Qn(){var n,t,e,r,i,o,s,a,u,l;return 2===j().getNumber("WEBGL_VERSION")?(n="#version 300 es",t="in",e="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",t="attribute",e="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}function Ya(n,t,e){void 0===e&&(e="index");var r=Ri(t);return r.map(function(i,o){return"int "+n[o]+" = "+e+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+e+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function Gw(n){var t=Ri(n).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var DN="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function nne(n,t,e,r){var i=[];n.forEach(function(f){var p=de(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var o,s,f,a=i.join("\n"),u=n.map(function(f){return function(p,m,g){void 0===g&&(g=!1);var v="";return v+=g?SN(p):Bl(p),p.shapeInfo.logicalShape.length<=m.logicalShape.length&&(v+=g?function(_,x){var w,P,M=_.name,T=M.charAt(0).toUpperCase()+M.slice(1),S="get"+T+"AtOutCoords",I=_.shapeInfo.logicalShape.length,N=x.logicalShape.length,O=Qo(_.shapeInfo.logicalShape,x.logicalShape),W=St(N),G=N-I,z=["x","y","z","w","u","v"];w=0===I?"":N<2&&O.length>=1?"coords = 0;":O.map(function(ne){return"coords."+z[ne+G]+" = 0;"}).join("\n"),P=N<2&&I>0?"coords":_.shapeInfo.logicalShape.map(function(ne,he){return"coords."+z[he+G]}).join(", ");var L="return outputValue;",B=1===de(_.shapeInfo.logicalShape),U=1===de(x.logicalShape);if(1!==I||B||U){if(B&&!U)L=1===N?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(O.length){var q=I-2,J=I-1;O.indexOf(q)>-1&&O.indexOf(J)>-1?L="return vec4(outputValue.x);":O.indexOf(q)>-1?L="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(J)>-1&&(L="return vec4(outputValue.xx, outputValue.zz);")}}else L="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+S+"() {\n      "+W+" coords = getOutputCoords();\n      "+w+"\n      vec4 outputValue = get"+T+"("+P+");\n      "+L+"\n    }\n  "}(p,m):function(_,x){var w=_.name,M=w.charAt(0).toUpperCase()+w.slice(1),T="get"+M+"AtOutCoords",N=_.shapeInfo.logicalShape.length,O=x.logicalShape.length;if(!_.shapeInfo.isUniform&&N===O&&null==_.shapeInfo.flatOffset&&dn(_.shapeInfo.texShape,x.texShape))return"\n      float "+T+"() {\n        return sampleTexture("+w+", resultUV);\n      }\n    ";var G=St(O),z=Qo(_.shapeInfo.logicalShape,x.logicalShape),P=O-N,L=["x","y","z","w","u","v"];return"\n    float "+T+"() {\n      "+G+" coords = getOutputCoords();\n      "+(0===N?"":O<2&&z.length>=1?"coords = 0;":z.map(function(U){return"coords."+L[U+P]+" = 0;"}).join("\n"))+"\n      return get"+M+"("+(O<2&&N>0?"coords":_.shapeInfo.logicalShape.map(function(U,q){return"coords."+L[q+P]}).join(", "))+");\n    }\n  "}(p,m)),v}(f,t,r)}).join("\n"),l=t.texShape,c=Qn(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+c.texture2D+"(textureSampler, uv).r;\n    }\n  ",h=(f=c).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+f.varyingFs+" vec2 resultUV;\n    "+f.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+f.defineSpecialNaN+"\n    "+f.defineSpecialInf+"\n    "+f.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+rne+"\n    "+ine+"\n    "+one+"\n  ";return t.isPacked?(o=function(f,p){switch(f.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return x=p,1===(w=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+w[1]+".0);\n      }\n    ":1===w[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+w[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+w[0]+", "+w[1]+"));\n      return 2 * (resTexRC.x * "+w[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(_,x){var w=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(dn(_,x))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+w[0]+", "+w[1]+"));\n      }\n    ";var M=Math.ceil(_[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+w[0]+", "+w[1]+"));\n\n      int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n      int r = 2 * (index / "+M+");\n      int c = imod(index, "+M+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(f,p);case 3:return m=f,g=p,v=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],b=(y=Math.ceil(m[2]/2))*Math.ceil(m[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n\n      int b = index / "+b+";\n      index -= b * "+b+";\n\n      int r = 2 * (index / "+y+");\n      int c = imod(index, "+y+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(_,x){for(var w=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],M=Math.ceil(_[_.length-1]/2),T=M*Math.ceil(_[_.length-2]/2),S=T,I="",N="b, r, c",O=2;O<_.length-1;O++)I="\n      int b"+O+" = index / "+(S*=_[_.length-O-1])+";\n      index -= b"+O+" * "+S+";\n    "+I,N="b"+O+", "+N;return"\n    ivec"+_.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+w[0]+", "+w[1]+"));\n      int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n\n      "+I+"\n\n      int b = index / "+T+";\n      index -= b * "+T+";\n\n      int r = 2 * (index / "+M+");\n      int c = imod(index, "+M+") * 2;\n\n      return ivec"+_.length+"("+N+");\n    }\n  "}(f,p)}var x,w,m,g,v,y,b}(t.logicalShape,l),s=function(f){return"\n    void setOutput(vec4 val) {\n      "+f.output+" = val;\n    }\n  "}(c)):(o=function(f,p){switch(f.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(y=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+y[1]+".0);\n      }\n    ":1===y[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+y[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      return resTexRC.x * "+y[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(v,y){return dn(v,y)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+y[0]+", "+y[1]+"));\n      }\n    ":1===v[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===v[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+y[0]+", "+y[1]+"));\n        int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      int r = index / "+v[1]+";\n      int c = index - r * "+v[1]+";\n      return ivec2(r, c);\n    }\n  "}(f,p);case 3:return m=p,g=Ya(["r","c","d"],f),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+m[0]+", "+m[1]+"));\n      int index = resTexRC.x * "+m[1]+" + resTexRC.y;\n      "+g+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(v,y){var b=Ya(["r","c","d","d2"],v);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n      "+b+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(f,p);case 5:return function(v,y){var b=Ya(["r","c","d","d2","d3"],v);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+y[0]+",\n                             "+y[1]+"));\n\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      "+b+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(f,p);case 6:return function(v,y){var b=Ya(["r","c","d","d2","d3","d4"],v);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+y[0]+", "+y[1]+"));\n      int index = resTexRC.x * "+y[1]+" + resTexRC.y;\n\n      "+b+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(f,p);default:throw new Error(f.length+"-D output sampling is not yet supported")}var y,m,g}(t.logicalShape,l),s=function(f){return"\n    void setOutput(float val) {\n      "+f.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(c)),r&&(h+=sne),[h,d,s,a,o,u,e].join("\n")}function Bl(n){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=e.shapeInfo.texShape;if(1===o[0]&&1===o[1])return"\n      float "+i+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+i+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+Xa(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 1:return function(e){var r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+i+"(int index) {\n        "+Vl(e)+"\n      }\n    ";var o=e.shapeInfo.texShape,s=o[0],a=o[1];if(1===a&&1===s)return"\n      float "+i+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=Xa(r);return 1===a?"\n      float "+i+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+s+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===s?"\n      float "+i+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int index) {\n      vec2 uv = uvFromFlat("+s+", "+a+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 2:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=e.shapeInfo.texShape;if(null!=s&&dn(r,s))return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+s[1]+".0, "+s[0]+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ";var l=Ps(r),c=l.newShape,d=l.keptDims;if(c.length<r.length)return"\n      "+Bl(Hl(e,c))+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+Ul(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+Vl(e)+"\n      }\n    ";var p=s[0],m=s[1],g=Xa(i);return 1===m?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+g+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":1===p?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+g+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+m+".0, 0.5);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+g+";\n    vec2 uv = uvFromFlat("+p+", "+m+", index);\n    return sampleTexture("+i+", uv);\n  }\n"}(n);case 3:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=Ps(r),l=u.newShape,c=u.keptDims;if(l.length<r.length)return"\n        "+Bl(Hl(e,l))+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+Ul(["row","col","depth"],c)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+s+", "+a+", 1)));\n        "+Vl(e)+"\n      }\n    ";var f=e.shapeInfo.texShape,p=f[0],m=f[1],g=e.shapeInfo.flatOffset;return m===s&&null==g?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+m+".0, "+p+".0);\n          return sampleTexture("+i+", uv);\n        }\n      ":m===a&&null==g?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+m+".0, "+p+".0);\n      return sampleTexture("+i+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+s+" + col * "+a+" + depth + "+Xa(i)+";\n        vec2 uv = uvFromFlat("+p+", "+m+", index);\n        return sampleTexture("+i+", uv);\n      }\n  "}(n);case 4:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,l=Ps(r),c=l.newShape,d=l.keptDims;if(c.length<r.length)return"\n      "+Bl(Hl(e,c))+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+Ul(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+a+", "+s+", 1)));\n        "+Vl(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],g=p[1];return g===u&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":g===s&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+a+" +\n          depth * "+s+" + depth2;\n      vec2 uv = uvFromFlat("+m+", "+g+", index + "+Xa(i)+");\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);case 5:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,l=r[1]*u,c=Ps(r),d=c.newShape,h=c.keptDims;if(d.length<r.length)return"\n      "+Bl(Hl(e,d))+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+Ul(["row","col","depth","depth2","depth3"],h)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+l+", "+u+", "+a+", "+s+")) +\n          depth3;\n        "+Vl(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,g=m[0],v=m[1];return v===l&&null==p?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+a+", "+s+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+g+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":v===s&&null==p?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+g+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+l+" + col * "+u+" + depth * "+a+" +\n          depth2 * "+s+" + depth3 + "+Xa(i)+";\n      vec2 uv = uvFromFlat("+g+", "+v+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);case 6:return function(e){var r=e.shapeInfo.logicalShape,i=e.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=Ps(r),a=s.newShape,u=s.keptDims;if(a.length<r.length)return"\n      "+Bl(Hl(e,a))+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+Ul(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var c=r[5],d=r[4]*c,h=r[3]*d,f=r[2]*h,p=r[1]*f;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+f+", "+h+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+Vl(e)+"\n      }\n    ";var m=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,v=g[0],y=g[1];return y===p&&null==m?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+f+", "+h+", "+d+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+v+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":y===c&&null==m?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+v+".0);\n        return sampleTexture("+i+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+f+" + depth * "+h+" +\n          depth2 * "+d+" + depth3 * "+c+" + depth4 + "+Xa(i)+";\n      vec2 uv = uvFromFlat("+v+", "+y+", index);\n      return sampleTexture("+i+", uv);\n    }\n  "}(n);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function SN(n){var t,i,o,s,a,u,l;switch(n.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(t=n.name).charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+Qn().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return s="get"+(o=(i=n).name).charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=Qn(),"\n    vec4 "+s+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+l.texture2D+"("+o+", uv);\n    }\n  ";case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],d=Qn();if(null!=u&&dn(o,u))return"\n      vec4 "+a+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+c+".0, "+l+".0);\n\n        return "+d.texture2D+"("+s+", uv);\n      }\n    ";var h=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+a+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(o[1]/2)+", "+h[0]+", "+h[1]+", row, col);\n      return "+d.texture2D+"("+s+", uv);\n    }\n  "}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===o[0])return"\n        "+SN(Hl(i,o.slice(1)))+"\n        vec4 "+a+"(int b, int row, int col) {\n          return "+a+"("+Ul(["b","row","col"],[1,2])+");\n        }\n      ";var h=l[0],f=l[1],p=Math.ceil(o[2]/2);return"\n    vec4 "+a+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+h+", "+f+", "+p*Math.ceil(o[1]/2)+", "+p+", b, row, col);\n      return "+Qn().texture2D+"("+s+", uv);\n    }\n  "}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],h=c[1],f=Math.ceil(o[s-1]/2),p=f*Math.ceil(o[s-2]/2),m="int b, int row, int col",g="b * "+p+" + (row / 2) * "+f+" + (col / 2)",v=2;v<s-1;v++)m="int b"+v+", "+m,g="b"+v+" * "+(p*=o[s-v-1])+" + "+g;return"\n    vec4 "+u+"("+m+") {\n      int index = "+g+";\n      int texR = index / "+h+";\n      int texC = index - texR * "+h+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+h+", "+d+");\n      return "+Qn().texture2D+"("+a+", uv);\n    }\n  "}(n)}}var rne="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ine="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",one="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",sne="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Xa(n){return"offset"+n}function Vl(n){var t=n.name,e=de(n.shapeInfo.logicalShape);return e<2?"return "+t+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function St(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Hl(n,t){var e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function Ul(n,t){return t.map(function(e){return n[e]}).join(", ")}var ane=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,D(n.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var o=Math.ceil(n[n.length-1]/t);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,l=u.length,c=St(l),d=wr("coords",l);if(1===o){var h=St(a=l+1);s="\n        "+h+" sourceLocR = "+h+"("+d.join()+", 0);\n        ++"+d[l-1]+";\n        "+h+" sourceLocG = "+h+"("+d.join()+", 0);\n        ++"+d[l-2]+";\n        "+h+" sourceLocA = "+h+"("+d.join()+", 0);\n        --"+d[l-1]+";\n        "+h+" sourceLocB = "+h+"("+d.join()+", 0);\n        --"+d[l-2]+";"}else a=l,s="\n        "+c+" sourceLocR = coords;\n        ++"+d[l-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+d[l-2]+";\n        "+c+" sourceLocA = coords;\n        --"+d[l-1]+";\n        "+c+" sourceLocB = coords;\n        --"+d[l-2]+";";var f=["x","y","z","w","u","v"].slice(0,a),p="."+f[a-1],m=f.map(function(T){return"int "+T}),g=wr("sourceLocR",a-1).concat("inIdx.r"),v=wr("sourceLocG",a-1).concat("inIdx.g"),y=wr("sourceLocB",a-1).concat("inIdx.b"),b=wr("sourceLocA",a-1).concat("inIdx.a"),_="max"===e?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",w="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",M=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+M+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+d[l-1]+" < "+(u[l-1]-1)+";\n        bool hasNextRow = "+d[l-2]+" < "+(u[l-2]-1)+";\n        "+s+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+w+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+w+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+_+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},une=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var a=n.effectiveFilterHeight,u=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(a-1-n.padInfo.top)+", "+(u-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+a+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},lne=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(c-1-n.padInfo.front)+", "+(d-1-n.padInfo.top)+", "+(h-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterDepth*n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+h+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},cne=function(n,t,e,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],$e(n,t),$e(n,e);var s="0.0";null!=r&&($e(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";null!=i&&($e(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+a+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},dne=function(n,t,e,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],$e(n,t),$e(n,e);var s="vec4(0.0)";null!=r&&($e(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";null!=i&&($e(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+s+";\n        vec4 scale = "+a+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},AN=function(n,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=$e(t,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},zw="return a + b;",$w="return a - b;",MN="return a * b;",IN="return (a < 0.) ? b * a : a;",$t=function(n,t,e){this.variableNames=["A","B"],this.outputShape=$e(t,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},TN="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Jo=function(n,t,e,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=$e(t,e);var i=this.outputShape.length,o="";if(r)if(0===i||1===de(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+St(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var s=wr("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+s[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+s[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},pne=function(){function n(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,t),i.gl.uniform1f(r.maxLoc,e)}},n}(),gne=function(){function n(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(i,o){null==r.minLoc&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,t),i.gl.uniform1f(r.maxLoc,e)}},n}(),mne=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},vne=function(n){this.outputShape=[],this.outputShape=Ga(n,1),this.variableNames=n.map(function(a,u){return"T"+u});var t=new Array(n.length-1);t[0]=n[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+n[e][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++)r.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+t[e-1]+"));");r.push("else setOutput(getT"+t.length+"(yR, yC-"+t[t.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},yne=function(n,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ga(n,t);var e=this.outputShape,r=e.length,i=St(r),o=wr("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,v){return"T"+v});var a=new Array(n.length-1);a[0]=n[0][t];for(var u=1;u<a.length;u++)a[u]=a[u-1]+n[u][t];var l=s[t],c=s.slice(-2),d=s.join(),h="if ("+l+" < "+a[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+c.join()+"));\n        }";for(u=1;u<a.length;u++){var f=a[u-1];h+="\n        if ("+l+" < "+a[u]+"  && "+l+" >= "+a[u-1]+") {\n          return getChannel(\n            getT"+u+"("+nm(s,l,f)+"),\n            vec2("+nm(c,l,f)+"));\n        }"}var m=a[a.length-1];h+="\n        return getChannel(\n          getT"+a.length+"("+nm(s,l,m)+"),\n          vec2("+nm(c,l,m)+"));",this.userCode="\n      float getValue("+s.map(function(g){return"int "+g})+") {\n        "+h+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+e[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+e[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+e[r-2]+" &&\n            "+o[r-1]+" < "+e[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function nm(n,t,e){var r=n.indexOf(t);return n.map(function(i,o){return o===r?i+" - "+e:i}).join()}var _ne=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===n.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},bne=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,o="channelsLast"===n.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(o?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(o?1:2)+"], coords["+(o?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+o+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xne=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},wne=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-n.padInfo.front)+", "+(e-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Cne=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ene=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,a=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+a+"; dm++) {\n              int d2 = d1 * "+a+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},RN=function(n,t,e,r){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,s=n.strideHeight,a=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,d=n.filterWidth,h=4*Math.floor(n.inChannels/4),f=n.inChannels%4,p="channelsLast"===n.dataFormat,m=p?1:2,g=p?2:3,v=p?3:1,y="",b="";e&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",b="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+s+", "+a+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+c+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+l+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+h+") *\n                    getW(wR, wC, "+h+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+h+", xR, xC) *\n                    getW(wR, wC, "+h+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+h+", d2),\n                getW(wR, wC, "+h+" + 1, d2),\n                getW(wR, wC, "+h+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+h+"),\n                  getX(batch, xR, xC, "+h+" + 1),\n                  getX(batch, xR, xC, "+h+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+h+", xR, xC),\n                  getX(batch, "+h+" + 1, xR, xC),\n                  getX(batch, "+h+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+_+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Dne=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,d=n.filterHeight,h=n.filterWidth,f=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+t+", "+e+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+a+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+"; wC++) {\n              int xC = xCCorner + wC * "+l+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},FN=function(n,t,e,r){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,h=n.filterHeight,f=n.filterWidth,p=n.outChannels/n.inChannels,m="",g="";e&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+h+"; wR++) {\n          int xR = xRCorner + wR * "+c+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},kN=function(n,t,e,r){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,d=n.dilationWidth,h=n.filterHeight,f=n.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<h;g++)for(var v=0;v<f;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<h;g++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+g*c+";\n          xC = xCCorner + "+(v=2*y)*d+";\n        ",1===l){if(v<f&&(m+=a%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<f)){var b=a%2==0?iw(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(m+="\n                  xCOffset = xC + "+a%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<f&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",a%2==1?(m+="\n                xCOffset = xC + 1 - "+l+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<f&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+l+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+l+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<f&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<f&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<f&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<h;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var _="",x="";e&&(_=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",x="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+_+"\n\n      const ivec2 strides = ivec2("+u+", "+l+");\n      const ivec2 pads = ivec2("+s+", "+a+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+w+"\n        "+x+"\n        setOutput(result);\n      }\n    "},Sne=function(n,t,e,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],s=n[1],a=n[2],c=e[0],d=e[1];this.outputShape=[t[0],c,d,n[3]];var f=[s-1+".0",a-1+".0"],p=f[0],m=f[1],g=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],_=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m];this.userCode="\n      const float height_ratio = float("+g[0]+");\n      const float width_ratio = float("+_[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+g[1]+";\n        float width_scale = "+_[1]+";\n\n        float in_y = "+g[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+_[2]+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Ane=function(n,t,e){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+St(r)+" coords = getOutputCoords();\n        int end = "+ON(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+ON(r,"coords")+" = idx;\n          val += getX("+function(s,a){if(1===s)return""+a;if(2===s)return a+".x, "+a+".y";if(3===s)return a+".x, "+a+".y, "+a+".z";if(4===s)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function ON(n,t){if(1===n)return""+t;if(2===n)return t+".y";if(3===n)return t+".z";if(4===n)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var Mne=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xd.DENSE;var t=Qd(n),e=Qn();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Ya(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},Ine=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xd.DENSE;var t=Qd(n),e=Qn();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Ya(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},Tne=function(){function n(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),Rne=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Fne=function(n){this.variableNames=["A"],this.outTexUsage=Nr.DOWNLOAD;var t=Qn();this.outputShape=n,this.userCode="\n      "+DN+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},kne=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Nr.DOWNLOAD;var t=Qn();this.outputShape=n,this.userCode="\n      "+DN+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},One=function(n,t,e){void 0===e&&(e=!1),this.variableNames=["A"];var r=Qn(),i=t[0],o=t[1];this.outputShape=n;var s="result";e&&(s="floor(result * 255. + 0.5)"),this.userCode="\n      "+Gw(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+s+", 0., 0., 0.);\n      }\n    "},Nne=function(n,t,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Qn(),i=t[0],o=t[1];this.outputShape=n;var s="",a="result";e&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;s+="\n          localCoords = coords;\n          if(localCoords[2] + "+l+" < "+n[2]+") {\n            localCoords[2] += "+l+";\n            if(localCoords[1] + "+u+" < "+n[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+c+"] = values[0];\n              } else if(offset == 1) {\n                result["+c+"] = values[1];\n              } else if(offset == 2) {\n                result["+c+"] = values[2];\n              } else {\n                result["+c+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Gw(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+s+"\n\n        "+r.output+" = "+a+";\n      }\n    "},NN=function(n,t,e){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Bne=function(){function n(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,i){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(e.valueLoc,t)}},n}(),Vne=function(n,t,e){this.variableNames=["A","indices"];var r=n.slice();r[e]=t,this.outputShape=r,this.rank=r.length;var i=St(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<s.length;d++)c.push(d===a?"int(getIndices("+l[d]+"))":""+l[d]);return c.join()}(n,e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},Hne=function(n,t,e){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var r=St(t.length),i=St(e.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function PN(n,t){var e=Qn();return R2(n,t,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function LN(n,t){return N2(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function BN(n,t){return P2(n,t,new Uint16Array([0,1,2,2,1,3]))}function lh(n,t,e,r,i,o,s){B2(e,r);var a=L2(n,t),u=n.TEXTURE_2D;return ue(n,t,function(){return n.bindTexture(u,a)}),ue(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),ue(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),ue(n,t,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),ue(n,t,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),ue(n,t,function(){return n.texImage2D(u,0,i,e,r,0,o,s,null)}),ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function VN(n,t,e,r,i){var o=Ng(e,r);return lh(n,t,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function HN(n,t,e,r,i){var o=Ng(e,r);return lh(n,t,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function UN(n,t,e,r,i){var o=Ng(e,r);return lh(n,t,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function jN(n,t,e,r,i){var o=Jd(e,r);return lh(n,t,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function WN(n,t,e,r,i){var o=Jd(e,r);return lh(n,t,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function GN(n,t,e,r){return ue(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),ww(n,t,e,"clipSpacePos",r,3,20,0)&&ww(n,t,e,"uv",r,2,20,12)}function zN(n,t,e,r,i,o,s){var a,u,l;ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(a=new Float32Array(r*i*4),u=n.FLOAT,l=s.internalFormatPackedFloat),a.set(o),ue(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,a)}),ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function $N(n,t,e,r){ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),r.data instanceof Uint8Array?ue(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):ue(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),ue(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function qN(n,t,e,r,i){var o=n.createBuffer();ue(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var s=16*e*r;return ue(n,t,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),ue(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,0)}),ue(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function KN(n,t,e){var r=n,i=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function YN(n,t,e,r,i){var o=Ng(e,r),s=o[0],a=o[1],u=new Uint8Array(e*r*4);return ue(n,t,function(){return n.readPixels(0,0,s,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function XN(n,t,e,r,i,o,s,a){var h,u=n,l=new Float32Array((h=Jd(o,s))[0]*h[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function QN(n,t,e,r){var i=new Float32Array(e*r*4);return ue(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,i)}),i}var Une=Object.freeze({createVertexShader:PN,createVertexBuffer:LN,createIndexBuffer:BN,createFloat32MatrixTexture:VN,createFloat16MatrixTexture:HN,createUnsignedBytesMatrixTexture:UN,createPackedMatrixTexture:jN,createFloat16PackedMatrixTexture:WN,bindVertexProgramAttributeStreams:GN,uploadDenseMatrixToTexture:zN,uploadPixelDataToTexture:$N,createBufferFromOutputTexture:qN,downloadFloat32MatrixFromBuffer:KN,downloadByteEncodedFloatMatrixFromOutputTexture:YN,downloadPackedMatrixFromBuffer:XN,downloadMatrixFromPackedOutputTexture:QN}),JN=function(){function n(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=j().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,M2(e,t)):this.gl=lo(e);var r="WEBGL_color_buffer_float";if(1===j().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Zd(this.gl,this.debug,"OES_texture_float"),Lr(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Zd(this.gl,this.debug,"OES_texture_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Lr(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Zd(this.gl,this.debug,"EXT_color_buffer_half_float");else if(j().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(Lr(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Lr(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=LN(this.gl,this.debug),this.indexBuffer=BN(this.gl,this.debug),this.framebuffer=V2(this.gl,this.debug),this.textureConfig=xw(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return j().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;ue(e,this.debug,function(){return e.finish()}),ue(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),ue(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),ue(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),ue(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),ue(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),VN(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),HN(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),UN(this.gl,this.debug,t,e)},n.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),$N(this.gl,this.debug,t,e)},n.prototype.uploadDenseMatrixToTexture=function(t,e,r,i){this.throwIfDisposed(),zN(this.gl,this.debug,t,e,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),WN(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),jN(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(Cw(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ue(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return YN(i.gl,i.debug,e,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,i,o,s){return XN(this.gl,t,0,0,0,o,s)},n.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return KN(this.gl,t,e)},n.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var i=qN(this.gl,this.debug,e,r);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},n.prototype.createFence=function(t){var e,r,i=this;if(j().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},e=s}else j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(e,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var i=this;return this.downloadMatrixDriver(t,function(){return QN(i.gl,i.debug,e,r)})},n.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=F2(e,this.debug,t),i=PN(e,this.debug),o=k2(e,this.debug);return ue(e,this.debug,function(){return e.attachShader(o,i)}),ue(e,this.debug,function(){return e.attachShader(o,r)}),O2(e,this.debug,o),this.debug&&Bg(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=GN(e,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&ue(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},n.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&Bg(this.gl,this.debug,this.program),ue(this.gl,this.debug,function(){return e.gl.useProgram(t)})},n.prototype.getUniformLocation=function(t,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?U2(this.gl,this.debug,t,e):j2(this.gl,t,e)},n.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),ue(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},n.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},n.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),W2(this.gl,this.debug,0,t,e,r)},n.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},n.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var i=Jd(e,r);this.setOutputMatrixTextureDriver(t,i[0],i[1])},n.prototype.setOutputMatrixWriteRegion=function(t,e,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,e)},n.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&Bg(this.gl,this.debug,this.program),eh(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),ue(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),ue(this.gl,this.debug,function(){return t.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Zd(this.gl,this.debug,2===j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(2!==j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(t){return le(this,void 0,void 0,function(){var e=this;return ce(this,function(r){switch(r.label){case 0:return[4,ow(function(){return e.disposed||e.isQueryAvailable(t,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var t=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},n.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||ow(function(){return r.pollItems(),0===r.itemsToPoll.length})},n.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Vg(this.gl,this.debug,t,this.framebuffer),this.debug&&eh(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Vg(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&eh(this.gl)):Cw(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var i=this.gl;Vg(i,this.debug,t,this.framebuffer),this.debug&&eh(i),this.outputTexture=t,ue(i,this.debug,function(){return i.viewport(0,0,e,r)}),ue(i,this.debug,function(){return i.scissor(0,0,e,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,i){var o=this;this.throwIfDisposed(),ue(this.gl,this.debug,function(){return o.gl.scissor(t,e,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function ZN(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach(function(e,r){var i=e.logicalShape,o=t[r],s=o.shape;if(!dn(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!e.isUniform||!o.isUniform){var a=e.texShape,u=o.isUniform?null:o.texData.texShape;if(!dn(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var jne=function(n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var i=e.inChannels,o=e.strideWidth,s=e.strideHeight,a=e.padInfo,u=e.outWidth,l=e.dilationWidth,c=e.dilationHeight,d=e.dataFormat,h=a.left,f=a.top,p=i*e.filterWidth,m=Qn(),g="channelsLast"===d,v=g?0:1,y=g?1:2,b="",_=0;_<=1;_++)for(var x=0;x<=1;x++)b+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+_+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+s+" - "+f+";\n            d0 = offsetY + "+c+" * (pos / "+p+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+o+". - "+h+".);\n              d1 = offsetX + "+l+" * (int(mod(float(pos), "+p+".) / "+i+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*_+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*_+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},Wne=function(n,t,e,r,i){this.variableNames=["x"],this.outputShape=[];var s=t,a=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+s+"; j <= "+s+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},Gne=function(n,t,e,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},zne=function(n,t,e,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var s=t,a=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+s+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+s+"; j <= "+s+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},$ne=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var i=n.effectiveFilterHeight,o=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(i-1-n.padInfo.top)+", "+(o-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(i*o-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qne=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var a=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(a-1-n.padInfo.front)+", "+(u-1-n.padInfo.top)+", "+(l-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+a+";\n           wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(a*u*l-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+l+" +\n                  wR * "+l+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qw=function(n,t,e,r,i,o,s){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===s&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var u=Math.ceil((e?n[1]:n[2])/2),l=e?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";o&&(f=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",p="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+l+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+h[0]+");\n          result += ("+d[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},Kne=function(){function n(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,i){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(e.seedLoc,t)}},n}(),Yne=function(n,t,e,r){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},Xne=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var a,l,c,t=n.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=wr("rc",t),r=St(t),i=function(a,u,l){if(1===a)return"rc > "+u[0];for(var c="",d=a-2;d<a;d++)c+=l[d]+" >= "+u[d],d<a-1&&(c+="||");return c}(t,n,e),o=function(a,u,l,c){if(1===a)return"";var d=c.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+l+";\n  "}(t,n[n.length-1],n[n.length-2],e),s=(c=function(d,h){for(var f=[],p=0;p<=1;p++)for(var m=0;m<=1;m++){for(var g=(0===p?"r":"rp1")+", "+(0===m?"c":"cp1"),v=2;v<d;v++)g=h[h.length-1-v]+","+g;f.push(g)}return f}(l=(a=n).length,e),1===l?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+c[0]+"),\n          cEdge ? 0. : getA("+c[1]+"),\n          rEdge ? 0. : getA("+c[2]+"),\n          rEdge || cEdge ? 0. : getA("+c[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+s+"));\n          }\n        }\n      "}},Qne=function(n,t,e){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=St(r),o=t.map(function(u){return u[0]}).join(","),s=t.map(function(u,l){return u[0]+n[l]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+a+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Jne=function(n,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(g,v){return g[0]+n[v]+g[1]});for(var r=n.length,i=St(r),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,v){return g[0]+n[v]}).join(","),a=wr("rc",r),u=wr("source",r),l=a[r-1]+" < "+this.outputShape[r-1],c=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[i+" rc = outputLoc;",a[r-1]+" += 1;\n       if("+l+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+a[r-2]+" += 1;\n       if("+a[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+a[r-1]+" += 1;\n         if("+l+") {"],h=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=1===r?2:4;p<m;p++)f+="\n        "+d[p]+"\n        if ("+h+") {\n          result["+p+"] = float("+e+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+c+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+s+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(f+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},Kw=function(n,t,e){if(this.variableNames=["x"],"avg"===t&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var h="avg"===t,f="0.0";if(h||(f="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+c+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+s+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+a+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+c+", "+d+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+s+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+a+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              getValue(batch, xR, xC + 3 * "+a+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+a+", d),\n              getValue(batch, xR, xC + 2 * "+a+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Yw=function(n,t,e){if(this.variableNames=["x"],"avg"===t&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,d=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=n.padInfo.front,p=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;var g="avg"===t,v="0.0";if(g||(v="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+s+");\n        const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+c+";\n              wD += "+a+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+h+";\n                  wC += "+l+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+h+" +\n                      wR * "+h+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),_=r%4,x="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+s+");\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+c+";\n            wD += "+a+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+l+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+l+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+l+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+l+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},Zne=function(n,t){this.variableNames=["x"];var e=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/e);this.outputShape=[r,o];var s="0.0",a="";"prod"===t?s="1.0":"min"===t?(s="1.0 / 1e-20",a="min"):"max"===t&&(s="-1.0 / 1e-20",a="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(e/4),c=e%4,d="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+a+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";i%e>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+s+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+s+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},ere=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var e="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),e+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Ya(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Gw(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},tre=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],l=[e&&a>1?i-1:i,e&&u>1?o-1:o],c=[e&&a>1?a-1:a,e&&u>1?u-1:u],d=l[0]/c[0],h=l[1]/c[1],f=1/d,p=1/h,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},nre=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[1],s=n[2];this.outputShape=[n[0],t,e,n[3]];var u=[r&&t>1?o-1:o,r&&e>1?s-1:s],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},rre=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=n[1],s=n[2],a=n[3];this.outputShape=[n[0],t,e,a];var u=[r&&t>1?o-1:o,r&&e>1?s-1:s],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+",\n          "+u[1]/l[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+s+".0,\n                                     "+s+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},ire=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],l=[e&&a>1?i-1:i,e&&u>1?o-1:o],c=[e&&a>1?a-1:a,e&&u>1?u-1:u],d=l[0]/c[0],h=l[1]/c[1],f=1/d,p=1/h,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+a+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ore=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var o=n[1],s=n[2];this.outputShape=[n[0],t,e,n[3]];var u=[r&&t>1?o-1:o,r&&e>1?s-1:s],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+s+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},sre=function(n,t){this.variableNames=["x"];var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=n,1!==e){var r=n.map(function(o,s){return-1!==t.indexOf(a=s)&&1!==n[a]?n[a]+" - coords["+a+"] - 1":"coords["+a+"]";var a}).join(","),i=St(e);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},are=function(n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=n;var u,r=wr("rc",e),i=r[e-1]+" + 1 < "+this.outputShape[e-1],o=r[e-2]+" + 1 < "+this.outputShape[e-2],s=St(e);function a(u){var l=n.map(function(c,d){return f=u,-1!==t.indexOf(h=d)&&1!==n[h]?n[h]+" - "+f[h]+" - 1":""+f[h];var h,f});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1),\n            "+n[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1),\n                "+n[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+s+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+a(r.slice())+";\n          if("+i+"){\n            result.g = "+((u=r.slice())[e-1]="("+u[e-1]+" + 1)",a(u)+";\n          }\n          if(")+o+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",a(u)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",a(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},eP=function(n,t,e,r,i,o,s){void 0===s&&(s=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=St(i.length),u=St(o.length),l="";1===e?l="i":2===e&&(l="i, j");var d="";1===r?d="i":2===r&&(d="i, coords[1]"),this.userCode="\n        "+a+" strides = "+a+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round(getIndices("+l+"));\n              flattenedIndex += index * "+(t>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},ure=function(n,t){this.variableNames=["x","segmentIds"];var e=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,s=o*Math.ceil(i/e);this.outputShape=[r,s];var a=4*Math.floor(e/4),u=e%4,l="\n        sumValue += dot(values, segFilter);\n    ",c="";i%e>0&&(c="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var d="";i%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+a+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+a+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "},lre=function(n,t,e){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<t.length;u++)a.push(""+o[u]),u<n&&s.push(""+o[u]);r=s.join(),i=a.join()}var l=St(e);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},cre=function(){function n(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=St(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(1===s)return"sourceLoc";if(s<=6)return Xw.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+t.map(function(s,a){return"sourceLoc."+Xw[a]+" = start["+a+"] + coords."+Xw[a]+";"}).join("\n")+"\n      ",this.userCode="\n      "+i+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,i){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(i,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,t)}},n}(),Xw=["x","y","z","w","u","v"],dre=function(){function n(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=St(this.rank),r=wr("coords",this.rank),i=wr("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a="\n      result.x = "+s+";\n      if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+i[this.rank-1]+";\n        result.y = "+s+";\n        --"+i[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+i[this.rank-2]+";\n        result.z = "+s+";\n        if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+i[this.rank-1]+";\n          result.w = "+s+";\n        }\n      }\n    ",l=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(c,d){return"start["+d+"]"}).join()+");":t.map(function(c,d){return i[d]+" = "+r[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+l+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,i){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(i,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,t)}},n}(),hre=function(n,t,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=St(e.length),o=St(e.length),s="";if(1===r)s="coords * strides + begin";else{var a=0;s=e.map(function(u,l){return a++,1===e.length?"coords * strides["+l+"] + begin["+l+"]":"coords["+(a-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+n+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "},fre=function(){function n(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(t,e,r){var i,o=tP(e,r),s=nP(t,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===Pr.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===Pr.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===Pr.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===Pr.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===Pr.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(t,e,r,i){if(null!=this.freeTextures){var o=nP(e,tP(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(i){t.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function tP(n,t){if(n===Nr.UPLOAD)return Pr.PACKED_2X2_FLOAT32;if(n===Nr.RENDER||null==n)return e=t,j().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Pr.PACKED_2X2_FLOAT32:Pr.UNPACKED_FLOAT32:e?Pr.PACKED_2X2_FLOAT16:Pr.UNPACKED_FLOAT16;var e;if(n===Nr.DOWNLOAD||n===Nr.PIXELS)return Pr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function nP(n,t,e){return n[0]+"_"+n[1]+"_"+t+"_"+e}var pre=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[r]*t[r];this.outputShape=e,this.rank=e.length;var i=St(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(1===a)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<s.length;c++)l.push("imod("+u[c]+", "+s[c]+")");return l.join()}(n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},gre=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];this.outputShape=e,this.rank=e.length;var i=St(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(a),c=0;c<s.length;c++)l[s[c]]=u[c];return l.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},mre=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=St(this.rank),o=EN("rc",this.rank),s=new Array(this.rank);for(r=0;r<t.length;r++)s[t[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+e[this.rank-1],l="getChannel(getA("+s.join()+"), "+a+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+l+";\n      if("+u+") {\n        result[1] = "+l+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+l+";\n        if("+u+") {\n          result[3] = "+l+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Ve=function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Pi="if (isnan(x)) return x;",rP="return abs(x);",iP=Pi+"\n  return (x < 0.0) ? 0.0 : x;\n",oP=Pi+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",sP="return (x >= 0.0) ? x : (exp(x) - 1.0);",aP="return -x;",uP="return ceil(x);",lP="return floor(x);",cP="return exp(x);",dP="return exp(x) - 1.0;",rm="return x;",hP="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",fP="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",pP="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",ch=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Mre=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var t=n.length,e=wr("rc",t),r=St(t),i=function(a,u){if(1===a)return"rc";for(var l="",c=0;c<a;c++)l+=u[c],c<a-1&&(l+=",");return l}(t,e),o=e.slice(-2),s=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+s+"));\n      }\n    "},im={};function om(n,t){if(void 0===t&&(t=!1),"linear"===n)return"return x;";if("relu"===n)return t?hP:iP;if("elu"===n)return t?pP:sP;if("relu6"===n)return t?fP:oP;if("prelu"===n)return t?TN:IN;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var gP=function(n){function t(e){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!j().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=lo(j().getNumber("WEBGL_VERSION"));i.binaryCache=((r=j().getNumber("WEBGL_VERSION"))in im||(im[r]={}),im[r]),i.gpgpu=new JN(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=e,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=e.gl.canvas;return i.textureManager=new fre(i.gpgpu),i.numMBBeforeWarning=null==j().global.screen?1024:j().global.screen.height*j().global.screen.width*window.devicePixelRatio*600/1024/1024,i.texData=new mN(i,F),i}return Ti(t,n),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,r,i){if(j().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===i&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:e,usage:Nr.UPLOAD}),o},t.prototype.move=function(e,r,i,o){if(j().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===o)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:i,dtype:o,values:r,usage:Nr.UPLOAD})},t.prototype.readSync=function(e){var r=this.texData.get(e),i=r.values,o=r.dtype,s=r.complexTensors,u=r.shape;if(null!=r.slice){var c;c=r.isPacked?new ch(u,rm):new Ve(u,rm);var d=this.runWebGLProgram(c,[{dataId:e,shape:u,dtype:o}],o),h=this.readSync(d.dataId);return this.disposeData(d.dataId),h}if(null!=i)return this.convertAndCacheOnCPU(e);if("string"===o)return i;var f,p,m=null!=this.activeTimers;return m&&(f=Fi()),p="complex64"===o?Hw(s.real.dataSync(),s.imag.dataSync()):this.getValuesFromTexture(e),m&&(this.downloadWaitMs+=Fi()-f),this.convertAndCacheOnCPU(e,p)},t.prototype.read=function(e){return le(this,void 0,void 0,function(){var r,i,o,s,u,l,c,d,h,f,p,m,g,v,y,x,w,M,T;return ce(this,function(S){switch(S.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(I){return r.push(I)})];if(i=this.texData.get(e),o=i.values,s=i.shape,u=i.dtype,l=i.complexTensors,c=i.isPacked,null!=i.slice)return d=c?new ch(s,rm):new Ve(s,rm),h=this.runWebGLProgram(d,[{dataId:e,shape:s,dtype:u}],u),f=this.read(h.dataId),this.disposeData(h.dataId),[2,f];if(null!=o)return[2,this.convertAndCacheOnCPU(e)];if(!j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===j().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&j().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(e),g=this.texData.get(m.dataId),p=(T=this.gpgpu).createBufferFromTexture.apply(T,[g.texture].concat(Qd(s)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return y=S.sent(),v=Hw(y[0],y[1]),[3,5];case 4:null==p?v=this.getValuesFromTexture(e):(x=de(s),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),S.label=5;case 5:return null!=m&&this.disposeData(m.dataId),w=this.convertAndCacheOnCPU(e,v),M=this.pendingRead.get(e),this.pendingRead.delete(e),M.forEach(function(I){return I(w)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,w]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var r=0;r<e.length;r++){var i=e[r];if(!I2(i))throw j().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var r,i=this.texData.get(e),o=i.shape,s=i.dtype,a=i.isPacked,u=de(o);if(j().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),c=this.texData.get(l.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Qd(o))).subarray(0,u);return this.disposeData(l.dataId),d}var h=j().getBool("WEBGL_PACK")&&!0===a,f=h?Hg(o):o,p=h?new kne(f):new Fne(f),m=this.runWebGLProgram(p,[{shape:f,dtype:s,dataId:e}],"float32"),g=this.texData.get(m.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(m.dataId),v},t.prototype.time=function(e){return le(this,void 0,void 0,function(){var r,i,o,s,a,u,l;return ce(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,null==this.programTimersStack?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,e(),s=qo(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),a=qo(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=c.sent(),u.kernelMs=c2(l),u.getExtraProfileInfo=function(){return l.map(function(d,h){return{name:a[h],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Fi(),endMs:null}},t.prototype.endTimer=function(e){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Fi(),e)},t.prototype.getQueryTime=function(e){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){return j().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var r=this.texData.get(e),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||e,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),null!=i&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,u)));var h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return j().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=F.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,r){var i=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&e.every(function(o){return null==i.texData.get(o.dataId).texture&&o.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,r){var i=this.makeOutput(e.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:F.keep(e.clone()),imag:F.keep(r.clone())},i},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,i);if(0===de(i))return Vn([],i,e.dtype);var o=this.texData.get(e.dataId).isPacked,s=Ow(e.shape,r,i);if(o||!s){var a=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dre(i):new cre(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,i)},t.prototype.shallowSlice=function(e,r,i){var o=this.texData.get(e.dataId),s=this.makeOutput(i,e.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=e.dtype;var u=Nw(r,e.strides);o.slice&&(u+=o.slice.flatOffset),a.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||e.dataId};var l=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,l+1),s},t.prototype.stridedSlice=function(e,r,i,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,i,o);var s=Xg(r,i,o);if(s.some(function(u){return 0===u}))return Vn([],s);var a=new hre(r,o,s);return this.compileAndRun(a,[e])},t.prototype.reverse=function(e,r){var i=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new are(e.shape,r):new sre(e.shape,r);return this.compileAndRun(i,[e])},t.prototype.concat=function(e,r){if("complex64"===e[0].dtype){var i=e.map(function(f){return si(f)}),o=e.map(function(f){return ho(f)});return Bn(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(1===e.length)return e[0];if(e.length>j().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(e.length/2),a=this.concat(e.slice(0,s),r),u=this.concat(e.slice(s),r);return this.concat([a,u],r)}if(j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var l=new yne(e.map(function(f){return f.shape}),r);return this.compileAndRun(l,e)}var c=Ga(e.map(function(f){return f.shape}),r),d=e.map(function(f){return f.as2D(-1,de(f.shape.slice(r)))}),h=new vne(d.map(function(f){return f.shape}));return this.compileAndRun(h,d).reshape(c)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,aP,e.dtype);var r=new Ve(e.shape,aP);return this.compileAndRun(r,[e])},t.prototype.batchMatMul=function(e,r,i,o){var s=i?e.shape[2]:e.shape[1],a=o?r.shape[1]:r.shape[2],u=i?e.shape[1]:e.shape[2],l=e.shape[0];if((1===s||1===a)&&u>1e3){i&&(e=e.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var c=1===a?e:e.as3D(l,u,1),d=1===a?2:1,h=1===a?r.as3D(l,1,u):r;return this.multiply(c,h).sum(d,!0)}var f=Mn(e.dtype,r.dtype),p=new qw(e.shape,[l,s,a],i,o);return this.compileAndRun(p,[e,r],f)},t.prototype.fusedBatchMatMul=function(e){var r=e.a,i=e.b,o=e.transposeA,s=e.transposeB,a=e.bias,u=e.activation,l=e.preluActivationWeights,c=o?r.shape[2]:r.shape[1],d=s?i.shape[1]:i.shape[2],h=r.shape[0],f=Mn(r.dtype,i.dtype),p=null!=a,m=null!=l,g=u?om(u,!0):null,v=new qw(r.shape,[h,c,d],o,s,p,g,m),y=[r,i];return a&&y.push(a),l&&y.push(l),this.compileAndRun(v,y,f)},t.prototype.multiply=function(e,r){if("complex64"===e.dtype){var i=this.texData.get(e.dataId),o=this.texData.get(r.dataId),s=new AN("return areal * breal - aimag * bimag;",e.shape,r.shape),a=new AN("return areal * bimag + aimag * breal;",e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,i.complexTensors.real),this.makeComplexComponentTensorInfo(e,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(s,u),c=this.compileAndRun(a,u),d=this.complex(l,c);return l.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,MN,e.dtype);var h=new $t(MN,e.shape,r.shape);return this.compileAndRun(h,[e,r],e.dtype)},t.prototype.batchNormalization=function(e,r,i,o,s,a){var u=[e,r,i],l=null;null!=a&&(l=a.shape,u.push(a));var c=null;if(null!=s&&(c=s.shape,u.push(s)),j().getBool("WEBGL_PACK_NORMALIZATION")){var d=new dne(e.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(d,u)}var h=new cne(e.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)},t.prototype.localResponseNormalization4D=function(e,r,i,o,s){var a=j().getBool("WEBGL_PACK_NORMALIZATION")?new zne(e.shape,r,i,o,s):new Wne(e.shape,r,i,o,s);return this.compileAndRun(a,[e])},t.prototype.LRNGrad=function(e,r,i,o,s,a,u){var l=new Gne(r.shape,o,s,a,u);return this.compileAndRun(l,[r,i,e])},t.prototype.tile=function(e,r){if("string"===e.dtype){var i=this.readSync(e.dataId).map(function(s){return zd(s)});return wN(Oe(e.shape,e.dtype,i),r)}var o=new pre(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.pad=function(e,r,i){var o=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jne(e.shape,r,i):new Qne(e.shape,r,i);return this.compileAndRun(o,[e])},t.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var i=j().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mre(e.shape,r):new gre(e.shape,r);return this.compileAndRun(i,[e])},t.prototype.gather=function(e,r,i){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,i);var o=new Vne(e.shape,r.size,i);return this.compileAndRun(o,[e,r])},t.prototype.batchToSpaceND=function(e,r,i){D(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,h){return d*h}),s=$g(e.shape,r,o),a=qg(s.length,r.length),u=Kg(e.shape,r,o),l=lN(i,r.length),c=cN(u,i,r.length);return e.reshape(s).transpose(a).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(e,r,i){D(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(h,f){return h*f}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<e.shape.length;++a)s.push([0,0]);var u=e.pad(s),l=$g(u.shape,r,o,!1),c=qg(l.length,r.length,!1),d=Kg(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(d)},t.prototype.reduce=function(e,r,i){var o=e.shape[0],s=e.shape[1],a=Yg(s),u=new Zne({windowSize:a,inSize:s,batchSize:o},r),l=this.compileAndRun(u,[e],i);return 1===l.shape[1]?l:this.reduce(l,r,i)},t.prototype.argReduce=function(e,r,i){void 0===i&&(i=null);var o=e.shape[0],s=e.shape[1];null!=i&&(o=i.shape[0],s=i.shape[1]);var a=Yg(s),u=new tne({windowSize:a,inSize:s,batchSize:o},r,null==i),l=[e];null!=i&&l.push(i);var c=this.compileAndRun(u,l,"int32");return 1===c.shape[1]?c:this.argReduce(e,r,c)},t.prototype.argReducePacked=function(e,r,i){void 0===i&&(i=null);var o=null!=i?i.shape:e.shape,s=Yg(o[o.length-1]),a=new ane(o,s,r,null==i),l=this.compileAndRun(a,null==i?[e]:[e,i],"int32");return l.rank===e.rank?this.argReducePacked(e,r,l):l},t.prototype.sum=function(e,r){br("sum",r,e.rank);var i=Ln(e.shape,r),o=i[0],s=de(i[1]),a=e.as2D(-1,s),u=vw(e.dtype);return this.reduce(a,"sum",u).reshape(o)},t.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var i=Ln(e.shape,r),o=i[0],s=de(i[1]),a=e.as2D(-1,s),u=vw(e.dtype);return this.reduce(a,"prod",u).reshape(o)},t.prototype.unsortedSegmentSum=function(e,r,i){var o=0,s=ki([o],e.rank),a=e;null!=s&&(a=e.transpose(s),o=Oi(1,e.rank)[0]);var u=function(f,p,m){for(var g=[],v=f.length,y=0;y<v;y++)g.push(y!==p?f[y]:m);return g}(a.shape,o,i),l=de([a.shape[o]]),c=a.as2D(-1,l),d=vw(e.dtype),h=this.segOpCompute(c,"unsortedSegmentSum",r,d,i).reshape(u);return null!=s&&(h=h.transpose(Wg(s))),h},t.prototype.segOpCompute=function(e,r,i,o,s){var a=e.shape[0],u=e.shape[1],l=function(h,f){var p,m=!1;for(h<=30?(p=h,m=!0):p=Og(h,Math.floor(Math.sqrt(h)));!m;)p>f||p===h?m=!0:p=Og(h,p+1);return p}(u,s),c=new ure({windowSize:l,inSize:u,batchSize:a,numSegments:s},r),d=this.compileAndRun(c,[e,i],o);return d.shape[1]===s?d:(i=Gg(0,s).tile([u/l]),this.segOpCompute(d,r,i,o,s))},t.prototype.argMinMaxReduce=function(e,r,i){var o=[r];if(br("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,e.rank),!j().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var s=Ln(e.shape,o),a=s[0],u=de(s[1]),l=e.as2D(-1,u);return this.argReduce(l,i).reshape(a)}return this.argReducePacked(e,i)},t.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},t.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},t.prototype.cumsum=function(e,r,i,o){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var s=new Ane(e.shape,i,o);return this.compileAndRun(s,[e])},t.prototype.equal=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(equal(a, b));\n","bool");var i=new $t("return float(a == b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.notEqual=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(notEqual(a, b));\n","bool");var i=new $t("return float(a != b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThan(a, b));\n","bool");var i=new $t("return float(a < b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.lessEqual=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var i=new $t("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThan(a, b));\n","bool");var i=new $t("return float(a > b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.greaterEqual=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var i=new $t("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.logicalNot=function(e){var r=new Ve(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},t.prototype.logicalAnd=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var i=new $t("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.logicalOr=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var i=new $t("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(i,[e,r],"bool")},t.prototype.select=function(e,r,i){var o=new lre(e.rank,r.shape,r.rank);return this.compileAndRun(o,[e,r,i],Mn(r.dtype,i.dtype))},t.prototype.where=function(e){jg("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return Ww(e.shape,r)},t.prototype.topk=function(e,r,i){return CN(e.dataSync(),e.shape,e.dtype,r)},t.prototype.min=function(e,r){br("min",r,e.rank);var i=Ln(e.shape,r),o=i[0],s=de(i[1]),a=e.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},t.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new $t("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,r.shape);return this.compileAndRun(i,[e,r])},t.prototype.mod=function(e,r){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new $t("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,r.shape);return this.compileAndRun(i,[e,r])},t.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);br("max",r,e.rank);var i=Ln(e.shape,r),o=i[0],s=de(i[1]),a=e.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},t.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new $t("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,r.shape);return this.compileAndRun(i,[e,r])},t.prototype.all=function(e,r){br("all",r,e.rank);var i=Ln(e.shape,r),o=i[0],s=de(i[1]),a=e.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},t.prototype.any=function(e,r){br("any",r,e.rank);var i=Ln(e.shape,r),o=i[0],s=de(i[1]),a=e.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},t.prototype.realDivide=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var i=new $t("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,r.shape);return this.compileAndRun(i,[e,r],"float32")},t.prototype.floorDiv=function(e,r){if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var i=new $t("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,r.shape);return this.compileAndRun(i,[e,r],"int32")},t.prototype.add=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,zw);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var i=Mn(e.dtype,r.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,zw,i);var o=new $t(zw,e.shape,r.shape);return this.compileAndRun(o,[e,r],i)},t.prototype.packedUnaryOp=function(e,r,i){var o=new ch(e.shape,r);return this.compileAndRun(o,[e],i)},t.prototype.packedBinaryOp=function(e,r,i,o,s){void 0===s&&(s=!1);var a=new Jo(i,e.shape,r.shape,s);return this.compileAndRun(a,[e,r],o)},t.prototype.complexSeparableBinaryOp=function(e,r,i){var o=this,s=this.texData.get(e.dataId),a=this.texData.get(r.dataId),u=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(h){var f=h[0],p=h[1],m=o.makeComplexComponentTensorInfo(e,f),g=o.makeComplexComponentTensorInfo(r,p),v=new $t(i,e.shape,r.shape);return o.compileAndRun(v,[m,g],Mn(f.dtype,p.dtype))}),l=u[0],c=u[1],d=this.complex(l,c);return l.dispose(),c.dispose(),d},t.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>j().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),i=this.addN(e.slice(0,r)),o=this.addN(e.slice(r));return this.addN([i,o])}var s=e.map(function(l){return l.dtype}).reduce(function(l,c){return Mn(l,c)}),a=e.map(function(l){return l.shape}),u=j().getBool("WEBGL_PACK")?new ene(e[0].shape,a):new Zte(e[0].shape,a);return this.compileAndRun(u,e,s)},t.prototype.subtract=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,$w);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var i=Mn(e.dtype,r.dtype);if(j().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,$w,e.dtype);var o=new $t($w,e.shape,r.shape);return this.compileAndRun(o,[e,r],i)},t.prototype.pow=function(e,r){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new $t("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,r.shape),o=Mn(e.dtype,r.dtype);return this.compileAndRun(i,[e,r],o)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,uP,e.dtype);var r=new Ve(e.shape,uP);return this.compileAndRun(r,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,lP,e.dtype);var r=new Ve(e.shape,lP);return this.compileAndRun(r,[e])},t.prototype.sign=function(e){var r=new Ve(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[e])},t.prototype.isNaN=function(e){var r=new Ve(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isInf=function(e){var r=new Ve(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isFinite=function(e){var r=new Ve(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.round=function(e){var r=new Ve(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,cP,e.dtype);var r=new Ve(e.shape,cP);return this.compileAndRun(r,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dP,e.dtype);var r=new Ve(e.shape,dP);return this.compileAndRun(r,[e])},t.prototype.softmax=function(e,r){var i=hn([r],e.shape),o=this.max(e,i),s=fr(o.shape,i),a=this.subtract(e,o.reshape(s)),u=this.exp(a),l=this.sum(u,i).reshape(s);return this.realDivide(u,l)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var r=new Ve(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[e])},t.prototype.log1p=function(e){var r=new Ve(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},t.prototype.sqrt=function(e){var r=new Ve(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Ve(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},t.prototype.reciprocal=function(e){var r=new Ve(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},t.prototype.relu=function(e){var r;return r=j().getBool("WEBGL_PACK")?new ch(e.shape,hP):new Ve(e.shape,iP),this.compileAndRun(r,[e])},t.prototype.relu6=function(e){var r;return r=j().getBool("WEBGL_PACK")?new ch(e.shape,fP):new Ve(e.shape,oP),this.compileAndRun(r,[e])},t.prototype.prelu=function(e,r){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(TN,e.shape,r.shape):new $t(IN,e.shape,r.shape);return this.compileAndRun(i,[e,r])},t.prototype.elu=function(e){if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,pP,e.dtype);var r=new Ve(e.shape,sP);return this.compileAndRun(r,[e])},t.prototype.eluDer=function(e,r){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,r.shape):new $t("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(i,[e,r])},t.prototype.selu=function(e){var r=new Ve(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(r,[e])},t.prototype.int=function(e){var r=new Ve(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},t.prototype.clip=function(e,r,i){var o,s=(o=j().getBool("WEBGL_PACK_CLIP")?new gne(e.shape):new pne(e.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[e],null,s)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(j().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,rP,e.dtype);var r=new Ve(e.shape,rP);return this.compileAndRun(r,[e])},t.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),i=new mne(e.shape),o=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(i,o)},t.prototype.sigmoid=function(e){var r=new Ve(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},t.prototype.softplus=function(e){var r=new Ve(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[e])},t.prototype.sin=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(r,[e])},t.prototype.cos=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(r,[e])},t.prototype.tan=function(e){var r=new Ve(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},t.prototype.asin=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(r,[e])},t.prototype.acos=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(r,[e])},t.prototype.atan=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(r,[e])},t.prototype.atan2=function(e,r){var i=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new $t("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,r.shape);return this.compileAndRun(i,[e,r])},t.prototype.sinh=function(e){var r=new Ve(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},t.prototype.cosh=function(e){var r=new Ve(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},t.prototype.tanh=function(e){var r=new Ve(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[e])},t.prototype.asinh=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(r,[e])},t.prototype.acosh=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(r,[e])},t.prototype.atanh=function(e){var r=new Ve(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(r,[e])},t.prototype.erf=function(e){var r=new Ve(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[e])},t.prototype.step=function(e,r){var o,i=new Ve(e.shape,(void 0===(o=r)&&(o=0),Pi+"\n    return x > 0.0 ? 1.0 : float("+o+");\n  "));return this.compileAndRun(i,[e])},t.prototype.conv2dByMatMul=function(e,r,i,o,s,a){var u=e.shape,l=this.texData.get(e.dataId),f="channelsLast"===i.dataFormat,m=u[2]%2!=0&&!!l.isPacked;if((1==u[0]*u[1]*u[2]||1===i.outChannels)&&i.inChannels>1e3||!j().getBool("WEBGL_LAZILY_UNPACK")||!j().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!m){var v=this.reshape(e,[1,f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],i.inChannels]),y=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:v,b:y,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var _={dataId:e.dataId,shape:[1,f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),i.inChannels],dtype:e.dtype},x=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,D(rh(l.shape,_.shape),function(){return"packed reshape "+l.shape+" to "+_.shape+" isn't free"});var w=this.reshape(r,[1,i.inChannels,i.outChannels]),M=this.fusedBatchMatMul({a:_,b:w,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),T=this.texData.get(M.dataId);return D(T.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=x,T.shape=i.outShape,F.makeTensorFromDataId(M.dataId,i.outShape,M.dtype)},t.prototype.conv2dWithIm2Row=function(e,r,i,o,s,a){var d=i.outWidth,h=i.outHeight,f="channelsLast"===i.dataFormat,p=i.filterWidth*i.filterHeight*i.inChannels,m=h*d,g=[p,m],v=e.squeeze([0]),y=r.reshape([1,p,-1]),b=new jne(g,v.shape,i),_=this.compileAndRun(b,[v]).reshape([1,g[0],g[1]]),x=null!=o,w=null!=a,M=s?om(s,!0):null,T=new qw(_.shape,[1,m,i.outChannels],!0,!1,x,M,w),S=[_,y];return o&&S.push(o),w&&S.push(a),this.compileAndRun(T,S).reshape(f?[1,h,d,i.outChannels]:[1,i.outChannels,h,d])},t.prototype.fusedConv2d=function(e){var r=e.input,i=e.filter,o=e.convInfo,s=e.bias,a=e.activation,u=e.preluActivationWeights;if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(r,i,o,s,a,u);if(j().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,i,o,s,a,u);var l=null!=s,c=null!=u,d=a?om(a,!1):null,h=new RN(o,l,d,c),f=[r,i];return s&&f.push(s),u&&f.push(u),this.compileAndRun(h,f)},t.prototype.conv2d=function(e,r,i){if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(e,r,i);if(j().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,i);var o=new RN(i);return this.compileAndRun(o,[e,r])},t.prototype.conv2dDerInput=function(e,r,i){var o=new bne(i);return this.compileAndRun(o,[e,r])},t.prototype.conv2dDerFilter=function(e,r,i){var o=new _ne(i);return this.compileAndRun(o,[e,r])},t.prototype.fusedDepthwiseConv2D=function(e){var r,i=e.input,o=e.filter,s=e.convInfo,a=e.bias,u=e.activation,l=e.preluActivationWeights,c=j().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,d=u?om(u,c):null,h=[i,o],f=null!=a,p=null!=l;return f&&h.push(a),p&&h.push(l),c?(r=new kN(s,f,d,p),this.compileAndRun(r,h)):(r=new FN(s,f,d,p),this.compileAndRun(r,h))},t.prototype.depthwiseConv2D=function(e,r,i){var o;return j().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new kN(i),this.compileAndRun(o,[e,r])):(o=new FN(i),this.compileAndRun(o,[e,r]))},t.prototype.depthwiseConv2DDerInput=function(e,r,i){var o=new Ene(i);return this.compileAndRun(o,[e,r])},t.prototype.depthwiseConv2DDerFilter=function(e,r,i){var o=new Cne(i);return this.compileAndRun(o,[e,r])},t.prototype.conv3d=function(e,r,i){var o=new Dne(i);return this.compileAndRun(o,[e,r])},t.prototype.conv3dDerInput=function(e,r,i){var o=new wne(i);return this.compileAndRun(o,[e,r])},t.prototype.conv3dDerFilter=function(e,r,i){var o=new xne(i);return this.compileAndRun(o,[e,r])},t.prototype.maxPool=function(e,r){var i=new Kw(r,"max",!1);return this.compileAndRun(i,[e])},t.prototype.avgPool=function(e,r){var i=new Kw(r,"avg",!1);return this.compileAndRun(i,[e],"float32")},t.prototype.maxPoolBackprop=function(e,r,i,o){var s=new Kw(o,"max",!0),a=this.compileAndRun(s,[r]),u=new $ne(o),l=this.compileAndRun(u,[e,a],r.dtype);return a.dispose(),l},t.prototype.avgPoolBackprop=function(e,r,i){var o=new une(i);return this.compileAndRun(o,[e],r.dtype)},t.prototype.cast=function(e,r){return Bw(e,r,this)},t.prototype.unstack=function(e,r){for(var i=e.shape[r],o=new Array(e.rank-1),s=0,a=0;a<e.rank;a++)a!==r&&(o[s++]=e.shape[a]);var u=new Array(e.rank).fill(0),l=e.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(e,u,l).reshape(o);return c},t.prototype.avgPool3d=function(e,r){var i=new Yw(r,"avg",!1);return this.compileAndRun(i,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,r,i){var o=new lne(i);return this.compileAndRun(o,[e],r.dtype)},t.prototype.maxPool3d=function(e,r){var i=new Yw(r,"max",!1);return this.compileAndRun(i,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,r,i,o){var s=new Yw(o,"max",!0),a=this.compileAndRun(s,[r]),u=new qne(o),l=this.compileAndRun(u,[e,a],r.dtype);return a.dispose(),l},t.prototype.reshape=function(e,r){var i=this.texData.get(e.dataId);if(i.isPacked&&!rh(e.shape,r)&&(null===i.texture||!rh(i.shape,r))){var o=this.packedReshape(e,r);return F.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return tm(e,r)},t.prototype.resizeBilinear=function(e,r,i,o){var s=j().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new rre(e.shape,r,i,o):new nre(e.shape,r,i,o);return this.compileAndRun(s,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,r,i){var o=new tre(e,r,i);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighbor=function(e,r,i,o){var s=new ore(e.shape,r,i,o);return this.compileAndRun(s,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,r,i){var o=new ire(e,r,i);return this.compileAndRun(o,[e])},t.prototype.multinomial=function(e,r,i,o){var s=r?e:Xo(e),l=new Kne(s.shape[0],s.shape[1],i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[s],"int32",c)},t.prototype.oneHot=function(e,r,i,o){var s=new Yne(e.size,r,i,o);return this.compileAndRun(s,[e])},t.prototype.diag=function(e){var r=new Rne(e.size);return this.compileAndRun(r,[e])},t.prototype.nonMaxSuppression=function(e,r,i,o,s){return jg("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Uw(e.dataSync(),r.dataSync(),i,o,s)},t.prototype.cropAndResize=function(e,r,i,o,s,a){var u=new Sne(e.shape,r.shape,o,s,a);return this.compileAndRun(u,[e,r,i],"float32")},t.prototype.depthToSpace=function(e,r,i){D(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=e.shape[0],l=("NHWC"===i?e.shape[1]:e.shape[2])*r,c=("NHWC"===i?e.shape[2]:e.shape[3])*r,d=("NHWC"===i?e.shape[3]:e.shape[1])/(r*r),h=new Tne("NHWC"===i?[o,l,c,d]:[o,d,l,c],r,i);return this.compileAndRun(h,[e])},t.prototype.split=function(e,r,i){return xN(e,r,i)},t.prototype.scatterND=function(e,r,i){var o=oh(0,e,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,d=[c/u,u],h=e.reshape([a,s]),f=r.reshape([a,u]);if(0===c)return tm(Vn([]),i);var p=ee(0),m=new eP(a,s,h.rank,f.rank,l,d);return this.compileAndRun(m,[f,h,p]).reshape(i)},t.prototype.sparseToDense=function(e,r,i,o){var s=oh(0,e,i),d=new eP(s.numUpdates,s.sliceRank,e.rank,r.rank,s.strides,[s.outputSize,1],!1);return this.compileAndRun(d,[r,e,o]).reshape(i)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,r){var i=this.texData.get(e.dataId),o=new NN("return real * expR - imag * expI;",e.shape,r),s=new NN("return real * expI + imag * expR;",e.shape,r),a=[this.makeComplexComponentTensorInfo(e,i.complexTensors.real),this.makeComplexComponentTensorInfo(e,i.complexTensors.imag)],u=this.compileAndRun(o,a),l=this.compileAndRun(s,a),c=this.complex(u,l).as2D(e.shape[0],e.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(e,r){var i=r.shape,o=i[i.length-1],s=Rw(e,r),a=s[0],u=s[1],l=s[2],c=s[3],d=r.reshape([u,o]),h=e.reshape([e.size/l,l]),f=new Hne(o,c,[u,l]);return this.compileAndRun(f,[h,d]).reshape(a)},t.prototype.fill=function(e,r,i){if("string"===(i=i||Rl(r))){var o=Gd(i,de(e));return o.fill(r),F.makeTensor(o,e,i,this)}var s=new Bne(e,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,r,i){return Vw(e,r,i)},t.prototype.makeTensorInfo=function(e,r){var i=this.write(null,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}},t.prototype.makeOutput=function(e,r){var i=this.makeTensorInfo(e,r).dataId;return F.makeTensorFromDataId(i,e,r,this)},t.prototype.unpackTensor=function(e){var r=new Mre(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},t.prototype.packTensor=function(e){var r=new Xne(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,r){var i=[th(e.shape)].concat(nh(e.shape)),o={dtype:e.dtype,shape:i,dataId:e.dataId},s=[th(r)].concat(nh(r)),a=new ere(s,i),u=this.runWebGLProgram(a,[o],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(e){var r,i=this.texData.get(e),o=i.isPacked,s=i.shape,a=i.dtype,u=Hg(s);return r=o?new Ine(u):new Mne(u),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:e}],a,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,r,i,o,s){var a=this;void 0===s&&(s=!1);var u=this.makeTensorInfo(e.outputShape,i),l=this.texData.get(u.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Xd.DENSE){var c=Qd(e.outputShape);l.texShape=c.map(function(b){return 2*b})}if(null!=e.outTexUsage&&(l.usage=e.outTexUsage),0===de(u.shape))return l.values=Tl(u.dtype,0),u;var d=[],h=r.map(function(b){if("complex64"===b.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var _=a.texData.get(b.dataId);if(null==_.texture){if(!e.packedInputs&&de(b.shape)<=j().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:_.values};e.packedInputs&&(_.isPacked=!0,_.shape=b.shape)}else if(!!_.isPacked!=!!e.packedInputs)b=_.isPacked?a.unpackTensor(b):a.packTensor(b),d.push(b),_=a.texData.get(b.dataId);else if(_.isPacked&&!rh(_.shape,b.shape)){var x=b,w=b.shape;b.shape=_.shape,b=a.packedReshape(b,w),d.push(b),_=a.texData.get(b.dataId),x.shape=w}return a.uploadToGPU(b.dataId),{shape:b.shape,texData:_,isUniform:!1}});this.uploadToGPU(u.dataId);var f,b,w,p={shape:u.shape,texData:l,isUniform:!1},m=(b=e,w="",h.concat(p).forEach(function(S){w+=S.shape+"_"+(S.isUniform?"uniform":S.texData.texShape)+"_"+(null!=S.texData&&null!=S.texData.slice&&S.texData.slice.flatOffset>0)}),b.constructor.name+"_"+w+"_"+b.userCode),g=this.getAndSaveBinary(m,function(){return function(b,_,x,w){var M=_.userCode,T=x.map(function(B,U){var q={logicalShape:B.shape,texShape:B.isUniform?null:B.texData.texShape,isUniform:B.isUniform,isPacked:!B.isUniform&&B.texData.isPacked,flatOffset:null};return null!=B.texData&&null!=B.texData.slice&&B.texData.slice.flatOffset>0&&(q.flatOffset=B.texData.slice.flatOffset),{name:_.variableNames[U],shapeInfo:q}}),S=T.map(function(B){return B.shapeInfo}),I={logicalShape:w.shape,texShape:w.texData.texShape,isUniform:!1,isPacked:w.texData.isPacked,flatOffset:null},N=nne(T,I,M,_.packedInputs),O=b.createProgram(N),W=null,G=b.getUniformLocation(O,"NAN",!1);1===j().getNumber("WEBGL_VERSION")&&(W=b.getUniformLocation(O,"INFINITY",!1));for(var z={},P=0;P<_.variableNames.length;P++){var L=_.variableNames[P];z[L]=b.getUniformLocation(O,L,!1),z["offset"+L]=b.getUniformLocation(O,"offset"+L,!1)}return{program:_,source:N,webGLProgram:O,uniformLocations:z,inShapeInfos:S,outShapeInfo:I,infLoc:W,nanLoc:G}}(a.gpgpu,e,h,p)}),v=null!=this.activeTimers;if(v&&(f=this.startTimer()),function(b,_,x,w,M){ZN(_.inShapeInfos,x),ZN([_.outShapeInfo],[w]);var T=w.texData.texture,S=w.texData.texShape;w.texData.isPacked?b.setOutputPackedMatrixTexture(T,S[0],S[1]):b.setOutputMatrixTexture(T,S[0],S[1]),b.setProgram(_.webGLProgram),1===j().getNumber("WEBGL_VERSION")&&null!==_.infLoc&&b.gl.uniform1f(_.infLoc,1/0),null!==_.nanLoc&&b.gl.uniform1f(_.nanLoc,NaN),x.forEach(function(I,N){var O=_.program.variableNames[N],W=_.uniformLocations[O],G=_.uniformLocations["offset"+O];if(null!=W)if(I.isUniform)if(de(I.shape)<2)b.gl.uniform1f(W,I.uniformValues[0]);else{var z=I.uniformValues;z instanceof Float32Array||(z=new Float32Array(z)),b.gl.uniform1fv(W,z)}else null!=I.texData.slice&&null!=G&&b.gl.uniform1i(G,I.texData.slice.flatOffset),b.setInputMatrixTexture(I.texData.texture,W,N)}),null!=M&&M(b,_.webGLProgram),b.executeProgram()}(this.gpgpu,g,h,p,o),d.forEach(function(b){return a.disposeData(b.dataId)}),v&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!j().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&!1===s){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},t.prototype.compileAndRun=function(e,r,i,o,s){void 0===s&&(s=!1);var a=this.runWebGLProgram(e,r,i=i||r[0].dtype,o,s);return F.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},t.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(j().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=oe(function(){if(!j().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=j().getBool("DEBUG");j().set("DEBUG",!1);var i=e.abs(ee(1e-8)).dataSync()[0];if(j().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var r,i=this.texData.get(e),o=i.shape,s=i.dtype,a=i.values,l=i.usage,c=i.isPacked;if(null==i.texture){var d,h=null!=this.activeTimers;h&&(d=Fi());var f=i.texShape;if(null==f&&(f=$2(o,c),i.texShape=f),null!=a){var p=Hg(o),m=void 0,g=f[1],v=f[0],y=a instanceof Uint8Array;c?(g=(r=Jd(f[0],f[1]))[0],m=new Nne(p,[v=r[1],g],y)):m=new One(p,[v,g],y);var b=this.makeTensorInfo([v,g],s);this.texData.get(b.dataId).usage=y?Nr.PIXELS:Nr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),g,v,a);var _=this.runWebGLProgram(m,[b],s,null,!0),x=this.texData.get(_.dataId);i.texture=x.texture,i.texShape=x.texShape,i.isPacked=x.isPacked,i.usage=x.usage,this.disposeData(b.dataId),this.texData.delete(_.dataId),i.values=null,h&&(this.uploadWaitMs+=Fi()-d)}else{var w=this.acquireTexture(f,l,s,c);i.texture=w}}},t.prototype.convertAndCacheOnCPU=function(e,r){var i=this.texData.get(e),o=i.dtype;return this.releaseGPUData(e),null!=r&&(i.values=function(s,a){if("float32"===a||"complex64"===a)return s;if("int32"===a||"bool"===a){for(var u="int32"===a?new Int32Array(s.length):new Uint8Array(s.length),l=0;l<u.length;++l)u[l]=Math.round(s[l]);return u}throw new Error("Unknown dtype "+a)}(r,o)),i.values},t.prototype.acquireTexture=function(e,r,i,o){if(this.numBytesInGPU+=this.computeBytes(e,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,o)},t.prototype.computeBytes=function(e,r){return e[0]*e[1]*sw(r)},t}(vN);A2()&&F.registerBackend("webgl",function(){return new gP},2);var Tre=k({square_:function(n){var t=E(n,"x","square");return F.runKernelFunc(function(r,i){return i([t]),r.square(t)},{x:t},null,"Square",{},[t],[])}}),dh="SquaredDifference",mP=k({squaredDifference_:function(n,t){var e,r=E(n,"a","squaredDifference"),i=E(t,"b","squaredDifference");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(a,u){var l=a.squaredDifference(r,i);return u([r,i]),l},{a:r,b:i},function(a,u){var l=u[0],c=u[1],d=ee(2);return{a:function(){return a.mul(l.sub(c).mul(d))},b:function(){return a.mul(c.sub(l).mul(d))}}},dh,{},[r,i],[])}}),Rre=k({abs_:function(n){var t=E(n,"x","abs");return"complex64"===t.dtype?F.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):F.runKernelFunc(function(e,r){var i=e.abs(t);return r([t]),i},{x:t},function(e,r){var i=r[0];return{x:function(){return e.mul(i.toFloat().step(-1))}}},"Abs")}}),Fre=k({acos_:function(n){var t=E(n,"x","acos");return F.runKernelFunc(function(e,r){var i=e.acos(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(ee(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),kre=k({acosh_:function(n){var t=E(n,"x","acosh");return F.runKernelFunc(function(e,r){var i=e.acosh(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),Ore=k({asin_:function(n){var t=E(n,"x","asin");return F.runKernelFunc(function(e,r){var i=e.asin(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(ee(1).sub(i.toFloat().square()).sqrt())}}})}}),Nre=k({asinh_:function(n){var t=E(n,"x","asinh");return F.runKernelFunc(function(e,r){var i=e.asinh(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.divStrict(ee(1).add(i.toFloat().square()).sqrt())}}})}}),Pre=k({atan_:function(n){var t=E(n,"x","atan");return F.runKernelFunc(function(e,r){var i=e.atan(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.div(i.toFloat().square().add(1))}}})}}),Lre=k({atanh_:function(n){var t=E(n,"x","atanh");return F.runKernelFunc(function(e,r){var i=e.atanh(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.div(ee(1).sub(i.toFloat().square()))}}})}}),Bre=k({ceil_:function(n){var t=E(n,"x","ceil");return F.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),Zw=k({clipByValue_:function(n,t,e){var r=E(n,"x","clipByValue");return D(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."}),F.runKernelFunc(function(s,a){var u=s.clip(r,t,e);return a([r]),u},{x:r},function(s,a){var u=a[0];return{x:function(){return s.where(u.greaterEqual(t).logicalAnd(u.lessEqual(e)),rt(s))}}},"ClipByValue",{min:t,max:e},[r])}}),Vre=k({cos_:function(n){var t=E(n,"x","cos");return F.runKernelFunc(function(r,i){var o=r.cos(t);return i([t]),o},{x:t},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},[t])}}),Hre=k({cosh_:function(n){var t=E(n,"x","cosh");return F.runKernelFunc(function(e,r){var i=e.cosh(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(e)}}})}}),Ure=k({erf_:function(n){var t=E(n,"x","erf");return D("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),F.runKernelFunc(function(e,r){var i=e.erf(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),e0=k({exp_:function(n){var t=E(n,"x","exp");return F.runKernelFunc(function(e,r){var i=e.exp(t);return r([i]),i},{x:t},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),jre=k({expm1_:function(n){var t=E(n,"x","expm1");return F.runKernelFunc(function(e,r){var i=e.expm1(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.exp())}}})}}),Wre=k({floor_:function(n){var t=E(n,"x","floor");return F.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),Gre=k({log_:function(n){var t=E(n,"x","log");return F.runKernelFunc(function(r,i){var o=r.log(t);return i([t]),o},{x:t},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},[t])}}),zre=k({log1p_:function(n){var t=E(n,"x","log1p");return F.runKernelFunc(function(e,r){var i=e.log1p(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.div(i.add(1))}}})}}),$re=k({logSigmoid_:function(n){var t=E(n,"x","logSigmoid");return F.runKernelFunc(function(e,r){var i=e.softplus(t.neg()).neg();return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.neg().sigmoid())}}})}}),sm=k({neg_:function(n){var t=E(n,"x","neg");return F.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},[t])}}),qre=k({reciprocal_:function(n){var t=E(n,"x","reciprocal");return F.runKernelFunc(function(e,r){var i=e.reciprocal(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.div(i.square().neg())}}})}}),Kre=k({round_:function(n){var t=E(n,"x","round");return F.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),vP=k({rsqrt_:function(n){var t=E(n,"x","rsqrt");return F.runKernelFunc(function(r,i){var o=r.rsqrt(t);return i([t]),o},{x:t},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[t])}}),yP=k({sigmoid_:function(n){var t=E(n,"x","sigmoid");return F.runKernelFunc(function(e,r){var i=e.sigmoid(t);return r([i]),i},{x:t},function(e,r){var i=r[0];return{x:function(){return e.mul(i.mul(ee(1).sub(i)))}}},"Sigmoid")}}),Yre=k({sign_:function(n){var t=E(n,"x","sign");return F.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),Xre=k({isNaN_:function(n){var t=E(n,"x","isNaN");return F.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),Qre=k({isInf_:function(n){var t=E(n,"x","isInf");return F.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),Jre=k({isFinite_:function(n){var t=E(n,"x","isFinite");return F.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return rt(e)}}})}}),Zre=k({sin_:function(n){var t=E(n,"x","sin");return F.runKernelFunc(function(r,i){var o=r.sin(t);return i([t]),o},{x:t},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},[t])}}),eie=k({sinh_:function(n){var t=E(n,"x","sinh");return F.runKernelFunc(function(e,r){var i=e.sinh(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(e)}}})}}),tie=k({softplus_:function(n){var t=E(n,"x","softplus");return F.runKernelFunc(function(e,r){var i=e.softplus(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.mul(i.sigmoid())}}})}}),nie=k({sqrt_:function(n){var t=E(n,"x","sqrt");return F.runKernelFunc(function(e,r){var i=e.sqrt(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.div(i.toFloat().sqrt().mul(2))}}})}}),rie=k({step_:function(n,t){void 0===t&&(t=0);var e=E(n,"x","step");return F.runKernelFunc(function(r){return r.step(e,t)},{$x:e},function(r){return{$x:function(){return rt(r)}}})}}),iie=k({tan_:function(n){var t=E(n,"x","tan");return F.runKernelFunc(function(e,r){var i=e.tan(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return e.div(i.cos().square())}}})}}),oie=k({tanh_:function(n){var t=E(n,"x","tanh");return F.runKernelFunc(function(e,r){var i=e.tanh(t);return r([i]),i},{x:t},function(e,r){var i=r[0];return{x:function(){return ee(1).sub(i.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function _P(n,t,e,r,i,o){var s,a,u=E(n,"x","batchNorm"),l=E(t,"mean","batchNorm"),c=E(e,"variance","batchNorm");return null!=i&&(s=E(i,"scale","batchNorm")),null!=r&&(a=E(r,"offset","batchNorm")),D(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),D(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),D(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),null!=s&&D(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),null!=a&&D(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),hh(u,l,c,a,s,o)}function bP(n,t,e,r,i,o){var s,a,u=E(n,"x","batchNorm"),l=E(t,"mean","batchNorm"),c=E(e,"variance","batchNorm");return null!=i&&(s=E(i,"scale","batchNorm")),null!=r&&(a=E(r,"offset","batchNorm")),D(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),D(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),D(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),null!=s&&D(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),null!=a&&D(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),hh(u,l,c,a,s,o)}function xP(n,t,e,r,i,o){var s,a,u=E(n,"x","batchNorm"),l=E(t,"mean","batchNorm"),c=E(e,"variance","batchNorm");return null!=i&&(s=E(i,"scale","batchNorm")),null!=r&&(a=E(r,"offset","batchNorm")),D(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),D(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),D(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),null!=s&&D(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),null!=a&&D(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),hh(u,l,c,a,s,o)}function hh(n,t,e,r,i,o){null==o&&(o=.001);var s,a,u,l=E(n,"x","batchNorm"),c=E(t,"mean","batchNorm"),d=E(e,"variance","batchNorm");return null!=i&&(s=E(i,"scale","batchNorm")),null!=r&&(a=E(r,"offset","batchNorm")),D(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),D(null==a||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),D(null==s||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===l.rank||1===l.rank?l.as4D(1,1,1,l.size):2===l.rank?l.as4D(1,1,l.shape[0],l.shape[1]):3===l.rank?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,F.runKernelFunc(function(f,p){var m=f.batchNormalization(u,am(c),am(d),o,am(s),am(a));return p([l,c,d,s]),m},{x:l,mean:c,variance:d,scale:s,offset:a},function(f,p){var g=p[0],v=p[1],y=p[2],b=p[3],_=null==b?ee(1):b,x=pn(v.shape,u.shape),w=[];if(1===v.rank){for(var M=0;M<u.shape.length-1;++M)w.push(u.shape[M]);w.push(1)}var T=g.sub(v),S=f.mul(_),I=vP(y.add(ee(o))),N=I.mul(I).mul(I).mul(ee(-.5));return{x:function(){return 1===v.rank?f.mul(Nl(I.as4D(1,1,1,v.shape[0]),w)).mul(_).reshape(g.shape):f.mul(I).mul(_).reshape(g.shape)},mean:function(){var O=I.mul(ee(-1)).mul(S);return 1===v.rank&&(O=O.sum(x)),O.reshape(v.shape)},variance:function(){var O=N.mul(T).mul(S);return 1===v.rank&&(O=O.sum(x)),O.reshape(v.shape)},scale:function(){var O=T.mul(I),W=f.mul(O);return 1===v.rank&&(W=W.sum(x)),W.reshape(v.shape)},offset:function(){var O=f;return 1===v.rank&&(O=O.sum(x)),O.reshape(v.shape)}}},"BatchNormalization",{varianceEpsilon:o},[l,c,d,s]).reshape(l.shape)}function am(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function um(){Z2("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var sie=k({batchNormalization2d_:function(n,t,e,r,i,o){return void 0===r&&(r=.001),um(),_P(n,t,e,o,i,r)}}),aie=k({batchNormalization3d_:function(n,t,e,r,i,o){return void 0===r&&(r=.001),um(),bP(n,t,e,o,i,r)}}),uie=k({batchNormalization4d_:function(n,t,e,r,i,o){return void 0===r&&(r=.001),um(),xP(n,t,e,o,i,r)}}),lie=k({batchNormalization_:function(n,t,e,r,i,o){return void 0===r&&(r=.001),um(),hh(n,t,e,o,i,r)}}),wP=k({batchNorm_:hh}),cie=k({batchNorm2d_:_P}),die=k({batchNorm3d_:bP}),hie=k({batchNorm4d_:xP}),lm=k({logicalAnd_:function(n,t){var e=E(n,"a","logicalAnd","bool"),r=E(t,"b","logicalAnd","bool");return $e(e.shape,r.shape),F.runKernelFunc(function(i){return i.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),fie=k({logicalNot_:function(n){var t=E(n,"x","logicalNot","bool");return F.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),CP=k({logicalOr_:function(n,t){var e=E(n,"a","logicalOr","bool"),r=E(t,"b","logicalOr","bool");return $e(e.shape,r.shape),F.runKernelFunc(function(i){return i.logicalOr(e,r)},{$a:e,$b:r})}}),pie=k({logicalXor_:function(n,t){var e=E(n,"a","logicalXor","bool"),r=E(t,"b","logicalXor","bool");return $e(e.shape,r.shape),CP(n,t).logicalAnd(lm(n,t).logicalNot())}}),Qa=k({where_:function(n,t,e){var r=E(t,"a","where"),i=E(e,"b","where"),o=E(n,"condition","where","bool");return nt(r.shape,i.shape,"Error in where: "),1===o.rank?D(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):nt(o.shape,i.shape,"Error in where: "),F.runKernelFunc(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return rt(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),EP=function(n){return le(this,void 0,void 0,function(){var t,e,r;return ce(this,function(i){switch(i.label){case 0:return[4,(t=E(n,"condition","whereAsync","bool")).data()];case 1:return e=i.sent(),r=Ww(t.shape,e),n!==t&&t.dispose(),[2,r]}})})},qe=k({add_:function(n,t){var e,r=E(n,"a","add"),i=E(t,"b","add");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(s){return s.add(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=pn(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=pn(i.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}},"Add")}}),gie=k({addN_:function(n){D(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),D(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var t=n.map(function(i,o){return E(i,"tensors"+o,"addN")}),e=t[0];return t.forEach(function(i){if(i.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(i){if(!dn(i.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),F.runKernelFunc(function(i){return i.addN(t)},t,function(i){var o={};return t.forEach(function(s,a){o[a]=function(){return i.clone()}}),o},"AddN")}}),mie=k({addStrict_:function(n,t){var e=E(n,"a","addStrict"),r=E(t,"b","addStrict");return nt(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),vie=k({atan2_:function(n,t){var e,r=E(n,"a","atan2"),i=E(t,"b","atan2");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=qe(u.square(),l.square()),d=s.mul(l.div(c)),h=pn(u.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(u.shape)},$b:function(){var c=qe(u.square(),l.square()),d=sm(s.mul(u.div(c))),h=pn(l.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(l.shape)}}})}}),Li=k({div_:function(n,t){var e,r=E(n,"a","div"),i=E(t,"b","div");if(e=Ft(r,i),i=e[1],"int32"===(r=e[0]).dtype&&"int32"===i.dtype)return DP(r,i);var o=$e(r.shape,i.shape);return F.runKernelFunc(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.div(l.toFloat()),d=pn(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),d=pn(l.shape,o);d.length>0&&(c=c.sum(d).reshape(l.shape));var h=l.square();return c.div(h.toFloat()).neg()}}},"Div")}}),yie=k({divNoNan_:function(n,t){var e,r=E(n,"a","div"),i=E(t,"b","div");r=(e=Ft(r,i))[0];var o=Li(r,i=e[1]),s=rt(o),a=i.equal(s);return Qa(a,s,o)}}),_ie=k({divStrict_:function(n,t){var e=E(n,"a","div"),r=E(t,"b","div");return nt(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),DP=k({floorDiv_:function(n,t){var e,r=E(n,"a","floorDiv"),i=E(t,"b","floorDiv");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.div(l.toFloat()),d=pn(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),d=pn(l.shape,o);d.length>0&&(c=c.sum(d).reshape(l.shape));var h=l.square();return c.div(h.toFloat()).neg()}}},"FloorDiv")}}),t0=k({maximum_:function(n,t){var e,r=E(n,"a","maximum"),i=E(t,"b","maximum");return e=Ft(r,i),i=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),i=i.toInt()),$e(r.shape,i.shape),F.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.greaterEqual(u).toFloat())},b:function(){return o.mul(a.less(u).toFloat())}}},"Maximum")}}),bie=k({maximumStrict_:function(n,t){var e=E(n,"a","maximumStrict"),r=E(t,"b","maximumStrict");return nt(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),SP=k({minimum_:function(n,t){var e,r=E(n,"a","minimum"),i=E(t,"b","minimum");return e=Ft(r,i),i=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),i=i.toInt()),$e(r.shape,i.shape),F.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.lessEqual(u).toFloat())},b:function(){return o.mul(a.greater(u).toFloat())}}},"Minimum")}}),xie=k({minimumStrict_:function(n,t){var e=E(n,"a","minimumStrict"),r=E(t,"b","minimumStrict");return nt(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),wie=k({mod_:function(n,t){var e,r=E(n,"a","mod"),i=E(t,"b","mod");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=pn(u.shape,o);return c.length>0?s.sum(c).reshape(u.shape):s},$b:function(){var c=s.mul(u.div(l).floor().neg()),d=pn(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c}}})}}),Cie=k({modStrict_:function(n,t){var e=E(n,"a","modStrict"),r=E(t,"b","modStrict");return nt(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),Jn=k({mul_:function(n,t){var e,r=E(n,"a","mul"),i=E(t,"b","mul");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.mul(l.toFloat()),d=pn(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),d=pn(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c}}},"Mul")}}),Eie=k({mulStrict_:function(n,t){var e=E(n,"a","mul"),r=E(t,"b","mul");return nt(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),cm=k({pow_:function(n,t){var e,r=E(n,"base","pow"),i=E(t,"exp","pow");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(a,u){var l=a.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(a,u){var l=u[0],c=u[1],d=u[2];return{a:function(){var h=c.toFloat(),f=a.mul(h.mul(l.pow(h.sub(ee(1))))),p=pn(l.shape,o);return p.length>0&&(f=f.sum(p)),f.reshape(l.shape)},b:function(){var h=l.greater(0),f=l.log().where(h,rt(l)),p=a.mul(d.mul(f)),m=pn(c.shape,o);return m.length>0&&(p=p.sum(m)),p.reshape(c.shape)}}},"Pow",{},[r,i],[!0])}}),Die=k({powStrict_:function(n,t){return nt(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}}),Sie=k({squaredDifferenceStrict_:function(n,t){var e=E(n,"a","squaredDifferenceStrict"),r=E(t,"b","squaredDifferenceStrict");return nt(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),wn=k({sub_:function(n,t){var e,r=E(n,"a","sub"),i=E(t,"b","sub");e=Ft(r,i);var o=$e((r=e[0]).shape,(i=e[1]).shape);return F.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=pn(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=pn(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),Aie=k({subStrict_:function(n,t){var e=E(n,"a","subStrict"),r=E(t,"b","subStrict");return nt(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),AP=k({equal_:function(n,t){var e,r=E(n,"a","equal"),i=E(t,"b","equal");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),Mie=k({equalStrict_:function(n,t){var e=E(n,"a","equalStrict"),r=E(t,"b","equalStrict");return nt(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),Iie=k({greater_:function(n,t){var e,r=E(n,"a","greater"),i=E(t,"b","greater");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),MP=k({greaterEqual_:function(n,t){var e,r=E(n,"a","greaterEqual"),i=E(t,"b","greaterEqual");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return rt(a)},b:function(){return rt(u)}}},"GreaterEqual")}}),Tie=k({greaterEqualStrict_:function(n,t){var e=E(n,"a","greaterEqualStrict"),r=E(t,"b","greaterEqualStrict");return nt(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),Rie=k({greaterStrict_:function(n,t){var e=E(n,"a","greaterStrict"),r=E(t,"b","greaterStrict");return nt(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),Fie=k({less_:function(n,t){var e,r=E(n,"a","less"),i=E(t,"b","less");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),kie=k({lessEqual_:function(n,t){var e,r=E(n,"a","lessEqual"),i=E(t,"b","lessEqual");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),Oie=k({lessEqualStrict_:function(n,t){var e=E(n,"a","lessEqualStrict"),r=E(t,"b","lessEqualStrict");return nt(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),Nie=k({lessStrict_:function(n,t){var e=E(n,"a","lessStrict"),r=E(t,"b","lessStrict");return nt(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),Pie=k({notEqual_:function(n,t){var e,r=E(n,"a","notEqual"),i=E(t,"b","notEqual");return e=Ft(r,i),$e((r=e[0]).shape,(i=e[1]).shape),F.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),Lie=k({notEqualStrict_:function(n,t){var e=E(n,"a","notEqualStrict"),r=E(t,"b","notEqualStrict");return nt(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function IP(n,t){for(var e=[],r=n;r<t;++r)e.push(r);return e}function TP(n){for(var t=[],e=0;e<n.length;++e)for(var r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var n0=k({gather_:function(n,t,e){void 0===e&&(e=0);var r=E(n,"x","gather"),i=E(t,"indices","gather","int32");e=hn(e,r.shape)[0];var o=function(s,a,u){for(var l=s.shape[u],c=[],d=1,h=1,f=0;f<u;f++)c.push(s.shape[f]),d*=s.shape[f];for(f=0;f<a.rank;f++)c.push(a.shape[f]);for(f=u+1;f<s.rank;f++)c.push(s.shape[f]),h*=s.shape[f];return{batchSize:d,sliceSize:h,dimSize:l,outputShape:c}}(r,i,e);return F.runKernelFunc(function(s,a){var u=s.gather(r,i.flatten(),e);return a([i]),u},{x:r,indices:i},function(s,a){var u=a[0];return{x:function(){var l=r.shape,c=u.size,d=l.slice(0,e),h=d.length,f=l.slice(e,l.length).slice(1),p=f.length,m=IP(0,h),g=IP(h+1,h+1+p),v=TP([d,[c],f]),y=s.reshape(v),b=u.reshape([c]),_=TP([[h],m,g]),x=y.transpose(_),w=RP(x,b,r.shape[e]),M=Wg(_);return w.transpose(M)},indices:function(){return u}}},"Gather",{axis:e}).reshape(o.outputShape)}}),RP=k({unsortedSegmentSum_:function(n,t,e){var r=E(n,"x","unsortedSegmentSum"),i=E(t,"segmentIds","unsortedSegmentSum","int32");return D(Pt(e),function(){return"numSegments must be of dtype int"}),F.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,e);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,l){for(var c=t0(l,rt(l)),d=n0(u,c),h=MP(l,ee(0,"int32")),f=d.rank-h.rank,p=0;p<f;++p)h=ai(h,p+1);h=lm(h,Ol(d.shape,"bool"));var m=rt(d);return Qa(h,d,m)}(o,a)}}})}});function FP(n,t,e,r,i,o,s){void 0===o&&(o="NHWC"),D(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var a=n,u=t,l=!1;3===t.rank&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),a=[1,n[0],n[1],n[2]]),D(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),D(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),D(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var c="NHWC"===o?a[3]:a[1],d="NHWC"===o?u.shape[3]:u.shape[1];D(c===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+e.shape[2]+"."}),D(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=s&&D(Pt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var h=em(o),f=Us(a,e.shape,r,1,i,s,!1,h),p=F.runKernelFunc(function(m,g){var v=m.conv2dDerInput(u,e,f);return g([e,u]),v},{dy4D:u,filter:e},function(m,g){var v=g[0],y=g[1];return{dy4D:function(){return ui(m,v,r,i,o,1,s)},filter:function(){return o0(m,y,v.shape,r,i,o,s)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function r0(n){var o,t="number"==typeof(o=n)?[o,o,o]:2===o.length?[o[0],o[1],1]:o;return 1===t[0]&&1===t[1]&&1===t[2]}function kP(n,t,e,r,i){D(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var o=n,s=t,a=!1;4===t.rank&&(a=!0,s=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=s.shape[4];D(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),D(5===s.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),D(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),D(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),D(l===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+e.shape[4]+"."});var c=ah(o,e.shape,r,1,i),d=F.runKernelFunc(function(h){return h.conv3dDerInput(s,e,c)},{dy5D:s});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var Vie=k({conv1d_:function(n,t,e,r,i,o,s){void 0===i&&(i="NWC"),void 0===o&&(o=1);var a=E(n,"x","conv1d"),u=E(t,"filter","conv1d"),l=a,c=!1;2===a.rank&&(c=!0,l=a.as3D(1,a.shape[0],a.shape[1])),D(3===l.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),D(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=s&&D(Pt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),D(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),D(pr(e,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+o+"'"}),D("NWC"===i,function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=ui(h,d,[1,e],r,"NHWC",[1,o],s);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),ui=k({conv2d_:function(n,t,e,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=E(n,"x","conv2d"),u=E(t,"filter","conv2d"),l=a,c=!1;3===a.rank&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(4===l.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),D(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=s&&D(Pt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var d="NHWC"===i?l.shape[3]:l.shape[1];D(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),D(pr(e,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"});var h=em(i),f=Us(l.shape,u.shape,e,o,r,s,!1,h),m=F.runKernelFunc(function(g,v){var y=g.conv2d(l,u,f);return v([u,l]),y},{x:l,filter:u},function(g,v){var b=v[0],_=v[1];return D(Ka(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return OP(_.shape,g,b,e,r,i)},filter:function(){return o0(_,g,b.shape,e,r,i)}}},"Conv2D",f,[u,l]);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Hie=k({conv3d_:function(n,t,e,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var f,s=E(n,"x","conv3d"),a=E(t,"filter","conv3d"),u=s,l=!1;4===s.rank&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),D(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),D(5===a.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),D(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),D((f=o,r0(e)||r0(f)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),D("NDHWC"===i,function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=ah(u.shape,a.shape,e,o,r),d=F.runKernelFunc(function(h,f){var p=h.conv3d(u,a,c);return f([u,a]),p},{x:u,$filter:a},function(h,f){D(r0(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=f[0],m=f[1];return{x:function(){return kP(p.shape,h,m,e,r)},$filter:function(){return function(g,v,y,b,_){var x=g;4===g.rank&&(x=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var w=v;4===w.rank&&(w=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3])),D(5===x.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),D(5===w.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+w.shape+"."}),D(5===y.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),D(x.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+y[3]+"."}),D(w.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+w.shape[4]+") must match output depth for filter ("+y[4]+")."});var M=ah(x.shape,y,b,1,_);return F.runKernelFunc(function(T){return T.conv3dDerFilter(x,w,M)},{x5D:x,dy5D:w})}(p,h,m.shape,e,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),o0=k({conv2dDerFilter_:function(n,t,e,r,i,o,s){void 0===o&&(o="NHWC");var a=n;3===n.rank&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),D(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),D(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),D(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var l="NHWC"===o?a.shape[3]:a.shape[1],c="NHWC"===o?u.shape[3]:u.shape[1];D(l===e[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+e[2]+"."}),D(c===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+e[3]+")."}),null!=s&&D(Pt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var d=em(o),h=Us(a.shape,e,r,1,i,s,!1,d);return F.runKernelFunc(function(f){return f.conv2dDerFilter(a,u,h)},{x4D:a,dy4D:u})}}),OP=k({conv2dDerInput_:FP}),dm=k({depthwiseConv2d_:function(n,t,e,r,i,o,s){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var a=E(n,"x","depthwiseConv2d"),u=E(t,"filter","depthwiseConv2d"),l=a,c=!1;3===a.rank&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),D(4===l.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),D(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),D(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==o&&(o=[1,1]),D(pr(e,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),null!=s&&D(Pt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var d=Us(l.shape,u.shape,e,o,r,s,!0),f=F.runKernelFunc(function(p,m){var g=p.depthwiseConv2D(l,u,d);return m([l,u]),g},{x:l,filter:u},function(p,m){D(Ka(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var g=m[0],v=m[1];return{x:function(){return NP(g.shape,p,v,d)},filter:function(){return PP(g,p,v.shape,d)}}},"DepthwiseConv2dNative",d,[l,u]);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),NP=k({depthwiseConv2dDerInput_:function(n,t,e,r){var i=t,o=!1;3===t.rank&&(o=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=F.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,e,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),PP=k({depthwiseConv2dDerFilter_:function(n,t,e,r){var i=n;3===n.rank&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t;return 3===o.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),F.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),s0=k({separableConv2d_:function(n,t,e,r,i,o,s){void 0===o&&(o=[1,1]),void 0===s&&(s="NHWC");var a=E(n,"x","separableConv2d"),u=E(t,"depthwiseFilter","separableConv2d"),l=E(e,"pointwiseFilter","separableConv2d"),c=a,d=!1;if(3===a.rank&&(d=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),D(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),D(4===l.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),D(1===l.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),D(1===l.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],f=u.shape[3];D(l.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+"."});var p=dm(c,u,r,i,s,o),m=ui(p,l,1,"valid",s);return d?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),Uie=k({conv2dTranspose_:function(n,t,e,r,i,o){return FP(e,E(n,"x","conv2dTranspose"),E(t,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),jie=k({conv3dTranspose_:function(n,t,e,r,i){return kP(e,E(n,"x","conv3dTranspose"),E(t,"filter","conv3dTranspose"),r,i)}}),hm=k({matMul_:function(n,t,e,r){var i;void 0===e&&(e=!1),void 0===r&&(r=!1);var o=E(n,"a","matMul"),s=E(t,"b","matMul");i=Ft(o,s),o=i[0],s=i[1];var a=e?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],l=e?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?s.shape[s.rank-2]:s.shape[s.rank-1],d=o.shape.slice(0,-2),h=s.shape.slice(0,-2),f=de(d),p=de(h);D(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),D(dn(d,h),function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),D(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var m=o.shape.slice(0,-2).concat([l,c]),g=e?o.as3D(f,a,l):o.as3D(f,l,a),v=r?s.as3D(p,c,u):s.as3D(p,u,c);return F.runKernelFunc(function(b,_){var x=b.batchMatMul(g,v,e,r);return _([g,v]),x},{a:g,b:v},function(b,_){var w=_[0],M=_[1];return e||r?!e&&r?{a:function(){return b.matMul(M,!1,!1)},b:function(){return b.matMul(w,!0,!1)}}:e&&!r?{a:function(){return M.matMul(b,!1,!0)},b:function(){return w.matMul(b,!1,!1)}}:{a:function(){return M.matMul(b,!0,!0)},b:function(){return b.matMul(w,!0,!0)}}:{a:function(){return b.matMul(M,!1,!0)},b:function(){return w.matMul(b,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:r}).reshape(m)}}),Wie=k({dot_:function(n,t){var e=E(n,"t1","dot"),r=E(t,"t2","dot");D(!(1!==e.rank&&2!==e.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var i=1===e.rank?e.size:e.shape[1],o=1===r.rank?r.size:r.shape[0];return D(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),1===e.rank&&1===r.rank?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===e.rank&&2===r.rank?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===e.rank&&1===r.rank?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Gie=k({outerProduct_:function(n,t){var e=E(n,"v1","outerProduct"),r=E(t,"v2","outerProduct");return D(1===e.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),fh=k({reverse_:function(n,t){var e=E(n,"x","reverse");if(0===e.rank)return e.clone();var r=hn(t,e.shape);return F.runKernelFunc(function(i){return i.reverse(e,r)},{$x:e},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(e)}}),zie=k({reverse1d_:function(n){var t=E(n,"x","reverse");return D(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),fh(t,0)}}),$ie=k({reverse2d_:function(n,t){var e=E(n,"x","reverse");return D(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),fh(e,t)}}),qie=k({reverse3d_:function(n,t){var e=E(n,"x","reverse");return D(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),fh(e,t)}}),Kie=k({reverse4d_:function(n,t){var e=E(n,"x","reverse");return D(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),fh(e,t)}});function LP(n,t,e,r,i,o){var s=E(n,"x","maxPool"),a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),null==r&&(r=[1,1]),D(4===a.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),D(pr(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),null!=o&&D(Pt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Pl(a.shape,t,e,r,i,o);if(1===l.filterWidth&&1===l.filterHeight&&dn(l.inShape,l.outShape))return s.clone();var d=F.runKernelFunc(function(h,f){var p=h.maxPool(a,l);return f([a,p]),p},{x:a},function(h,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,y,b,_,x,w,M){var T=E(g,"dy","maxPoolBackprop"),S=E(v,"input","maxPoolBackprop"),I=E(y,"output","maxPoolBackprop");D(S.rank===T.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+T.rank+")"}),null==x&&(x=[1,1]),D(pr(_,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+x+"'"}),D(4===T.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+T.rank+"."}),D(4===S.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."});var N=Pl(S.shape,b,_,x,w,void 0);return F.runKernelFunc(function(O){return O.maxPoolBackprop(T,S,I,N)},{$dy:T,$input:S})}(h,p,m,t,e,r,i)}}},"MaxPool",l,[a]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function BP(n,t,e,r,i,o){var s=E(n,"x","avgPool","float32");null==r&&(r=[1,1]),D(pr(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),D(4===a.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),null!=o&&D(Pt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Pl(a.shape,t,e,r,i,o);if(1===l.filterWidth&&1===l.filterHeight&&dn(l.inShape,l.outShape))return s.clone();var c=F.runKernelFunc(function(d){return d.avgPool(a,l)},{x:a},function(d){return{x:function(){return function(h,f,p,m,g,v){var y=E(h,"dy","avgPoolBackprop"),b=E(f,"input","avgPoolBackprop");D(b.rank===y.rank,function(){return"Rank of input ("+b.rank+") does not match rank of dy ("+y.rank+")"}),null==g&&(g=[1,1]),D(pr(m,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"});var _=b,x=y,w=!1;3===b.rank&&(w=!0,_=b.as4D(1,b.shape[0],b.shape[1],b.shape[2]),x=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),D(4===x.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),D(4===_.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var M=Pl(_.shape,p,m,g,v),T=F.runKernelFunc(function(S){return S.avgPoolBackprop(x,_,M)},{dy4D:x,input4D:_});return w?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}(d,a,t,e,r,i)}}},"AvgPool",l);return c=c.cast(s.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var In=k({maxPool_:function(n,t,e,r,i){return LP(n,t,e,1,r,i)}}),ph=k({avgPool_:function(n,t,e,r,i){return BP(n,t,e,1,r,i)}}),Yie=k({pool_:function(n,t,e,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var s=E(n,"x","maxPool"),a=s,u=!1;3===s.rank&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),D(pr(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,x,w,M,T,c=Pl(a.shape,t,o,i,r),d=[c.dilationHeight,c.dilationWidth];l="same"===r?(x=d,w=[c.filterHeight,c.filterWidth].map(function(S,I){return S+(S-1)*(x[I]-1)}).map(function(S){return S-1}),M=w.map(function(S){return Math.floor(S/2)}),T=w.map(function(S,I){return S-M[I]}),w.map(function(S,I){return[M[I],T[I]]})):[[0,0],[0,0]];var h=1===d[0]&&1===d[1],f=function(_,x,w){var M=w.map(function(G){return G[0]}),T=w.map(function(G){return G[1]}),S=_.concat(M,T),I=x.map(function(G,z){return(G-S[z]%G)%G}),N=T.map(function(G,z){return G+I[z]});return[x.map(function(G,z){return[M[z],N[z]]}),x.map(function(G,z){return[0,I[z]]})]}([c.inHeight,c.inWidth],d,l),m=f[1],g=h?r:"valid",v=h?a:aN(a,d,f[0]),y=("avg"===e?function(){return BP(v,t,o,1,g)}:function(){return LP(v,t,o,1,g)})(),b=h?y:iN(y,d,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Xie=k({maxPool3d_:function(n,t,e,r,i,o,s){void 0===o&&(o="NDHWC");var a=E(n,"x","maxPool3d"),u=a,l=!1;4===a.rank&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),D(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),D("NDHWC"===o,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),D(pr(e,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"}),null!=i&&D(Pt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=sh(u.shape,t,e,s,r,i,o),d=F.runKernelFunc(function(h,f){var p=h.maxPool3d(u,c);return f([u,p]),p},{x:u},function(h,f){var p=f[0],m=f[1];return{x:function(){return function(g,v,y,b,_,x,w,M){var T=E(g,"dy","maxPool3dBackprop"),S=E(v,"input","maxPool3dBackprop"),I=E(y,"output","maxPool3dBackprop"),N=T,O=S,W=I,G=!1;4===S.rank&&(G=!0,N=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),O=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),W=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3])),D(5===N.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),D(5===O.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."}),D(5===W.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+W.rank+"."}),null==x&&(x=[1,1,1]),D(pr(_,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+x+"'"}),null!=M&&D(Pt(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+M+" but got pad "+w+"."});var z=sh(O.shape,b,_,x,w,M),P=F.runKernelFunc(function(L){return L.maxPool3dBackprop(N,O,W,z)},{dy5D:N,input5D:O});return G?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P}(h,p,m,t,e,s,r,i)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Qie=k({avgPool3d_:function(n,t,e,r,i,o,s){void 0===o&&(o="NDHWC");var a=E(n,"x","avgPool3d","float32"),u=a,l=!1;4===a.rank&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),null==s&&(s=[1,1,1]),D(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),D("NDHWC"===o,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),D(pr(e,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+s+"'"}),null!=i&&D(Pt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=sh(u.shape,t,e,s,r,i,o),d=F.runKernelFunc(function(h){return h.avgPool3d(u,c)},{x:u},function(h){return{x:function(){return function(f,p,m,g,v,y,b){var _=E(f,"dy","avgPool3dBackprop"),x=E(p,"input","avgPool3dBackprop"),w=_,M=x,T=!1;4===x.rank&&(T=!0,w=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),M=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),D(5===w.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+w.rank+"."}),D(5===M.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+M.rank+"."}),null==v&&(v=[1,1,1]),D(pr(g,v),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"}),null!=b&&D(Pt(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+b+" but got pad "+y+"."});var S=sh(M.shape,m,g,v,y,b),I=F.runKernelFunc(function(N){return N.avgPool3dBackprop(w,M,S)},{dy5D:w,input5D:M});return T?I.as4D(I.shape[1],I.shape[2],I.shape[3],I.shape[4]):I}(h,u,t,e,s,r,i)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),po=k({slice_:function(n,t,e){var r,i,o=E(n,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(o.rank-1).fill(0)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(0)):t.slice()).forEach(function(u){D(-1!==u,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==e?new Array(o.rank).fill(-1):"number"==typeof e?[e].concat(new Array(o.rank-1).fill(-1)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(-1)):e).map(function(u,l){return u>=0?u:(D(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),fN(o,r,i);var s=o.shape;return F.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],s[c]-r[c]-i[c]]);return{x:function(){return u.pad(l)}}},"Slice",{begin:r,size:i})}}),Jie=k({slice1d_:function(n,t,e){var r=E(n,"x","slice1d");return D(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),po(r,[t],[e])}}),Zie=k({slice2d_:function(n,t,e){var r=E(n,"x","slice2d");return D(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),po(r,t,e)}}),VP=k({slice3d_:function(n,t,e){var r=E(n,"x","slice3d");return D(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),po(r,t,e)}}),eoe=k({slice4d_:function(n,t,e){var r=E(n,"x","slice4d");return D(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),po(r,t,e)}});function HP(n,t,e,r,i){return t.rank<e.rank&&(t=t.reshape(fr(t.shape,r))),n.rank<e.rank&&(n=n.reshape(fr(n.shape,r))),{x:function(){var o=n.mul(e.equal(t).cast(n.dtype));return null==i?o:o.transpose(i)}}}var toe=k({all_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","all","bool"),i=hn(t,r.shape),o=i,s=ki(o,r.rank);null!=s&&(r=r.transpose(s),o=Oi(o.length,r.rank));var a=F.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(e){var u=fr(a.shape,i);return a.reshape(u)}return a}}),noe=k({any_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","any","bool"),i=hn(t,r.shape),o=i,s=ki(o,r.rank);null!=s&&(r=r.transpose(s),o=Oi(o.length,r.rank));var a=F.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(e){var u=fr(a.shape,i);return a.reshape(u)}return a}}),roe=k({argMax_:function(n,t){void 0===t&&(t=0);var e=E(n,"x","argMax");null==t&&(t=0);var r=hn(t,e.shape),i=ki(r,e.rank);return null!=i&&(e=e.transpose(i),r=Oi(r.length,e.rank)),F.runKernelFunc(function(a,u){var l=a.argMax(e,r[0]);return u([e]),l},{x:e},function(a,u){var l=u[0];return{x:function(){return rt(l)}}},"ArgMax",{axis:r[0]},[e])}}),ioe=k({argMin_:function(n,t){void 0===t&&(t=0);var e=E(n,"x","argMin");null==t&&(t=0);var r=hn(t,e.shape),i=ki(r,e.rank);return null!=i&&(e=e.transpose(i),r=Oi(r.length,e.rank)),F.runKernelFunc(function(o,s){var a=o.argMin(e,r[0]);return s([e]),a},{$x:e},function(o,s){var a=s[0];return{$x:function(){return rt(a)}}})}}),ooe=k({logSumExp_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","logSumExp"),i=hn(t,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(e){var u=fr(a.shape,i);return a.reshape(u)}return a}}),fm=k({max_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","max"),i=r,o=hn(t,r.shape),s=o,a=ki(s,r.rank);null!=a&&(r=r.transpose(a),s=Oi(s.length,r.rank));var l=F.runKernelFunc(function(d,h){var f=d.max(r,s);return h([i,f]),f},{x:r},function(d,h){return HP(d,h[1],h[0],o,a)},"Max",{axes:s},[r],[!0]);if(e){var c=fr(l.shape,o);l=l.reshape(c)}return l}}),soe=k({mean_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","mean"),i=hn(t,r.shape),o=de(Ln(r.shape,i)[1]);return Qg(function(s){var a=ee(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(t,e),gradFunc:function(u){var l=s.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Ol(s.shape,"float32")).div(o)}}})(r)}}),aoe=k({min_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","min"),i=r,o=hn(t,r.shape),s=o,a=ki(s,r.rank);null!=a&&(r=r.transpose(a),s=Oi(s.length,r.rank));var l=F.runKernelFunc(function(d,h){var f=d.min(r,s);return h([i,f]),f},{x:r},function(d,h){return HP(d,h[1],h[0],o,a)},"Min",{axes:s},[r],[!0]);if(e){var c=fr(l.shape,o);l=l.reshape(c)}return l}}),uoe=k({moments_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=hn(t,(n=E(n,"x","moments")).shape),i=n.mean(r,e),o=i.shape;e||(o=fr(i.shape,r));var s=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,e)}}}),UP=k({sum_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=hn(t,r.shape);return Qg(function(o){var s=ki(i,o.rank),a=i,u=o;null!=s&&(u=o.transpose(s),a=Oi(a.length,o.rank));var l=function(f){var p=o.shape.slice();return i.forEach(function(m){p[m]=1}),f.reshape(p).mul(Ol(o.shape,"float32"))},d=F.runKernelFunc(function(f){return f.sum(u,a)},{x:u},function(f){return{x:function(){return l(f)}}},"Sum",{axes:a});if(e){var h=fr(d.shape,i);d=d.reshape(h)}return{value:d,gradFunc:l}})(r)}}),loe=k({prod_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=E(n,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=hn(t,r.shape),o=ki(i,r.rank),s=i,a=r;null!=o&&(a=r.transpose(o),s=Oi(s.length,r.rank));var u=F.runKernelFunc(function(c){return c.prod(a,s)},{permutedX:a});if(e){var l=fr(u.shape,i);u=u.reshape(l)}return u}}),jP=k({elu_:function(n){var t=E(n,"x","elu");return F.runKernelFunc(function(e,r){var i=e.elu(t);return r([i]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){return F.runKernelFunc(function(o){return o.eluDer(e,i)},{dy:e,y:i})}}})}}),coe=k({leakyRelu_:function(n,t){void 0===t&&(t=.2);var e=E(n,"x","leakyRelu");return t0(ee(t).mul(e),e)}}),WP=k({prelu_:function(n,t){var e=E(n,"x","prelu"),r=E(t,"alpha","prelu");return F.runKernelFunc(function(i,o){var s=i.prelu(e,r);return o([e,r]),s},{x:e,alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{x:function(){return Qa(u,i,i.mul(a))},alpha:function(){var l=Qa(u,rt(i),i.mul(s)),c=pn(a.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}},"Prelu")}}),Lt=k({relu_:function(n){var t=E(n,"x","relu");return"bool"===t.dtype?t.toInt():F.runKernelFunc(function(e,r){var i=e.relu(t);return r([t]),i},{x:t},function(e,r){var i=r[0];return{x:function(){return e.mulStrict(i.step().toFloat())}}},"Relu")}}),GP=k({relu6_:function(n){var t=E(n,"x","relu6");return"bool"===t.dtype?t.toInt():F.runKernelFunc(function(e,r){var i=e.relu6(t);return r([t]),i},{x:t},function(e,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return e.mulStrict(o.toFloat())}}},"Relu6")}}),doe=k({selu_:function(n){var t=E(n,"x","selu");return F.runKernelFunc(function(e,r){var i=e.selu(t);return r([t]),i},{$x:t},function(e,r){var i=r[0];return{$x:function(){var o=i.greater(ee(0)),s=ee(1.7580993408473768),a=ee(1.0507009873554805),u=e.mul(a),l=e.mul(s).mul(i.toFloat().exp());return Qa(o,u,l)}}})}}),js=k({transpose_:function(n,t){var e=E(n,"x","transpose");return null==t&&(t=e.shape.map(function(i,o){return o}).reverse()),D(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(i){D(i>=0&&i<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1?e.clone():F.runKernelFunc(function(i){return i.transpose(e,t)},{x:e},function(i){var o=Wg(t);return{x:function(){return i.transpose(o)}}},"Transpose",{perm:t})}}),hoe=k({localResponseNormalization_:function(n,t,e,r,i){void 0===t&&(t=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=E(n,"x","localResponseNormalization");D(4===o.rank||3===o.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."}),D(Pt(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var s=o,a=!1;3===o.rank&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=F.runKernelFunc(function(l,c){var d=l.localResponseNormalization4D(s,t,e,r,i);return c([s,d]),d},{x4D:s},function(l,c){var d=c[0],h=c[1];return{x4D:function(){return F.runKernelFunc(function(f){return f.LRNGrad(l,d,h,t,e,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),zP=k({norm_:function(n,t,e,r){void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1);var i=function a(u,l,c){if(void 0===c&&(c=null),0===u.rank)return u.abs();if(1!==u.rank&&null===c)return a(u.reshape([-1]),l,c);if(1===u.rank||"number"==typeof c||Array.isArray(c)&&1===c.length){if(1===l)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if("euclidean"===l||2===l)return u.abs().pow(ee(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&2===c.length){if(1===l)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if("fro"===l||"euclidean"===l)return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=E(n,"x","norm"),t,e),o=i.shape;if(r){var s=hn(e,n.shape);o=fr(i.shape,s)}return i.reshape(o)}}),foe=k({basicLSTMCell_:function(n,t,e,r,i,o){var s=E(n,"forgetBias","basicLSTMCell"),a=E(t,"lstmKernel","basicLSTMCell"),u=E(e,"lstmBias","basicLSTMCell"),l=E(r,"data","basicLSTMCell"),c=E(i,"c","basicLSTMCell"),d=E(o,"h","basicLSTMCell"),h=l.concat(d,1).matMul(a).add(u),p=h.shape[1]/4,m=[h.shape[0],p],g=h.slice([0,0],m),v=h.slice([0,p],m),y=h.slice([0,2*p],m),b=h.slice([0,3*p],m),_=g.sigmoid().mulStrict(v.tanh()).addStrict(c.mulStrict(s.add(y).sigmoid())),x=_.tanh().mulStrict(b.sigmoid());return[_,x]}}),poe=k({multiRNNCell_:function(n,t,e,r){for(var i=E(t,"data","multiRNNCell"),o=ih(e,"c","multiRNNCell"),s=ih(r,"h","multiRNNCell"),a=i,u=[],l=0;l<n.length;l++){var c=n[l](a,o[l],s[l]);u.push(c[0]),u.push(c[1]),a=c[1]}var d=[],h=[];for(l=0;l<u.length;l+=2)d.push(u[l]),h.push(u[l+1]);return[d,h]}}),goe=k({movingAverage_:function(n,t,e,r,i){void 0===i&&(i=!0);var o=E(n,"v","movingAverage"),s=E(t,"x","movingAverage"),a=E(e,"decay","movingAverage");D2(o,s),D(dn(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=ee(1),l=u.sub(a),c=s.sub(o).mul(l);if(i){D(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=E(r,"step","movingAverage");c=c.div(u.sub(cm(a,d)))}return o.add(c)}}),moe=k({stridedSlice_:function(n,t,e,r,i,o,s,a,u){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==s)throw new Error("ellipsis mask is not yet supported");var l=E(n,"x","stridedSlice"),c=kw(a),d=l.shape.slice();c.forEach(function(g){t[g]=0,e[g]=1,d.splice(g,0,1)}),l=l.reshape(d);for(var h=0;h<l.rank;h++)t[h]=pN(i,t,r,l.shape,h),e[h]=gN(o,e,r,l.shape,h),r[h]=r[h]||1;var f=kw(u);f.forEach(function(g){e[g]=t[g]+1,r[g]=1});var p=Xg(t,e,r),m=p.filter(function(g,v){return-1===f.indexOf(v)});return r.every(function(g){return 1===g})?po(l,t,p).reshape(m):F.runKernelFunc(function(g){return g.stridedSlice(l,t,e,r)},{$x:l}).reshape(m)}}),voe=k({topk_:function(n,t,e){void 0===t&&(t=1),void 0===e&&(e=!0);var r=E(n,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var o=F.runKernelFunc(function(s){return s.topk(r,t,e)},{$x:r});return{values:o[0],indices:o[1]}}}),yoe=k({scatterND_:function(n,t,e){var r=E(n,"indices","scatterND","int32"),i=E(t,"updates","scatterND");return hN(i,r,e),F.runKernelFunc(function(o){return o.scatterND(r,i,e)},{indices:r,updates:i},null,"ScatterNd",{shape:e})}}),a0=k({fft_:function(n){D("complex64"===n.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],r=n.as2D(n.size/t,t);return F.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),pm=k({ifft_:function(n){D("complex64"===n.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],r=n.as2D(n.size/t,t);return F.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),u0=k({rfft_:function(n,t){D("float32"===n.dtype,function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e,r=n.shape[n.shape.length-1],i=n.size/r;if(null!=t&&t<r){var o=n.shape.map(function(v){return 0}),s=n.shape.map(function(v){return v});s[n.shape.length-1]=t,e=n.slice(o,s),r=t}else if(null!=t&&t>r){var a=n.shape.map(function(v){return v});a[n.shape.length-1]=t-r,e=n.concat(At(a),n.shape.length-1),r=t}else e=n;var u=e.zerosLike(),l=Bn(e,u).as2D(i,r),c=a0(l),d=Math.floor(r/2)+1,h=si(c),f=ho(c),p=h.split([d,r-d],h.shape.length-1),m=f.split([d,r-d],f.shape.length-1),g=e.shape.slice();return g[e.shape.length-1]=d,Bn(p[0],m[0]).reshape(g)}}),$P=k({irfft_:function(n){var t=n.shape[n.shape.length-1],e=n.size/t;if(t<=2){var r=n.as2D(e,t),i=pm(r);return si(i)}var o=[e,2*(t-1)],s=si(n).as2D(e,t),a=ho(n).as2D(e,t),u=s.slice([0,1],[e,t-2]).reverse(1),l=a.slice([0,1],[e,t-2]).reverse(1).mul(ee(-1)),c=s.concat(u,1),d=a.concat(l,1);return r=Bn(c,d).as2D(o[0],o[1]),i=pm(r),si(i)}}),_oe=Object.freeze({fft:a0,ifft:pm,rfft:u0,irfft:$P}),boe=k({sparseToDense_:function(n,t,e,r){void 0===r&&(r=0);var i=E(n,"sparseIndices","sparseToDense","int32"),o=E(t,"sparseValues","sparseToDense"),s=E(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,l,c){if("int32"!==a.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,h=a.rank>1?a.shape[1]:1;if(l.length!==h)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+h+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,e,s),F.runKernelFunc(function(a){return a.sparseToDense(i,o,e,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),xoe=k({gatherND_:function(n,t){var e=E(t,"indices","gatherND","int32"),r=E(n,"x","gatherND");return F.runKernelFunc(function(i){return i.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),woe=k({diag_:function(n){var t=E(n,"x","diag").flatten(),e=n.shape.concat(n.shape);return F.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(e)}}),Coe=k({dropout_:function(n,t,e,r){var i=E(n,"x","dropout");if(D("float32"===i.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),D(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return n instanceof Ct?i.clone():i;var o=function(u,l){if(null==l)return u.shape.slice();if(dn(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],d=0;d<u.shape.length;d++)c.push(null==l[d]&&null!=u.shape[d]?u.shape[d]:l[d]);return c}return l}(i,e),s=1-t,a=sN(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function qP(n,t,e){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var s=2*Math.PI*o/(n+r-1);i[o]=t-e*Math.cos(s)}return fn(i,"float32")}var Zn,l0=k({hannWindow_:function(n){return qP(n,.5,.5)}}),KP=k({hammingWindow_:function(n){return qP(n,.54,.46)}}),c0=k({frame_:function(n,t,e,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,s=[];o+t<=n.size;)s.push(po(n,o,t)),o+=e;if(r)for(;o<n.size;){var a=o+t-n.size,u=bn([po(n,o,t-a),fo([a],i)]);s.push(u),o+=e}return 0===s.length?Hs([],[0,t]):bn(s).as2D(s.length,t)}}),YP=k({stft_:function(n,t,e,r,i){void 0===i&&(i=l0),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var s=c0(n,t,e),a=Jn(s,i(t)),u=[],l=0;l<s.shape[0];l++)u.push(u0(a.slice([l,0],[1,t]),r));return bn(u)}}),Eoe=Object.freeze({hannWindow:l0,hammingWindow:KP,frame:c0,stft:YP});!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Zn||(Zn={}));var Soe=k({absoluteDifference_:function(n,t,e,r){void 0===r&&(r=Zn.SUM_BY_NONZERO_WEIGHTS);var i=E(n,"labels","absoluteDifference"),o=E(t,"predictions","absoluteDifference"),s=null;null!=e&&(s=E(e,"weights","absoluteDifference")),nt(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Zo(a,s,r)}}),Zo=k({computeWeightedLoss_:function(n,t,e){void 0===e&&(e=Zn.SUM_BY_NONZERO_WEIGHTS);var r=E(n,"losses","computeWeightedLoss"),i=null;null!=t&&(i=E(t,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(e===Zn.NONE)return o;if(e===Zn.SUM)return o.sum();if(e===Zn.MEAN){if(null==i)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(ee(s)):a}if(e===Zn.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(ee(r.size));var u=i.mul(Ol(r.shape)).notEqual(ee(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+e)}}),Aoe=k({cosineDistance_:function(n,t,e,r,i){void 0===i&&(i=Zn.SUM_BY_NONZERO_WEIGHTS);var o=E(n,"labels","cosineDistance"),s=E(t,"predictions","cosineDistance"),a=null;null!=r&&(a=E(r,"weights","cosineDistance")),nt(o.shape,s.shape,"Error in cosineDistance: ");var u=ee(1).sub(o.mul(s).sum(e,!0));return Zo(u,a,i)}}),Moe=k({hingeLoss_:function(n,t,e,r){void 0===r&&(r=Zn.SUM_BY_NONZERO_WEIGHTS);var i=E(n,"labels","hingeLoss"),o=E(t,"predictions","hingeLoss"),s=null;null!=e&&(s=E(e,"weights","hingeLoss")),nt(i.shape,o.shape,"Error in hingeLoss: ");var a=ee(1);i=ee(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return Zo(u,s,r)}}),Ioe=k({huberLoss_:function(n,t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=Zn.SUM_BY_NONZERO_WEIGHTS);var o=E(n,"labels","huberLoss"),s=E(t,"predictions","huberLoss"),a=null;null!=e&&(a=E(e,"weights","huberLoss")),nt(o.shape,s.shape,"Error in huberLoss: ");var u=ee(r),l=s.sub(o).abs(),c=SP(l,u),d=l.sub(c),h=ee(.5).mul(c.square()).add(u.mul(d));return Zo(h,a,i)}}),Toe=k({logLoss_:function(n,t,e,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=Zn.SUM_BY_NONZERO_WEIGHTS);var o=E(n,"labels","logLoss"),s=E(t,"predictions","logLoss"),a=null;null!=e&&(a=E(e,"weights","logLoss")),nt(o.shape,s.shape,"Error in logLoss: ");var u=ee(1),l=ee(r),c=o.mul(s.add(l).log()).neg().sub(u.sub(o).mul(u.sub(s).add(l).log()));return Zo(c,a,i)}}),Roe=k({meanSquaredError_:function(n,t,e,r){void 0===r&&(r=Zn.SUM_BY_NONZERO_WEIGHTS);var i=E(n,"labels","meanSquaredError"),o=E(t,"predictions","meanSquaredError"),s=null;null!=e&&(s=E(e,"weights","meanSquaredError")),nt(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Zo(a,s,r)}}),Foe=k({sigmoidCrossEntropy_:function(n,t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=Zn.SUM_BY_NONZERO_WEIGHTS);var o=E(n,"multiClassLabels","sigmoidCrossEntropy"),s=E(t,"logits","sigmoidCrossEntropy"),a=null;if(null!=e&&(a=E(e,"weights","sigmoidCrossEntropy")),nt(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ee(r),l=ee(1),c=ee(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var d=function(h,f){var p=E(h,"labels","sigmoidCrossEntropyWithLogits"),m=E(f,"logits","sigmoidCrossEntropyWithLogits");nt(p.shape,m.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=m.relu(),v=m.mul(p),y=m.abs().neg().exp().log1p();return g.sub(v).add(y)}(o,s);return Zo(d,a,i)}}),koe=k({softmaxCrossEntropy_:function(n,t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=Zn.SUM_BY_NONZERO_WEIGHTS);var o=E(n,"onehotLabels","softmaxCrossEntropy"),s=E(t,"logits","softmaxCrossEntropy"),a=null;if(null!=e&&(a=E(e,"weights","softmaxCrossEntropy")),nt(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ee(r),l=ee(1),c=ee(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var d=function(h,f,p){if(void 0===p&&(p=-1),-1===p&&(p=f.rank-1),p!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+p);return Qg(function(m,g,v){var y=g.logSumExp([p],!0),b=g.toFloat().sub(y);return v([m,b]),{value:b.mul(m).neg().sum([p]),gradFunc:function(_,x){var w=x[0],M=x[1],T=fr(_.shape,[p]);return[_.reshape(T).mul(w.toFloat().sub(M.exp())),_.reshape(T).mul(M.exp().sub(w.toFloat()))]}}})(h,f)}(o,s);return Zo(d,a,i)}}),Ooe=Object.freeze({get Reduction(){return Zn},absoluteDifference:Soe,computeWeightedLoss:Zo,cosineDistance:Aoe,hingeLoss:Moe,huberLoss:Ioe,logLoss:Toe,meanSquaredError:Roe,sigmoidCrossEntropy:Foe,softmaxCrossEntropy:koe});function XP(n,t){return void 0===t&&(t=!1),F.tidy(function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var e=n.shape[0],r=n.shape[1],i=oN(e),o=n.clone(),s=Hs([[1]],[1,1]),a=s.clone(),u=e>=r?r:e,l=function(d){var h,f=o,p=a,m=i;h=F.tidy(function(){var g=o.slice([d,d],[e-d,1]),v=g.norm(),y=o.slice([d,d],[1,1]),b=Hs([[-1]]).where(y.greater(0),Hs([[1]])),_=y.sub(b.mul(v)),x=g.div(_);a=1===x.shape[0]?s.clone():s.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var w=b.matMul(_).div(v).neg(),M=o.slice([d,0],[e-d,r]),T=w.mul(a);if(0===d)o=M.sub(T.matMul(a.transpose().matMul(M)));else{var S=M.sub(T.matMul(a.transpose().matMul(M)));o=o.slice([0,0],[d,r]).concat(S,0)}var I=i.slice([0,d],[e,i.shape[1]-d]);if(0===d)i=I.sub(I.matMul(a).matMul(T.transpose()));else{var N=I.sub(I.matMul(a).matMul(T.transpose()));i=i.slice([0,0],[e,d]).concat(N,1)}return[a,o,i]}),a=h[0],o=h[1],i=h[2],_r([f,p,m])},c=0;c<u;++c)l(c);return!t&&e>r&&(i=i.slice([0,0],[e,r]),o=o.slice([0,0],[r,r])),[i,o]})}var Noe=k({bandPart_:function(n,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=E(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(t<=s))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+s+").");if(!(e<=a))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+a+").");t<0&&(t=s),e<0&&(e=a);var u=Gg(0,s,1,"int32").reshape([-1,1]),l=Gg(0,a,1,"int32"),c=wn(u,l),d=lm(c.lessEqual(ee(+t,"int32")),c.greaterEqual(ee(-e,"int32"))),h=At([s,a],r.dtype);return Br(xn(r.reshape([-1,s,a])).map(function(f){return Qa(d,f,h)})).reshape(i)}}),Poe=k({gramSchmidt_:function(n){var t;if(Array.isArray(n)){t=!1,D(null!=n&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=n[0].shape[0],r=function(u){D(n[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+e+")"})},i=1;i<n.length;++i)r(i)}else t=!0,n=Mw(n,n.shape[0],0).map(function(u){return uN(u,[0])});D(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],s=n,a=function(u){o.push(F.tidy(function(){var l=s[u];if(u>0)for(var c=0;c<u;++c){var d=UP(o[c].mulStrict(l)).mul(o[c]);l=l.sub(d)}return l.div(zP(l,"euclidean"))}))};for(i=0;i<n.length;++i)a(i);return t?Br(o,0):o}}),Loe=k({qr_:function(n,t){if(void 0===t&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return XP(n,t);var e=n.shape.slice(0,n.shape.length-2).reduce(function(s,a){return s*a}),r=xn(n.reshape([e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=XP(s,t),l=a[1];i.push(a[0]),o.push(l)}),[Br(i,0).reshape(n.shape),Br(o,0).reshape(n.shape)]}}),Boe=Object.freeze({bandPart:Noe,gramSchmidt:Poe,qr:Loe});function gm(n,t,e,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var s=n.shape[0];return e=Math.min(e,s),D(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),D(2===n.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),D(4===n.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),D(1===t.rank,function(){return"scores must be a 1D tensor"}),D(t.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+t.shape[0]}),D(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var Voe=k({resizeBilinear_:function(n,t,e){void 0===e&&(e=!1);var r=E(n,"images","resizeBilinear");D(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),D(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t[0],a=t[1],u=F.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,s,a,e)},{x:i},function(l,c){return{x:function(){return F.runKernelFunc(function(d){return d.resizeBilinearBackprop(l,c[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:s,newWidth:a});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Hoe=k({resizeNearestNeighbor_:function(n,t,e){void 0===e&&(e=!1);var r=E(n,"images","resizeNearestNeighbor");D(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),D(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),D("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=t[0],a=t[1],u=F.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,s,a,e)},{batchImages:i},function(l,c){return{batchImages:function(){return F.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(l,c[0],e)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Uoe=k({nonMaxSuppression_:function(n,t,e,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=E(n,"boxes","nonMaxSuppression"),s=E(t,"scores","nonMaxSuppression"),a=gm(o,s,e,r,i);return F.runKernelFunc(function(l){return l.nonMaxSuppression(o,s,e,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",{maxOutputSize:e=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold})}}),Woe=k({nonMaxSuppressionWithScore_:function(n,t,e,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var s=E(n,"boxes","nonMaxSuppression"),a=E(t,"scores","nonMaxSuppression"),u=gm(s,a,e,r,i,o),l={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=F.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),zoe=k({cropAndResize_:function(n,t,e,r,i,o){var s=E(n,"image","cropAndResize"),a=E(t,"boxes","cropAndResize","float32"),u=E(e,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=a.shape[0];return D(4===s.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),D(2===a.rank&&4===a.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+a.shape+"."}),D(1===u.rank&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+a.shape+"."}),D(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),D(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),D("bilinear"===i||"nearest"===i,function(){return"method must be bilinear or nearest, but was "+i}),F.runKernelFunc(function(c,d){return c.cropAndResize(s,a,u,r,i,o)},{images:s,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),d0=Object.freeze({resizeBilinear:Voe,resizeNearestNeighbor:Hoe,nonMaxSuppression:Uoe,nonMaxSuppressionAsync:function(n,t,e,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),le(this,void 0,void 0,function(){var o,s,a,u,d;return ce(this,function(h){switch(h.label){case 0:return o=E(n,"boxes","nonMaxSuppressionAsync"),s=E(t,"scores","nonMaxSuppressionAsync"),a=gm(o,s,e,r,i),e=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return u=h.sent(),d=Uw(u[0],u[1],e,r,i),o!==n&&o.dispose(),s!==t&&s.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:Woe,nonMaxSuppressionWithScoreAsync:function(n,t,e,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),le(this,void 0,void 0,function(){var s,a,u,l,h;return ce(this,function(f){switch(f.label){case 0:return s=E(n,"boxes","nonMaxSuppressionAsync"),a=E(t,"scores","nonMaxSuppressionAsync"),u=gm(s,a,e,r,i,o),e=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return l=f.sent(),h=jw(l[0],l[1],e,r,i,o),s!==n&&s.dispose(),a!==t&&a.dispose(),[2,h]}})})},cropAndResize:zoe}),h0=function(n,t){return!(n>0)||"linear"===t},f0=function(n,t,e){if(null==e||"linear"===e)return n;if("relu"===e)return n.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},p0=function(n,t){var e=t,r=pn(n.shape,t.shape);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},g0=function(n,t,e){if("linear"===t)return n;if("relu"===t)return Lt(n);if("elu"===t)return jP(n);if("relu6"===t)return GP(n);if("prelu"===t)return WP(n,e);throw new Error("Unknown fused activation "+t+".")},$oe=k({fusedMatMul_:function(n){var t,e=n.a,r=n.b,i=n.transposeA,o=void 0!==i&&i,s=n.transposeB,a=void 0!==s&&s,u=n.bias,l=n.activation,c=void 0===l?"linear":l,d=n.preluActivationWeights;if(!1===h0(F.state.gradientDepth,c)){var h=hm(e,r,o,a);return null!=u&&(h=qe(h,u)),g0(h,c,d)}var f=E(e,"a","fused matMul"),p=E(r,"b","fused matMul");t=Ft(f,p),f=t[0],p=t[1];var m=o?f.shape[f.rank-2]:f.shape[f.rank-1],g=a?p.shape[p.rank-1]:p.shape[p.rank-2],v=o?f.shape[f.rank-1]:f.shape[f.rank-2],y=a?p.shape[p.rank-2]:p.shape[p.rank-1],b=f.shape.slice(0,-2),_=p.shape.slice(0,-2),x=de(b),w=de(_);D(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),D(dn(b,_),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+_+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),D(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var M,T,S=f.shape.slice(0,-2).concat([v,y]),I=o?f.as3D(x,m,v):f.as3D(x,v,m),N=a?p.as3D(w,y,g):p.as3D(w,g,y);null!=u&&$e(S,(M=Ft(M=E(u,"bias","fused matMul"),f)[0]).shape),null!=d&&(T=E(d,"prelu weights","fused matMul"));var O={a:I,b:N};return null!=u&&(O.bias=M),null!=d&&(O.preluActivationWeights=T),F.runKernelFunc(function(G,z){var P=G.fusedBatchMatMul({a:I,b:N,transposeA:o,transposeB:a,bias:M,activation:c,preluActivationWeights:T});return z([I,N,P]),P},O,function(G,z){var P=z[0],L=z[1],U=f0(G,z[2],c),q={};return null!=u&&(q={bias:function(){return p0(M,U)}}),Object.assign(o||a?!o&&a?{a:function(){return U.matMul(L,!1,!1)},b:function(){return U.matMul(P,!0,!1)}}:o&&!a?{a:function(){return L.matMul(U,!1,!0)},b:function(){return P.matMul(U,!1,!1)}}:{a:function(){return L.matMul(U,!0,!0)},b:function(){return U.matMul(P,!0,!0)}}:{a:function(){return U.matMul(L,!1,!0)},b:function(){return P.matMul(U,!0,!1)}},q)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:c},[I,N],[!0]).reshape(S)}}),qoe=k({fusedConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=void 0===o?"NHWC":o,a=n.dilations,u=void 0===a?[1,1]:a,l=n.dimRoundingMode,c=n.bias,d=n.activation,h=void 0===d?"linear":d,f=n.preluActivationWeights;if(!1===h0(F.state.gradientDepth,h=h||"linear")){var p=ui(t,e,r,i,s,u,l);return null!=c&&(p=qe(p,c)),g0(p,h,f)}var m=E(t,"x","conv2d"),g=E(e,"filter","conv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),D(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),D(4===g.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),null!=l&&D(Pt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),D(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),D(pr(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),D("NHWC"===s,function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var b,_,x=Us(v.shape,g.shape,r,u,i,l);null!=c&&(b=Ft(b=E(c,"bias","fused conv2d"),m)[0],$e(x.outShape,b.shape)),null!=f&&(_=E(f,"prelu weights","fused conv2d"));var w={x:v,filter:g};null!=c&&(w.bias=b),null!=f&&(w.preluActivationWeights=_);var T=F.runKernelFunc(function(S,I){var N=S.fusedConv2d({input:v,filter:g,convInfo:x,bias:b,activation:h,preluActivationWeights:_});return I([g,v,N]),N},w,function(S,I){var O=I[0],W=I[1],z=f0(S,I[2],h);D(Ka(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var P={};return null!=c&&(P={bias:function(){return p0(b,z)}}),Object.assign({x:function(){return OP(W.shape,z,O,r,i)},filter:function(){return o0(W,z,O.shape,r,i)}},P)},"FusedConv2D",{convInfo:x,activation:h},[g,v],[!0]);return y?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),Koe=k({fusedDepthwiseConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=void 0===o?"NHWC":o,a=n.dilations,u=void 0===a?[1,1]:a,l=n.dimRoundingMode,c=n.bias,d=n.activation,h=void 0===d?"linear":d,f=n.preluActivationWeights;if(!1===h0(F.state.gradientDepth,h)){var p=dm(t,e,r,i,s,u,l);return null!=c&&(p=qe(p,c)),g0(p,h,f)}var m=E(t,"x","depthwiseConv2d"),g=E(e,"filter","depthwiseConv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),D(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),D(4===g.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),D(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),null==u&&(u=[1,1]),D(pr(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=l&&D(Pt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var b,_,x=Us(v.shape,g.shape,r,u,i,l,!0);null!=c&&(b=Ft(b=E(c,"bias","fused conv2d"),m)[0],$e(x.outShape,b.shape)),null!=f&&(_=E(f,"prelu weights","fused depthwiseConv2d"));var w={x:v,filter:g};null!=c&&(w.bias=b),null!=f&&(w.preluActivationWeights=_);var T=F.runKernelFunc(function(S,I){var N=S.fusedDepthwiseConv2D({input:v,filter:g,convInfo:x,bias:b,activation:h,preluActivationWeights:_});return I([g,v,N]),N},w,function(S,I){D(Ka(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=I[0],O=I[1],G=f0(S,I[2],h),z={};return null!=c&&(z={bias:function(){return p0(b,G)}}),Object.assign({x:function(){return NP(O.shape,G,N,x)},filter:function(){return PP(O,G,N.shape,x)}},z)},"FusedDepthwiseConv2D",{convInfo:x,activation:h},[g,v],[!0]);return y?T.as3D(T.shape[1],T.shape[2],T.shape[3]):T}}),Yoe=Object.freeze({matMul:$oe,conv2d:qoe,depthwiseConv2d:Koe}),Xoe=Object.freeze({image:d0,linalg:Boe,losses:Ooe,spectral:_oe,fused:Yoe,signal:Eoe,square:Tre,squaredDifference:mP,conv1d:Vie,conv2d:ui,conv3d:Hie,depthwiseConv2d:dm,separableConv2d:s0,conv2dTranspose:Uie,conv3dTranspose:jie,op:k,batchNormalization2d:sie,batchNormalization3d:aie,batchNormalization4d:uie,batchNormalization:lie,batchNorm:wP,batchNorm2d:cie,batchNorm3d:die,batchNorm4d:hie,booleanMaskAsync:function(n,t,e){return le(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,d,h,f,p,m;return ce(this,function(g){switch(g.label){case 0:for(r=E(n,"tensor","boolMask"),i=E(t,"mask","boolMask","bool"),o=null==e?0:e,a=r.shape,D((s=i.rank)>0,function(){return"mask cannot be scalar"}),nt(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+s;l++)u*=a[l];return c=a.slice(0,o).concat([u],a.slice(o+s)),d=r.reshape(c),h=i.reshape([-1]),[4,EP(h)];case 1:return f=g.sent(),p=f.squeeze([1]),m=n0(d,p,o),n!==r&&r.dispose(),t!==i&&i.dispose(),p.dispose(),d.dispose(),h.dispose(),f.dispose(),[2,m]}})})},complex:Bn,real:si,imag:ho,concat:bn,concat1d:vte,concat2d:yte,concat3d:_te,concat4d:bte,split:Mw,matMul:hm,dot:Wie,outerProduct:Gie,reverse:fh,reverse1d:zie,reverse2d:$ie,reverse3d:qie,reverse4d:Kie,maxPool:In,avgPool:ph,pool:Yie,maxPool3d:Xie,avgPool3d:Qie,slice:po,slice1d:Jie,slice2d:Zie,slice3d:VP,slice4d:eoe,abs:Rre,acos:Fre,acosh:kre,asin:Ore,asinh:Nre,atan:Pre,atanh:Lre,ceil:Bre,clipByValue:Zw,cos:Vre,cosh:Hre,erf:Ure,exp:e0,expm1:jre,floor:Wre,log:Gre,log1p:zre,logSigmoid:$re,neg:sm,reciprocal:qre,round:Kre,rsqrt:vP,sigmoid:yP,sign:Yre,isNaN:Xre,isInf:Qre,isFinite:Jre,sin:Zre,sinh:eie,softplus:tie,sqrt:nie,step:rie,tan:iie,tanh:oie,all:toe,any:noe,argMax:roe,argMin:ioe,logSumExp:ooe,max:fm,mean:soe,min:aoe,moments:uoe,sum:UP,prod:loe,equal:AP,equalStrict:Mie,greater:Iie,greaterEqual:MP,greaterEqualStrict:Tie,greaterStrict:Rie,less:Fie,lessEqual:kie,lessEqualStrict:Oie,lessStrict:Nie,notEqual:Pie,notEqualStrict:Lie,add:qe,addN:gie,addStrict:mie,atan2:vie,div:Li,divNoNan:yie,divStrict:_ie,floorDiv:DP,maximum:t0,maximumStrict:bie,minimum:SP,minimumStrict:xie,mod:wie,modStrict:Cie,mul:Jn,mulStrict:Eie,pow:cm,powStrict:Die,squaredDifferenceStrict:Sie,sub:wn,subStrict:Aie,elu:jP,leakyRelu:coe,prelu:WP,relu:Lt,relu6:GP,selu:doe,logicalAnd:lm,logicalNot:fie,logicalOr:CP,logicalXor:pie,where:Qa,whereAsync:EP,buffer:Oe,print:function(n,t){void 0===t&&(t=!1),console.log(n.toString(t))},batchToSpaceND:iN,broadcastTo:Tte,cast:Rte,clone:Fte,cumsum:kte,depthToSpace:Ote,expandDims:ai,eye:oN,multinomial:Nte,oneHot:Tw,pad:qa,pad1d:Pte,pad2d:Lte,pad3d:Bte,pad4d:Vte,rand:Hte,randomNormal:Ute,randomGamma:jte,randomUniform:sN,reshape:Ni,spaceToBatchND:aN,squeeze:uN,stack:Br,tile:Nl,truncatedNormal:Wte,unstack:xn,setdiff1dAsync:function(n,t){return le(this,void 0,void 0,function(){var e,r,i,o,s,a,u,l,c,d;return ce(this,function(h){switch(h.label){case 0:return e=E(n,"x","setdiff1d"),r=E(t,"y","setdiff1d"),D(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),D(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),D(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return i=h.sent(),[4,r.data()];case 2:for(o=h.sent(),s=new Set(o),a=0,c=0;c<i.length;c++)s.has(i[c])||a++;for(u=new Yd([a],e.dtype),l=new Yd([a],"int32"),c=0,d=0;c<i.length;c++)s.has(i[c])||(u.values[d]=i[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})},fill:fo,linspace:function(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");return F.runKernelFunc(function(r){return r.linspace(n,t,e)},{})},ones:Ol,range:Gg,scalar:ee,tensor:Vn,tensor1d:fn,tensor2d:Hs,tensor3d:Aw,tensor4d:xr,tensor5d:function(n,t,e){if(Ua(n),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=co(n,e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Vs(n,t,r,e)},tensor6d:function(n,t,e){if(Ua(n),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=co(n,e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Vs(n,t=t||r,r,e)},variable:function(n,t,e,r){return void 0===t&&(t=!0),F.makeVariable(n,t,e,r)},zeros:At,onesLike:rN,zerosLike:rt,transpose:js,softmax:Xo,logSoftmax:$te,localResponseNormalization:hoe,norm:zP,gather:n0,unsortedSegmentSum:RP,basicLSTMCell:foe,multiRNNCell:poe,movingAverage:goe,stridedSlice:moe,topk:voe,scatterND:yoe,fft:a0,ifft:pm,rfft:u0,irfft:$P,sparseToDense:boe,gatherND:xoe,diag:woe,dropout:Coe,hannWindow:l0,hammingWindow:KP,frame:c0,stft:YP,inTopKAsync:function(n,t,e){return void 0===e&&(e=1),le(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,d,h,f,p,m,g;return ce(this,function(v){switch(v.label){case 0:return r=E(n,"predictions","inTopK"),i=E(t,"targets","inTopK"),D(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),D(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),nt(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],D(e>0&&e<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+e}),[4,r.data()];case 1:return s=v.sent(),[4,i.data()];case 2:for(a=v.sent(),c=(u=[s.length/o,o])[1],d=Tl("bool",l=u[0]),h=0;h<l;h++){for(p=s.subarray(f=h*c,f+c),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(y,b){return b.value-y.value}),d[h]=0,g=0;g<e;g++)if(m[g].index===a[h]){d[h]=1;break}}return n!==r&&r.dispose(),t!==i&&i.dispose(),[2,Vn(d,i.shape,"bool")]}})})}});function Y(n,t){Array.isArray(n)||(n=[n]),n.forEach(function(e){null!=e&&D("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function m0(n,t,e,r){if("linear"===e)return n.linear(t);if("relu"===e)return n.relu(t);if("elu"===e)return n.elu(t);if("relu6"===e)return n.relu6(t);if("prelu"===e)return n.prelu(t,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var Qoe=function(n){function t(){var e=n.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new mN(e,F),e}return Ti(t,n),t.prototype.write=function(e,r,i){this.firstUse&&(this.firstUse=!1,j().get("IS_NODE")&&jg("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var o={};return this.data.set(o,{values:e,dtype:i}),o},t.prototype.move=function(e,r,i,o){this.data.set(e,{values:r,dtype:o})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return le(this,void 0,void 0,function(){return ce(this,function(r){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var r=this.data.get(e),o=r.complexTensors;return"complex64"===r.dtype?Hw(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),i=r;if("string"===e.dtype)try{i=r.map(function(o){return zd(o)})}catch(o){throw new Error("Failed to decode encoded string bytes into utf-8")}return Oe(e.shape,e.dtype,i)},t.prototype.makeOutput=function(e,r,i){var o=this.write(e,r,i);return F.makeTensorFromDataId(o,r,i,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){return r=Fi(),e(),[2,{kernelMs:Fi()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,r){var i=this.makeOutput(null,e.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:F.keep(e.clone()),imag:F.keep(r.clone())},i},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,i){if(Y(e,"slice"),Ow(e.shape,r,i)){var o=Nw(r,e.strides),s=de(i);return Vn(this.readSync(e.dataId).subarray(o,o+s),i,e.dtype)}for(var a=Oe(i,e.dtype),u=this.bufferSync(e),l=0;l<a.size;++l){var c=a.indexToLoc(l).map(function(d,h){return d+r[h]});a.values[l]=u.get.apply(u,c)}return a.toTensor()},t.prototype.stridedSlice=function(e,r,i,o){Y(e,"stridedSlice");var s=Xg(r,i,o);if(s.some(function(f){return 0===f}))return Vn([],s);for(var a=Oe(s,e.dtype),u=this.bufferSync(e),l=0;l<a.size;l++){for(var c=a.indexToLoc(l),d=new Array(c.length),h=0;h<d.length;h++)d[h]=c[h]*o[h]+r[h];a.set.apply(a,[u.get.apply(u,d)].concat(c))}return a.toTensor()},t.prototype.diag=function(e){for(var r=this.readSync(e.dataId),i=Oe([e.size,e.size],e.dtype),o=i.values,s=0;s<r.length;s++)o[s*e.size+s]=r[s];return i.toTensor()},t.prototype.unstack=function(e,r){for(var i=e.shape[r],o=new Array(e.rank-1),s=0,a=0;a<e.rank;a++)a!==r&&(o[s++]=e.shape[a]);var u=new Array(e.rank).fill(0),l=e.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(e,u,l).reshape(o);return c},t.prototype.reverse=function(e,r){Y(e,"reverse");for(var i=Oe(e.shape,e.dtype),o=this.bufferSync(e),s=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(d){return c[d]=e.shape[d]-1-c[d]}),i.set.apply(i,[o.get.apply(o,c)].concat(l))},a=0;a<i.size;a++)s(a);return i.toTensor()},t.prototype.concat=function(e,r){var i=this;if("complex64"===e[0].dtype){var o=e.map(function(f){return si(f)}),s=e.map(function(f){return ho(f)});return Bn(this.concat(o,r),this.concat(s,r))}var a=e.map(function(f){var p=de(f.shape.slice(r));return f.as2D(-1,p)}),u=Ga(a.map(function(f){return f.shape}),1),l=Oe(u,e[0].dtype).values;if(1===a[0].shape[0]){var c=0;a.forEach(function(f){l.set(i.readSync(f.dataId),c),c+=f.size})}else{var d=0;a.forEach(function(f){for(var p=i.readSync(f.dataId),m=0,g=0;g<f.shape[0];++g)for(var v=g*u[1]+d,y=0;y<f.shape[1];++y)l[v+y]=p[m++];d+=f.shape[1]})}var h=Ga(e.map(function(f){return f.shape}),r);return Vn(l,h,e[0].dtype)},t.prototype.neg=function(e){return Y(e,"neg"),this.multiply(ee(-1),e)},t.prototype.add=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(e,r,Mn(e.dtype,r.dtype),function(i,o){return i+o})},t.prototype.addN=function(e){var r=this;Y(e,"addN");for(var i=e.map(function(c){return r.readSync(c.dataId)}),o=Oe(e[0].shape,e[0].dtype),s=o.values,a=0;a<e.length;a++)for(var u=i[a],l=0;l<s.length;l++)s[l]+=u[l];return o.toTensor()},t.prototype.softmax=function(e,r){var i=hn([r],e.shape),o=this.max(e,i),s=fr(o.shape,i),a=this.subtract(e,o.reshape(s)),u=this.exp(a),l=this.sum(u,i).reshape(s);return this.realDivide(u,l)},t.prototype.subtract=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(e,r,Mn(e.dtype,r.dtype),function(i,o){return i-o})},t.prototype.pow=function(e,r){return Y([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.pow(i,o)})},t.prototype.batchMatMul=function(e,r,i,o){Y([e,r],"matMul");for(var s=i?e.shape[1]:e.shape[2],a=i?e.shape[2]:e.shape[1],u=o?r.shape[1]:r.shape[2],l=e.shape[0],c=this.readSync(e.dataId),d=this.readSync(r.dataId),h=i?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=h[0],p=h[1],m=h[2],g=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],v=g[0],y=g[1],b=g[2],_=a*u,x=Oe([l,a,u],e.dtype),w=x.values,M=this.blockSize,T=0;T<l;T++)for(var S=0;S<a;S+=M)for(var I=0;I<u;I+=M)for(var N=0;N<s;N+=M)for(var O=Math.min(S+M,a),W=Math.min(I+M,u),G=Math.min(N+M,s),z=S;z<O;z++)for(var P=I;P<W;P++){for(var L=0,B=N;B<G;B++)L+=c[T*f+z*p+B*m]*d[B*v+P*y+T*b];w[T*_+(z*u+P)]+=L}return x.toTensor()},t.prototype.fusedBatchMatMul=function(e){var a=e.bias,u=e.activation,l=e.preluActivationWeights,c=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return a&&(c=this.add(c,a)),u&&(c=m0(this,c,u,l)),c},t.prototype.multiply=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(e,r,Mn(e.dtype,r.dtype),function(i,o){return i*o})},t.prototype.realDivide=function(e,r){return Y([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(i,o){return i/o})},t.prototype.floorDiv=function(e,r){return Y([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(i,o){return Math.floor(i/o)})},t.prototype.sum=function(e,r){Y(e,"sum"),br("sum",r,e.rank);for(var i=Ln(e.shape,r),s=i[1],a=At(i[0],Mn(e.dtype,"int32")),u=de(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),d=0;d<l.length;++d){for(var h=d*u,f=0,p=0;p<u;++p)f+=c[h+p];l[d]=f}return a},t.prototype.prod=function(e,r){Y(e,"sum");for(var i=Ln(e.shape,r),s=i[1],a=At(i[0],Mn(e.dtype,"int32")),u=de(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),d=0;d<l.length;++d){for(var h=d*u,f=1,p=0;p<u;++p)f*=c[h+p];l[d]=f}return a},t.prototype.unsortedSegmentSum=function(e,r,i){Y(e,"unsortedSegmentSum");for(var o=[],s=e.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=ee(a,"int32"),l=AP(u,r).asType("float32").mul(e).sum(0);o.push(l)}return Br(o)},t.prototype.argMin=function(e,r){Y(e,"argMin");var i=[r];br("argMin",i,e.rank);for(var o=Ln(e.shape,i),a=o[1],u=At(o[0],"int32"),l=de(a),c=this.readSync(u.dataId),d=this.readSync(e.dataId),h=0;h<c.length;++h){for(var f=h*l,p=d[f],m=0,g=0;g<l;++g){var v=d[f+g];v<p&&(p=v,m=g)}c[h]=m}return u},t.prototype.argMax=function(e,r){Y(e,"argMax");var i=[r];br("argMax",i,e.rank);for(var o=Ln(e.shape,i),a=o[1],u=At(o[0],"int32"),l=de(a),c=this.readSync(u.dataId),d=this.readSync(e.dataId),h=0;h<c.length;++h){for(var f=h*l,p=d[f],m=0,g=0;g<l;++g){var v=d[f+g];v>p&&(p=v,m=g)}c[h]=m}return u},t.prototype.cumsum=function(e,r,i,o){if(Y(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var s=Mn(e.dtype,"int32"),a=At(e.shape,s),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=e.shape[e.rank-1],d=o?function(g,v){return g+c-v-1}:function(g,v){return g+v},h=0;h<l.length;h+=c)for(var f=0;f<c;f++){var p=d(h,f);if(0===f)u[p]=i?0:l[p];else{var m=d(h,f-1);u[p]=i?l[m]+u[m]:l[p]+u[m]}}return a},t.prototype.equal=function(e,r){return Y([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i===o?1:0})},t.prototype.notEqual=function(e,r){return Y([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i!==o?1:0})},t.prototype.less=function(e,r){return Y([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i<o?1:0})},t.prototype.lessEqual=function(e,r){return Y([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i<=o?1:0})},t.prototype.greater=function(e,r){return Y([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i>o?1:0})},t.prototype.greaterEqual=function(e,r){return Y([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i>=o?1:0})},t.prototype.logicalNot=function(e){Y(e,"logicalNot");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,e.shape,"bool")},t.prototype.logicalAnd=function(e,r){return Y([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i&&o})},t.prototype.logicalOr=function(e,r){return Y([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(i,o){return i||o})},t.prototype.select=function(e,r,i){Y([e,r,i],"select");for(var o=this.readSync(e.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),u=At(r.shape,Mn(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,d=0===e.rank||e.rank>1||1===r.rank?1:de(r.shape.slice(1)),h=0;h<o.length;h++)for(var f=0;f<d;f++)l[c++]=1===o[h]?s[h]:a[h];return u},t.prototype.where=function(e){Y([e],"where");var r=this.readSync(e.dataId);return Ww(e.shape,r)},t.prototype.topk=function(e,r,i){return Y(e,"topk"),CN(this.readSync(e.dataId),e.shape,e.dtype,r)},t.prototype.min=function(e,r){Y(e,"min"),br("min",r,e.rank);for(var i=Ln(e.shape,r),s=i[1],a=At(i[0],e.dtype),u=de(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],p=0;p<u;++p){var m=c[h+p];m<f&&(f=m)}l[d]=f}return a},t.prototype.minimum=function(e,r){return Y([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.min(i,o)})},t.prototype.mod=function(e,r){return Y([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},t.prototype.max=function(e,r){Y(e,"max"),br("max",r,e.rank);for(var i=Ln(e.shape,r),s=i[1],a=At(i[0],e.dtype),u=de(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],p=0;p<u;++p){var m=c[h+p];m>f&&(f=m)}l[d]=f}return a},t.prototype.maximum=function(e,r){return Y([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.max(i,o)})},t.prototype.all=function(e,r){Y(e,"all"),br("all",r,e.rank);for(var i=Ln(e.shape,r),s=i[1],a=At(i[0],e.dtype),u=de(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],p=0;p<u;++p)f=f&&c[h+p];l[d]=f}return a},t.prototype.any=function(e,r){Y(e,"any"),br("any",r,e.rank);for(var i=Ln(e.shape,r),s=i[1],a=At(i[0],e.dtype),u=de(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],p=0;p<u;++p)f=f||c[h+p];l[d]=f}return a},t.prototype.squaredDifference=function(e,r){return Y([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){var s=i-o;return s*s})},t.prototype.ceil=function(e){Y(e,"ceil");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.floor=function(e){Y(e,"floor");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.sign=function(e){Y(e,"x");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=r[o]<0?-1:r[o]>0?1:0;return this.makeOutput(i,e.shape,"float32")},t.prototype.isNaN=function(e){Y(e,"x");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},t.prototype.isInf=function(e){Y(e,"x");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},t.prototype.isFinite=function(e){Y(e,"x");for(var r=this.readSync(e.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,e.shape,"bool")},t.prototype.round=function(e){Y(e,"round");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);i[o]=r[o]-s<.5?Math.floor(r[o]):r[o]-s>.5?Math.ceil(r[o]):s%2==0?s:s+1}return this.makeOutput(i,e.shape,"float32")},t.prototype.exp=function(e){Y(e,"exp");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.expm1=function(e){Y(e,"expm1");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.log=function(e){Y(e,"log");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.log1p=function(e){Y(e,"log1p");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.log1p(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.sqrt=function(e){Y(e,"sqrt");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.sqrt(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.rsqrt=function(e){Y(e,"rsqrt");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/Math.sqrt(r[o]);return this.makeOutput(i,e.shape,"float32")},t.prototype.reciprocal=function(e){Y(e,"reciprocal");for(var r=this.readSync(e.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Y(e,"relu");for(var r=At(e.shape,e.dtype),i=this.readSync(r.dataId),o=this.readSync(e.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},t.prototype.relu6=function(e){Y(e,"relu");for(var r=At(e.shape,e.dtype),i=this.readSync(r.dataId),o=this.readSync(e.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},t.prototype.prelu=function(e,r){return Y([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return i<0?o*i:i})},t.prototype.elu=function(e){Y(e,"elu");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,e.shape,"float32")},t.prototype.eluDer=function(e,r){Y([e,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(e.dataId),a=0;a<o.length;++a){var u=o[a];i[a]=u>=1?s[a]:s[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},t.prototype.selu=function(e){Y(e,"selu");for(var o=new Float32Array(e.size),s=this.readSync(e.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(o,e.shape,"float32")},t.prototype.clip=function(e,r,i){Y(e,"clip");for(var o=new Float32Array(e.size),s=this.readSync(e.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>i?i:u<r?r:u}return this.makeOutput(o,e.shape,"float32")},t.prototype.abs=function(e){for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<e.size;++o)r[o]=Math.hypot(i[2*o],i[2*o+1]);return this.makeOutput(r,e.shape,"float32")},t.prototype.int=function(e){Y(e,"int");for(var r=new Int32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,e.shape,"int32")},t.prototype.sigmoid=function(e){Y(e,"sigmoid");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,e.shape,"float32")},t.prototype.softplus=function(e){Y(e,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var c,a=o[s]>-r,u=o[s]<r,l=Math.exp(o[s]);c=u?l:a?o[s]:Math.log(1+l),i[s]=c}return this.makeOutput(i,e.shape,"float32")},t.prototype.sin=function(e){Y(e,"sin");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cos=function(e){Y(e,"cos");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tan=function(e){Y(e,"tan");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asin=function(e){Y(e,"asin");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acos=function(e){Y(e,"acos");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan=function(e){Y(e,"atan");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan2=function(e,r){return Y([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(i,o){return Math.atan2(i,o)})},t.prototype.sinh=function(e){Y(e,"sinh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cosh=function(e){Y(e,"cosh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tanh=function(e){Y(e,"tanh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=d2(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asinh=function(e){Y(e,"asinh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acosh=function(e){Y(e,"acosh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atanh=function(e){Y(e,"atanh");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.erf=function(e){Y(e,"erf");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),u=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,e.shape,"float32")},t.prototype.step=function(e,r){void 0===r&&(r=0),Y(e,"step");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var a=o[s];i[s]=isNaN(a)?NaN:a>0?1:r}return this.makeOutput(i,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var s=e.bias,a=e.activation,u=e.preluActivationWeights,l=this.conv2d(e.input,e.filter,e.convInfo);return s&&(l=this.add(l,s)),a&&(l=m0(this,l,a,u)),l},t.prototype.conv2d=function(e,r,i){Y([e,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,d="channelsLast"===i.dataFormat,h=Oe(i.outShape,e.dtype),f=e.strides[0],p=d?e.strides[1]:e.strides[2],m=d?e.strides[2]:1,g=d?1:e.strides[1],v=h.strides[0],y=d?h.strides[1]:h.strides[2],b=d?h.strides[2]:1,_=d?1:h.strides[1],x=this.readSync(e.dataId),w=this.readSync(r.dataId),M=h.values,T=0;T<i.batchSize;++T)for(var S=T*f,I=T*v,N=0;N<i.outHeight;++N)for(var O=I+N*y,W=N*i.strideHeight-c,G=0;G<o;G++){var z=W+G*a;if(!(z<0||z>=i.inHeight))for(var P=G*r.strides[0],L=S+z*p,B=0;B<i.outWidth;++B)for(var U=O+B*b,q=B*i.strideWidth-l,J=0;J<s;J++){var ne=q+J*u;if(!(ne<0||ne>=i.inWidth))for(var he=L+ne*m,fe=P+J*r.strides[1],He=0;He<i.inChannels;++He){for(var Ee=x[he+He*g],je=0;je<i.outChannels;++je)M[U+je*_]+=Ee*w[fe+je];fe+=i.outChannels}}}return h.toTensor()},t.prototype.conv3d=function(e,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,d=i.padInfo.front,h=i.padInfo.left,f=i.padInfo.top,p=Oe(i.outShape,e.dtype),m=this.readSync(e.dataId),g=this.readSync(r.dataId),v=p.values,y=0;y<i.batchSize;++y)for(var b=y*e.strides[0],_=y*p.strides[0],x=0;x<i.outDepth;++x)for(var w=_+x*p.strides[1],M=x*i.strideDepth-d,T=0;T<o;T++){var S=M+T*u;if(!(S<0||S>=i.inDepth))for(var I=T*r.strides[0],N=b+S*e.strides[1],O=0;O<i.outHeight;++O)for(var W=w+O*p.strides[2],G=O*i.strideHeight-f,z=0;z<s;z++){var P=G+z*l;if(!(P<0||P>=i.inHeight))for(var L=I+z*r.strides[1],B=N+P*e.strides[2],U=0;U<i.outWidth;++U)for(var q=W+U*i.outChannels,J=U*i.strideWidth-h,ne=0;ne<a;ne++){var he=J+ne*c;if(!(he<0||he>=i.inWidth))for(var He=B+he*i.inChannels,Ee=L+ne*r.strides[2],je=0;je<i.inChannels;++je){for(var We=m[He+je],Le=0;Le<i.outChannels;++Le)v[q+Le]+=We*g[Ee+Le];Ee+=i.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,r,i){Y([e,r],"conv2dDerInput");for(var o=Oe(i.inShape,"float32"),s=o.values,a=this.readSync(e.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],d=l[1],h=l[2],f=i.batchSize,p=i.filterHeight,m=i.filterWidth,g=i.inChannels,v=i.inHeight,y=i.inWidth,b=i.outChannels,_=i.outHeight,x=i.outWidth,w=i.strideHeight,M=i.strideWidth,S=p-1-i.padInfo.top,I=m-1-i.padInfo.left,N="channelsLast"===i.dataFormat,O=o.strides[0],W=N?o.strides[1]:o.strides[2],G=N?o.strides[2]:1,z=N?1:o.strides[1],P=e.strides[0],L=N?e.strides[1]:e.strides[2],B=N?e.strides[2]:1,U=N?1:e.strides[1],q=0;q<f;++q)for(var J=0;J<g;++J)for(var ne=0;ne<v;++ne)for(var he=ne-S,fe=Math.max(0,Math.ceil(he/w)),He=Math.min(_,(p+he)/w),Ee=0;Ee<y;++Ee){for(var je=Ee-I,We=Math.max(0,Math.ceil(je/M)),Le=Math.min(x,(m+je)/M),It=0,Je=fe;Je<He;++Je)for(var _t=Je*w-he,ht=We;ht<Le;++ht)for(var qt=P*q+L*Je+B*ht,Ht=c*(p-1-_t)+d*(m-1-(ht*M-je))+h*J,Ut=0;Ut<b;++Ut)It+=a[qt+U*Ut]*u[Ht+Ut];s[O*q+W*ne+G*Ee+z*J]=It}return o.toTensor()},t.prototype.conv3dDerInput=function(e,r,i){for(var o=Oe(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],l=a[1],c=a[2],d=a[3],h=this.readSync(e.dataId),f=e.strides,p=f[0],m=f[1],g=f[2],v=f[3],y=this.readSync(r.dataId),b=r.strides,_=b[0],x=b[1],w=b[2],M=b[3],T=i.batchSize,S=i.filterDepth,I=i.filterHeight,N=i.filterWidth,O=i.inChannels,W=i.inDepth,G=i.inHeight,z=i.inWidth,P=i.outChannels,L=i.outDepth,B=i.outHeight,U=i.outWidth,q=i.strideDepth,J=i.strideHeight,ne=i.strideWidth,he=S-1-i.padInfo.front,fe=I-1-i.padInfo.top,He=N-1-i.padInfo.left,Ee=0;Ee<T;++Ee)for(var je=0;je<O;++je)for(var We=0;We<W;++We)for(var Le=We-he,It=Math.max(0,Math.ceil(Le/q)),Je=Math.min(L,(S+Le)/q),_t=0;_t<G;++_t)for(var ht=_t-fe,qt=Math.max(0,Math.ceil(ht/J)),Ht=Math.min(B,(I+ht)/J),Ut=0;Ut<z;++Ut){for(var bo=Ut-He,xo=Math.max(0,Math.ceil(bo/ne)),Ur=Math.min(U,(N+bo)/ne),Jl=0,as=It;as<Je;++as)for(var Qs=as*q-Le,us=qt;us<Ht;++us)for(var Zl=us*J-ht,ls=xo;ls<Ur;++ls)for(var wC=p*Ee+m*as+g*us+v*ls,ec=_*(S-1-Qs)+x*(I-1-Zl)+w*(N-1-(ls*ne-bo))+M*je,wo=0;wo<P;++wo)Jl+=h[wC+wo]*y[ec+wo];s[u*Ee+l*We+c*_t+d*Ut+je]=Jl}return o.toTensor()},t.prototype.conv2dDerFilter=function(e,r,i){Y([e,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l="channelsLast"===i.dataFormat,c=Oe(i.filterShape,"float32"),d=i.padInfo.left,h=i.padInfo.top,f=this.bufferSync(e),p=this.bufferSync(r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((h-m)/o)),v=Math.min(i.outHeight,(i.inHeight+h-m)/o),y=0;y<u;++y)for(var b=Math.max(0,Math.ceil((d-y)/s)),_=Math.min(i.outWidth,(i.inWidth+d-y)/s),x=0;x<i.inChannels;++x)for(var w=0;w<i.outChannels;++w){for(var M=0,T=0;T<i.batchSize;++T)for(var S=g;S<v;++S)for(var I=m+S*o-h,N=b;N<_;++N){var O=y+N*s-d;M+=l?f.get(T,I,O,x)*p.get(T,S,N,w):f.get(T,x,I,O)*p.get(T,w,S,N)}c.set(M,m,y,x,w)}return c.toTensor()},t.prototype.conv3dDerFilter=function(e,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,d=Oe(i.filterShape,"float32"),h=d.values,f=d.strides,p=f[0],m=f[1],g=f[2],v=f[3],y=this.readSync(r.dataId),b=r.strides,_=b[0],x=b[1],w=b[2],M=b[3],T=this.readSync(e.dataId),S=e.strides,I=S[0],N=S[1],O=S[2],W=S[3],G=i.padInfo.front,z=i.padInfo.left,P=i.padInfo.top,L=0;L<u;++L)for(var B=Math.max(0,Math.ceil((G-L)/o)),U=Math.min(i.outDepth,(i.inDepth+G-L)/o),q=L*p,J=0;J<l;++J)for(var ne=Math.max(0,Math.ceil((P-J)/s)),he=Math.min(i.outHeight,(i.inHeight+P-J)/s),fe=J*m+q,He=0;He<c;++He)for(var Ee=Math.max(0,Math.ceil((z-He)/a)),je=Math.min(i.outWidth,(i.inWidth+z-He)/a),We=He*g+fe,Le=0;Le<i.inChannels;++Le)for(var It=Le*v+We,Je=0;Je<i.outChannels;++Je){for(var _t=0,ht=0;ht<i.batchSize;++ht)for(var qt=ht*I,Ht=ht*_,Ut=B;Ut<U;++Ut)for(var bo=(L+Ut*o-G)*N+qt,xo=Ut*x+Ht,Ur=ne;Ur<he;++Ur)for(var Jl=(J+Ur*s-P)*O+bo,as=Ur*w+xo,Qs=Ee;Qs<je;++Qs)_t+=T[(He+Qs*a-z)*W+Jl+Le]*y[Qs*M+as+Je];h[It+Je]=_t}return d.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var s=e.bias,a=e.activation,u=e.preluActivationWeights,l=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return s&&(l=this.add(l,s)),a&&(l=m0(this,l,a,u)),l},t.prototype.depthwiseConv2D=function(e,r,i){Y([e,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,d=i.outChannels/i.inChannels,h=Oe(i.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(r.dataId),m=h.values,g=0;g<i.batchSize;++g)for(var v=g*e.strides[0],y=g*h.strides[0],b=0;b<i.outHeight;++b)for(var _=y+b*h.strides[1],x=b*i.strideHeight-l,w=0;w<o;++w){var M=x+w*a;if(!(M<0||M>=i.inHeight))for(var T=w*r.strides[0],S=v+M*e.strides[1],I=0;I<i.outWidth;++I)for(var N=_+I*h.strides[2],O=I*i.strideWidth-c,W=0;W<s;++W){var G=O+W*u;if(!(G<0||G>=i.inWidth))for(var P=S+G*i.inChannels,L=N,B=T+W*r.strides[1],U=0;U<i.inChannels;++U){for(var q=f[P+U],J=0;J<d;++J)m[L+J]+=q*p[B+J];L+=d,B+=d}}}return h.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,r,i){Y([e,r],"depthwiseConv2DDerInput");for(var o=Oe(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],l=a[1],c=a[2],d=this.readSync(e.dataId),h=e.strides,f=h[0],p=h[1],m=h[2],g=this.readSync(r.dataId),v=r.strides,y=v[0],b=v[1],_=v[2],x=i.batchSize,w=i.filterHeight,M=i.filterWidth,T=i.inChannels,S=i.inHeight,I=i.inWidth,O=i.outHeight,W=i.outWidth,G=i.strideHeight,z=i.strideWidth,P=w-1-i.padInfo.top,L=M-1-i.padInfo.left,B=i.outChannels/T,U=0;U<x;++U)for(var q=0;q<T;++q)for(var J=0;J<S;++J)for(var ne=J-P,he=Math.max(0,Math.ceil(ne/G)),fe=Math.min(O,(w+ne)/G),He=0;He<I;++He){for(var Ee=He-L,je=Math.max(0,Math.ceil(Ee/z)),We=Math.min(W,(M+Ee)/z),Le=0,It=he;It<fe;++It)for(var Je=It*G-ne,_t=je;_t<We;++_t)for(var ht=f*U+p*It+m*_t,qt=y*(w-1-Je)+b*(M-1-(_t*z-Ee))+_*q,Ht=0;Ht<B;++Ht)Le+=d[ht+(q*B+Ht)]*g[qt+Ht];s[u*U+l*J+c*He+q]=Le}return o.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,r,i){Y([e,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=Oe(i.filterShape,"float32"),c=i.padInfo.left,d=i.padInfo.top,h=i.outChannels/i.inChannels,f=this.bufferSync(e),p=this.bufferSync(r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((d-m)/o)),v=Math.min(i.outHeight,(i.inHeight+d-m)/o),y=0;y<u;++y)for(var b=Math.max(0,Math.ceil((c-y)/s)),_=Math.min(i.outWidth,(i.inWidth+c-y)/s),x=0;x<i.outChannels;++x){for(var w=Math.trunc(x/h),M=x%h,T=0,S=0;S<i.batchSize;++S)for(var I=g;I<v;++I)for(var N=m+I*o-d,O=b;O<_;++O)T+=f.get(S,N,y+O*s-c,w)*p.get(S,I,O,x);l.set(T,m,y,w,M)}return l.toTensor()},t.prototype.tile=function(e,r){return Y(e,"tile"),wN(this.bufferSync(e),r)},t.prototype.pad=function(e,r,i){Y(e,"pad");var o=r.map(function(h,f){return h[0]+e.shape[f]+h[1]}),s=r.map(function(h){return h[0]}),a=this.bufferSync(e),u=Oe(o,e.dtype);0!==i&&u.values.fill(i);for(var l=0;l<e.size;l++){var c=a.indexToLoc(l),d=c.map(function(h,f){return h+s[f]});u.set.apply(u,[a.get.apply(a,c)].concat(d))}return u.toTensor()},t.prototype.transpose=function(e,r){Y(e,"transpose");for(var i=new Array(e.rank),o=0;o<i.length;o++)i[o]=e.shape[r[o]];var s=this.readSync(e.dataId),a=Oe(i,e.dtype),u=this.bufferSync(e);for(o=0;o<e.size;++o){for(var l=u.indexToLoc(o),c=new Array(l.length),d=0;d<c.length;d++)c[d]=l[r[d]];var h=a.locToIndex(c);a.values[h]=s[o]}return a.toTensor()},t.prototype.gather=function(e,r,i){Y([e,r],"gather");var o=e.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=Oe(o,e.dtype),u=this.bufferSync(e),l=0;l<a.size;++l){var c=a.indexToLoc(l),d=c.slice();d[i]=s[c[i]];var h=u.locToIndex(d);a.values[l]=u.values[h]}return a.toTensor()},t.prototype.batchToSpaceND=function(e,r,i){Y([e],"batchToSpaceND");var o=r.reduce(function(d,h){return d*h}),s=$g(e.shape,r,o),a=qg(s.length,r.length),u=Kg(e.shape,r,o),l=lN(i,r.length),c=cN(u,i,r.length);return e.reshape(s).transpose(a).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(e,r,i){Y([e],"spaceToBatchND");var o=r.reduce(function(h,f){return h*f}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<e.shape.length;++a)s.push([0,0]);var u=e.pad(s),l=$g(u.shape,r,o,!1),c=qg(l.length,r.length,!1),d=Kg(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(d)},t.prototype.pool=function(e,r,i){Y(e,"pool");for(var o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),m=Oe(r.outShape,e.dtype),g=m.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],b=r.outShape[3],_=0;_<r.batchSize;++_)for(var x=_*v,w=_*e.strides[0],M=0;M<r.inChannels;++M)for(var T=0;T<r.outHeight;++T)for(var S=T*o-d,I=Math.max(0,S),N=Math.min(r.inHeight,l+S),O=x+T*y,W=0;W<r.outWidth;++W){for(var G=W*s-h,z=Math.max(0,G),P=Math.min(r.inWidth,c+G),L=f,B=0,U=0,q=I;q<N;q+=a){for(var J=w+q*e.strides[1],ne=z;ne<P;ne+=u){var he=p[J+ne*e.strides[2]+M];"max"===i&&he>L?L=he:"avg"===i&&(B+=he,U++)}if(isNaN(L))break}g[O+W*b+M]="avg"===i?B/U:L}return m.toTensor()},t.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},t.prototype.maxPoolPositions=function(e,r){for(var i=Oe(r.outShape,"int32"),o=r.strideHeight,s=r.strideWidth,a=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,f=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var m=0;m<r.inChannels;++m)for(var g=0;g<r.outHeight;++g){for(var v=g*o-d,y=v;y<0;)y+=a;for(var b=Math.min(r.inHeight,l+v),_=0;_<r.outWidth;++_){for(var x=_*s-h,w=x;w<0;)w+=u;for(var M=Math.min(r.inWidth,c+x),T=Number.NEGATIVE_INFINITY,S=-1,I=y;I<b;I+=a)for(var N=I-v,O=w;O<M;O+=u){var W=O-x,G=f.get(p,I,O,m);G>T&&(T=G,S=N*c+W)}i.set(S,p,g,_,m)}}return i.toTensor()},t.prototype.maxPoolBackprop=function(e,r,i,o){Y([r,i],"maxPoolBackprop");for(var s=this.maxPoolPositions(r,o),a=o.strideHeight,u=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,d=o.effectiveFilterHeight,h=o.effectiveFilterWidth,f=h-1-o.padInfo.left,p=d-1-o.padInfo.top,m=Oe(r.shape,"float32"),g=this.bufferSync(s),v=this.bufferSync(e),y=0;y<o.batchSize;++y)for(var b=0;b<o.inChannels;++b)for(var _=0;_<o.inHeight;++_)for(var x=0;x<o.inWidth;++x){for(var w=_-p,M=x-f,T=0,S=0;S<d;S+=l){var I=(w+S)/a;if(!(I<0||I>=o.outHeight||Math.floor(I)!==I))for(var N=0;N<h;N+=c){var O=(M+N)/u;if(!(O<0||O>=o.outWidth||Math.floor(O)!==O)){var W=d*h-1-g.get(y,I,O,b)===S*h+N?1:0;0!==W&&(T+=v.get(y,I,O,b)*W)}}}m.set(T,y,_,x,b)}return m.toTensor()},t.prototype.avgPoolBackprop=function(e,r,i){Y([e,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,d=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,p=d-1-i.padInfo.top,m=Oe(r.shape,"float32"),g=1/(a*u),v=this.bufferSync(e),y=0;y<i.batchSize;++y)for(var b=0;b<i.inChannels;++b)for(var _=0;_<i.inHeight;++_)for(var x=0;x<i.inWidth;++x){for(var w=_-p,M=x-f,T=0,S=0;S<d;S+=l){var I=(w+S)/o;if(!(I<0||I>=i.outHeight||Math.floor(I)!==I))for(var N=0;N<h;N+=c){var O=(M+N)/s;O<0||O>=i.outWidth||Math.floor(O)!==O||(T+=v.get(y,I,O,b))}}m.set(T*g,y,_,x,b)}return m.toTensor()},t.prototype.pool3d=function(e,r,i){Y(e,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(e.dataId),b=Oe(r.outShape,e.dtype),_=b.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],w=r.outShape[2]*r.outShape[3]*r.outShape[4],M=r.outShape[3]*r.outShape[4],T=r.outShape[4],S=0;S<r.batchSize;++S)for(var I=S*x,N=S*e.strides[0],O=0;O<r.inChannels;++O)for(var W=0;W<r.outDepth;++W){for(var G=W*o-p,z=G;z<0;)z+=u;for(var P=Math.min(r.inDepth,d+G),L=I+W*w,B=0;B<r.outHeight;++B){for(var U=B*s-m,q=U;q<0;)q+=l;for(var J=Math.min(r.inHeight,h+U),ne=L+B*M,he=0;he<r.outWidth;++he){for(var fe=he*a-g,He=fe;He<0;)He+=c;for(var Ee=Math.min(r.inWidth,f+fe),je=ne+he*T,We=v,Le=0,It=0,Je=z;Je<P;Je+=u){for(var _t=N+Je*e.strides[1],ht=q;ht<J;ht+=l){for(var qt=_t+ht*e.strides[2],Ht=He;Ht<Ee;Ht+=c){var Ut=y[qt+Ht*e.strides[3]+O];if("max"===i&&Ut>We?We=Ut:"avg"===i&&(Le+=Ut,It++),isNaN(We))break}if(isNaN(We))break}if(isNaN(We))break}_[je+O]="avg"===i?Le/It:We}}}return b.toTensor()},t.prototype.avgPool3d=function(e,r){return Y(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,r,i){Y([e,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,d=i.dilationDepth,h=i.dilationHeight,f=i.dilationWidth,p=i.effectiveFilterDepth,m=i.effectiveFilterHeight,g=i.effectiveFilterWidth,v=p-1-i.padInfo.front,y=g-1-i.padInfo.left,b=m-1-i.padInfo.top,_=Oe(r.shape,"float32"),x=1/(u*l*c),w=this.bufferSync(e),M=0;M<i.batchSize;++M)for(var T=0;T<i.inChannels;++T)for(var S=0;S<i.inDepth;++S)for(var I=0;I<i.inHeight;++I)for(var N=0;N<i.inWidth;++N){for(var O=S-v,W=I-b,G=N-y,z=0,P=0;P<p;P+=d){var L=(O+P)/o;if(!(L<0||L>=i.outDepth||Math.floor(L)!==L))for(var B=0;B<m;B+=h){var U=(W+B)/s;if(!(U<0||U>=i.outHeight||Math.floor(U)!==U))for(var q=0;q<g;q+=f){var J=(G+q)/a;J<0||J>=i.outWidth||Math.floor(J)!==J||(z+=w.get(M,L,U,J,T))}}}_.set(z*x,M,S,I,N,T)}return _.toTensor()},t.prototype.maxPool3d=function(e,r){return Y(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,r){for(var i=Oe(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.front,m=r.padInfo.top,g=r.padInfo.left,v=this.bufferSync(e),y=0;y<r.batchSize;++y)for(var b=0;b<r.inChannels;++b)for(var _=0;_<r.outDepth;++_){for(var x=_*o-p,w=x;w<0;)w+=u;for(var M=Math.min(r.inDepth,d+x),T=0;T<r.outHeight;++T){for(var S=T*s-m,I=S;I<0;)I+=l;for(var N=Math.min(r.inHeight,h+S),O=0;O<r.outWidth;++O){for(var W=O*a-g,G=W;G<0;)G+=c;for(var z=Math.min(r.inWidth,f+W),P=Number.NEGATIVE_INFINITY,L=-1,B=w;B<M;B+=u)for(var U=B-x,q=I;q<N;q+=l)for(var J=q-S,ne=G;ne<z;ne+=c){var he=ne-W,fe=v.get(y,B,q,ne,b);fe>=P&&(P=fe,L=U*h*f+J*h+he)}i.set(L,y,_,T,O,b)}}}return i.toTensor()},t.prototype.maxPool3dBackprop=function(e,r,i,o){Y([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,f=o.effectiveFilterDepth,p=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=f-1-o.padInfo.front,v=m-1-o.padInfo.left,y=p-1-o.padInfo.top,b=Oe(r.shape,"float32"),_=this.bufferSync(s),x=this.bufferSync(e),w=0;w<o.batchSize;++w)for(var M=0;M<o.inChannels;++M)for(var T=0;T<o.inDepth;++T)for(var S=0;S<o.inHeight;++S)for(var I=0;I<o.inWidth;++I){for(var N=T-g,O=S-y,W=I-v,G=0,z=0;z<f;z+=c){var P=(N+z)/a;if(!(P<0||P>=o.outDepth||Math.floor(P)!==P))for(var L=0;L<p;L+=d){var B=(O+L)/u;if(!(B<0||B>=o.outHeight||Math.floor(B)!==B))for(var U=0;U<m;U+=h){var q=(W+U)/l;if(!(q<0||q>=o.outWidth||Math.floor(q)!==q)){var J=f*p*m-1-_.get(w,P,B,q,M)===z*p*m+L*m+U?1:0;0!==J&&(G+=x.get(w,P,B,q,M)*J)}}}}b.set(G,w,T,S,I,M)}return b.toTensor()},t.prototype.cast=function(e,r){return Bw(e,r,this)},t.prototype.reshape=function(e,r){return tm(e,r)},t.prototype.avgPool=function(e,r){return Y(e,"avgPool"),this.pool(e,r,"avg").toFloat()},t.prototype.resizeBilinear=function(e,r,i,o){Y(e,"resizeBilinear");for(var s=e.shape,a=s[0],u=s[1],l=s[2],c=s[3],d=this.readSync(e.dataId),h=new Float32Array(de([a,r,i,c])),f=[o&&r>1?u-1:u,o&&i>1?l-1:l],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],m=0,g=f[0]/p[0],v=f[1]/p[1],y=0;y<a;y++)for(var b=0;b<r;b++)for(var _=g*b,x=Math.floor(_),w=_-x,M=Math.min(u-1,Math.ceil(_)),T=y*e.strides[0]+x*e.strides[1],S=y*e.strides[0]+M*e.strides[1],I=0;I<i;I++)for(var N=v*I,O=Math.floor(N),W=N-O,G=Math.min(l-1,Math.ceil(N)),z=T+O*e.strides[2],P=S+O*e.strides[2],L=T+G*e.strides[2],B=S+G*e.strides[2],U=0;U<c;U++){var q=d[z+U],J=d[P+U],ne=q+(d[L+U]-q)*W;h[m++]=ne+(J+(d[B+U]-J)*W-ne)*w}return Vn(h,[a,r,i,c])},t.prototype.resizeBilinearBackprop=function(e,r,i){Y([e,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=e.shape,d=c[1],h=c[2],f=new Float32Array(s*a*u*l),p=[i&&d>1?a-1:a,i&&h>1?u-1:u],m=[i&&d>1?d-1:d,i&&h>1?h-1:h],g=p[0]/m[0],v=p[1]/m[1],y=this.readSync(e.dataId),b=0,_=0;_<s;_++)for(var x=_*r.strides[0],w=0;w<d;w++)for(var M=w*g,T=Math.floor(M),S=Math.min(Math.ceil(M),a-1),I=x+T*r.strides[1],N=x+S*r.strides[1],O=M-T,W=1-O,G=0;G<h;G++)for(var z=G*v,P=Math.floor(z),L=Math.min(Math.ceil(z),u-1),B=z-P,U=1-B,q=I+P*r.strides[2],J=I+L*r.strides[2],ne=N+P*r.strides[2],he=N+L*r.strides[2],fe=W*U,He=W*B,Ee=O*U,je=O*B,We=0;We<l;We++){var Le=y[b++];f[q+We]+=Le*fe,f[J+We]+=Le*He,f[ne+We]+=Le*Ee,f[he+We]+=Le*je}return xr(f,[s,u,a,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(e,r,i,o){Y(e,"resizeNearestNeighbor");for(var s=e.shape,a=s[0],u=s[1],l=s[2],c=s[3],d=this.readSync(e.dataId),h=new Float32Array(a*r*i*c),f=[o&&r>1?u-1:u,o&&i>1?l-1:l],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],m=f[0]/p[0],g=f[1]/p[1],v=0,y=0;y<a;y++)for(var b=y*e.strides[0],_=0;_<r;_++)for(var x=m*_,w=b+Math.min(u-1,o?Math.round(x):Math.floor(x))*e.strides[1],M=0;M<i;M++)for(var T=g*M,S=w+Math.min(l-1,o?Math.round(T):Math.floor(T))*e.strides[2],I=0;I<c;I++)h[v++]=d[S+I];return Vn(h,[a,r,i,c],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,r,i){Y([e,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=e.shape,d=c[1],h=c[2],f=new Float32Array(s*a*u*l),p=this.readSync(e.dataId),m=[i&&d>1?a-1:a,i&&h>1?u-1:u],g=[i&&d>1?d-1:d,i&&h>1?h-1:h],v=m[0]/g[0],y=m[1]/g[1],b=1/v,_=1/y,x=2*Math.ceil(b)+2,w=2*Math.ceil(_)+2,M=0;M<s;M++)for(var T=M*r.strides[0],S=0;S<a;S++)for(var I=T+S*r.strides[1],N=Math.floor(S*b),O=Math.floor(N-x/2),W=0;W<u;W++)for(var G=I+W*r.strides[2],z=Math.floor(W*_),P=Math.floor(z-w/2),L=0;L<l;L++){for(var B=0,U=0;U<x;U++){var q=U+O;if(!(q<0||q>=d)){var J=T+q*e.strides[1],ne=q*v;if(S===Math.min(a-1,i?Math.round(ne):Math.floor(ne)))for(var he=0;he<w;he++){var fe=he+P;if(!(fe<0||fe>=h)){var He=J+fe*e.strides[2],Ee=fe*y;W===Math.min(u-1,i?Math.round(Ee):Math.floor(Ee))&&(B+=p[He+L])}}}}f[G+L]=B}return xr(f,r.shape,r.dtype)},t.prototype.batchNormalization=function(e,r,i,o,s,a){Y([e,r,i,s,a],"batchNorm");for(var u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),d=s?this.readSync(s.dataId):new Float32Array([1]),h=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(u.length),p=h.length,m=d.length,g=c.length,v=l.length,y=0,b=0,_=0,x=0,w=0;w<u.length;++w)f[w]=h[y++]+(u[w]-l[b++])*d[_++]/Math.sqrt(c[x++]+o),y>=p&&(y=0),b>=v&&(b=0),_>=m&&(_=0),x>=g&&(x=0);return xr(f,e.shape)},t.prototype.localResponseNormalization4D=function(e,r,i,o,s){Y(e,"localResponseNormalization4D");var a=e.shape[3],u=a-1,l=this.readSync(e.dataId),c=e.size,d=new Float32Array(c);function h(g){for(var v=g%a,y=g-v+Math.max(0,v-r),b=g-v+Math.min(v+r,u),_=0;y<=b;y++){var x=l[y];_+=x*x}return _}for(var f=0;f<c;f++){var p=h(f),m=l[f]*Math.pow(i+o*p,-s);d[f]=m}return xr(d,e.shape)},t.prototype.LRNGrad=function(e,r,i,o,s,a,u){Y(e,"LRNGrad");for(var l=e.shape[3],c=this.readSync(e.dataId),d=this.readSync(r.dataId),h=this.readSync(i.dataId),f=new Float32Array(e.size),p=e.size,m=0;m<p;m++){for(var g=m%l,v=m-g+Math.max(0,g-o),y=m-g+Math.min(l,g+o+1),b=0,_=v;_<y;_++)b+=Math.pow(d[_],2);for(b=a*b+s,_=v;_<y;_++){var x=-2*a*u*d[_]*h[m]/b;m===_&&(x+=Math.pow(b,-u)),f[_]+=x*=c[m]}}return xr(f,e.shape)},t.prototype.multinomial=function(e,r,i,o){Y(e,"multinomial");for(var s=r?e:Xo(e),a=s.shape[0],u=s.shape[1],l=At([a,i],"int32"),c=this.readSync(l.dataId),d=this.readSync(s.dataId),h=0;h<a;++h){var f=h*u,p=new Float32Array(u-1);p[0]=d[f];for(var m=1;m<p.length;++m)p[m]=p[m-1]+d[f+m];for(var g=zg(o.toString()),v=h*i,y=0;y<i;++y){var b=g();c[v+y]=p.length;for(var _=0;_<p.length;_++)if(b<p[_]){c[v+y]=_;break}}}return l},t.prototype.oneHot=function(e,r,i,o){Y(e,"oneHot");var s=new Float32Array(e.size*r);s.fill(o);for(var a=this.readSync(e.dataId),u=0;u<e.size;++u)a[u]>=0&&a[u]<r&&(s[u*r+a[u]]=i);return Hs(s,[e.size,r],"int32")},t.prototype.nonMaxSuppression=function(e,r,i,o,s){return Y(e,"nonMaxSuppression"),Uw(this.readSync(e.dataId),this.readSync(r.dataId),i,o,s)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,r){for(var i=e.shape[0],o=e.shape[1],s=Oe(e.shape,"float32"),a=Oe(e.shape,"float32"),u=si(e).as2D(i,o),l=ho(e).as2D(i,o),c=0;c<i;c++)for(var d=u.slice([c,0],[1,o]),h=l.slice([c,0],[1,o]),f=Bn(d,h),p=this.readSync(this.fftImpl(f,r).dataId),m=0;m<o;m++){var g=yN(p,m);s.values[c*o+m]=g.real,a.values[c*o+m]=g.imag}return Bn(s.toTensor(),a.toTensor()).as2D(i,o)},t.prototype.fftImpl=function(e,r){var i=e.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(e.shape[0],e.shape[1]);return r&&(s=Bn(si(s).div(ee(o)),ho(s).div(ee(o)))),s}var a=this.readSync(e.dataId),u=function(l){for(var c=new Float32Array(l.length/2),d=new Float32Array(l.length/2),h=0;h<l.length;h+=2)c[h/2]=l[h],d[h/2]=l[h+1];return{real:c,imag:d}}(this.fourierTransformByMatmul(a,o,r));return Bn(u.real,u.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,r,i){if(1===r)return e;var o=this.readSync(e.dataId),s=r/2,a=function(v){for(var y=Math.ceil(v.length/4),b=new Float32Array(y),_=new Float32Array(y),x=0;x<v.length;x+=4)b[Math.floor(x/4)]=v[x],_[Math.floor(x/4)]=v[x+1];return{real:b,imag:_}}(o),u=Bn(a.real,a.imag).as1D(),l=function(v){for(var y=Math.floor(v.length/4),b=new Float32Array(y),_=new Float32Array(y),x=2;x<v.length;x+=4)b[Math.floor(x/4)]=v[x],_[Math.floor(x/4)]=v[x+1];return{real:b,imag:_}}(o),c=Bn(l.real,l.imag).as1D();u=this.fftRadix2(u,s,i),c=this.fftRadix2(c,s,i);var d=function(v,y){for(var b=new Float32Array(v/2),_=new Float32Array(v/2),x=0;x<Math.ceil(v/2);x++){var w=(y?2:-2)*Math.PI*(x/v);b[x]=Math.cos(w),_[x]=Math.sin(w)}return{real:b,imag:_}}(r,i),h=Bn(d.real,d.imag).mul(c),f=u.add(h),p=u.sub(h),m=si(f).concat(si(p)),g=ho(f).concat(ho(p));return Bn(m,g).as1D()},t.prototype.fourierTransformByMatmul=function(e,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,u=0,l=0;l<r;l++){var c=Kte(s*l,r,i),d=yN(e,l);a+=d.real*c.real-d.imag*c.imag,u+=d.real*c.imag+d.imag*c.real}i&&(a/=r,u/=r),qte(o,a,u,s)}return o},t.prototype.depthToSpace=function(e,r,i){D("NHWC"===i,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),D(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=e.shape[0],s=e.shape[1],a=e.shape[2],u=e.shape[3],l=s*r,c=a*r,d=u/(r*r),h=this.readSync(e.dataId),f=new Float32Array(o*l*c*d),p=0,m=0;m<o;++m)for(var g=0;g<l;++g)for(var v=Math.floor(g/r),y=g%r,b=0;b<c;++b)for(var _=Math.floor(b/r),x=(y*r+b%r)*d,w=0;w<d;++w)f[p++]=h[w+x+u*(_+a*(v+s*m))];return xr(f,[o,l,c,d])},t.prototype.broadcastedBinaryOp=function(e,r,i,o){var s=$e(e.shape,r.shape),a=Oe(s,i),u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=Qo(e.shape,s),d=Qo(r.shape,s),h=a.values;if(c.length+d.length===0)for(var f=0;f<h.length;++f)h[f]=o(u[f%u.length],l[f%l.length]);else{var p=this.bufferSync(e),m=this.bufferSync(r),g=function(v){var y=a.indexToLoc(v),b=y.slice(-e.rank);c.forEach(function(M){return b[M]=0});var _=p.locToIndex(b),x=y.slice(-r.rank);d.forEach(function(M){return x[M]=0});var w=m.locToIndex(x);h[v]=o(u[_],l[w])};for(f=0;f<h.length;++f)g(f)}return a.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,r,i){var o=$e(e.shape,r.shape),s=Oe(o,"float32"),a=Oe(o,"float32"),u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=Qo(e.shape,o),d=Qo(r.shape,o),h=s.values,f=a.values;if(c.length+d.length===0)for(var p=0;p<h.length;p++){var m=p%u.length,g=p%l.length,v=i(u[2*m],u[2*m+1],l[2*g],l[2*g+1]);h[p]=v.real,f[p]=v.imag}else{var y=this.bufferSync(this.data.get(e.dataId).complexTensors.real),b=this.bufferSync(this.data.get(r.dataId).complexTensors.real),_=function(x){var w=s.indexToLoc(x),M=w.slice(-e.rank);c.forEach(function(O){return M[O]=0});var T=y.locToIndex(M),S=w.slice(-r.rank);d.forEach(function(O){return S[O]=0});var I=b.locToIndex(S),N=i(u[2*T],u[2*T+1],l[2*I],l[2*I+1]);h[x]=N.real,f[x]=N.imag};for(p=0;p<h.length;p++)_(p)}return this.complex(s.toTensor(),a.toTensor())},t.prototype.split=function(e,r,i){return xN(e,r,i)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,r,i,o,s,a){for(var u=e.shape,l=u[0],c=u[1],d=u[2],h=u[3],f=r.shape[0],p=o[0],m=o[1],g=Oe([f,p,m,h],"float32"),v=this.readSync(r.dataId),y=this.readSync(i.dataId),b=this.readSync(e.dataId),_=e.strides,x=g.strides,w=0;w<f;w++){var M=4*w,T=v[M],S=v[M+1],I=v[M+2],N=v[M+3],O=y[w];if(!(O>=l))for(var W=p>1?(I-T)*(c-1)/(p-1):0,G=m>1?(N-S)*(d-1)/(m-1):0,z=0;z<p;z++){var P=p>1?T*(c-1)+z*W:.5*(T+I)*(c-1);if(P<0||P>c-1)for(var L=0;L<m;L++)for(var B=0;B<h;B++){var U=B+L*x[2]+z*x[1]+w*x[0];g.values[U]=a}else if("bilinear"===s){var q=Math.floor(P),J=Math.ceil(P),ne=P-q;for(L=0;L<m;L++)if((Je=m>1?S*(d-1)+L*G:.5*(S+N)*(d-1))<0||Je>d-1)for(B=0;B<h;B++)g.values[U=B+L*x[2]+z*x[1]+w*x[0]]=a;else{var he=Math.floor(Je),fe=Math.ceil(Je),He=Je-he;for(B=0;B<h;B++){var Ee=b[U=B+he*_[2]+q*_[1]+O*_[0]],je=b[U=B+fe*_[2]+q*_[1]+O*_[0]],We=b[U=B+he*_[2]+J*_[1]+O*_[0]],Le=Ee+(je-Ee)*He,It=We+(b[U=B+fe*_[2]+J*_[1]+O*_[0]]-We)*He;g.values[U=B+L*x[2]+z*x[1]+w*x[0]]=Le+(It-Le)*ne}}}else for(L=0;L<m;++L){var Je;if((Je=m>1?S*(d-1)+L*G:.5*(S+N)*(d-1))<0||Je>d-1)for(B=0;B<h;B++)g.values[U=B+L*x[2]+z*x[1]+w*x[0]]=a;else{var _t=Math.round(Je),ht=Math.round(P);for(B=0;B<h;B++)g.values[B+L*x[2]+z*x[1]+w*x[0]]=b[B+_t*_[2]+ht*_[1]+O*_[0]]}}}}return g.toTensor()},t.prototype.sparseToDense=function(e,r,i,o){var s=oh(0,e,i);return this.scatter(e,r,i,s.outputSize,s.sliceSize,s.numUpdates,s.sliceRank,s.strides,o,!1)},t.prototype.gatherND=function(e,r){var i=r.shape,o=i[i.length-1],s=Rw(e,r),a=s[0],u=s[1],l=s[2],c=s[3];if(0===u)return Vn([],a,e.dtype);for(var d=new Yd([u,l],e.dtype),h=this.readSync(r.dataId),f=this.readSync(e.dataId),p=0;p<u;p++){for(var m=[],g=0,v=0;v<o;v++){var y=h[p*o+v];g+=y*c[v],m.push(y)}if(g<0||g>=e.size/l)throw new Error("Invalid indices: "+m+" does not index into "+e.shape);for(var b=0;b<l;b++)d.values[p*l+b]=f[g*l+b]}return d.toTensor().reshape(a)},t.prototype.scatterND=function(e,r,i){var o=oh(0,e,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,d=ee(0);return this.scatter(e,r,i,c,u,a,s,l,d,!0)},t.prototype.fill=function(e,r,i){var o=Gd(i=i||Rl(r),de(e));return o.fill(r),F.makeTensor(o,e,i,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var r=Gd(e.dtype,de(e.shape));return this.makeOutput(r,e.shape,e.dtype)},t.prototype.linspace=function(e,r,i){return Vw(e,r,i)},t.prototype.scatter=function(e,r,i,o,s,a,u,l,c,d){var h=[o/s,s],f=this.readSync(e.dataId),p=this.readSync(r.dataId);if(0===o)return Vn([],i,r.dtype);var m=new Yd(h,r.dtype);m.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<a;g++){for(var v=[],y=0,b=0;b<u;b++){var _=f[g*u+b];v.push(_),y+=_*l[b]}if(y<0||y>=o/s)throw new Error("Invalid indices: "+v+" does not index into "+i);for(var x=0;x<s;x++)d?m.values[y*s+x]+=p[g*s+x]:m.values[y*s+x]=0===r.rank?p[0]:p[g*s+x]}return m.toTensor().reshape(i)},t}(vN);F.registerBackend("cpu",function(){return new Qoe},1);for(var v0=0,QP=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,r=n.attrs,o=t.boxes,s=t.scores,u=r.maxOutputSize,l=r.iouThreshold,c=r.scoreThreshold,d=r.softNmsSigma,h=n.backend;Y(o,"NonMaxSuppressionWithScore");var f=jw(h.data.get(o.dataId).values,h.data.get(s.dataId).values,u,l,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var r=n.inputs.x,i=n.backend;Y(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var u=o[a];s[a]=u*u}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:dh,backendName:"cpu",kernelFunc:function(n){var t=n.inputs,i=t.a,o=t.b,s=n.backend;Y([i,o],dh);var a=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values,l=function(h,f,p,m,g,v){var y=$e(h,f),b=y.length,_=Ri(y),x=Tl(g,de(y)),w=h.length,M=f.length,T=Ri(h),S=Ri(f),I=Qo(h,y),N=Qo(f,y);if(I.length+N.length===0)for(var O=0;O<x.length;++O)x[O]=v(p[O%p.length],m[O%m.length]);else{var W=function(G){var z=b2(G,b,_),P=z.slice(-w);I.forEach(function(q){return P[q]=0});var L=dw(P,w,T),B=z.slice(-M);N.forEach(function(q){return B[q]=0});var U=dw(B,M,S);x[G]=v(p[L],m[U])};for(O=0;O<x.length;++O)W(O)}return[x,y]}(i.shape,o.shape,a,u,i.dtype,function(h,f){var p=h-f;return p*p}),d=l[1];return{dataId:s.write(l[0],d,i.dtype),shape:d,dtype:i.dtype}}}];v0<QP.length;v0++)u2(QP[v0]);for(var jl,Joe=function(n){this.variableNames=["A"];var t=Qn(),e=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+e+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Zoe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Qn(),e=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+e+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},y0=0,JP=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.backend,i=n.inputs.pixels,s="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],d=[c,l],h=[c,l,n.attrs.numChannels];(a||s)&&(null==jl&&(jl=document.createElement("canvas").getContext("2d")),jl.canvas.width=l,jl.canvas.height=c,jl.drawImage(i,0,0,l,c),i=jl.canvas);var f=e.makeTensorInfo(d,"int32");e.texData.get(f.dataId).usage=Nr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(f.dataId),i);var p=j().getBool("WEBGL_PACK")?new Zoe(h):new Joe(h),m=e.runWebGLProgram(p,[f],"int32");return e.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs;jg("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=t.scores,u=r.maxOutputSize,l=r.iouThreshold,c=r.scoreThreshold,d=r.softNmsSigma,h=e,f=jw(h.readSync(t.boxes.dataId),h.readSync(s.dataId),u,l,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var r=n.inputs.x,i=n.backend,o=new Ve(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:dh,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,i=t.a,o=t.b,s=n.backend,a=j().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("return (a - b) * (a - b);",i.shape,o.shape):new $t("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}}];y0<JP.length;y0++)u2(JP[y0]);for(var _0=0,ZP=[{kernelName:"Square",gradFunc:function(n,t){var e=t[0];return{x:function(){return n.mul(e.toFloat().mul(2))}}}},{kernelName:dh,gradFunc:function(n,t){var e=t[0],r=t[1],i=ee(2);return{a:function(){return Jn(n,Jn(i,wn(e,r)))},b:function(){return Jn(n,Jn(i,wn(r,e)))}}}}];_0<ZP.length;_0++)nte(ZP[_0]);var ese=function(){function n(){}return n.prototype.fetch=function(t,e){return fetch(t,e)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},n}();j().get("IS_BROWSER")&&j().setPlatform("browser",new ese);var b0,nse=function(){function n(){this.util=Co(753),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(t,e){return null!=j().global.fetch?j().global.fetch(t,e):(null==b0&&(b0=Co(522)),b0(t,e))},n.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},n.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},n}();j().get("IS_NODE")&&j().setPlatform("node",new nse);var x0={float32:4,int32:4,uint16:2,uint8:1,bool:1};function eL(n,t){for(var e={},r=0,i=function(a){var u=a.name,l=a.dtype,c=a.shape,d=de(c),h=void 0;if("quantization"in a){var f=a.quantization;if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Weight "+a.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=x0[f.dtype],m=n.slice(r,r+d*p),g="uint8"===f.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===l)h=Float32Array.from(g,function(w){return w*f.scale+f.min});else{if("int32"!==l)throw new Error("Unsupported dtype in weight '"+u+"': "+l);h=Int32Array.from(g,function(w){return Math.round(w*f.scale+f.min)})}r+=d*p}else if("string"===l){var v=de(a.shape);h=[];for(var y=0;y<v;y++){var b=new Uint32Array(n.slice(r,r+4))[0];r+=4;var _=new Uint8Array(n.slice(r,r+b));h.push(_),r+=b}}else{var x=x0[l];if(m=n.slice(r,r+d*x),"float32"===l)h=new Float32Array(m);else if("int32"===l)h=new Int32Array(m);else{if("bool"!==l)throw new Error("Unsupported dtype in weight '"+u+"': "+l);h=new Uint8Array(m)}r+=d*x}e[u]=Vn(h,c,l)},o=0,s=t;o<s.length;o++)i(s[o]);return e}function rse(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var t=0,e=[];n.forEach(function(o){if(t+=o.byteLength,e.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(t),i=0;return e.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var w0="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function tL(n){return w0?Buffer.byteLength(n):new Blob([n]).size}function C0(n){var t=0;n.forEach(function(i){t+=i.byteLength});var e=new Uint8Array(t),r=0;return n.forEach(function(i){e.set(new Uint8Array(i),r),r+=i.byteLength}),e.buffer}function nL(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var t=n.split("/");return t[t.length-1]}function gh(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:tL(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:tL(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var Vr=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,e){return n.getHandlers(t,"load",e)},n.getHandlers=function(t,e,r){var i=[];return("load"===e?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var s=o(t,r);null!==s&&i.push(s)}),i},n}(),Wl="://",Ws=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(t,e){D(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(Wl)&&(t=t.slice(0,t.indexOf(Wl))),D(t.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();D(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=e},n.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function vm(n){if(-1===n.indexOf(Wl))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ws.getSchemes().join(","));return{scheme:n.split(Wl)[0],path:n.split(Wl)[1]}}function rL(n,t,e){return void 0===e&&(e=!1),le(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,d;return ce(this,function(h){switch(h.label){case 0:return D(n!==t,function(){return"Old path and new path are the same: '"+n+"'"}),D((r=Vr.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),D(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],D((o=Vr.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),D(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),s=o[0],a=vm(n).scheme,u=vm(n).path,l=a===vm(n).scheme,[4,i.load()];case 1:return c=h.sent(),e&&l?[4,Ws.getManager(a).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,s.save(c)];case 4:return d=h.sent(),!e||l?[3,6]:[4,Ws.getManager(a).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Ja="models_store",Gs="model_info_store";function iL(){if(!j().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function E0(n){var t=n.result;t.createObjectStore(Ja,{keyPath:"modelPath"}),t.createObjectStore(Gs,{keyPath:"modelPath"})}var Gl=function(){function n(t){if(this.indexedDB=iL(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return n.prototype.save=function(t){return le(this,void 0,void 0,function(){return ce(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},n.prototype.load=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return E0(s)},s.onsuccess=function(){var a=s.result;if(null==e){var u=a.transaction(Ja,"readonly"),l=u.objectStore(Ja).get(r.modelPath);l.onsuccess=function(){if(null==l.result)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(m){return a.close(),o(l.error)},u.oncomplete=function(){return a.close()}}else{var c,d=gh(e),h=a.transaction(Gs,"readwrite"),f=h.objectStore(Gs),p=f.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var m=(c=a.transaction(Ja,"readwrite")).objectStore(Ja).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});m.onsuccess=function(){return i({modelArtifactsInfo:d})},m.onerror=function(g){var v=(f=h.objectStore(Gs)).delete(r.modelPath);v.onsuccess=function(){return a.close(),o(m.error)},v.onerror=function(y){return a.close(),o(m.error)}}},p.onerror=function(m){return a.close(),o(p.error)},h.oncomplete=function(){null==c?a.close():c.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},n.URL_SCHEME="indexeddb://",n}(),oL=function(n){return j().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Gl.URL_SCHEME)?(t=n.slice(Gl.URL_SCHEME.length),new Gl(t)):null;var t};Vr.registerSaveRouter(oL),Vr.registerLoadRouter(oL);var ise=function(){function n(){this.indexedDB=iL()}return n.prototype.listModels=function(){return le(this,void 0,void 0,function(){var t=this;return ce(this,function(e){return[2,new Promise(function(r,i){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return E0(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(Gs,"readonly"),u=a.objectStore(Gs).getAll();u.onsuccess=function(){for(var l={},c=0,d=u.result;c<d.length;c++){var h=d[c];l[h.modelPath]=h.modelArtifactsInfo}r(l)},u.onerror=function(l){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},n.prototype.removeModel=function(t){return le(this,void 0,void 0,function(){var e=this;return ce(this,function(r){var i;return t=(i=t).startsWith(Gl.URL_SCHEME)?i.slice(Gl.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=e.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return E0(a)},a.onsuccess=function(){var u,l=a.result,c=l.transaction(Gs,"readwrite"),d=c.objectStore(Gs),h=d.get(t);h.onsuccess=function(){if(null==h.result)return l.close(),s(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var f=d.delete(t),p=function(){var m=(u=l.transaction(Ja,"readwrite")).objectStore(Ja).delete(t);m.onsuccess=function(){return o(h.result.modelArtifactsInfo)},m.onerror=function(g){return s(h.error)}};f.onsuccess=p,f.onerror=function(m){return p(),l.close(),s(h.error)}},h.onerror=function(f){return l.close(),s(h.error)},c.oncomplete=function(){null==u?l.close():u.oncomplete=function(){return l.close()}}},a.onerror=function(u){return s(a.error)}})]})})},n}();if(j().getBool("IS_BROWSER"))try{Ws.registerManager(Gl.URL_SCHEME,new ise)}catch(n){}var es="/",zl="tensorflowjs_models",sL="info",ose="model_topology",sse="weight_specs",ase="weight_data",use="model_metadata";function aL(n){return{info:[zl,n,sL].join(es),topology:[zl,n,ose].join(es),weightSpecs:[zl,n,sse].join(es),weightData:[zl,n,ase].join(es),modelMetadata:[zl,n,use].join(es)}}function lse(n){var t=n.split(es);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(es)}var $l=function(){function n(t){if(!j().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=aL(this.modelPath)}return n.prototype.save=function(t){return le(this,void 0,void 0,function(){var e,r,i;return ce(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),i=gh(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(w0)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),u="",l=0,c=a.length;l<c;l++)u+=String.fromCharCode(a[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch(s){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return le(this,void 0,void 0,function(){var t,e,r,i,o,s,a;return ce(this,function(u){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=i,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(s=JSON.parse(o),e.format=s.format,e.generatedBy=s.generatedBy,e.convertedBy=s.convertedBy,e.userDefinedMetadata=s.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(l){if(w0){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(l),h=new Uint8Array(d.length),f=0;f<d.length;++f)h.set([d.charCodeAt(f)],f);return h.buffer}(a),[2,e]})})},n.URL_SCHEME="localstorage://",n}(),uL=function(n){return j().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith($l.URL_SCHEME)?(t=n.slice($l.URL_SCHEME.length),new $l(t)):null;var t};Vr.registerSaveRouter(uL),Vr.registerLoadRouter(uL);var cse=function(){function n(){D(j().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),D("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return le(this,void 0,void 0,function(){var t,e,r,i,o,s;return ce(this,function(a){for(t={},e=zl+es,r=es+sL,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(e)&&o.endsWith(r)&&(s=lse(o),t[s]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},n.prototype.removeModel=function(t){return le(this,void 0,void 0,function(){var e,r;return ce(this,function(i){var o;if(t=(o=t).startsWith($l.URL_SCHEME)?o.slice($l.URL_SCHEME.length):o,e=aL(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},n}();if(j().getBool("IS_BROWSER"))try{Ws.registerManager($l.URL_SCHEME,new cse)}catch(n){}function lL(n){return new Promise(function(t){return setTimeout(t)}).then(n)}var D0=function(){function n(t){if(!j().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return n.prototype.save=function(t){return le(this,void 0,void 0,function(){var e,o,s,a;return ce(this,function(u){switch(u.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return o=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(s=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,lL(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==t.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,[4,lL(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:gh(t)}]}})})},n.URL_SCHEME="downloads://",n}(),pse=function(){function n(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return n.prototype.load=function(){return le(this,void 0,void 0,function(){var t,e,r=this;return ce(this,function(i){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(null!=c){0===e.length&&o({modelTopology:c});var d=l.weightsManifest;if(null!=d){var h;try{h=r.checkManifestAndWeightFiles(d,e)}catch(g){return void s(g)}var f=[],p=[],m=[];d.forEach(function(g){g.paths.forEach(function(v){p.push(v),m.push(null)}),f.push.apply(f,g.weights)}),d.forEach(function(g){g.paths.forEach(function(v){var y=new FileReader;y.onload=function(b){var _=b.target.result,x=p.indexOf(v);m[x]=_,-1===m.indexOf(null)&&o({modelTopology:c,weightSpecs:f,weightData:C0(m),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},y.onerror=function(b){return s("Failed to weights data from file of path '"+v+"'.")},y.readAsArrayBuffer(h[v])})})}else s(new Error("weightManifest field is missing from file "+t.name))}else s(new Error("modelTopology field is missing from file "+t.name))},a.onerror=function(u){return s("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(t)})]})})},n.prototype.checkManifestAndWeightFiles=function(t,e){for(var r=[],i=e.map(function(u){return nL(u.name)}),o={},s=0,a=t;s<a.length;s++)a[s].paths.forEach(function(u){var l=nL(u);if(-1!==r.indexOf(l))throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),-1===i.indexOf(l))throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=e[i.indexOf(l)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return o},n}();function cL(n,t,e,r){var o;D(null!=(o=n)&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"}),function(o,s){D(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),D(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),D(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(e=null==e?0:e,r=null==r?1:r);var i=0;return Promise.all(n.map(function(o){return o.then(function(s){var a=e+ ++i/n.length*(r-e);return t(a),s}),o}))}function dL(n,t){return le(this,void 0,void 0,function(){var e,r,i,o,s,a,u,l,c;return ce(this,function(d){switch(d.label){case 0:return null==t&&(t={}),e=null==t.fetchFunc?j().platform.fetch:t.fetchFunc,r=n.map(function(h){return e(h,t.requestInit,{isBinary:!0})}),i=0,o=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,cL(r,t.onProgress,i,o)];case 3:s=d.sent(),d.label=4;case 4:return a=s.map(function(h){return h.arrayBuffer()}),u=.5,l=1,null!=t.onProgress?[3,6]:[4,Promise.all(a)];case 5:return c=d.sent(),[3,8];case 6:return[4,cL(a,t.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function hL(n){var t=this;return function(e,r,i){return void 0===r&&(r=""),le(t,void 0,void 0,function(){var o,s,a,u,l,c,d,h,f,p;return ce(this,function(m){switch(m.label){case 0:if(o=e.map(function(){return!1}),s={},a=null!=i?i.map(function(){return!1}):[],u=[],e.forEach(function(g,v){var y=0;g.weights.forEach(function(b){var x=x0["quantization"in b?b.quantization.dtype:b.dtype]*de(b.shape),w=function(){o[v]=!0,null==s[v]&&(s[v]=[]),s[v].push({manifestEntry:b,groupOffset:y,sizeBytes:x})};null!=i?i.forEach(function(M,T){M===b.name&&(w(),a[T]=!0)}):w(),u.push(b.name),y+=x})}),!a.every(function(g){return g}))throw l=i.filter(function(g,v){return!a[v]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return c=o.reduce(function(g,v,y){return v&&g.push(y),g},[]),d=[],c.forEach(function(g){e[g].paths.forEach(function(v){var y=r+(r.endsWith("/")?"":"/")+v;d.push(y)})}),[4,n(d)];case 1:return h=m.sent(),f={},p=0,c.forEach(function(g){for(var v=e[g].paths.length,y=0,b=0;b<v;b++)y+=h[p+b].byteLength;for(var _=new ArrayBuffer(y),x=new Uint8Array(_),w=0,M=0;M<v;M++){var T=new Uint8Array(h[p+M]);x.set(T,w),w+=T.byteLength}s[g].forEach(function(S){var I=eL(_.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var N in I)f[N]=I[N]}),p+=v}),[2,f]}})})}}Vr.registerSaveRouter(function(n){return j().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(D0.URL_SCHEME)?(void 0===(t=n.slice(D0.URL_SCHEME.length))&&(t="model"),new D0(t)):null;var t});var fL=function(){function n(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(D("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=j().platform.fetch,D(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&D(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return n.prototype.save=function(t){return le(this,void 0,void 0,function(){var e,o;return ce(this,function(s){switch(s.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:gh(t),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return le(this,void 0,void 0,function(){var t,e,r,i,o,s,a,u,l,c,d,h;return ce(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,t.json()];case 3:return e=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=e.weightsManifest,s=e.generatedBy,a=e.convertedBy,u=e.format,l=e.userDefinedMetadata,null==(i=e.modelTopology)&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:h=f.sent(),c=h[0],d=h[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:d,userDefinedMetadata:l,generatedBy:s,convertedBy:a,format:u}]}})})},n.prototype.loadWeights=function(t){return le(this,void 0,void 0,function(){var r,i,o,s,a,u,l,d,h;return ce(this,function(f){switch(f.label){case 0:for(void 0,void 0,m=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),g=p.lastIndexOf("?"),r=[p.substring(0,m)+"/",g>m?p.substring(g):""],i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,l=t;u<l.length;u++)a.push.apply(a,l[u].weights);return d=[],t.forEach(function(p){p.paths.forEach(function(m){d.push(s+m+o)})}),[4,dL(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=f.sent(),[2,[a,C0(h)]]}var p,m,g})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function S0(n){return null!=n.match(fL.URL_SCHEME_REGEX)}var pL=function(n,t){return"undefined"==typeof fetch?null:(Array.isArray(n)?n.every(function(e){return S0(e)}):S0(n))?A0(n,{onProgress:t}):null};function A0(n,t){return new fL(n,t)}Vr.registerSaveRouter(pL),Vr.registerLoadRouter(pL);var ql,M0=function(){function n(t){this.modelArtifacts=t}return n.prototype.load=function(){return le(this,void 0,void 0,function(){return ce(this,function(t){return[2,this.modelArtifacts]})})},n}(),gse=function(){function n(t){this.saveHandler=t}return n.prototype.save=function(t){return le(this,void 0,void 0,function(){return ce(this,function(e){return[2,this.saveHandler(t)]})})},n}(),gL=Object.freeze({browserFiles:function(n){return new pse(n)},browserHTTPRequest:function(n,t){return A0(n,t)},concatenateArrayBuffers:C0,decodeWeights:eL,encodeWeights:function(n,t){return le(this,void 0,void 0,function(){var e,r,i,o,s,a=this;return ce(this,function(u){switch(u.label){case 0:for(e=[],r=[],i=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),o=function(l){var c=i[l],d=Array.isArray(n)?n[l].tensor:n[c];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var h={name:c,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var f=new Promise(function(p){return le(a,void 0,void 0,function(){var m,g,v,y,b,_,x;return ce(this,function(w){switch(w.label){case 0:return[4,d.bytes()];case 1:for(m=w.sent(),g=m.reduce(function(M,T){return M+T.length},0)+4*m.length,v=new Uint8Array(g),y=0,b=0;b<m.length;b++)_=m[b],x=new Uint8Array(new Uint32Array([_.length]).buffer),v.set(x,y),v.set(_,y+=4),y+=_.length;return p(v),[2]}})})});r.push(f)}else r.push(d.data());null!=t&&(h.group=t),e.push(h)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:rse(u.sent()),specs:e}]}})})},fromMemory:function(n,t,e,r){return 1===arguments.length?null!=n.modelTopology||null!=n.weightSpecs?new M0(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new M0({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new M0({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))},getLoadHandlers:function(n,t){return Vr.getLoadHandlers(n,t)},getModelArtifactsInfoForJSON:gh,getSaveHandlers:function(n){return Vr.getSaveHandlers(n)},http:A0,isHTTPScheme:S0,loadWeights:function(n,t,e,r){return void 0===t&&(t=""),le(this,void 0,void 0,function(){return ce(this,function(i){return[2,hL(function(o){return dL(o,{requestInit:r})})(n,t,e)]})})},registerLoadRouter:function(n){return Vr.registerLoadRouter(n)},registerSaveRouter:function(n){return Vr.registerSaveRouter(n)},weightsLoaderFactory:hL,withSaveHandler:function(n){return new gse(n)},copyModel:function(n,t){return le(this,void 0,void 0,function(){return ce(this,function(e){return[2,rL(n,t,!1)]})})},listModels:function(){return le(this,void 0,void 0,function(){var n,t,e,r,i,o,s;return ce(this,function(a){switch(a.label){case 0:n=Ws.getSchemes(),t={},e=0,r=n,a.label=1;case 1:return e<r.length?[4,Ws.getManager(i=r[e]).listModels()]:[3,4];case 2:for(s in o=a.sent())t[i+Wl+s]=o[s];a.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(n,t){return le(this,void 0,void 0,function(){return ce(this,function(e){return[2,rL(n,t,!0)]})})},removeModel:function(n){return le(this,void 0,void 0,function(){var t;return ce(this,function(e){return t=vm(n),[2,Ws.getManager(t.scheme).removeModel(t.path)]})})}}),mse=k({confusionMatrix_:function(n,t,e){var r=E(n,"labels","confusionMatrix"),i=E(t,"predictions","confusionMatrix");D(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),D(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),D(1===i.rank,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),D(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),D(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var o=Tw(r.asType("int32"),e),s=Tw(i.asType("int32"),e);return o.transpose().matMul(s).asType("int32")}}),vse=(Object.freeze({confusionMatrix:mse}),k({fromPixels_:function(n,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==n)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)e=!0;else if("undefined"!=typeof ImageData&&n instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement)o=!0;else{if(null==n.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=s2("FromPixels",F.backendName))return F.runKernel("FromPixels",{pixels:n},{numChannels:t});var a,u,l=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],d=l[1];if(s?a=n.getContext("2d").getImageData(0,0,c,d).data:r||e?a=n.data:(o||i)&&(null==ql&&(ql=document.createElement("canvas").getContext("2d")),ql.canvas.width=c,ql.canvas.height=d,ql.drawImage(n,0,0,c,d),a=ql.getImageData(0,0,c,d).data),4===t)u=new Int32Array(a);else{var h=c*d;u=new Int32Array(h*t);for(var f=0;f<h;f++)for(var p=0;p<t;++p)u[f*t+p]=a[4*f+p]}return Aw(u,[d,c,t],"int32")}})),I0=Object.freeze({toPixels:function(n,t){return le(this,void 0,void 0,function(){var e,r,i,o,s,a,u,l,c,f,p,m,g,v,y,b,_,x,w,M,T;return ce(this,function(S){switch(S.label){case 0:if(e=E(n,"img","toPixels"),n instanceof Ct||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),i=r[0],o=r[1],(s=2===e.rank?1:e.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,e.data()];case 1:return a=S.sent(),u=e.min(),l=e.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=S.sent(),f=c[0][0],p=c[1][0],u.dispose(),l.dispose(),"float32"===e.dtype){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m="float32"===e.dtype?255:1,g=new Uint8ClampedArray(o*i*4),v=0;v<i*o;++v)y=void 0,b=void 0,_=void 0,x=void 0,1===s?(y=a[v]*m,b=a[v]*m,_=a[v]*m,x=255):3===s?(y=a[3*v]*m,b=a[3*v+1]*m,_=a[3*v+2]*m,x=255):4===s&&(y=a[4*v]*m,b=a[4*v+1]*m,_=a[4*v+2]*m,x=a[4*v+3]*m),g[0+(w=4*v)]=Math.round(y),g[w+1]=Math.round(b),g[w+2]=Math.round(_),g[w+3]=Math.round(x);return null!=t&&(t.width=o,t.height=i,M=t.getContext("2d"),T=new ImageData(g,o,i),M.putImageData(T,0,0)),e!==n&&e.dispose(),[2,g]}})})},fromPixels:vse}),mL=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(t,e){return new t(e)},n}(),vL=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function zs(n){D(null!=n.className,function(){return"Class being registered does not have the static className property defined."}),D("string"==typeof n.className,function(){return"className is required to be a string, but got type "+typeof n.className}),D(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),vL.register(n)}function T0(){return 32===F.backend.floatPrecision()?.001:.1}function R0(n,t,e){var r=!0;if((Pn(n)||Pn(t))&&(r=!1),Pn(n)&&Pn(t)&&(r=!0),r){var i=n.constructor.name,o=t.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(n)&&Array.isArray(t)){var s=co(n),a=co(t);if(!dn(s,a))throw new Error("Arrays have different shapes. Actual: ["+s+"]. Expected: ["+a+"]")}var u=Pn(n)?n:qo(n),l=Pn(t)?t:qo(t);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+l.length+".\nActual:   "+u+".\nExpected: "+l+".");for(var c=0;c<l.length;++c){var d=u[c],h=l[c];if(!e(d,h))throw new Error("Arrays differ: actual["+c+"] = "+d+", expected["+c+"] = "+h+".\nActual:   "+u+".\nExpected: "+l+".")}}function F0(n,t,e){return!isFinite(n)&&!isFinite(t)||!(isNaN(n)||isNaN(t)||Math.abs(n-t)>e)}Object.freeze({Serializable:mL,SerializationMap:vL,registerClass:zs}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(n,t,e){return null==e&&(e=T0()),R0(n,t,function(r,i){return F0(r,i,e)})},testEpsilon:T0,expectPromiseToFail:function(n,t){n().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(n,t){var e="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Ls(n)||Ls(n[0])||Ls(t)||Ls(t[0])?R0(n,e,function(r,i){return r==i}):R0(n,t,function(r,i){return F0(r,i,0)})},expectNumbersClose:function(n,t,e){if(null==e&&(e=T0()),!F0(n,t,e))throw new Error("Numbers differ: actual === "+n+", expected === "+t)},expectValuesInRange:function(n,t,e){for(var r=0;r<n.length;r++)if(n[r]<t||n[r]>e)throw new Error("Value out of range:"+n[r]+" low: "+t+", high: "+e)},expectArrayBuffersEqual:function(n,t){expect(new Float32Array(n)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:Une,webgl_util:dte,forceHalfFloat:function(){j().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:gP,setWebGLContext:M2,GPGPUContext:JN});var Za=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Ti(t,n),t.prototype.minimize=function(e,r,i){void 0===r&&(r=!1);var o=this.computeGradients(e,i),s=o.value,a=o.grads;if(null!=i){var u=i.map(function(l){return{name:l.name,tensor:a[l.name]}});this.applyGradients(u)}else this.applyGradients(a);return _r(a),r?s:(s.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,r){return function(n,t){D(Bs(n),function(){return"The f passed in variableGrads(f) must be a function"}),D(null==t||Array.isArray(t)&&t.every(function(c){return c instanceof kl}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=t;if(!e)for(var r in t=[],F.registeredVariables)t.push(F.registeredVariables[r]);var i=e?t.filter(function(c){return!c.trainable}):null,o=t.length;D((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=F.gradients(n,t,null,!0),a=s.value,u=s.grads;D(u.some(function(c){return null!=c}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),D(0===a.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var l={};return t.forEach(function(c,d){null!=u[d]&&(l[c.name]=u[d])}),null!=i&&i.forEach(function(c){return l[c.name]=null}),{value:a,grads:l}}(e,r)},t.prototype.dispose=function(){null!=this.iterations_&&_r(this.iterations_)},t.prototype.saveIterations=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:ee(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){return ce(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,e.slice(1)]}})})},t}(mL);Object.defineProperty(Za,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var _L=function(n){function t(e,r,i){void 0===i&&(i=null);var o=n.call(this)||this;return o.learningRate=e,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==i&&(o.epsilon=F.backend.epsilon()),o}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=F.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:oe(function(){return rt(s).variable(!1)})}),null==r.accumulatedUpdates[o]&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:oe(function(){return rt(s).variable(!1)})});var a=Array.isArray(e)?e[o].tensor:e[i];if(null!=a){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;oe(function(){var c=u.mul(r.rho).add(a.square().mul(1-r.rho)),d=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),h=l.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(c),l.assign(h);var f=d.mul(-r.learningRate).add(s);s.assign(f)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(_r(this.accumulatedGrads.map(function(e){return e.variable})),_r(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){var e;return ce(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),this.accumulatedGrads=e.slice(0,r=e.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(Za);zs(_L);var bL=function(n){function t(e,r){void 0===r&&(r=.1);var i=n.call(this)||this;return i.learningRate=e,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=F.registeredVariables[i];null==r.accumulatedGrads[o]&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:oe(function(){return fo(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(e)?e[o].tensor:e[i];if(null!=a){var u=r.accumulatedGrads[o].variable;oe(function(){var l=u.add(a.square());u.assign(l);var c=a.div(l.add(F.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&_r(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(Za);zs(bL);var xL=function(n){function t(e,r,i,o){void 0===o&&(o=null);var s=n.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],oe(function(){s.accBeta1=ee(r).variable(),s.accBeta2=ee(i).variable()}),null==o&&(s.epsilon=F.backend.epsilon()),s}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this,i=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);oe(function(){var o=wn(1,r.accBeta1),s=wn(1,r.accBeta2);i.forEach(function(a,u){var l=F.registeredVariables[a];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:oe(function(){return rt(l).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:oe(function(){return rt(l).variable(!1)})});var c=Array.isArray(e)?e[u].tensor:e[a];if(null!=c){var d=r.accumulatedFirstMoment[u].variable,h=r.accumulatedSecondMoment[u].variable,f=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=h.mul(r.beta2).add(c.square().mul(1-r.beta2)),m=f.div(o),g=p.div(s);d.assign(f),h.assign(p);var v=m.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(v)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&_r(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&_r(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){var e;return ce(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){var r,i=this;return ce(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),oe(function(){i.accBeta1.assign(cm(i.beta1,i.iterations_+1)),i.accBeta2.assign(cm(i.beta2,i.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,r=e.length/2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(Za);zs(xL);var wL=function(n){function t(e,r,i,o,s){void 0===o&&(o=null),void 0===s&&(s=0);var a=n.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],oe(function(){a.iteration=ee(0).variable(),a.accBeta1=ee(r).variable()}),null==o&&(a.epsilon=F.backend.epsilon()),a}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this,i=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);oe(function(){var o=wn(1,r.accBeta1),s=Li(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var l=F.registeredVariables[a];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:rt(l).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:rt(l).variable(!1)});var c=Array.isArray(e)?e[u].tensor:e[a];if(null!=c){var d=r.accumulatedFirstMoment[u].variable,h=r.accumulatedWeightedInfNorm[u].variable,f=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=h.mul(r.beta2),m=c.abs(),g=p.maximum(m);d.assign(f),h.assign(g);var v=s.div(o).mul(f.div(g.add(r.epsilon))).add(l);l.assign(v)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&_r(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&_r(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){return ce(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(Za);zs(wL);var k0=function(n){function t(e){var r=n.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=Array.isArray(e)?e[o].tensor:e[i];if(null!=s){var a=F.registeredVariables[i];oe(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(n){return F.keep(n)}(ee(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,r){return new e(r.learningRate)},t.className="SGD",t}(Za);zs(k0);var CL=function(n){function t(e,r,i){void 0===i&&(i=!1);var o=n.call(this,e)||this;return o.learningRate=e,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=ee(o.momentum),o}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=F.registeredVariables[i];null==r.accumulations[o]&&(r.accumulations[o]={originalName:i+"/momentum",variable:oe(function(){return rt(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(e)?e[o].tensor:e[i];null!=u&&oe(function(){var l,c=r.m.mul(a).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(s):r.c.mul(c).add(s),a.assign(c),s.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&_r(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){return ce(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){return ce(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(k0);zs(CL);var EL=function(n){function t(e,r,i,o,s){void 0===r&&(r=.9),void 0===i&&(i=0),void 0===o&&(o=null),void 0===s&&(s=!1);var a=n.call(this)||this;if(a.learningRate=e,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,null==o&&(a.epsilon=F.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return Ti(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e)).forEach(function(i,o){var s=F.registeredVariables[i];null==r.accumulatedMeanSquares[o]&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:oe(function(){return rt(s).variable(!1)})}),null==r.accumulatedMoments[o]&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:oe(function(){return rt(s).variable(!1)})}),null==r.accumulatedMeanGrads[o]&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:oe(function(){return rt(s).variable(!1)})});var a=Array.isArray(e)?e[o].tensor:e[i];if(null!=a){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;oe(function(){var c=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,h=d.mul(r.decay).add(a.mul(1-r.decay)),f=l.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(h.square().add(r.epsilon)).sqrt()));u.assign(c),d.assign(h),l.assign(f);var p=s.sub(f);s.assign(p)}else{var m=u.mul(r.decay).add(a.square().mul(1-r.decay));f=l.mul(r.momentum).add(a.mul(r.learningRate).div(m.add(r.epsilon).sqrt())),u.assign(m),l.assign(f),p=s.sub(f),s.assign(p)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&_r(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&_r(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&_r(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return le(this,void 0,void 0,function(){var e;return ce(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},t.prototype.setWeights=function(e){return le(this,void 0,void 0,function(){var r;return ce(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),this.accumulatedMeanSquares=e.slice(0,r=this.centered?e.length/3:e.length/2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(Za);zs(EL),function(){function n(){}n.sgd=function(t){return new k0(t)},n.momentum=function(t,e,r){return void 0===r&&(r=!1),new CL(t,e,r)},n.rmsprop=function(t,e,r,i,o){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1),new EL(t,e,r,i,o)},n.adam=function(t,e,r,i){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===i&&(i=null),new xL(t,e,r,i)},n.adadelta=function(t,e,r){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new _L(t,e,r)},n.adamax=function(t,e,r,i,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===i&&(i=null),void 0===o&&(o=0),new wL(t,e,r,i,o)},n.adagrad=function(t,e){return void 0===e&&(e=.1),new bL(t,e)}}(),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,Ct.prototype.squaredDifference=function(n){return mP(this,n)},H=Xoe;var O0=function(n,t){return(O0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])})(n,t)};function Fe(n,t){function e(){this.constructor=n}O0(n,t),n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}var er=function(){return er=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},er.apply(this,arguments)};function pe(n,t,e,r){return new(e||(e=Promise))(function(o,s){function a(c){try{l(r.next(c))}catch(d){s(d)}}function u(c){try{l(r.throw(c))}catch(d){s(d)}}function l(c){c.done?o(c.value):function(o){return o instanceof e?o:new e(function(s){s(o)})}(c.value).then(a,u)}l((r=r.apply(n,t||[])).next())})}function ge(n,t){var r,i,o,s,e={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,i&&(o=2&l[0]?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,i=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(!(o=(o=e.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){e=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){e.label=l[1];break}if(6===l[0]&&e.label<o[1]){e.label=o[1],o=l;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(l);break}o[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(c){l=[6,c],i=0}finally{r=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}}function mh(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),i=0;for(t=0;t<e;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var Kl=function(){function n(t,e){if(!tu(t)||!tu(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function vh(n,t){return n instanceof Ct&&n.shape.length===t}function _m(n){return vh(n,3)}function $s(n){return vh(n,4)}function SL(n){return n%2==0}function AL(n){return n&&n.width&&n.height}function N0(n){return n.reduce(function(t,e){return t.add(e)},new dt(0,0)).div(new dt(n.length,n.length))}function yh(n,t,e){return Array(n).fill(0).map(function(r,i){return t+i*e})}function tu(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||0===n}function ML(n){return tu(n)&&0<=n&&n<=1}var dt=function(){function n(t,e){this._x=t,this._y=e}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.sub=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.mul=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.div=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),ts=function(){function n(t,e){void 0===e&&(e=!0);var r=t||{},i=[r.left,r.top,r.right,r.bottom].every(tu),o=[r.x,r.y,r.width,r.height].every(tu);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],u=s[1],l=s[2],c=s[3];n.assertIsValidBox({x:a,y:u,width:l,height:c},"Box.constructor",e),this._x=a,this._y=u,this._width=l,this._height=c}return n.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(tu)},n.assertIsValidBox=function(t,e,r){if(void 0===r&&(r=!1),!n.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new dt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new dt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new dt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new dt(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)});return new n({x:t[0],y:t[1],width:t[2],height:t[3]})},n.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)});return new n({x:t[0],y:t[1],width:t[2],height:t[3]})},n.prototype.toSquare=function(){var t=this,e=t.x,r=t.y,i=t.width,o=t.height,s=Math.abs(i-o);return i<o&&(e-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new n({x:e,y:r,width:i,height:o})},n.prototype.rescale=function(t){var e=AL(t)?t.width:t,r=AL(t)?t.height:t;return new n({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},n.prototype.pad=function(t,e){var r=[this.x-t/2,this.y-e/2,this.width+t,this.height+e];return new n({x:r[0],y:r[1],width:r[2],height:r[3]})},n.prototype.clipAtImageBorders=function(t,e){var r=this,o=r.y,s=r.right,a=r.bottom,u=Math.max(r.x,0),l=Math.max(o,0),d=a-l;return new n({x:u,y:l,width:Math.min(s-u,t-u),height:Math.min(d,e-l)}).floor()},n.prototype.shift=function(t,e){return new n({x:this.x+t,y:this.y+e,width:this.width,height:this.height})},n.prototype.padAtBorders=function(t,e){var r=this.width+1,i=this.height+1,a=r,u=i,l=this.left,c=this.top,d=this.right,h=this.bottom;return d>e&&(a=-d+e+r,d=e),h>t&&(u=-h+t+i,h=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:1,edy:u,dx:1,edx:a,y:c,ey:h,x:l,ex:d,w:r,h:i}},n.prototype.calibrate=function(t){return new n({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},n}(),bm=function(n){function t(e,r,i,o,s){return void 0===s&&(s=!1),n.call(this,{left:e,top:r,right:i,bottom:o},s)||this}return Fe(t,n),t}(ts),IL=function(){function n(t,e,r,i,o){this._imageDims=new Kl(o.width,o.height),this._score=t,this._classScore=e,this._className=r,this._box=new ts(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new ts(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},n}(),go=function(n){function t(e,r,i){return n.call(this,e,e,"",r,i)||this}return Fe(t,n),t.prototype.forSize=function(e,r){var i=n.prototype.forSize.call(this,e,r);return new t(i.score,i.relativeBox,i.imageDims)},t}(IL);function Sse(n,t,e){void 0===e&&(e=!0);var o=Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))*Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top));return e?o/(n.area+t.area-o):o/Math.min(n.area,t.area)}function _h(n,t,e,r){void 0===r&&(r=!0);for(var i=t.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var u=i,l=[],c=0;c<u.length;c++)l.push(Sse(n[a],n[u[c]],r));i=i.filter(function(p,m){return l[m]<=e})};i.length>0;)s();return o}function bh(n,t){return oe(function(){var e=t[0],r=t[1],i=t[2],o=fo(mh(n.shape.slice(0,3),[1]),e),s=fo(mh(n.shape.slice(0,3),[1]),r),a=fo(mh(n.shape.slice(0,3),[1]),i),u=bn([o,s,a],3);return wn(n,u)})}function P0(n){return 1/(1+Math.exp(-n))}var Cn,L0=function(n){function t(e,r,i,o,s){return void 0===s&&(s=!1),n.call(this,{x:e,y:r,width:i,height:o},s)||this}return Fe(t,n),t}(ts),xm=function(){function n(t,e,r){void 0===r&&(r=new dt(0,0));var i=e.width,o=e.height;this._imgDims=new Kl(i,o),this._shift=r,this._positions=t.map(function(s){return s.mul(new dt(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new dt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new dt(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},n.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new dt(t,e))},n.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},n.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var r=t instanceof go?t.box.floor():new ts(t);return this.shiftBy(r.x,r.y).align(null,e)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),s=i.minBoxPadding;return i.useDlibAlignment?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),r=t[1],i=t[2],o=function(d){return i.sub(d).magnitude()},s=(o(t[0])+o(r))/2,a=Math.floor(s/.45),u=N0(t),l=Math.floor(Math.max(0,u.x-.5*a)),c=Math.floor(Math.max(0,u.y-.43*a));return new L0(l,c,Math.min(a,this.imageWidth+l),Math.min(a,this.imageHeight+c))},n.prototype.alignMinBbox=function(t){var e=function(n){var t=n.map(function(a){return a.x}),e=n.map(function(a){return a.y}),r=t.reduce(function(a,u){return u<a?u:a},1/0),i=e.reduce(function(a,u){return u<a?u:a},1/0),o=t.reduce(function(a,u){return a<u?u:a},0),s=e.reduce(function(a,u){return a<u?u:a},0);return new bm(r,i,o,s)}(this.positions);return e.pad(e.width*t,e.height*t)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),Rse=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],N0([e[3],e[4]])]},t}(xm),TL=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(N0)},t}(xm),RL=function(){function n(t,e){this._label=t,this._distance=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+function(n,t){void 0===t&&(t=2);var e=Math.pow(10,t);return Math.floor(n*e)/e}(this.distance)+")":"")},n}(),FL=function(n){function t(e,r){var i=n.call(this,e)||this;return i._label=r,i}return Fe(t,n),t.assertIsValidLabeledBox=function(e,r){if(ts.assertIsValidBox(e,r),!tu(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(ts),wm=function(){function n(t,e){if("string"!=typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},n.fromJSON=function(t){var e=t.descriptors.map(function(r){return new Float32Array(r)});return new n(t.label,e)},n}();function B0(n,t){return Object.assign({},n,{detection:t})}function kL(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function OL(n){var t="";if(!n)try{n=Co(Object(function(){var i=new Error("Cannot find module 'fs'");throw i.code="MODULE_NOT_FOUND",i}()))}catch(r){t=r.toString()}return{readFile:n?function(r){return new Promise(function(i,o){n.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function NL(){var n=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=OL();return er({Canvas:n||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:i},o)}function PL(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function LL(){return"object"==typeof global&&"undefined"!=typeof process&&!!process.version}function V0(n){Cn=n}function H0(){PL()&&V0(kL()),LL()&&V0(NL())}!function(n){function t(e,r,i,o){var s=n.call(this,e,r)||this;return s._score=i,s._classScore=o,s}Fe(t,n),t.assertIsValidPredictedBox=function(e,r){if(FL.assertIsValidLabeledBox(e,r),!ML(e.score)||!ML(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(FL);var tr={getEnv:function(){if(!Cn)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Cn},setEnv:V0,initialize:H0,createBrowserEnv:kL,createFileSystem:OL,createNodejsEnv:NL,monkeyPatch:function(n){if(Cn||H0(),!Cn)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=n.Canvas,e=void 0===t?Cn.Canvas:t,r=n.Image,i=void 0===r?Cn.Image:r;Cn.Canvas=e,Cn.Image=i,Cn.createCanvasElement=n.createCanvasElement||function(){return new e},Cn.createImageElement=n.createImageElement||function(){return new i},Cn.ImageData=n.ImageData||Cn.ImageData,Cn.Video=n.Video||Cn.Video,Cn.fetch=n.fetch||Cn.fetch,Cn.readFile=n.readFile||Cn.readFile},isBrowser:PL,isNodejs:LL};function U0(n){return tr.isNodejs()||"string"!=typeof n?n:document.getElementById(n)}function mo(n){var t=tr.getEnv(),e=t.Canvas;if(n instanceof t.CanvasRenderingContext2D)return n;var i=U0(n);if(!(i instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}H0();var ns=(()=>(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"}(ns||(ns={})),ns))(),BL=function(t){void 0===t&&(t={});var r=t.backgroundColor,i=t.fontColor,o=t.fontSize,s=t.fontStyle,a=t.padding;this.anchorPosition=t.anchorPosition||ns.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=s||"Georgia",this.padding=a||4};!function(){function n(t,e,r){void 0===r&&(r={}),this.text="string"==typeof t?[t]:t instanceof n?t.text:t,this.anchor=e,this.options=new BL(r)}n.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(r){return t.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*e},n.prototype.measureHeight=function(){var t=this.options;return this.text.length*t.fontSize+2*t.padding},n.prototype.getUpperLeft=function(t,e){var r=this.options.anchorPosition,i=r===ns.BOTTOM_RIGHT||r===ns.TOP_RIGHT,o=r===ns.BOTTOM_LEFT||r===ns.BOTTOM_RIGHT,s=this.measureWidth(t),a=this.measureHeight(),u=i?this.anchor.x-s:this.anchor.x,l=o?this.anchor.y-a:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-s),0),y:Math.max(Math.min(l,d-a),0)}}return{x:u,y:l}},n.prototype.draw=function(t){var e=U0(t),r=mo(e),i=this.options,o=i.backgroundColor,s=i.fontColor,a=i.fontSize,l=i.padding;r.font=a+"px "+i.fontStyle;var c=this.measureWidth(r),d=this.measureHeight();r.fillStyle=o;var h=this.getUpperLeft(r,e);r.fillRect(h.x,h.y,c,d),r.fillStyle=s,this.text.forEach(function(f,p){r.fillText(f,l+h.x,l+h.y+(p+1)*a)})}}();function VL(n){var t=tr.getEnv();return n instanceof t.Image&&n.complete||n instanceof t.Video&&n.readyState>=3}function HL(n){var t=tr.getEnv(),r=t.Video;return n instanceof t.Image?new Kl(n.naturalWidth,n.naturalHeight):n instanceof r?new Kl(n.videoWidth,n.videoHeight):new Kl(n.width,n.height)}function Cm(n){var t=n.width,e=n.height,i=(0,tr.getEnv().createCanvasElement)();return i.width=t,i.height=e,i}function j0(n,t){var e=tr.getEnv().ImageData;if(!(n instanceof e||VL(n)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||HL(n),i=r.width,o=r.height,s=Cm({width:i,height:o});return n instanceof e?mo(s).putImageData(n,0,0):mo(s).drawImage(n,0,0,i,o),s}function Bse(n,t){return pe(this,void 0,void 0,function(){var e,r,i,o,s,a;return ge(this,function(u){switch(u.label){case 0:return e=t||tr.getEnv().createCanvasElement(),r=n.shape.slice($s(n)?1:0),i=r[0],o=r[1],s=r[2],a=oe(function(){return n.as3D(i,o,s).toInt()}),[4,I0.toPixels(a,e)];case 1:return u.sent(),a.dispose(),[2,e]}})})}function UL(n){var t=tr.getEnv();return n instanceof t.Image||n instanceof t.Canvas||n instanceof t.Video}var Em=function(){function n(t,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(i,o){if(_m(i))return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape);if($s(i)){var s=i.shape[0];if(1!==s)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");return r._imageTensors[o]=i,void(r._inputDimensions[o]=i.shape.slice(1))}var a=i instanceof tr.getEnv().Canvas?i:j0(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var t=this;return yh(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},n.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},n.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},n.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},n.prototype.getReshapedInputDimensions=function(t){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(n,t){var e=n.width,r=n.height,i=t/Math.max(r,e);return new Kl(Math.round(e*i),Math.round(r*i))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},n.prototype.toBatchTensor=function(t,e){var r=this;return void 0===e&&(e=!0),this._inputSize=t,oe(function(){var i=yh(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof Ct){var u=$s(a)?a:a.expandDims();return u=function(n,t){return void 0===t&&(t=!1),oe(function(){var e=n.shape.slice(1),r=e[0],i=e[1];if(r===i)return n;var o=Math.abs(r-i),s=Math.round(o*(t?.5:1)),a=r>i?2:1,u=function(f){var p=n.shape.slice();return p[a]=f,fo(p,0)},l=u(s),c=o-l.shape[a],h=[t&&c?u(c):null,n,l].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return bn(h,a)})}(u,e),(u.shape[1]!==t||u.shape[2]!==t)&&(u=d0.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(a instanceof tr.getEnv().Canvas)return I0.fromPixels(function(n,t,e){void 0===e&&(e=!1);var r=tr.getEnv(),o=r.Canvas;if(!(n instanceof r.Image||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=HL(n),a=t/Math.max(s.height,s.width),u=a*s.width,l=a*s.height,c=Cm({width:t,height:t}),d=n instanceof o?n:j0(n),h=Math.abs(u-l)/2,f=e&&u<l?h:0,p=e&&l<u?h:0;return mo(c).drawImage(d,f,p,u,l),c}(a,t,e));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)});return Br(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,t,t,3)})},n}();function Tn(n){return pe(this,void 0,void 0,function(){var t,e,r;return ge(this,function(i){switch(i.label){case 0:if(n instanceof Em)return[2,n];if(!(t=Array.isArray(n)?n:[n]).length)throw new Error("toNetInput - empty array passed as input");return e=function(o){return Array.isArray(n)?" at input index "+o+":":""},(r=t.map(U0)).forEach(function(o,s){if(!UL(o)&&!_m(o)&&!$s(o))throw"string"==typeof t[s]?new Error("toNetInput -"+e(s)+" string passed, but could not resolve HTMLElement for element id "+t[s]):new Error("toNetInput -"+e(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if($s(o)){var a=o.shape[0];if(1!==a)throw new Error("toNetInput -"+e(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return UL(o)&&function(n){return new Promise(function(t,e){if(n instanceof tr.getEnv().Canvas||VL(n))return t();function r(o){!o.currentTarget||(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}function i(o){!o.currentTarget||(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}(o)}))];case 1:return i.sent(),[2,new Em(r,Array.isArray(n))]}})})}function W0(n,t){return pe(this,void 0,void 0,function(){var e,r,i,o,s,a;return ge(this,function(l){switch(l.label){case 0:return e=tr.getEnv().Canvas,r=n,n instanceof e?[3,5]:[4,Tn(n)];case 1:if((i=l.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(o=i.getInput(0))instanceof e?(s=o,[3,4]):[3,2];case 2:return[4,Bse(o)];case 3:s=l.sent(),l.label=4;case 4:r=s,l.label=5;case 5:return a=mo(r),[2,t.map(function(c){return c instanceof go?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}).map(function(c){var d=c.x,h=c.y,f=c.width,p=c.height,m=Cm({width:f,height:p});return mo(m).putImageData(a.getImageData(d,h,f,p),0,0),m})]}})})}function G0(n,t){return pe(this,void 0,void 0,function(){return ge(this,function(e){if(!_m(n)&&!$s(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if($s(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,oe(function(){var r=n.shape.slice($s(n)?1:0),i=r[0],o=r[1],s=r[2];return t.map(function(l){return l instanceof go?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}).map(function(l){var c=l.x,d=l.y,h=l.width,f=l.height;return VP(n.as3D(i,o,s),[d,c,0],[f,h,s])})})]})})}function Hse(n,t){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return[4,(0,tr.getEnv().fetch)(n,t)];case 1:if(!((r=i.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Use(n){return pe(this,void 0,void 0,function(){return ge(this,function(t){switch(t.label){case 0:return[4,Hse(n)];case 1:return[2,t.sent().json()]}})})}function jL(n,t){var e=t+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:e};if("/"===n)return{modelBaseUri:"/",manifestUri:"/"+e};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"",i=(n=n.replace(r,"")).split("/").filter(function(a){return a}),o=n.endsWith(".json")?i[i.length-1]:e,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:s=n.startsWith("/")?"/"+s:s,manifestUri:"/"===s?"/"+o:s+"/"+o}}function jse(n,t){return pe(this,void 0,void 0,function(){var e,i,o;return ge(this,function(s){switch(s.label){case 0:return e=jL(n,t),i=e.modelBaseUri,[4,Use(e.manifestUri)];case 1:return o=s.sent(),[2,gL.loadWeights(o,i)]}})})}var rs=function(){function n(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},n.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=e},n.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof kl})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof kl)})},n.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){t.reassignParamFromPath(e.path,e.tensor.variable())})},n.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,i=e.tensor,o=Vn(i.dataSync());i.dispose(),t.reassignParamFromPath(r,o)})},n.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){return Array.from(t.tensor.dataSync())}).reduce(function(t,e){return t.concat(e)}))},n.prototype.load=function(t){return pe(this,void 0,void 0,function(){return ge(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},n.prototype.loadFromUri=function(t){return pe(this,void 0,void 0,function(){var e;return ge(this,function(r){switch(r.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,jse(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},n.prototype.loadFromDisk=function(t){return pe(this,void 0,void 0,function(){var e,r,i,o,a,u,l,c,d;return ge(this,function(h){switch(h.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=tr.getEnv().readFile,r=jL(t,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=gL.weightsLoaderFactory(function(f){return Promise.all(f.map(function(p){return e(p).then(function(m){return m.buffer})}))}),c=(l=JSON).parse,[4,e(i)];case 1:return u=c.apply(l,[h.sent().toString()]),[4,a(u,o)];case 2:return d=h.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),i=e.params;this._paramMappings=e.paramMappings,this._params=i},n.prototype.extractWeights=function(t){var e=this.extractParams(t),i=e.params;this._paramMappings=e.paramMappings,this._params=i},n.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+t);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=e.obj,i=e.objProp;if(!(r&&i&&r[i]instanceof Ct))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:i}},n}();function Hr(n,t,e){return oe(function(){var r=s0(n,t.depthwise_filter,t.pointwise_filter,e,"same");return qe(r,t.bias)})}function z0(n,t,e){return void 0===e&&(e=!1),oe(function(){var r=Lt(e?qe(ui(n,t.conv0.filters,[2,2],"same"),t.conv0.bias):Hr(n,t.conv0,[2,2])),i=Hr(r,t.conv1,[1,1]),s=Hr(Lt(qe(r,i)),t.conv2,[1,1]);return Lt(qe(r,qe(i,s)))})}function Dm(n,t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),oe(function(){var i=Lt(e?qe(ui(n,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Hr(n,t.conv0,r?[2,2]:[1,1])),o=Hr(i,t.conv1,[1,1]),a=Hr(Lt(qe(i,o)),t.conv2,[1,1]),l=Hr(Lt(qe(i,qe(o,a))),t.conv3,[1,1]);return Lt(qe(i,qe(o,qe(a,l))))})}function Bi(n,t,e,r){return void 0===e&&(e="same"),void 0===r&&(r=!1),oe(function(){var i=qe(ui(n,t.filters,[1,1],e),t.bias);return r?Lt(i):i})}function is(n,t){Object.keys(n).forEach(function(e){t.some(function(r){return r.originalPath===e})||n[e].dispose()})}function Sm(n,t){return function(e,r,i,o){var s=xr(n(e*r*i*i),[i,i,e,r]),a=fn(n(r));return t.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function $0(n,t){return function(e,r,i){var o=Hs(n(e*r),[e,r]),s=fn(n(r));return t.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var WL=function(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r};function q0(n,t){return function(e,r,i){var o=xr(n(9*e),[3,3,e,1]),s=xr(n(e*r),[1,1,e,r]),a=fn(n(r));return t.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new WL(o,s,a)}}function K0(n){return function(t){var e=n(t+"/depthwise_filter",4),r=n(t+"/pointwise_filter",4),i=n(t+"/bias",1);return new WL(e,r,i)}}function qs(n,t){return function(e,r,i){var o=n[e];if(!vh(o,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+o);return t.push({originalPath:e,paramPath:i||e}),o}}function os(n){var t=n;return{extractWeights:function(i){var o=t.slice(0,i);return t=t.slice(i),o},getRemainingWeights:function(){return t}}}function GL(n,t){var e=Sm(n,t),r=q0(n,t);function i(s,a,u,l){return void 0===l&&(l=!1),{conv0:l?e(s,a,3,u+"/conv0"):r(s,a,u+"/conv0"),conv1:r(a,a,u+"/conv1"),conv2:r(a,a,u+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(s,a,u,l){void 0===l&&(l=!1);var c=i(s,a,u,l);return{conv0:c.conv0,conv1:c.conv1,conv2:c.conv2,conv3:r(a,a,u+"/conv3")}}}}function zL(n){return function(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}}function $L(n,t){var e=qs(n,t),r=zL(e),i=K0(e);return{extractDenseBlock3Params:function(a,u){return void 0===u&&(u=!1),{conv0:u?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}},extractDenseBlock4Params:function(a,u){return void 0===u&&(u=!1),{conv0:u?r(a+"/conv0"):i(a+"/conv0"),conv1:i(a+"/conv1"),conv2:i(a+"/conv2"),conv3:i(a+"/conv3")}}}}var qL=function(n){function t(){return n.call(this,"FaceFeatureExtractor")||this}return Fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return oe(function(){var a=Dm(bh(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ee(255)),r.dense0,!0);return a=Dm(a,r.dense1),a=Dm(a,r.dense2),a=Dm(a,r.dense3),ph(a,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(n){var t=[],e=$L(n,t).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return is(n,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(n){var t=[],e=os(n),i=e.getRemainingWeights,o=GL(e.extractWeights,t).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:s,dense1:a,dense2:u,dense3:l}}}(e)},t}(rs);function vo(n,t){return oe(function(){return qe(hm(n,t.weights),t.bias)})}function KL(n){var t={},e={};return Object.keys(n).forEach(function(r){(r.startsWith("fc")?e:t)[r]=n[r]}),{featureExtractorMap:t,classifierMap:e}}var YL=function(n){function t(e,r){var i=n.call(this,e)||this;return i._faceFeatureExtractor=r,i}return Fe(t,n),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return oe(function(){var o=e instanceof Em?r.faceFeatureExtractor.forwardInput(e):e;return vo(o.as2D(o.shape[0],-1),i.fc)})},t.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.paramMappings;this._params=r.params,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return function(n,t,e){var r=[],i=os(n),s=i.getRemainingWeights,u=$0(i.extractWeights,r)(t,e,"fc");if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var r=KL(e),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function(n){var t=[],e=qs(n,t),i={fc:("fc",{weights:e("fc/weights",2),bias:e("fc/bias",1)})};return is(n,t),{params:i,paramMappings:t}}(o)},t.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=e.slice(0,e.length-o),a=e.slice(e.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},t}(rs),XL=["neutral","happy","sad","angry","fearful","disgusted","surprised"],qse=function(){function n(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);XL.forEach(function(r,i){e[r]=t[i]})}return n.prototype.asSortedArray=function(){var t=this;return XL.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,r){return r.probability-e.probability})},n}(),Kse=function(n){function t(e){return void 0===e&&(e=new qL),n.call(this,"FaceExpressionNet",e)||this}return Fe(t,n),t.prototype.forwardInput=function(e){var r=this;return oe(function(){return Xo(r.runNet(e))})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.predictExpressions=function(e){return pe(this,void 0,void 0,function(){var r,i,o,s,a=this;return ge(this,function(u){switch(u.label){case 0:return[4,Tn(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(xn(i).map(function(l){return pe(a,void 0,void 0,function(){var c;return ge(this,function(d){switch(d.label){case 0:return[4,l.data()];case 1:return c=d.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),s=o.map(function(l){return new qse(l)}),[2,r.isBatchInput?s:s[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(YL);function QL(n,t){return Object.assign({},n,{expressions:t})}function Y0(n,t){var e=n.detection.box,r=t.shiftBy(e.x,e.y),i=r.align(),o=n.detection.imageDims,s=new go(n.detection.score,i.rescale(o.reverse()),o);return Object.assign({},n,{landmarks:r,unshiftedLandmarks:t,alignedRect:s})}function JL(n,t,e){return qe(ui(n,t.filters,e,"same"),t.bias)}function X0(n,t,e){void 0===e&&(e=!0);var r=e?Lt(n):n;return r=Hr(r,t.separable_conv0,[1,1]),r=Hr(Lt(r),t.separable_conv1,[1,1]),r=In(r,[3,3],[2,2],"same"),qe(r,JL(n,t.expansion_conv,[2,2]))}var rae=function(n){function t(e){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return Fe(t,n),t.prototype.forwardInput=function(e){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return oe(function(){var a=bh(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ee(256)),u=Lt(JL(a,i.entry_flow.conv_in,[2,2]));return u=X0(u,i.entry_flow.reduction_block_0,!1),u=X0(u,i.entry_flow.reduction_block_1),yh(r._numMainBlocks,0,1).forEach(function(l){u=function(n,t){var e=Hr(Lt(n),t.separable_conv0,[1,1]);return e=Hr(Lt(e),t.separable_conv1,[1,1]),e=Hr(Lt(e),t.separable_conv2,[1,1]),qe(e,n)}(u,i.middle_flow["main_block_"+l])}),u=X0(u,i.exit_flow.reduction_block),u=Lt(Hr(u,i.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(n,t){var e=[],r=function(n,t){var e=qs(n,t),r=zL(e),i=K0(e);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),expansion_conv:r(a+"/expansion_conv")}},extractMainBlockParams:function(a){return{separable_conv0:i(a+"/separable_conv0"),separable_conv1:i(a+"/separable_conv1"),separable_conv2:i(a+"/separable_conv2")}}}}(n,e),o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,d={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:s("entry_flow/reduction_block_0"),reduction_block_1:s("entry_flow/reduction_block_1")},h={};yh(t,0,1).forEach(function(g){h["main_block_"+g]=a("middle_flow/main_block_"+g)});var m={reduction_block:s("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return is(n,e),{params:{entry_flow:d,middle_flow:h,exit_flow:m},paramMappings:e}}(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return function(n,t){var e=[],r=os(n),o=r.getRemainingWeights,s=function(n,t){var e=Sm(n,t),r=q0(n,t);return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:function(s,a,u){return{separable_conv0:r(s,a,u+"/separable_conv0"),separable_conv1:r(a,a,u+"/separable_conv1"),expansion_conv:e(s,a,1,u+"/expansion_conv")}},extractMainBlockParams:function(s,a){return{separable_conv0:r(s,s,a+"/separable_conv0"),separable_conv1:r(s,s,a+"/separable_conv1"),separable_conv2:r(s,s,a+"/separable_conv2")}}}}(r.extractWeights,e),u=s.extractSeparableConvParams,l=s.extractReductionBlockParams,c=s.extractMainBlockParams,p={conv_in:(0,s.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:l(32,64,"entry_flow/reduction_block_0"),reduction_block_1:l(64,128,"entry_flow/reduction_block_1")},m={};yh(t,0,1).forEach(function(b){m["main_block_"+b]=c(128,"middle_flow/main_block_"+b)});var y={reduction_block:l(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:m,exit_flow:y}}}(e,this._numMainBlocks)},t}(rs),xh=(()=>(function(n){n.FEMALE="female",n.MALE="male"}(xh||(xh={})),xh))(),sae=function(n){function t(e){void 0===e&&(e=new rae(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return Fe(t,n),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return oe(function(){var o=e instanceof Em?r.faceFeatureExtractor.forwardInput(e):e,s=ph(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1);return{age:vo(s,i.fc.age).as1D(),gender:vo(s,i.fc.gender)}})},t.prototype.forwardInput=function(e){var r=this;return oe(function(){var i=r.runNet(e);return{age:i.age,gender:Xo(i.gender)}})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return pe(this,void 0,void 0,function(){var r,i,o,s,a,u,l=this;return ge(this,function(c){switch(c.label){case 0:return[4,Tn(e)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=xn(i.age),s=xn(i.gender),a=o.map(function(d,h){return{ageTensor:d,genderTensor:s[h]}}),[4,Promise.all(a.map(function(d){var h=d.ageTensor,f=d.genderTensor;return pe(l,void 0,void 0,function(){var p,m,g,v,y;return ge(this,function(b){switch(b.label){case 0:return[4,h.data()];case 1:return p=b.sent()[0],[4,f.data()];case 2:return m=b.sent()[0],v=(g=m>.5)?xh.MALE:xh.FEMALE,y=g?m:1-m,h.dispose(),f.dispose(),[2,{age:p,gender:v,genderProbability:y}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),o=r.paramMappings;this._params=r.params,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return function(n){var t=[],e=os(n),i=e.getRemainingWeights,o=$0(e.extractWeights,t),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{fc:{age:s,gender:a}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var r=KL(e),o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function(n){var t=[],e=qs(n,t);function r(o){return{weights:e(o+"/weights",2),bias:e(o+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return is(n,t),{params:i,paramMappings:t}}(o)},t.prototype.extractParams=function(e){var i=e.slice(0,e.length-1539),o=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},t}(rs),ZL=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.postProcess=function(e,r,i){var o=i.map(function(a){var u=a.width,l=a.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),s=o.length;return oe(function(){var a=function(h,f){return Br([fo([68],h),fo([68],f)],1).as2D(1,136).as1D()},u=function(h,f){var p=o[h],m=p.width,g=p.height;return f(m,g)?Math.abs(m-g)/2:0};return e.mul(fo([s,136],r)).sub(Br(Array.from(Array(s),function(h,f){return a(function(h){return u(h,function(f,p){return f<p})}(f),function(h){return u(h,function(f,p){return p<f})}(f))}))).div(Br(Array.from(Array(s),function(h,f){return a(o[f].width,o[f].height)})))})},t.prototype.forwardInput=function(e){var r=this;return oe(function(){var i=r.runNet(e);return r.postProcess(i,e.inputSize,e.inputDimensions.map(function(o){return{height:o[0],width:o[1]}}))})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.detectLandmarks=function(e){return pe(this,void 0,void 0,function(){var r,i,o,s=this;return ge(this,function(a){switch(a.label){case 0:return[4,Tn(e)];case 1:return r=a.sent(),i=oe(function(){return xn(s.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return pe(s,void 0,void 0,function(){var c,d,h,f,p;return ge(this,function(m){switch(m.label){case 0:return h=(d=Array).from,[4,u.data()];case 1:return c=h.apply(d,[m.sent()]),f=c.filter(function(g,v){return SL(v)}),p=c.filter(function(g,v){return!SL(v)}),[2,new TL(Array(68).fill(0).map(function(g,v){return new dt(f[v],p[v])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(YL),eB=function(n){function t(e){return void 0===e&&(e=new qL),n.call(this,"FaceLandmark68Net",e)||this}return Fe(t,n),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(ZL),lae=function(n){function t(){return n.call(this,"TinyFaceFeatureExtractor")||this}return Fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return oe(function(){var a=z0(bh(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(ee(255)),r.dense0,!0);return a=z0(a,r.dense1),a=z0(a,r.dense2),ph(a,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(n){var t=[],e=$L(n,t).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return is(n,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(n){var t=[],e=os(n),i=e.getRemainingWeights,o=GL(e.extractWeights,t).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{dense0:s,dense1:a,dense2:u}}}(e)},t}(rs),cae=function(n){function t(e){return void 0===e&&(e=new lae),n.call(this,"FaceLandmark68TinyNet",e)||this}return Fe(t,n),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(ZL);function Q0(n,t,e,r,i){void 0===i&&(i="same");var o=t.conv,a=o.bias,u=ui(n,o.filters,e,i);return u=function(n,t){return qe(Jn(n,t.weights),t.biases)}(u=qe(u,a),t.scale),r?Lt(u):u}function tB(n,t){return Q0(n,t,[1,1],!1)}function nB(n,t){return Q0(n,t,[2,2],!0,"valid")}function fae(n,t){function o(a,u,l,c){var d=function(a,u,l,c){var d=function(a,u,l){var c=n(a),d=c.length/(u*l*l);if(function(n){return n%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return oe(function(){return js(xr(c,[u,d,l,l]),[2,3,1,0])})}(a,u,l),h=fn(n(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:h}}(a,u,l,c+"/conv"),h=function(a,u){var l=fn(n(a)),c=fn(n(a));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}(u,c+"/scale");return{conv:d,scale:h}}return{extractConvLayerParams:o,extractResidualLayerParams:function(a,u,l,c,d){return void 0===d&&(d=!1),{conv1:o((d?.5:1)*a,u,l,c+"/conv1"),conv2:o(a,u,l,c+"/conv2")}}}}function mae(n){var t=[],e=function(n,t){var e=qs(n,t);function i(s){var a=e(s+"/conv/filters",4),u=e(s+"/conv/bias",1),l=function(s){return{weights:e(s+"/scale/weights",1),biases:e(s+"/scale/biases",1)}}(s);return{conv:{filters:a,bias:u},scale:l}}return{extractConvLayerParams:i,extractResidualLayerParams:function(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}}}(n,t),i=e.extractResidualLayerParams,o=(0,e.extractConvLayerParams)("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),d=i("conv64_2"),h=i("conv64_3"),f=i("conv128_down"),p=i("conv128_1"),m=i("conv128_2"),g=i("conv256_down"),v=i("conv256_1"),y=i("conv256_2"),b=i("conv256_down_out"),_=n.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!function(n){return vh(n,2)}(_))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);var x={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:h,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:y,conv256_down_out:b,fc:_};return is(n,t),{params:x,paramMappings:t}}function yo(n,t){var e=function(n,t){return Q0(n,t,[1,1],!0)}(n,t.conv1);return e=tB(e,t.conv2),e=qe(e,n),Lt(e)}function Am(n,t){var e=nB(n,t.conv1);e=tB(e,t.conv2);var r=ph(n,2,2,"valid"),i=At(r.shape),o=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){var a=mh(e.shape);a[1]=1;var u=At(a),l=mh((e=bn([e,u],1)).shape);l[2]=1;var c=At(l);e=bn([e,c],2)}return r=o?bn([r,i],3):r,e=qe(r,e),Lt(e)}!function(n){Fe(function(){return null!==n&&n.apply(this,arguments)||this},n)}(eB);var vae=function(n){function t(){return n.call(this,"FaceRecognitionNet")||this}return Fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return oe(function(){var a=nB(bh(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(ee(256)),r.conv32_down);a=yo(a=In(a,3,2,"valid"),r.conv32_1),a=yo(a,r.conv32_2),a=yo(a,r.conv32_3),a=yo(a=Am(a,r.conv64_down),r.conv64_1),a=yo(a,r.conv64_2),a=yo(a,r.conv64_3),a=yo(a=Am(a,r.conv128_down),r.conv128_1),a=yo(a,r.conv128_2),a=yo(a=Am(a,r.conv256_down),r.conv256_1);var u=(a=Am(a=yo(a,r.conv256_2),r.conv256_down_out)).mean([1,2]);return hm(u,r.fc)})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return pe(this,void 0,void 0,function(){var r,i,o,s=this;return ge(this,function(a){switch(a.label){case 0:return[4,Tn(e)];case 1:return r=a.sent(),i=oe(function(){return xn(s.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return mae(e)},t.prototype.extractParams=function(e){return function(n){var t=os(n),e=t.extractWeights,r=t.getRemainingWeights,i=[],o=fae(e,i),a=o.extractResidualLayerParams,u=(0,o.extractConvLayerParams)(4704,32,7,"conv32_down"),l=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),h=a(36864,64,3,"conv64_down",!0),f=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),m=a(36864,64,3,"conv64_3"),g=a(147456,128,3,"conv128_down",!0),v=a(147456,128,3,"conv128_1"),y=a(147456,128,3,"conv128_2"),b=a(589824,256,3,"conv256_down",!0),_=a(589824,256,3,"conv256_1"),x=a(589824,256,3,"conv256_2"),w=a(589824,256,3,"conv256_down_out"),M=oe(function(){return js(Hs(e(32768),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:h,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:y,conv256_down:b,conv256_1:_,conv256_2:x,conv256_down_out:w,fc:M},paramMappings:i}}(e)},t}(rs);function rB(n,t,e){return Object.assign({},n,{gender:t,genderProbability:e})}var iB=function(){function n(t){var e=void 0===t?{}:t,r=e.minFaceSize,i=e.scaleFactor,o=e.maxNumScales,s=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function _o(n,t,e){return oe(function(){var r=ui(n,t.filters,e,"same");return r=qe(r,t.batch_norm_offset),Zw(r,0,6)})}function Aae(n,t,e){var r=n.arraySync(),i=Math.min(r[t][0],r[t][2]),o=Math.min(r[t][1],r[t][3]),s=Math.max(r[t][0],r[t][2]),a=Math.max(r[t][1],r[t][3]),u=Math.min(r[e][0],r[e][2]),l=Math.min(r[e][1],r[e][3]),c=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),h=(s-i)*(a-o),f=(c-u)*(d-l);if(h<=0||f<=0)return 0;var p=Math.max(i,u),m=Math.max(o,l),g=Math.min(s,c),v=Math.min(a,d),y=Math.max(g-p,0)*Math.max(v-m,0);return y/(h+f-y)}function Yl(n,t){return oe(function(){var e=n.shape[0];return{boxPredictionEncoding:Ni(Bi(n,t.box_encoding_predictor),[e,-1,1,4]),classPrediction:Ni(Bi(n,t.class_predictor),[e,-1,3])}})}var Mm=function(){function n(t){var e=void 0===t?{}:t,r=e.minConfidence,i=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),oB=function(n){function t(){return n.call(this,"SsdMobilenetv1")||this}return Fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return oe(function(){var i=e.toBatchTensor(512,!1).toFloat(),s=function(n,t){return oe(function(){var e=null,r=_o(n,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(o,s){var a=s+1,u=function(n){return[2,4,6,12].some(function(t){return t===n})?[2,2]:[1,1]}(a);r=function(n,t,e){return oe(function(){var r=dm(n,t.filters,e,"same");return r=wP(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Zw(r,0,6)})}(r,o.depthwise_conv,u),r=_o(r,o.pointwise_conv,[1,1]),11===a&&(e=r)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}(wn(Jn(i,ee(.007843137718737125)),ee(1)),r.mobilenetv1),a=function(n,t,e){return oe(function(){var r=_o(n,e.conv_0,[1,1]),i=_o(r,e.conv_1,[2,2]),o=_o(i,e.conv_2,[1,1]),s=_o(o,e.conv_3,[2,2]),a=_o(s,e.conv_4,[1,1]),u=_o(a,e.conv_5,[2,2]),l=_o(u,e.conv_6,[1,1]),c=_o(l,e.conv_7,[2,2]),d=Yl(t,e.box_predictor_0),h=Yl(n,e.box_predictor_1),f=Yl(i,e.box_predictor_2),p=Yl(s,e.box_predictor_3),m=Yl(u,e.box_predictor_4),g=Yl(c,e.box_predictor_5);return{boxPredictions:bn([d.boxPredictionEncoding,h.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:bn([d.classPrediction,h.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1)}})}(s.out,s.conv11,r.prediction_layer);return function(n,t,e){return oe(function(){var r=n.shape[0],i=function(n,t){var e=function(n){var t=xn(js(n,[1,0])),e=[wn(t[2],t[0]),wn(t[3],t[1])];return{sizes:e,centers:[qe(t[0],Li(e[0],ee(2))),qe(t[1],Li(e[1],ee(2)))]}}(n),r=e.sizes,i=e.centers,o=xn(js(t,[1,0])),s=Li(Jn(e0(Li(o[2],ee(5))),r[0]),ee(2)),a=qe(Jn(Li(o[0],ee(10)),r[0]),i[0]),u=Li(Jn(e0(Li(o[3],ee(5))),r[1]),ee(2)),l=qe(Jn(Li(o[1],ee(10)),r[1]),i[1]);return js(Br([wn(a,s),wn(l,u),qe(a,s),qe(l,u)]),[1,0])}(Ni(Nl(e.extra_dim,[r,1,1]),[-1,4]),Ni(n,[-1,4]));i=Ni(i,[r,i.shape[0]/r,4]);var o=yP(po(t,[0,0,1],[-1,-1,-1])),s=po(o,[0,0,0],[-1,-1,1]);return s=Ni(s,[r,s.shape[1]]),{boxes:xn(i),scores:xn(s)}})}(a.boxPredictions,a.classPredictions,r.output_layer)})},t.prototype.forward=function(e){return pe(this,void 0,void 0,function(){var r;return ge(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Tn(e)];case 1:return[2,r.apply(this,[i.sent()])]}})})},t.prototype.locateFaces=function(e,r){return void 0===r&&(r={}),pe(this,void 0,void 0,function(){var i,o,s,a,u,l,c,d,h,f,p,m,g,y,b,_,x,w,M,T;return ge(this,function(S){switch(S.label){case 0:return i=new Mm(r),o=i.maxResults,s=i.minConfidence,[4,Tn(e)];case 1:for(a=S.sent(),u=this.forwardInput(a),d=(l=u.boxes)[0],h=(c=u.scores)[0],f=1;f<l.length;f++)l[f].dispose(),c[f].dispose();return g=(m=Array).from,[4,h.data()];case 2:return p=g.apply(m,[S.sent()]),y=function(n,t,e,r,i){var s=Math.min(e,n.shape[0]),a=t.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>i}).sort(function(c,d){return d.score-c.score}),u=function(c){return c<=.5?1:0},l=[];return a.forEach(function(c){if(!(l.length>=s)){for(var d=c.score,h=l.length-1;h>=0;--h){var f=Aae(n,c.boxIndex,l[h]);if(0!==f&&(c.score*=u(f),c.score<=i))break}d===c.score&&l.push(c.boxIndex)}}),l}(d,p,o,0,s),b=a.getReshapedInputDimensions(0),x=(_=a.inputSize)/b.width,w=_/b.height,M=d.arraySync(),T=y.map(function(I){var N=[Math.max(0,M[I][0]),Math.min(1,M[I][2])].map(function(L){return L*w}),O=N[0],W=N[1],G=[Math.max(0,M[I][1]),Math.min(1,M[I][3])].map(function(L){return L*x}),z=G[0];return new go(p[I],new L0(z,O,G[1]-z,W-O),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),h.dispose(),[2,T]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(n){var t=[],e=function(n,t){var e=qs(n,t);function r(l,c,d){return{filters:e(l+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function i(l){var c="mobilenetv1/conv_"+l,d="MobilenetV1/Conv2d_"+l+"_depthwise",h=c+"/depthwise_conv",f=c+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,h+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,h+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,h+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,h+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,h+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",l,f)}}function s(l,c){return{filters:e(l+"/weights",4,c+"/filters"),bias:e(l+"/biases",1,c+"/bias")}}function a(l){return{box_encoding_predictor:s("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),class_predictor:s("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(n,t),r=e.extractMobilenetV1Params,i=e.extractPredictionLayerParams,o=n["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!_m(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return is(n,t),{params:s,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(n){var t=[],e=os(n),r=e.extractWeights,i=e.getRemainingWeights,o=function(n,t){function r(u,l,c,d,h){var f=xr(n(u*l*c*c),[c,c,u,l]),p=fn(n(l));return t.push({paramPath:d+"/filters"},{paramPath:d+"/"+(h?"batch_norm_offset":"bias")}),{filters:f,bias:p}}function i(u,l,c,d){var h=r(u,l,c,d,!0);return{filters:h.filters,batch_norm_offset:h.bias}}function o(u,l,c){var d=function(u,l){var c=xr(n(9*u),[3,3,u,1]),d=fn(n(u)),h=fn(n(u)),f=fn(n(u)),p=fn(n(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:h,batch_norm_mean:f,batch_norm_variance:p}}(u,c+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:i(u,l,1,c+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:i(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:i(1024,256,1,"prediction_layer/conv_0"),conv_1:i(256,512,3,"prediction_layer/conv_1"),conv_2:i(512,128,1,"prediction_layer/conv_2"),conv_3:i(128,256,3,"prediction_layer/conv_3"),conv_4:i(256,128,1,"prediction_layer/conv_4"),conv_5:i(128,256,3,"prediction_layer/conv_5"),conv_6:i(256,64,1,"prediction_layer/conv_6"),conv_7:i(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,t),a=o.extractPredictionLayerParams,u=(0,o.extractMobilenetV1Params)(),l=a(),d={extra_dim:Aw(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:d},paramMappings:t}}(e)},t}(rs);!function(n){Fe(function(){return null!==n&&n.apply(this,arguments)||this},n)}(oB);var Oae=[new dt(.738768,.874946),new dt(2.42204,2.65704),new dt(4.30971,7.04493),new dt(10.246,4.59428),new dt(12.6868,11.8741)],Nae=[new dt(1.603231,2.094468),new dt(6.041143,7.080126),new dt(2.882459,3.518061),new dt(4.266906,5.178857),new dt(9.041765,10.66308)],Pae=[117.001,114.697,97.404],Im=function(n){return"number"==typeof n};function J0(n){return oe(function(){var t=Jn(n,ee(.10000000149011612));return qe(Lt(wn(n,t)),t)})}function Ks(n,t){return oe(function(){var e=qa(n,[[0,0],[1,1],[1,1],[0,0]]);return e=ui(e,t.conv.filters,[1,1],"valid"),e=wn(e,t.bn.sub),e=Jn(e,t.bn.truediv),J0(e=qe(e,t.conv.bias))})}function Ys(n,t){return oe(function(){var e=qa(n,[[0,0],[1,1],[1,1],[0,0]]);return e=s0(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),J0(e=qe(e,t.bias))})}var Z0=function(){function n(t){var e=void 0===t?{}:t,r=e.inputSize,i=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),sB=function(n){function t(e){var r=n.call(this,"TinyYolov2")||this;return function(n){if(!n)throw new Error("invalid config: "+n);if("boolean"!=typeof n.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Im(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(t){return"string"==typeof t}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(t){return t||{}}).every(function(t){return Im(t.x)&&Im(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||3!==n.meanRgb.length||!n.meanRgb.every(Im)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}(e),r._config=e,r}return Fe(t,n),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,r){var i=Ks(e,r.conv0);return i=Ks(i=In(i,[2,2],[2,2],"same"),r.conv1),i=Ks(i=In(i,[2,2],[2,2],"same"),r.conv2),i=Ks(i=In(i,[2,2],[2,2],"same"),r.conv3),i=Ks(i=In(i,[2,2],[2,2],"same"),r.conv4),i=Ks(i=In(i,[2,2],[2,2],"same"),r.conv5),i=Ks(i=In(i,[2,2],[1,1],"same"),r.conv6),Bi(i=Ks(i,r.conv7),r.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,r){var i=this.config.isFirstLayerConv2d?J0(Bi(e,r.conv0,"valid",!1)):Ys(e,r.conv0);return i=Ys(i=In(i,[2,2],[2,2],"same"),r.conv1),i=Ys(i=In(i,[2,2],[2,2],"same"),r.conv2),i=Ys(i=In(i,[2,2],[2,2],"same"),r.conv3),i=Ys(i=In(i,[2,2],[2,2],"same"),r.conv4),i=Ys(i=In(i,[2,2],[2,2],"same"),r.conv5),i=In(i,[2,2],[1,1],"same"),i=r.conv6?Ys(i,r.conv6):i,Bi(i=r.conv7?Ys(i,r.conv7):i,r.conv8,"valid",!1)},t.prototype.forwardInput=function(e,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return oe(function(){var s=e.toBatchTensor(r,!1).toFloat();return s=(s=i.config.meanRgb?bh(s,i.config.meanRgb):s).div(ee(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},t.prototype.forward=function(e,r){return pe(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Tn(e)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},t.prototype.detect=function(e,r){return void 0===r&&(r={}),pe(this,void 0,void 0,function(){var i,o,s,a,u,l,c,d,h,f,p,m,y=this;return ge(this,function(b){switch(b.label){case 0:return i=new Z0(r),o=i.inputSize,s=i.scoreThreshold,[4,Tn(e)];case 1:return a=b.sent(),[4,this.forwardInput(a,o)];case 2:return u=b.sent(),l=oe(function(){return xn(u)[0].expandDims()}),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(l,a.getReshapedInputDimensions(0),s)];case 3:return d=b.sent(),u.dispose(),l.dispose(),h=d.map(function(_){return _.box}),f=d.map(function(_){return _.score}),p=d.map(function(_){return _.classScore}),m=d.map(function(_){return y.config.classes[_.label]}),[2,_h(h.map(function(_){return _.rescale(o)}),f,this.config.iouThreshold,!0).map(function(_){return new IL(f[_],p[_],m[_],h[_],c)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(n,t){var a,e=[],r=function(n,t){var e=qs(n,t);function i(a){return{filters:e(a+"/filters",4),bias:e(a+"/bias",1)}}return{extractConvParams:i,extractConvWithBatchNormParams:function(a){var u=i(a+"/conv"),l=function(a){return{sub:e(a+"/sub",1),truediv:e(a+"/truediv",1)}}(a+"/bn");return{conv:u,bn:l}},extractSeparableConvParams:K0(e)}}(n,e),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;a={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return is(n,e),{params:a,paramMappings:e}}(e,this.config)},t.prototype.extractParams=function(e){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(7!==i&&8!==i&&9!==i)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return function(n,t,e,r){var h,i=os(n),s=i.getRemainingWeights,a=[],u=function(n,t){var e=Sm(n,t),o=q0(n,t);return{extractConvParams:e,extractConvWithBatchNormParams:function(s,a,u){var l=e(s,a,3,u+"/conv"),c=function(s,a){var u=fn(n(s)),l=fn(n(s));return t.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:l}}(a,u+"/bn");return{conv:l,bn:c}},extractSeparableConvParams:o}}(i.extractWeights,a),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(t.withSeparableConvs){var f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],_=r[7],x=r[8];h={conv0:t.isFirstLayerConv2d?l(f,p,3,"conv0"):d(f,p,"conv0"),conv1:d(p,m,"conv1"),conv2:d(m,g,"conv2"),conv3:d(g,v,"conv3"),conv4:d(v,y,"conv4"),conv5:d(y,b,"conv5"),conv6:_?d(b,_,"conv6"):void 0,conv7:x?d(_,x,"conv7"):void 0,conv8:l(x||_||b,5*e,1,"conv8")}}else m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],_=r[7],x=r[8],h={conv0:c(f=r[0],p=r[1],"conv0"),conv1:c(p,m,"conv1"),conv2:c(m,g,"conv2"),conv3:c(g,v,"conv3"),conv4:c(v,y,"conv4"),conv5:c(y,b,"conv5"),conv6:c(b,_,"conv6"),conv7:c(_,x,"conv7"),conv8:l(x,5*e,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:h,paramMappings:a}}(e,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(e,r,i){return pe(this,void 0,void 0,function(){var o,s,a,u,l,c,d,h,f,p,m,g,v,y,b,_,x,w,M,T,S,I,N,O,W,G,z,P,L,B=this;return ge(this,function(U){switch(U.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),u=a/o,l=a/s,c=e.shape[1],d=this.config.anchors.length,h=oe(function(){var q=e.reshape([c,c,d,B.boxEncodingSize]);return[q.slice([0,0,0,0],[c,c,d,4]),q.slice([0,0,0,4],[c,c,d,1]),B.withClassScores?Xo(q.slice([0,0,0,5],[c,c,d,B.config.classes.length]),3):ee(0)]}),f=h[0],m=h[2],g=[],[4,(p=h[1]).array()];case 1:return v=U.sent(),[4,f.array()];case 2:y=U.sent(),b=0,U.label=3;case 3:if(!(b<c))return[3,12];_=0,U.label=4;case 4:if(!(_<c))return[3,11];x=0,U.label=5;case 5:return x<d?(w=P0(v[b][_][x][0]),!i||w>i?(M=(_+P0(y[b][_][x][0]))/c*u,T=(b+P0(y[b][_][x][1]))/c*l,S=Math.exp(y[b][_][x][2])*this.config.anchors[x].x/c*u,I=Math.exp(y[b][_][x][3])*this.config.anchors[x].y/c*l,N=M-S/2,O=T-I/2,W={row:b,col:_,anchor:x},this.withClassScores?[4,this.extractPredictedClass(m,W)]:[3,7]):[3,9]):[3,10];case 6:return L=U.sent(),[3,8];case 7:L={classScore:1,label:0},U.label=8;case 8:z=(G=L).classScore,P=G.label,g.push(er({box:new bm(N,O,N+S,O+I),score:w,classScore:w*z,label:P},W)),U.label=9;case 9:return x++,[3,5];case 10:return _++,[3,4];case 11:return b++,[3,3];case 12:return f.dispose(),p.dispose(),m.dispose(),[2,g]}})})},t.prototype.extractPredictedClass=function(e,r){return pe(this,void 0,void 0,function(){var i,o,s,a;return ge(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,e.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return a[i][o][s][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(rs),Gae=function(n){function t(e){void 0===e&&(e=!0);var i=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:Nae,meanRgb:Pae}:{anchors:Oae,withClassScores:!0});return n.call(this,i)||this}return Fe(t,n),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return pe(this,void 0,void 0,function(){return ge(this,function(o){switch(o.label){case 0:return[4,this.detect(e,r)];case 1:return[2,o.sent().map(function(s){return new go(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(sB),aB=function(n){function t(){var e=null!==n&&n.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return Fe(t,n),t}(Z0),wh=function(){function n(){}return n.prototype.then=function(t){return pe(this,void 0,void 0,function(){var e;return ge(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return pe(this,void 0,void 0,function(){return ge(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},n}();function uB(n,t){return Object.assign({},n,{descriptor:t})}function Tm(n,t,e,r,i){return void 0===i&&(i=function(o){return o.alignedRect}),pe(this,void 0,void 0,function(){var o,s,a,u,l;return ge(this,function(c){switch(c.label){case 0:return o=n.map(function(d){return function(n){return function(n){return n.detection instanceof go}(n)&&n.landmarks instanceof xm&&n.unshiftedLandmarks instanceof xm&&n.alignedRect instanceof go}(d)?i(d):d.detection}),(a=r)?[3,5]:t instanceof Ct?[4,G0(t,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,W0(t,o)];case 3:u=c.sent(),c.label=4;case 4:a=u,c.label=5;case 5:return[4,e(s=a)];case 6:return l=c.sent(),s.forEach(function(d){return d instanceof Ct&&d.dispose()}),[2,l]}})})}function eC(n,t,e,r,i){return pe(this,void 0,void 0,function(){var o=this;return ge(this,function(s){return[2,Tm([n],t,function(a){return pe(o,void 0,void 0,function(){return ge(this,function(u){return[2,e(a[0])]})})},r,i)]})})}function tC(n,t){var r=t[1];return{height:Math.floor(t[0]*n),width:Math.floor(r*n)}}var nC=function(n){function t(e,r,i,o){return n.call(this,{left:e,top:r,right:i,bottom:o},!0)||this}return Fe(t,n),t}(ts);function lB(n){return oe(function(){return Jn(wn(n,ee(127.5)),ee(.0078125))})}function Xl(n,t){return oe(function(){return qe(Lt(n),Jn(t,sm(Lt(sm(n)))))})}function rC(n,t,e){return void 0===e&&(e=!1),oe(function(){var r=Bi(n,t.conv1,"valid");return r=Xl(r,t.prelu1_alpha),r=Xl(r=Bi(r=In(r,e?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),Xl(r=Bi(r=e?r:In(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function eue(n,t,e,r,i){i.stage1=[];var o=t.map(function(h){return oe(function(){var f={scale:h},p=function(n,t){return oe(function(){var e=tC(t,n.shape.slice(1)),s=lB(d0.resizeBilinear(n,[e.height,e.width]));return js(s,[0,2,1,3])})}(n,h),m=Date.now(),g=function(n,t){return oe(function(){var e=rC(n,t,!0),r=Bi(e,t.conv4_1,"valid"),i=ai(fm(r,3),3);return{prob:Xo(wn(r,i),3),regions:Bi(e,t.conv4_2,"valid")}})}(p,r),v=g.prob,y=g.regions;return f.pnet=Date.now()-m,{scoresTensor:xn(xn(v,3)[1])[0],regionsTensor:xn(y)[0],scale:h,statsForScale:f}})}),s=o.map(function(h){var f=h.scoresTensor,p=h.regionsTensor,g=h.statsForScale,v=function(n,t,e,r){for(var i=[],o=n.arraySync(),s=0;s<n.shape[0];s++)for(var a=0;a<n.shape[1];a++)o[s][a]>=r&&i.push(new dt(a,s));return i.map(function(l){var c=new bm(Math.round((2*l.y+1)/e),Math.round((2*l.x+1)/e),Math.round((2*l.y+12)/e),Math.round((2*l.x+12)/e)),d=o[l.y][l.x],h=t.arraySync();return{cell:c,score:d,region:new nC(h[l.y][l.x][0],h[l.y][l.x][1],h[l.y][l.x][2],h[l.y][l.x][3])}})}(f,p,h.scale,e);if(f.dispose(),p.dispose(),!v.length)return i.stage1.push(g),[];var y=Date.now(),b=_h(v.map(function(_){return _.cell}),v.map(function(_){return _.score}),.5);return g.nms=Date.now()-y,g.numBoxes=b.length,i.stage1.push(g),b.map(function(_){return v[_]})}),a=s.reduce(function(h,f){return h.concat(f)},[]),u=[],l=[];if(a.length>0){var c=Date.now(),d=_h(a.map(function(h){return h.cell}),a.map(function(h){return h.score}),.7);i.stage1_nms=Date.now()-c,l=d.map(function(h){return a[h].score}),u=d.map(function(h){return a[h]}).map(function(h){var f=h.cell,p=h.region;return new bm(f.left+p.left*f.width,f.top+p.top*f.height,f.right+p.right*f.width,f.bottom+p.bottom*f.height).toSquare().round()})}return{boxes:u,scores:l}}function cB(n,t,e){var r=e.width,i=e.height;return pe(this,void 0,void 0,function(){var o,s,a,u=this;return ge(this,function(l){switch(l.label){case 0:return o=mo(n),[4,Promise.all(t.map(function(c){return pe(u,void 0,void 0,function(){var d,g,v,y;return ge(this,function(b){return d=c.padAtBorders(n.height,n.width),y=o.getImageData(g=d.x-1,v=d.y-1,d.ex-g,d.ey-v),[2,tr.isNodejs()?j0(y):createImageBitmap(y)]})})}))];case 1:return s=l.sent(),a=[],s.forEach(function(c){var h=mo(Cm({width:r,height:i}));h.drawImage(c,0,0,r,i);for(var f=h.getImageData(0,0,r,i).data,p=[],m=0;m<f.length;m+=4)p.push(f[m+2]),p.push(f[m+1]),p.push(f[m]);a.push(p)}),[2,a.map(function(c){return oe(function(){return lB(js(xr(c,[1,r,i,3]),[0,2,1,3]).toFloat())})})]}})})}function nue(n,t,e,r,i){return pe(this,void 0,void 0,function(){var o,s,a,u,l,c,d,h,f,p,m,g,v,y;return ge(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,cB(n,t,{width:24,height:24})];case 1:return s=b.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(_){var x=function(n,t){return oe(function(){var e=rC(n,t),o=Xl(vo(Ni(e,[e.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),s=vo(o,t.fc2_1),a=ai(fm(s,1),1),u=Xo(wn(s,a),1),l=vo(o,t.fc2_2);return{scores:xn(u,1)[1],regions:l}})}(_,r);return _.dispose(),x}),i.stage2_rnet=Date.now()-o,u=a.length>1?bn(a.map(function(_){return _.scores})):a[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[b.sent()]),u.dispose(),h=l.map(function(_,x){return{score:_,idx:x}}).filter(function(_){return _.score>e}).map(function(_){return _.idx}),f=h.map(function(_){return t[_]}),p=h.map(function(_){return l[_]}),m=[],g=[],f.length>0&&(o=Date.now(),v=_h(f,p,.7),i.stage2_nms=Date.now()-o,y=v.map(function(_){var x=a[h[_]].regions.arraySync();return new nC(x[0][0],x[0][1],x[0][2],x[0][3])}),g=v.map(function(_){return p[_]}),m=v.map(function(_,x){return f[_].calibrate(y[x])})),a.forEach(function(_){_.regions.dispose(),_.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function iue(n,t,e,r,i){return pe(this,void 0,void 0,function(){var o,s,a,u,l,c,d,h,f,p,m,g,v,y,b;return ge(this,function(_){switch(_.label){case 0:return o=Date.now(),[4,cB(n,t,{width:48,height:48})];case 1:return s=_.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(x){var w=function(n,t){return oe(function(){var e=rC(n,t);e=Xl(e=Bi(e=In(e,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var o=Xl(vo(Ni(e,[e.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),s=vo(o,t.fc2_1),a=ai(fm(s,1),1),u=Xo(wn(s,a),1),l=vo(o,t.fc2_2),c=vo(o,t.fc2_3);return{scores:xn(u,1)[1],regions:l,points:c}})}(x,r);return x.dispose(),w}),i.stage3_onet=Date.now()-o,u=a.length>1?bn(a.map(function(x){return x.scores})):a[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[_.sent()]),u.dispose(),h=l.map(function(x,w){return{score:x,idx:w}}).filter(function(x){return x.score>e}).map(function(x){return x.idx}),f=h.map(function(x){var w=a[x].regions.arraySync();return new nC(w[0][0],w[0][1],w[0][2],w[0][3])}),p=h.map(function(x,w){return t[x].calibrate(f[w])}),m=h.map(function(x){return l[x]}),g=[],v=[],y=[],p.length>0&&(o=Date.now(),b=_h(p,m,.7,!1),i.stage3_nms=Date.now()-o,g=b.map(function(x){return p[x]}),v=b.map(function(x){return m[x]}),y=b.map(function(x,w){return Array(5).fill(0).map(function(M,T){var S=a[x].points.arraySync();return new dt(S[0][T]*(g[w].width+1)+g[w].left,S[0][T+5]*(g[w].height+1)+g[w].top)})})),a.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:g,scores:v,points:y}]}})})}var oue=function(n){function t(){return n.call(this,"Mtcnn")||this}return Fe(t,n),t.prototype.load=function(e){return pe(this,void 0,void 0,function(){return ge(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,e)]})})},t.prototype.loadFromDisk=function(e){return pe(this,void 0,void 0,function(){return ge(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,e)]})})},t.prototype.forwardInput=function(e,r){return void 0===r&&(r={}),pe(this,void 0,void 0,function(){var i,o,s,a,u,l,c,d,h,f,p,m,g,v,b,_,x,w,M,T;return ge(this,function(S){switch(S.label){case 0:if(!(i=this.params))throw new Error("Mtcnn - load model before inference");if(!(o=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),u=oe(function(){return function(n){return oe(function(){return Br(xn(n,3).reverse(),3)})}(ai(I0.fromPixels(o)).toFloat())}),l=function(I){return u.dispose(),s.total=Date.now()-a,I},c=u.shape.slice(1),d=c[0],h=c[1],f=new iB(r),p=f.minFaceSize,m=f.scaleFactor,g=f.maxNumScales,v=f.scoreThresholds,b=(f.scaleSteps||function(n,t,e){for(var o=12/n,s=[],a=Math.min(e[0],e[1])*o,u=0;a>=12;)s.push(o*Math.pow(t,u)),a*=t,u+=1;return s}(p,m,[d,h])).filter(function(I){var N=tC(I,[d,h]);return Math.min(N.width,N.height)>12}).slice(0,g),s.scales=b,s.pyramid=b.map(function(I){return tC(I,[d,h])}),_=Date.now(),[4,eue(u,b,v[0],i.pnet,s)];case 1:return x=S.sent(),s.total_stage1=Date.now()-_,x.boxes.length?(s.stage2_numInputBoxes=x.boxes.length,_=Date.now(),[4,nue(o,x.boxes,v[1],i.rnet,s)]):[2,l({results:[],stats:s})];case 2:return w=S.sent(),s.total_stage2=Date.now()-_,w.boxes.length?(s.stage3_numInputBoxes=w.boxes.length,_=Date.now(),[4,iue(o,w.boxes,v[2],i.onet,s)]):[2,l({results:[],stats:s})];case 3:return M=S.sent(),s.total_stage3=Date.now()-_,T=M.boxes.map(function(I,N){return Y0(B0({},new go(M.scores[N],new L0(I.left/h,I.top/d,I.width/h,I.height/d),{height:d,width:h})),new Rse(M.points[N].map(function(O){return O.sub(new dt(I.left,I.top)).div(new dt(I.width,I.height))}),{width:I.width,height:I.height}))}),[2,l({results:T,stats:s})]}})})},t.prototype.forward=function(e,r){return void 0===r&&(r={}),pe(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Tn(e)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},t.prototype.forwardWithStats=function(e,r){return void 0===r&&(r={}),pe(this,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Tn(e)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(n){var t=[],e=function(n,t){var e=qs(n,t);function r(c){return{filters:e(c+"/weights",4,c+"/filters"),bias:e(c+"/bias",1)}}function i(c){return{weights:e(c+"/weights",2),bias:e(c+"/bias",1)}}function o(c){return e(c,1)}function s(c){return{conv1:r(c+"/conv1"),prelu1_alpha:o(c+"/prelu1_alpha"),conv2:r(c+"/conv2"),prelu2_alpha:o(c+"/prelu2_alpha"),conv3:r(c+"/conv3"),prelu3_alpha:o(c+"/prelu3_alpha")}}return{extractPNetParams:function(){var c=s("pnet"),d=r("pnet/conv4_1"),h=r("pnet/conv4_2");return er(er({},c),{conv4_1:d,conv4_2:h})},extractRNetParams:function(){var c=s("rnet"),d=i("rnet/fc1"),h=o("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),p=i("rnet/fc2_2");return er(er({},c),{fc1:d,prelu4_alpha:h,fc2_1:f,fc2_2:p})},extractONetParams:function(){var c=s("onet"),d=r("onet/conv4"),h=o("onet/prelu4_alpha"),f=i("onet/fc1"),p=o("onet/prelu5_alpha"),m=i("onet/fc2_1"),g=i("onet/fc2_2"),v=i("onet/fc2_3");return er(er({},c),{conv4:d,prelu4_alpha:h,fc1:f,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:v})}}}(n,t),i=e.extractRNetParams,o=e.extractONetParams,s=(0,e.extractPNetParams)(),a=i(),u=o();return is(n,t),{params:{pnet:s,rnet:a,onet:u},paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(n){var t=os(n),r=t.getRemainingWeights,i=[],o=function(n,t){var e=Sm(n,t),r=$0(n,t);function i(l,c){var d=fn(n(l));return t.push({paramPath:c}),d}function o(l,c,d){return void 0===d&&(d=!1),{conv1:e(l[0],l[1],3,c+"/conv1"),prelu1_alpha:i(l[1],c+"/prelu1_alpha"),conv2:e(l[1],l[2],3,c+"/conv2"),prelu2_alpha:i(l[2],c+"/prelu2_alpha"),conv3:e(l[2],l[3],d?2:3,c+"/conv3"),prelu3_alpha:i(l[3],c+"/prelu3_alpha")}}return{extractPNetParams:function(){var l=o([3,10,16,32],"pnet"),c=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return er(er({},l),{conv4_1:c,conv4_2:d})},extractRNetParams:function(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),h=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return er(er({},l),{fc1:c,prelu4_alpha:d,fc2_1:h,fc2_2:f})},extractONetParams:function(){var l=o([3,32,64,64],"onet"),c=e(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),h=r(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),m=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return er(er({},l),{conv4:c,prelu4_alpha:d,fc1:h,prelu5_alpha:f,fc2_1:p,fc2_2:m,fc2_3:g})}}}(t.extractWeights,i),a=o.extractRNetParams,u=o.extractONetParams,l=(0,o.extractPNetParams)(),c=a(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:i}}(e)},t}(rs),aue=[new dt(1.603231,2.094468),new dt(6.041143,7.080126),new dt(2.882459,3.518061),new dt(4.266906,5.178857),new dt(9.041765,10.66308)],uue=[117.001,114.697,97.404],lue=function(n){function t(){return n.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:aue,meanRgb:uue,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return Fe(t,n),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return pe(this,void 0,void 0,function(){return ge(this,function(o){switch(o.label){case 0:return[4,this.detect(e,r)];case 1:return[2,o.sent().map(function(s){return new go(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(sB),it={ssdMobilenetv1:new oB,tinyFaceDetector:new lue,tinyYolov2:new Gae,mtcnn:new oue,faceLandmark68Net:new eB,faceLandmark68TinyNet:new cae,faceRecognitionNet:new vae,faceExpressionNet:new Kse,ageGenderNet:new sae};function dB(n,t){return Object.assign({},n,{age:t})}var hB=function(n){function t(e,r,i){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=i,o}return Fe(t,n),t}(wh),iC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r,i=this;return ge(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,Tm(e=o.sent(),this.input,function(s){return pe(i,void 0,void 0,function(){return ge(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return it.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,e.map(function(s,a){return QL(s,r[a])})]}})})},t.prototype.withAgeAndGender=function(){return new uC(this,this.input)},t}(hB),oC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r;return ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,eC(e,this.input,function(o){return it.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,QL(e,r)]}})})},t.prototype.withAgeAndGender=function(){return new lC(this,this.input)},t}(hB),sC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.withAgeAndGender=function(){return new cC(this,this.input)},t.prototype.withFaceDescriptors=function(){return new hC(this,this.input)},t}(iC),aC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.withAgeAndGender=function(){return new dC(this,this.input)},t.prototype.withFaceDescriptor=function(){return new fC(this,this.input)},t}(oC),fB=function(n){function t(e,r,i){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=i,o}return Fe(t,n),t}(wh),uC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r,i=this;return ge(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,Tm(e=o.sent(),this.input,function(s){return pe(i,void 0,void 0,function(){return ge(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return it.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,e.map(function(s,a){var u=r[a],l=u.age;return dB(rB(s,u.gender,u.genderProbability),l)})]}})})},t.prototype.withFaceExpressions=function(){return new iC(this,this.input)},t}(fB),lC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r,i;return ge(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?[4,eC(e,this.input,function(u){return it.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,[2,dB(rB(e,r.gender,r.genderProbability),i)]}})})},t.prototype.withFaceExpressions=function(){return new oC(this,this.input)},t}(fB),cC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.withFaceExpressions=function(){return new sC(this,this.input)},t.prototype.withFaceDescriptors=function(){return new hC(this,this.input)},t}(uC),dC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.withFaceExpressions=function(){return new aC(this,this.input)},t.prototype.withFaceDescriptor=function(){return new fC(this,this.input)},t}(lC),pB=function(n){function t(e,r){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i}return Fe(t,n),t}(wh),hC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e;return ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,Tm(e=i.sent(),this.input,function(o){return Promise.all(o.map(function(s){return it.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,i.sent().map(function(o,s){return uB(e[s],o)})]}})})},t.prototype.withFaceExpressions=function(){return new sC(this,this.input)},t.prototype.withAgeAndGender=function(){return new cC(this,this.input)},t}(pB),fC=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r;return ge(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,eC(e,this.input,function(o){return it.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,uB(e,r)]}})})},t.prototype.withFaceExpressions=function(){return new aC(this,this.input)},t.prototype.withAgeAndGender=function(){return new dC(this,this.input)},t}(pB),gB=function(n){function t(e,r,i){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o.useTinyLandmarkNet=i,o}return Fe(t,n),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?it.faceLandmark68TinyNet:it.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(wh),cue=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r,i,o,s,a=this;return ge(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(l){return l.detection}),this.input instanceof Ct?[4,G0(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,W0(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return a.landmarkNet.detectLandmarks(l)}))];case 6:return s=u.sent(),i.forEach(function(l){return l instanceof Ct&&l.dispose()}),[2,e.map(function(l,c){return Y0(l,s[c])})]}})})},t.prototype.withFaceExpressions=function(){return new sC(this,this.input)},t.prototype.withAgeAndGender=function(){return new cC(this,this.input)},t.prototype.withFaceDescriptors=function(){return new hC(this,this.input)},t}(gB),due=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r,i,o,s;return ge(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(e=a.sent())?(r=e.detection,this.input instanceof Ct?[4,G0(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,W0(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((i=o)[0])];case 6:return s=a.sent(),i.forEach(function(u){return u instanceof Ct&&u.dispose()}),[2,Y0(e,s)]}})})},t.prototype.withFaceExpressions=function(){return new aC(this,this.input)},t.prototype.withAgeAndGender=function(){return new dC(this,this.input)},t.prototype.withFaceDescriptor=function(){return new fC(this,this.input)},t}(gB),mB=function(n){function t(e,r){void 0===r&&(r=new Mm);var i=n.call(this)||this;return i.input=e,i.options=r,i}return Fe(t,n),t}(wh),hue=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r,i,o;return ge(this,function(s){switch(s.label){case 0:return r=(e=this).input,(i=e.options)instanceof iB?[4,it.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(!(o=i instanceof aB?function(a){return it.tinyFaceDetector.locateFaces(a,i)}:i instanceof Mm?function(a){return it.ssdMobilenetv1.locateFaces(a,i)}:i instanceof Z0?function(a){return it.tinyYolov2.locateFaces(a,i)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return pe(e,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return B0({},s)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new cue(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new iC(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new uC(this.runAndExtendWithFaceDetections(),this.input)},t}(mB),fue=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Fe(t,n),t.prototype.run=function(){return pe(this,void 0,void 0,function(){var e,r;return ge(this,function(i){switch(i.label){case 0:return[4,new hue(this.input,this.options)];case 1:return e=i.sent(),r=e[0],e.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return pe(e,void 0,void 0,function(){var i;return ge(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?B0({},i):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new due(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new oC(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new lC(this.runAndExtendWithFaceDetection(),this.input)},t}(mB);function vB(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}!function(){function n(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof wm)return s;if(s instanceof Float32Array)return new wm(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new wm(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(t,e){return e.map(function(r){return function(n,t){if(n.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(n),r=Array.from(t);return Math.sqrt(e.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(r,t)}).reduce(function(r,i){return r+i},0)/(e.length||1)},n.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){return new RL(r.label,e.computeMeanDistance(t,r.descriptors))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new RL("unknown",e.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},n.fromJSON=function(t){return new n(t.labeledDescriptors.map(function(r){return wm.fromJSON(r)}),t.distanceThreshold)}}();var wue=function(){function n(t){(function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),function(n,t,e){t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e}(this,"tag",void 0),this.tag=t}return function(n,t,e){t&&vB(n.prototype,t)}(n,[{key:"call",value:function(e,r){return r.subscribe(e)}}]),n}();class gn{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(t,e=!1){return this.onePassHasher.start().appendStr(t).end(e)}static hashAsciiStr(t,e=!1){return this.onePassHasher.start().appendAsciiStr(t).end(e)}static _hex(t){const e=gn.hexChars,r=gn.hexOut;let i,o,s,a;for(a=0;a<4;a+=1)for(o=8*a,i=t[a],s=0;s<8;s+=2)r[o+1+s]=e.charAt(15&i),i>>>=4,r[o+0+s]=e.charAt(15&i),i>>>=4;return r.join("")}static _md5cycle(t,e){let r=t[0],i=t[1],o=t[2],s=t[3];r+=(i&o|~i&s)+e[0]-680876936|0,r=(r<<7|r>>>25)+i|0,s+=(r&i|~r&o)+e[1]-389564586|0,s=(s<<12|s>>>20)+r|0,o+=(s&r|~s&i)+e[2]+606105819|0,o=(o<<17|o>>>15)+s|0,i+=(o&s|~o&r)+e[3]-1044525330|0,i=(i<<22|i>>>10)+o|0,r+=(i&o|~i&s)+e[4]-176418897|0,r=(r<<7|r>>>25)+i|0,s+=(r&i|~r&o)+e[5]+1200080426|0,s=(s<<12|s>>>20)+r|0,o+=(s&r|~s&i)+e[6]-1473231341|0,o=(o<<17|o>>>15)+s|0,i+=(o&s|~o&r)+e[7]-45705983|0,i=(i<<22|i>>>10)+o|0,r+=(i&o|~i&s)+e[8]+1770035416|0,r=(r<<7|r>>>25)+i|0,s+=(r&i|~r&o)+e[9]-1958414417|0,s=(s<<12|s>>>20)+r|0,o+=(s&r|~s&i)+e[10]-42063|0,o=(o<<17|o>>>15)+s|0,i+=(o&s|~o&r)+e[11]-1990404162|0,i=(i<<22|i>>>10)+o|0,r+=(i&o|~i&s)+e[12]+1804603682|0,r=(r<<7|r>>>25)+i|0,s+=(r&i|~r&o)+e[13]-40341101|0,s=(s<<12|s>>>20)+r|0,o+=(s&r|~s&i)+e[14]-1502002290|0,o=(o<<17|o>>>15)+s|0,i+=(o&s|~o&r)+e[15]+1236535329|0,i=(i<<22|i>>>10)+o|0,r+=(i&s|o&~s)+e[1]-165796510|0,r=(r<<5|r>>>27)+i|0,s+=(r&o|i&~o)+e[6]-1069501632|0,s=(s<<9|s>>>23)+r|0,o+=(s&i|r&~i)+e[11]+643717713|0,o=(o<<14|o>>>18)+s|0,i+=(o&r|s&~r)+e[0]-373897302|0,i=(i<<20|i>>>12)+o|0,r+=(i&s|o&~s)+e[5]-701558691|0,r=(r<<5|r>>>27)+i|0,s+=(r&o|i&~o)+e[10]+38016083|0,s=(s<<9|s>>>23)+r|0,o+=(s&i|r&~i)+e[15]-660478335|0,o=(o<<14|o>>>18)+s|0,i+=(o&r|s&~r)+e[4]-405537848|0,i=(i<<20|i>>>12)+o|0,r+=(i&s|o&~s)+e[9]+568446438|0,r=(r<<5|r>>>27)+i|0,s+=(r&o|i&~o)+e[14]-1019803690|0,s=(s<<9|s>>>23)+r|0,o+=(s&i|r&~i)+e[3]-187363961|0,o=(o<<14|o>>>18)+s|0,i+=(o&r|s&~r)+e[8]+1163531501|0,i=(i<<20|i>>>12)+o|0,r+=(i&s|o&~s)+e[13]-1444681467|0,r=(r<<5|r>>>27)+i|0,s+=(r&o|i&~o)+e[2]-51403784|0,s=(s<<9|s>>>23)+r|0,o+=(s&i|r&~i)+e[7]+1735328473|0,o=(o<<14|o>>>18)+s|0,i+=(o&r|s&~r)+e[12]-1926607734|0,i=(i<<20|i>>>12)+o|0,r+=(i^o^s)+e[5]-378558|0,r=(r<<4|r>>>28)+i|0,s+=(r^i^o)+e[8]-2022574463|0,s=(s<<11|s>>>21)+r|0,o+=(s^r^i)+e[11]+1839030562|0,o=(o<<16|o>>>16)+s|0,i+=(o^s^r)+e[14]-35309556|0,i=(i<<23|i>>>9)+o|0,r+=(i^o^s)+e[1]-1530992060|0,r=(r<<4|r>>>28)+i|0,s+=(r^i^o)+e[4]+1272893353|0,s=(s<<11|s>>>21)+r|0,o+=(s^r^i)+e[7]-155497632|0,o=(o<<16|o>>>16)+s|0,i+=(o^s^r)+e[10]-1094730640|0,i=(i<<23|i>>>9)+o|0,r+=(i^o^s)+e[13]+681279174|0,r=(r<<4|r>>>28)+i|0,s+=(r^i^o)+e[0]-358537222|0,s=(s<<11|s>>>21)+r|0,o+=(s^r^i)+e[3]-722521979|0,o=(o<<16|o>>>16)+s|0,i+=(o^s^r)+e[6]+76029189|0,i=(i<<23|i>>>9)+o|0,r+=(i^o^s)+e[9]-640364487|0,r=(r<<4|r>>>28)+i|0,s+=(r^i^o)+e[12]-421815835|0,s=(s<<11|s>>>21)+r|0,o+=(s^r^i)+e[15]+530742520|0,o=(o<<16|o>>>16)+s|0,i+=(o^s^r)+e[2]-995338651|0,i=(i<<23|i>>>9)+o|0,r+=(o^(i|~s))+e[0]-198630844|0,r=(r<<6|r>>>26)+i|0,s+=(i^(r|~o))+e[7]+1126891415|0,s=(s<<10|s>>>22)+r|0,o+=(r^(s|~i))+e[14]-1416354905|0,o=(o<<15|o>>>17)+s|0,i+=(s^(o|~r))+e[5]-57434055|0,i=(i<<21|i>>>11)+o|0,r+=(o^(i|~s))+e[12]+1700485571|0,r=(r<<6|r>>>26)+i|0,s+=(i^(r|~o))+e[3]-1894986606|0,s=(s<<10|s>>>22)+r|0,o+=(r^(s|~i))+e[10]-1051523|0,o=(o<<15|o>>>17)+s|0,i+=(s^(o|~r))+e[1]-2054922799|0,i=(i<<21|i>>>11)+o|0,r+=(o^(i|~s))+e[8]+1873313359|0,r=(r<<6|r>>>26)+i|0,s+=(i^(r|~o))+e[15]-30611744|0,s=(s<<10|s>>>22)+r|0,o+=(r^(s|~i))+e[6]-1560198380|0,o=(o<<15|o>>>17)+s|0,i+=(s^(o|~r))+e[13]+1309151649|0,i=(i<<21|i>>>11)+o|0,r+=(o^(i|~s))+e[4]-145523070|0,r=(r<<6|r>>>26)+i|0,s+=(i^(r|~o))+e[11]-1120210379|0,s=(s<<10|s>>>22)+r|0,o+=(r^(s|~i))+e[2]+718787259|0,o=(o<<15|o>>>17)+s|0,i+=(s^(o|~r))+e[9]-343485551|0,i=(i<<21|i>>>11)+o|0,t[0]=r+t[0]|0,t[1]=i+t[1]|0,t[2]=o+t[2]|0,t[3]=s+t[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(gn.stateIdentity),this}appendStr(t){const e=this._buffer8,r=this._buffer32;let o,s,i=this._bufferLength;for(s=0;s<t.length;s+=1){if(o=t.charCodeAt(s),o<128)e[i++]=o;else if(o<2048)e[i++]=192+(o>>>6),e[i++]=63&o|128;else if(o<55296||o>56319)e[i++]=224+(o>>>12),e[i++]=o>>>6&63|128,e[i++]=63&o|128;else{if(o=1024*(o-55296)+(t.charCodeAt(++s)-56320)+65536,o>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");e[i++]=240+(o>>>18),e[i++]=o>>>12&63|128,e[i++]=o>>>6&63|128,e[i++]=63&o|128}i>=64&&(this._dataLength+=64,gn._md5cycle(this._state,r),i-=64,r[0]=r[16])}return this._bufferLength=i,this}appendAsciiStr(t){const e=this._buffer8,r=this._buffer32;let o,i=this._bufferLength,s=0;for(;;){for(o=Math.min(t.length-s,64-i);o--;)e[i++]=t.charCodeAt(s++);if(i<64)break;this._dataLength+=64,gn._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}appendByteArray(t){const e=this._buffer8,r=this._buffer32;let o,i=this._bufferLength,s=0;for(;;){for(o=Math.min(t.length-s,64-i);o--;)e[i++]=t[s++];if(i<64)break;this._dataLength+=64,gn._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}getState(){const t=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[t[0],t[1],t[2],t[3]]}}setState(t){const e=t.buffer,r=t.state,i=this._state;let o;for(this._dataLength=t.length,this._bufferLength=t.buflen,i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],o=0;o<e.length;o+=1)this._buffer8[o]=e.charCodeAt(o)}end(t=!1){const e=this._bufferLength,r=this._buffer8,i=this._buffer32,o=1+(e>>2);this._dataLength+=e;const s=8*this._dataLength;if(r[e]=128,r[e+1]=r[e+2]=r[e+3]=0,i.set(gn.buffer32Identity.subarray(o),o),e>55&&(gn._md5cycle(this._state,i),i.set(gn.buffer32Identity)),s<=4294967295)i[14]=s;else{const a=s.toString(16).match(/(.*?)(.{0,8})$/);if(null===a)return;const u=parseInt(a[2],16),l=parseInt(a[1],16)||0;i[14]=u,i[15]=l}return gn._md5cycle(this._state,i),t?this._state:gn._hex(this._state)}}if(gn.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),gn.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),gn.hexChars="0123456789abcdef",gn.hexOut=[],gn.onePassHasher=new gn,"5d41402abc4b2a76b9719d911017c592"!==gn.hashStr("hello"))throw new Error("Md5 self test failed.");let pC=(()=>{class n{constructor(){this.authorization$bs=new cr(this.getItem("authorization")),this.authorization$=this.authorization$bs.asObservable()}get storage(){return window.localStorage}get length(){return this.storage.length}clear(){return this.storage.clear()}key(e){return this.storage.key(e)}removeItem(e){return this.storage.removeItem(e)}getItem(e){return this.storage.getItem(e)}setItem(e,r){this.storage.setItem(e,r)}setAuthorization(e){this.setItem("authorization",e),this.authorization$bs.next(e)}getAuthorization(){return this.authorization$bs.getValue()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Cue=(()=>{class n{constructor(e,r){this.http=e,this.ls=r,this.isLogin$=this.ls.authorization$.pipe(Se(i=>!!i))}login(e,r){return this.http.post("api/public/user/login",{username:e,password:this.encodePassword(r)}).pipe(_l())}register(e,r,i){return this.http.post("api/public/user/register",{username:e,password:this.encodePassword(r),role:i}).pipe(_l())}getUser(){return this.http.get("api/user").pipe(_l())}encodePassword(e){return gn.hashStr(e)}}return n.\u0275fac=function(e){return new(e||n)(R(yl),R(pC))},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Eue=(()=>{class n{constructor(){this.colors={primary:"color: #000; background: #0f0; font-size: 16px;",secondary:"color: #000; background: #fe0; font-size: 14px;"}}tap1(...e){const[r,...i]=e;return this.tapInfo(`%c${r}`,this.colors.primary,...i)}tap2(...e){const[r,...i]=e;return this.tapInfo(`%c${r}`,this.colors.secondary,...i)}tapInfo(...e){return ln((...r)=>this.log(...e,...r))}tapWarn(...e){return ln((...r)=>this.warn(...e,...r))}tapError(...e){return ln((...r)=>this.error(...e,...r))}log(...e){return gC(1)&&console.log(...e)}warn(...e){return gC(10)&&console.warn(...e)}error(...e){return gC(20)&&console.error(...e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function gC(n){const t=window.logLevel;return!t||n>=t}let Due=(()=>{class n{constructor(e,r){this.http=e,this.log=r}ngOnDestroy(){}getWebcamStream(){return Jt(navigator.mediaDevices.getUserMedia({video:!0,audio:!1})).pipe(function(e){return e.lift(new wue("getWebcamStream"))})}startDetecting(e,r=1e3){return Jt(this.loadModel()).pipe(yr(()=>n2(r)),En(()=>{const i=Date.now();return Jt(this.detect(e)).pipe(Se(o=>({time:i,result:o})))}),Se(({time:i,result:o})=>{var s,a;const u=null==o?void 0:o.expressions,l=null===(s=null==u?void 0:u.asSortedArray())||void 0===s?void 0:s[0],c=null===(a=n.expressionsLevel[null==l?void 0:l.expression])||void 0===a?void 0:a.cn;return{time:i,value:this.expressionToValue(l),expressions:u,expression:null==l?void 0:l.expression,expressionCn:c}}))}stopTracks(e){e.getTracks().forEach(r=>r.stop())}setTracksEnabled(e,r){e.getTracks().forEach(i=>i.enabled=r)}startTimer(e=1e3){return _e(Date.now()).pipe(yr(r=>n2(e).pipe(Se(()=>Date.now()-r))),Se(this.timeDiffToString))}saveResults(e){return this.http.post("/api/watch-log",{courseId:1,emotion:JSON.stringify(e)}).pipe(this.log.tap1("saveResults"),_l())}loadModel(){return t2(function*(){it.tinyFaceDetector.params||(yield it.tinyFaceDetector.load("/assets/models")),it.faceExpressionNet.params||(yield it.faceExpressionNet.load("/assets/models"))})()}detect(e){return t2(function*(){return yield function(n,t){return void 0===t&&(t=new Mm),new fue(n,t)}(e,new aB({inputSize:512,scoreThreshold:.5})).withFaceExpressions()})()}expressionToValue(e){if(e){const r=n.expressionsLevel[null==e?void 0:e.expression].baseValue;return r<0?r-e.probability:r+e.probability}}timeDiffToString(e){const r=Math.floor(e/1e3/60/60);e-=1e3*r*60*60;const i=Math.floor(e/1e3/60);e-=1e3*i*60;const o=Math.floor(e/1e3);return e-=1e3*o,`${r}\u5c0f\u65f6${i}\u5206\u949f${o}\u79d2`}}return n.expressionsLevel={surprised:{cn:"\u60ca\u559c",baseValue:2},happy:{cn:"\u5f00\u5fc3",baseValue:1},neutral:{cn:"\u5e73\u9759",baseValue:0},sad:{cn:"\u4f24\u5fc3",baseValue:-1},disgusted:{cn:"\u6076\u5fc3",baseValue:-2},fearful:{cn:"\u62c5\u5fc3",baseValue:-3},angry:{cn:"\u751f\u6c14",baseValue:-4}},n.\u0275fac=function(e){return new(e||n)(R(yl),R(Eue))},n.\u0275prov=K({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Aue={provide:g_,useFactory:function(n,t){return()=>{if(wa(t)){const e=Array.from(n.querySelectorAll(`[class*=${yB}]`)),r=/\bflex-layout-.+?\b/g;e.forEach(i=>{i.classList.contains(`${yB}ssr`)&&i.parentNode?i.parentNode.removeChild(i):i.className.replace(r,"")})}}},deps:[ae,Yn],multi:!0},yB="flex-layout-";let mC=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({providers:[Aue]}),n})();class ru{constructor(t=!1,e="all",r="",i="",o=0){this.matches=t,this.mediaQuery=e,this.mqAlias=r,this.suffix=i,this.priority=o,this.property=""}clone(){return new ru(this.matches,this.mediaQuery,this.mqAlias,this.suffix)}}let _B=(()=>{class n{constructor(){this.stylesheet=new Map}addStyleToElement(e,r,i){const o=this.stylesheet.get(e);o?o.set(r,i):this.stylesheet.set(e,new Map([[r,i]]))}clearStyles(){this.stylesheet.clear()}getStyleForElement(e,r){const i=this.stylesheet.get(e);let o="";if(i){const s=i.get(r);("number"==typeof s||"string"==typeof s)&&(o=s+"")}return o}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=K({factory:function(){return new n},token:n,providedIn:"root"}),n})();const vC={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[]},Vi=new re("Flex Layout token, config options for the library",{providedIn:"root",factory:()=>vC}),iu=new re("FlexLayoutServerLoaded",{providedIn:"root",factory:()=>!1}),yC=new re("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:()=>null});function bB(n,t){return n=n?n.clone():new ru,t&&(n.mqAlias=t.alias,n.mediaQuery=t.mediaQuery,n.suffix=t.suffix,n.priority=t.priority),n}const _C="inline",xB=["row","column","row-reverse","column-reverse"];function Tue(n){if(n)switch(n.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":n="wrap-reverse";break;case"no":case"none":case"nowrap":n="nowrap";break;default:n="wrap"}return n}let Bt=(()=>{class n{constructor(e,r,i,o){this.elementRef=e,this.styleBuilder=r,this.styler=i,this.marshal=o,this.DIRECTIVE_KEY="",this.inputs=[],this.mru={},this.destroySubject=new be,this.styleCache=new Map}get parentElement(){return this.elementRef.nativeElement.parentElement}get nativeElement(){return this.elementRef.nativeElement}get activatedValue(){return this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY)}set activatedValue(e){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,this.marshal.activatedAlias)}ngOnChanges(e){Object.keys(e).forEach(r=>{if(-1!==this.inputs.indexOf(r)){const i=r.split(".").slice(1).join(".");this.setValue(e[r].currentValue,i)}})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete(),this.marshal.releaseElement(this.nativeElement)}init(e=[]){this.marshal.init(this.elementRef.nativeElement,this.DIRECTIVE_KEY,this.updateWithValue.bind(this),this.clearStyles.bind(this),e)}addStyles(e,r){const i=this.styleBuilder,o=i.shouldCache;let s=this.styleCache.get(e);(!s||!o)&&(s=i.buildStyles(e,r),o&&this.styleCache.set(e,s)),this.mru=Object.assign({},s),this.applyStyleToElement(s),i.sideEffect(e,s,r)}clearStyles(){Object.keys(this.mru).forEach(e=>{this.mru[e]=""}),this.applyStyleToElement(this.mru),this.mru={}}triggerUpdate(){this.marshal.triggerUpdate(this.nativeElement,this.DIRECTIVE_KEY)}getFlexFlowDirection(e,r=!1){if(e){const[i,o]=this.styler.getFlowDirection(e);if(!o&&r){const s=function(n){let[t,e,r]=function(n){n=n?n.toLowerCase():"";let[t,e,r]=n.split(" ");return xB.find(i=>i===t)||(t=xB[0]),e===_C&&(e=r!==_C?r:"",r=_C),[t,Tue(e),!!r]}(n);return function(n,t=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":n,"flex-wrap":t||null}}(t,e,r)}(i);this.styler.applyStyleToElements(s,[e])}return i.trim()}return"row"}hasWrap(e){return this.styler.hasWrap(e)}applyStyleToElement(e,r,i=this.nativeElement){this.styler.applyStyleToElement(i,e,r)}setValue(e,r){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,r)}updateWithValue(e){this.currentValue!==e&&(this.addStyles(e),this.currentValue=e)}}return n.\u0275fac=function(e){!function(){throw new Error("invalid")}()},n.\u0275dir=$({type:n,features:[Wt]}),n})();const Fue=[{alias:"xs",mediaQuery:"screen and (min-width: 0px) and (max-width: 599.98px)",priority:1e3},{alias:"sm",mediaQuery:"screen and (min-width: 600px) and (max-width: 959.98px)",priority:900},{alias:"md",mediaQuery:"screen and (min-width: 960px) and (max-width: 1279.98px)",priority:800},{alias:"lg",mediaQuery:"screen and (min-width: 1280px) and (max-width: 1919.98px)",priority:700},{alias:"xl",mediaQuery:"screen and (min-width: 1920px) and (max-width: 4999.98px)",priority:600},{alias:"lt-sm",overlapping:!0,mediaQuery:"screen and (max-width: 599.98px)",priority:950},{alias:"lt-md",overlapping:!0,mediaQuery:"screen and (max-width: 959.98px)",priority:850},{alias:"lt-lg",overlapping:!0,mediaQuery:"screen and (max-width: 1279.98px)",priority:750},{alias:"lt-xl",overlapping:!0,priority:650,mediaQuery:"screen and (max-width: 1919.98px)"},{alias:"gt-xs",overlapping:!0,mediaQuery:"screen and (min-width: 600px)",priority:-950},{alias:"gt-sm",overlapping:!0,mediaQuery:"screen and (min-width: 960px)",priority:-850},{alias:"gt-md",overlapping:!0,mediaQuery:"screen and (min-width: 1280px)",priority:-750},{alias:"gt-lg",overlapping:!0,mediaQuery:"screen and (min-width: 1920px)",priority:-650}],wB="(orientation: portrait) and (max-width: 599.98px)",CB="(orientation: landscape) and (max-width: 959.98px)",EB="(orientation: portrait) and (min-width: 600px) and (max-width: 839.98px)",DB="(orientation: landscape) and (min-width: 960px) and (max-width: 1279.98px)",SB="(orientation: portrait) and (min-width: 840px)",AB="(orientation: landscape) and (min-width: 1280px)",ss={HANDSET:`${wB}, ${CB}`,TABLET:`${EB} , ${DB}`,WEB:`${SB}, ${AB} `,HANDSET_PORTRAIT:`${wB}`,TABLET_PORTRAIT:`${EB} `,WEB_PORTRAIT:`${SB}`,HANDSET_LANDSCAPE:`${CB}`,TABLET_LANDSCAPE:`${DB}`,WEB_LANDSCAPE:`${AB}`},kue=[{alias:"handset",priority:2e3,mediaQuery:ss.HANDSET},{alias:"handset.landscape",priority:2e3,mediaQuery:ss.HANDSET_LANDSCAPE},{alias:"handset.portrait",priority:2e3,mediaQuery:ss.HANDSET_PORTRAIT},{alias:"tablet",priority:2100,mediaQuery:ss.TABLET},{alias:"tablet.landscape",priority:2100,mediaQuery:ss.TABLET_LANDSCAPE},{alias:"tablet.portrait",priority:2100,mediaQuery:ss.TABLET_PORTRAIT},{alias:"web",priority:2200,mediaQuery:ss.WEB,overlapping:!0},{alias:"web.landscape",priority:2200,mediaQuery:ss.WEB_LANDSCAPE,overlapping:!0},{alias:"web.portrait",priority:2200,mediaQuery:ss.WEB_PORTRAIT,overlapping:!0}],Nue=/(\.|-|_)/g;function Pue(n){let t=n.length>0?n.charAt(0):"",e=n.length>1?n.slice(1):"";return t.toUpperCase()+e}function Vue(n,t=[]){const e={};return n.forEach(r=>{e[r.alias]=r}),t.forEach(r=>{e[r.alias]?function(n,...t){if(null==n)throw TypeError("Cannot convert undefined or null to object");for(let e of t)if(null!=e)for(let r in e)e.hasOwnProperty(r)&&(n[r]=e[r])}(e[r.alias],r):e[r.alias]=r}),function(n){return n.forEach(t=>{t.suffix||(t.suffix=function(n){return n.replace(Nue,"|").split("|").map(Pue).join("")}(t.alias),t.overlapping=!!t.overlapping)}),n}(Object.keys(e).map(r=>e[r]))}const MB=new re("Token (@angular/flex-layout) Breakpoints",{providedIn:"root",factory:()=>{const n=_c(yC),t=_c(Vi),e=[].concat.apply([],(n||[]).map(i=>Array.isArray(i)?i:[i]));return Vue((t.disableDefaultBps?[]:Fue).concat(t.addOrientationBps?kue:[]),e)}});function Ch(n,t){return(t&&t.priority||0)-(n&&n.priority||0)}function Hue(n,t){return(n.priority||0)-(t.priority||0)}let Eh=(()=>{class n{constructor(e){this.findByMap=new Map,this.items=[...e].sort(Hue)}findByAlias(e){return e?this.findWithPredicate(e,r=>r.alias==e):null}findByQuery(e){return this.findWithPredicate(e,r=>r.mediaQuery==e)}get overlappings(){return this.items.filter(e=>1==e.overlapping)}get aliases(){return this.items.map(e=>e.alias)}get suffixes(){return this.items.map(e=>e.suffix?e.suffix:"")}findWithPredicate(e,r){let i=this.findByMap.get(e);return i||(i=this.items.find(r)||null,this.findByMap.set(e,i)),i||null}}return n.\u0275fac=function(e){return new(e||n)(R(MB))},n.\u0275prov=K({factory:function(){return new n(R(MB))},token:n,providedIn:"root"}),n})(),km=(()=>{class n{constructor(e,r,i){this._zone=e,this._platformId=r,this._document=i,this.source=new cr(new ru(!0)),this.registry=new Map,this.pendingRemoveListenerFns=[],this._observable$=this.source.asObservable()}get activations(){const e=[];return this.registry.forEach((r,i)=>{r.matches&&e.push(i)}),e}isActive(e){const r=this.registry.get(e);return r?r.matches:this.registerQuery(e).some(i=>i.matches)}observe(e,r=!1){if(e&&e.length){const i=this._observable$.pipe(vr(s=>!r||e.indexOf(s.mediaQuery)>-1));return ic(new Ke(s=>{const a=this.registerQuery(e);if(a.length){const u=a.pop();a.forEach(l=>{s.next(l)}),this.source.next(u)}s.complete()}),i)}return this._observable$}registerQuery(e){const r=Array.isArray(e)?e:[e],i=[];return function(n,t){const e=n.filter(r=>!IB[r]);if(e.length>0){const r=e.join(", ");try{const i=t.createElement("style");i.setAttribute("type","text/css"),i.styleSheet||i.appendChild(t.createTextNode(`\n/*\n  @angular/flex-layout - workaround for possible browser quirk with mediaQuery listeners\n  see http://bit.ly/2sd4HMP\n*/\n@media ${r} {.fx-query-test{ }}\n`)),t.head.appendChild(i),e.forEach(o=>IB[o]=i)}catch(i){console.error(i)}}}(r,this._document),r.forEach(o=>{const s=u=>{this._zone.run(()=>this.source.next(new ru(u.matches,o)))};let a=this.registry.get(o);a||(a=this.buildMQL(o),a.addListener(s),this.pendingRemoveListenerFns.push(()=>a.removeListener(s)),this.registry.set(o,a)),a.matches&&i.push(new ru(!0,o))}),i}ngOnDestroy(){let e;for(;e=this.pendingRemoveListenerFns.pop();)e()}buildMQL(e){return function(n,t){return t&&window.matchMedia("all").addListener?window.matchMedia(n):{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{},onchange:null,addEventListener(){},removeEventListener(){},dispatchEvent:()=>!1}}(e,wa(this._platformId))}}return n.\u0275fac=function(e){return new(e||n)(R(ve),R(Yn),R(ae))},n.\u0275prov=K({factory:function(){return new n(R(ve),R(Yn),R(ae))},token:n,providedIn:"root"}),n})();const IB={},Ql="print",zue={alias:Ql,mediaQuery:Ql,priority:1e3};let TB=(()=>{class n{constructor(e,r,i){this.breakpoints=e,this.layoutConfig=r,this._document=i,this.registeredBeforeAfterPrintHooks=!1,this.isPrintingBeforeAfterEvent=!1,this.beforePrintEventListeners=[],this.afterPrintEventListeners=[],this.isPrinting=!1,this.queue=new $ue,this.deactivations=[]}withPrintQuery(e){return[...e,Ql]}isPrintEvent(e){return e.mediaQuery.startsWith(Ql)}get printAlias(){return this.layoutConfig.printWithBreakpoints||[]}get printBreakPoints(){return this.printAlias.map(e=>this.breakpoints.findByAlias(e)).filter(e=>null!==e)}getEventBreakpoints({mediaQuery:e}){const r=this.breakpoints.findByQuery(e);return(r?[...this.printBreakPoints,r]:this.printBreakPoints).sort(Ch)}updateEvent(e){let r=this.breakpoints.findByQuery(e.mediaQuery);return this.isPrintEvent(e)&&(r=this.getEventBreakpoints(e)[0],e.mediaQuery=r?r.mediaQuery:""),bB(e,r)}registerBeforeAfterPrintHooks(e){if(!this._document.defaultView||this.registeredBeforeAfterPrintHooks)return;this.registeredBeforeAfterPrintHooks=!0;const r=()=>{this.isPrinting||(this.isPrintingBeforeAfterEvent=!0,this.startPrinting(e,this.getEventBreakpoints(new ru(!0,Ql))),e.updateStyles())},i=()=>{this.isPrintingBeforeAfterEvent=!1,this.isPrinting&&(this.stopPrinting(e),e.updateStyles())};this._document.defaultView.addEventListener("beforeprint",r),this._document.defaultView.addEventListener("afterprint",i),this.beforePrintEventListeners.push(r),this.afterPrintEventListeners.push(i)}interceptEvents(e){return this.registerBeforeAfterPrintHooks(e),r=>{this.isPrintEvent(r)?r.matches&&!this.isPrinting?(this.startPrinting(e,this.getEventBreakpoints(r)),e.updateStyles()):!r.matches&&this.isPrinting&&!this.isPrintingBeforeAfterEvent&&(this.stopPrinting(e),e.updateStyles()):this.collectActivations(r)}}blockPropagation(){return e=>!(this.isPrinting||this.isPrintEvent(e))}startPrinting(e,r){this.isPrinting=!0,e.activatedBreakpoints=this.queue.addPrintBreakpoints(r)}stopPrinting(e){e.activatedBreakpoints=this.deactivations,this.deactivations=[],this.queue.clear(),this.isPrinting=!1}collectActivations(e){if(!this.isPrinting||this.isPrintingBeforeAfterEvent)if(e.matches)this.isPrintingBeforeAfterEvent||(this.deactivations=[]);else{const r=this.breakpoints.findByQuery(e.mediaQuery);r&&(this.deactivations.push(r),this.deactivations.sort(Ch))}}ngOnDestroy(){this._document.defaultView&&(this.beforePrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("beforeprint",e)),this.afterPrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("afterprint",e)))}}return n.\u0275fac=function(e){return new(e||n)(R(Eh),R(Vi),R(ae))},n.\u0275prov=K({factory:function(){return new n(R(Eh),R(Vi),R(ae))},token:n,providedIn:"root"}),n})();class $ue{constructor(){this.printBreakpoints=[]}addPrintBreakpoints(t){return t.push(zue),t.sort(Ch),t.forEach(e=>this.addBreakpoint(e)),this.printBreakpoints}addBreakpoint(t){t&&void 0===this.printBreakpoints.find(r=>r.mediaQuery===t.mediaQuery)&&(this.printBreakpoints=function(n){return!!n&&n.mediaQuery.startsWith(Ql)}(t)?[t,...this.printBreakpoints]:[...this.printBreakpoints,t])}clear(){this.printBreakpoints=[]}}function RB(n){for(let t in n){let e=n[t]||"";switch(t){case"display":n.display="flex"===e?["-webkit-flex","flex"]:"inline-flex"===e?["-webkit-inline-flex","inline-flex"]:e;break;case"align-items":case"align-self":case"align-content":case"flex":case"flex-basis":case"flex-flow":case"flex-grow":case"flex-shrink":case"flex-wrap":case"justify-content":n["-webkit-"+t]=e;break;case"flex-direction":e=e||"row",n["-webkit-flex-direction"]=e,n["flex-direction"]=e;break;case"order":n.order=n["-webkit-"+t]=isNaN(+e)?"0":e}}return n}let Mt=(()=>{class n{constructor(e,r,i,o){this._serverStylesheet=e,this._serverModuleLoaded=r,this._platformId=i,this.layoutConfig=o}applyStyleToElement(e,r,i=null){let o={};"string"==typeof r&&(o[r]=i,r=o),o=this.layoutConfig.disableVendorPrefixes?r:RB(r),this._applyMultiValueStyleToElement(o,e)}applyStyleToElements(e,r=[]){const i=this.layoutConfig.disableVendorPrefixes?e:RB(e);r.forEach(o=>{this._applyMultiValueStyleToElement(i,o)})}getFlowDirection(e){const r="flex-direction";let i=this.lookupStyle(e,r);return[i||"row",this.lookupInlineStyle(e,r)||cl(this._platformId)&&this._serverModuleLoaded?i:""]}hasWrap(e){return"wrap"===this.lookupStyle(e,"flex-wrap")}lookupAttributeValue(e,r){return e.getAttribute(r)||""}lookupInlineStyle(e,r){return wa(this._platformId)?e.style.getPropertyValue(r):this._getServerStyle(e,r)}lookupStyle(e,r,i=!1){let o="";return e&&((o=this.lookupInlineStyle(e,r))||(wa(this._platformId)?i||(o=getComputedStyle(e).getPropertyValue(r)):this._serverModuleLoaded&&(o=this._serverStylesheet.getStyleForElement(e,r)))),o?o.trim():""}_applyMultiValueStyleToElement(e,r){Object.keys(e).sort().forEach(i=>{const o=e[i],s=Array.isArray(o)?o:[o];s.sort();for(let a of s)a=a?a+"":"",wa(this._platformId)||!this._serverModuleLoaded?wa(this._platformId)?r.style.setProperty(i,a):this._setServerStyle(r,i,a):this._serverStylesheet.addStyleToElement(r,i,a)})}_setServerStyle(e,r,i){r=r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();const o=this._readStyleAttribute(e);o[r]=i||"",this._writeStyleAttribute(e,o)}_getServerStyle(e,r){return this._readStyleAttribute(e)[r]||""}_readStyleAttribute(e){const r={},i=e.getAttribute("style");if(i){const o=i.split(/;+/g);for(let s=0;s<o.length;s++){const a=o[s].trim();if(a.length>0){const u=a.indexOf(":");if(-1===u)throw new Error(`Invalid CSS style: ${a}`);r[a.substr(0,u).trim()]=a.substr(u+1).trim()}}}return r}_writeStyleAttribute(e,r){let i="";for(const o in r)r[o]&&(i+=o+":"+r[o]+";");e.setAttribute("style",i)}}return n.\u0275fac=function(e){return new(e||n)(R(_B),R(iu),R(Yn),R(Vi))},n.\u0275prov=K({factory:function(){return new n(R(_B),R(iu),R(Yn),R(Vi))},token:n,providedIn:"root"}),n})();let Vt=(()=>{class n{constructor(e,r,i){this.matchMedia=e,this.breakpoints=r,this.hook=i,this.activatedBreakpoints=[],this.elementMap=new Map,this.elementKeyMap=new WeakMap,this.watcherMap=new WeakMap,this.updateMap=new WeakMap,this.clearMap=new WeakMap,this.subject=new be,this.observeActivations()}get activatedAlias(){return this.activatedBreakpoints[0]?this.activatedBreakpoints[0].alias:""}onMediaChange(e){const r=this.findByQuery(e.mediaQuery);r&&((e=bB(e,r)).matches&&-1===this.activatedBreakpoints.indexOf(r)?(this.activatedBreakpoints.push(r),this.activatedBreakpoints.sort(Ch),this.updateStyles()):!e.matches&&-1!==this.activatedBreakpoints.indexOf(r)&&(this.activatedBreakpoints.splice(this.activatedBreakpoints.indexOf(r),1),this.activatedBreakpoints.sort(Ch),this.updateStyles()))}init(e,r,i,o,s=[]){OB(this.updateMap,e,r,i),OB(this.clearMap,e,r,o),this.buildElementKeyMap(e,r),this.watchExtraTriggers(e,r,s)}getValue(e,r,i){const o=this.elementMap.get(e);if(o){const s=void 0!==i?o.get(i):this.getActivatedValues(o,r);if(s)return s.get(r)}}hasValue(e,r){const i=this.elementMap.get(e);if(i){const o=this.getActivatedValues(i,r);if(o)return void 0!==o.get(r)||!1}return!1}setValue(e,r,i,o){let s=this.elementMap.get(e);if(s){const u=(s.get(o)||new Map).set(r,i);s.set(o,u),this.elementMap.set(e,s)}else s=(new Map).set(o,(new Map).set(r,i)),this.elementMap.set(e,s);const a=this.getValue(e,r);void 0!==a&&this.updateElement(e,r,a)}trackValue(e,r){return this.subject.asObservable().pipe(vr(i=>i.element===e&&i.key===r))}updateStyles(){this.elementMap.forEach((e,r)=>{const i=new Set(this.elementKeyMap.get(r));let o=this.getActivatedValues(e);o&&o.forEach((s,a)=>{this.updateElement(r,a,s),i.delete(a)}),i.forEach(s=>{if(o=this.getActivatedValues(e,s),o){const a=o.get(s);this.updateElement(r,s,a)}else this.clearElement(r,s)})})}clearElement(e,r){const i=this.clearMap.get(e);if(i){const o=i.get(r);o&&(o(),this.subject.next({element:e,key:r,value:""}))}}updateElement(e,r,i){const o=this.updateMap.get(e);if(o){const s=o.get(r);s&&(s(i),this.subject.next({element:e,key:r,value:i}))}}releaseElement(e){const r=this.watcherMap.get(e);r&&(r.forEach(o=>o.unsubscribe()),this.watcherMap.delete(e));const i=this.elementMap.get(e);i&&(i.forEach((o,s)=>i.delete(s)),this.elementMap.delete(e))}triggerUpdate(e,r){const i=this.elementMap.get(e);if(i){const o=this.getActivatedValues(i,r);o&&(r?this.updateElement(e,r,o.get(r)):o.forEach((s,a)=>this.updateElement(e,a,s)))}}buildElementKeyMap(e,r){let i=this.elementKeyMap.get(e);i||(i=new Set,this.elementKeyMap.set(e,i)),i.add(r)}watchExtraTriggers(e,r,i){if(i&&i.length){let o=this.watcherMap.get(e);if(o||(o=new Map,this.watcherMap.set(e,o)),!o.get(r)){const a=ic(...i).subscribe(()=>{const u=this.getValue(e,r);this.updateElement(e,r,u)});o.set(r,a)}}}findByQuery(e){return this.breakpoints.findByQuery(e)}getActivatedValues(e,r){for(let o=0;o<this.activatedBreakpoints.length;o++){const a=e.get(this.activatedBreakpoints[o].alias);if(a&&(void 0===r||a.has(r)&&null!=a.get(r)))return a}const i=e.get("");return void 0===r||i&&i.has(r)?i:void 0}observeActivations(){const r=this.breakpoints.items.map(i=>i.mediaQuery);this.matchMedia.observe(this.hook.withPrintQuery(r)).pipe(ln(this.hook.interceptEvents(this)),vr(this.hook.blockPropagation())).subscribe(this.onMediaChange.bind(this))}}return n.\u0275fac=function(e){return new(e||n)(R(km),R(Eh),R(TB))},n.\u0275prov=K({factory:function(){return new n(R(km),R(Eh),R(TB))},token:n,providedIn:"root"}),n})();function OB(n,t,e,r){if(void 0!==r){let i=n.get(t);i||(i=new Map,n.set(t,i)),i.set(e,r)}}const bC="inline",Om=["row","column","row-reverse","column-reverse"];function Yue(n){if(n)switch(n.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":n="wrap-reverse";break;case"no":case"none":case"nowrap":n="nowrap";break;default:n="wrap"}return n}let Que=(()=>{class n extends class{constructor(){this.shouldCache=!0}sideEffect(t,e,r){}}{buildStyles(e){return function(n){let[t,e,r]=function(n){n=n?n.toLowerCase():"";let[t,e,r]=n.split(" ");return Om.find(i=>i===t)||(t=Om[0]),e===bC&&(e=r!==bC?r:"",r=bC),[t,Yue(e),!!r]}(n);return function(n,t=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":n,"flex-wrap":t||null}}(t,e,r)}(e)}}return n.\u0275fac=function(){let t;return function(r){return(t||(t=me(n)))(r||n)}}(),n.\u0275prov=K({factory:function(){return new n},token:n,providedIn:"root"}),n})();const Jue=["fxLayout","fxLayout.xs","fxLayout.sm","fxLayout.md","fxLayout.lg","fxLayout.xl","fxLayout.lt-sm","fxLayout.lt-md","fxLayout.lt-lg","fxLayout.lt-xl","fxLayout.gt-xs","fxLayout.gt-sm","fxLayout.gt-md","fxLayout.gt-lg"];let Zue=(()=>{class n extends Bt{constructor(e,r,i,o){super(e,i,r,o),this.DIRECTIVE_KEY="layout",this.styleCache=ele,this.init()}}return n.\u0275fac=function(e){return new(e||n)(C(se),C(Mt),C(Que),C(Vt))},n.\u0275dir=$({type:n,features:[Q]}),n})(),PB=(()=>{class n extends Zue{constructor(){super(...arguments),this.inputs=Jue}}return n.\u0275fac=function(){let t;return function(r){return(t||(t=me(n)))(r||n)}}(),n.\u0275dir=$({type:n,selectors:[["","fxLayout",""],["","fxLayout.xs",""],["","fxLayout.sm",""],["","fxLayout.md",""],["","fxLayout.lg",""],["","fxLayout.xl",""],["","fxLayout.lt-sm",""],["","fxLayout.lt-md",""],["","fxLayout.lt-lg",""],["","fxLayout.lt-xl",""],["","fxLayout.gt-xs",""],["","fxLayout.gt-sm",""],["","fxLayout.gt-md",""],["","fxLayout.gt-lg",""]],inputs:{fxLayout:"fxLayout","fxLayout.xs":"fxLayout.xs","fxLayout.sm":"fxLayout.sm","fxLayout.md":"fxLayout.md","fxLayout.lg":"fxLayout.lg","fxLayout.xl":"fxLayout.xl","fxLayout.lt-sm":"fxLayout.lt-sm","fxLayout.lt-md":"fxLayout.lt-md","fxLayout.lt-lg":"fxLayout.lt-lg","fxLayout.lt-xl":"fxLayout.lt-xl","fxLayout.gt-xs":"fxLayout.gt-xs","fxLayout.gt-sm":"fxLayout.gt-sm","fxLayout.gt-md":"fxLayout.gt-md","fxLayout.gt-lg":"fxLayout.gt-lg"},features:[Q]}),n})();const ele=new Map;let VB=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[mC,fl]]}),n})();class hce{constructor(t,e,r=!0){this.key=t,this.value=e,this.key=r?t.replace(/['"]/g,"").trim():t.trim(),this.value=r?e.replace(/['"]/g,"").trim():e.trim(),this.value=this.value.replace(/;/,"")}}function HB(n){let t=typeof n;return"object"===t?n.constructor===Array?"array":n.constructor===Set?"set":"object":t}function jB(n){const[t,...e]=n.split(":");return new hce(t,e.join(":"))}function WB(n,t){return t.key&&(n[t.key]=t.value),n}let gce=(()=>{class n extends Bt{constructor(e,r,i,o,s,a,u,l,c){super(e,null,r,i),this.sanitizer=o,this.ngStyleInstance=u,this.DIRECTIVE_KEY="ngStyle",this.ngStyleInstance||(this.ngStyleInstance=new mp(e,s,a)),this.init();const d=this.nativeElement.getAttribute("style")||"";this.fallbackStyles=this.buildStyleMap(d),this.isServer=l&&cl(c)}updateWithValue(e){const r=this.buildStyleMap(e);this.ngStyleInstance.ngStyle=Object.assign(Object.assign({},this.fallbackStyles),r),this.isServer&&this.applyStyleToElement(r),this.ngStyleInstance.ngDoCheck()}clearStyles(){this.ngStyleInstance.ngStyle=this.fallbackStyles,this.ngStyleInstance.ngDoCheck()}buildStyleMap(e){const r=i=>this.sanitizer.sanitize(ot.STYLE,i)||"";if(e)switch(HB(e)){case"string":return zB(function(n,t=";"){return String(n).trim().split(t).map(e=>e.trim()).filter(e=>""!==e)}(e),r);case"array":return zB(e,r);default:return function(n,t){let e=[];return"set"===HB(n)?n.forEach(r=>e.push(r)):Object.keys(n).forEach(r=>{e.push(`${r}:${n[r]}`)}),function(n,t){return n.map(jB).filter(r=>!!r).map(r=>(t&&(r.value=t(r.value)),r)).reduce(WB,{})}(e,t)}(e,r)}return{}}ngDoCheck(){this.ngStyleInstance.ngDoCheck()}}return n.\u0275fac=function(e){return new(e||n)(C(se),C(Mt),C(Vt),C(Ca),C(Cs),C(bi),C(mp,10),C(iu),C(Yn))},n.\u0275dir=$({type:n,features:[Q]}),n})();const mce=["ngStyle","ngStyle.xs","ngStyle.sm","ngStyle.md","ngStyle.lg","ngStyle.xl","ngStyle.lt-sm","ngStyle.lt-md","ngStyle.lt-lg","ngStyle.lt-xl","ngStyle.gt-xs","ngStyle.gt-sm","ngStyle.gt-md","ngStyle.gt-lg"];let GB=(()=>{class n extends gce{constructor(){super(...arguments),this.inputs=mce}}return n.\u0275fac=function(){let t;return function(r){return(t||(t=me(n)))(r||n)}}(),n.\u0275dir=$({type:n,selectors:[["","ngStyle",""],["","ngStyle.xs",""],["","ngStyle.sm",""],["","ngStyle.md",""],["","ngStyle.lg",""],["","ngStyle.xl",""],["","ngStyle.lt-sm",""],["","ngStyle.lt-md",""],["","ngStyle.lt-lg",""],["","ngStyle.lt-xl",""],["","ngStyle.gt-xs",""],["","ngStyle.gt-sm",""],["","ngStyle.gt-md",""],["","ngStyle.gt-lg",""]],inputs:{ngStyle:"ngStyle","ngStyle.xs":"ngStyle.xs","ngStyle.sm":"ngStyle.sm","ngStyle.md":"ngStyle.md","ngStyle.lg":"ngStyle.lg","ngStyle.xl":"ngStyle.xl","ngStyle.lt-sm":"ngStyle.lt-sm","ngStyle.lt-md":"ngStyle.lt-md","ngStyle.lt-lg":"ngStyle.lt-lg","ngStyle.lt-xl":"ngStyle.lt-xl","ngStyle.gt-xs":"ngStyle.gt-xs","ngStyle.gt-sm":"ngStyle.gt-sm","ngStyle.gt-md":"ngStyle.gt-md","ngStyle.gt-lg":"ngStyle.gt-lg"},features:[Q]}),n})();function zB(n,t){return n.map(jB).filter(r=>!!r).map(r=>(t&&(r.value=t(r.value)),r)).reduce(WB,{})}let $B=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[mC]]}),n})();const vce=["webcam"],yce=function(){return{width:"100%"}},_ce=function(){return{width:"320px"}},bce=function(n){return{display:n}},xce=[{path:"",component:(()=>{class n{constructor(e,r){this.ws=e,this.location=r,this.ngOnInit$$=new be,this.ngAfterViewInit$$=new be,this.ngOnDestroy$$=new be,this.webcamOpening$$=new be,this.webcamOpening$=this.webcamOpening$$.pipe(Fx((i,o)=>void 0===o?!i:o,!0),Wo(!0)),this.webcamOpeningSub=this.webcamOpening$.subscribe(i=>{if(i)this.ws.getWebcamStream().pipe(Mi(1)).subscribe(o=>this._webcamStream$.next(o));else{const o=this._webcamStream$.value;o&&this.ws.stopTracks(o),this._webcamStream$.next(null)}}),this._webcamStream$=new cr(null),this.webcamStream$=this._webcamStream$.asObservable(),this.detectingResult$=this.ngAfterViewInit$$.pipe(yr(()=>this.webcamOpening$),vr(i=>i&&this.webcamVideoEl instanceof HTMLVideoElement),yr(()=>this.ws.startDetecting(this.webcamVideoEl).pipe(Rt(this.webcamOpening$.pipe(vr(i=>!i))))),_l()),this.detectingResultSub=this.detectingResult$.subscribe(console.log),this.detectingResultBuffer$=this.detectingResult$.pipe(ZO(this.ngOnDestroy$$)),this.saveResults$$=new be,this.saveResultsSub=this.detectingResult$.pipe(ZO(this.saveResults$$),yr(i=>this.ws.saveResults(i))).subscribe(),this.emotionText$=this.detectingResult$.pipe(Se(({value:i,expression:o})=>i?o:"Please try to turn your face around"),Wo("Loading...")),this.webcamButtonText$=this.webcamOpening$.pipe(Se(i=>i?"\u5173\u95ed\u6444\u50cf\u5934":"\u5f00\u542f\u6444\u50cf\u5934"))}get webcamVideoEl(){var e;const r=null===(e=this.webcamVideo)||void 0===e?void 0:e.nativeElement;return r instanceof HTMLVideoElement?r:null}ngOnInit(){this.ngOnInit$$.next(),this.ngOnInit$$.complete(),this.playingTime$=this.ws.startTimer()}ngAfterViewInit(){this.ngAfterViewInit$$.next(),this.ngAfterViewInit$$.complete()}ngOnDestroy(){this.ngOnDestroy$$.next(),this.ngOnDestroy$$.complete(),this.webcamOpening$$.next(!1),this.detectingResultSub.unsubscribe(),this.saveResultsSub.unsubscribe(),this.webcamOpeningSub.unsubscribe(),this.saveResults$$.complete()}toggleWebcam(e){this.webcamOpening$$.next(e)}leave(){this.location.back(),this.saveResults$$.next()}}return n.\u0275fac=function(e){return new(e||n)(C(Due),C(ul))},n.\u0275cmp=Hn({type:n,selectors:[["app-watch"]],viewQuery:function(e,r){if(1&e&&No(vce,5),2&e){let i;rn(i=function(n,t){return n[19].queries[t].queryList}(X(),lE()))&&(r.webcamVideo=i.first)}},decls:10,vars:15,consts:[["fxLayout","column","fxLayout.gt-xs","row",1,"container"],[1,"info",3,"ngStyle","ngStyle.gt-xs"],[1,"video",3,"ngStyle"],["autoplay","",1,"hidden",3,"srcObject"],["webcam",""]],template:function(e,r){1&e&&(et(0,"div",0),et(1,"div",1),et(2,"div",2),Jc(3,"async"),tn(4,"video",3,4),Jc(6,"async"),et(7,"h3"),Ji(8),Jc(9,"async"),tt(),tt(),tt(),tt()),2&e&&(at(1),pt("ngStyle",n_(11,yce))("ngStyle.gt-xs",n_(12,_ce)),at(1),pt("ngStyle",function(n,t,e,r){return eM(X(),ir(),n,t,e,r)}(13,bce,Zc(3,5,r.webcamStream$)?"block":"none")),at(2),pt("srcObject",Zc(6,7,r.webcamStream$)),at(4),ws(Zc(9,9,r.emotionText$)))},directives:[PB,mp,GB],pipes:[X_],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.container[_ngcontent-%COMP%]{width:100%}.live-stream[_ngcontent-%COMP%]{flex:1}.live-stream[_ngcontent-%COMP%] > video[_ngcontent-%COMP%]{width:100%}.info[_ngcontent-%COMP%]{flex-shrink:0}.info[_ngcontent-%COMP%]   .video[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}"]}),n})(),data:{title:"\u9996\u9875"}}];let wce=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[XO.forRoot(xce)],XO]}),n})(),Cce=(()=>{class n{constructor(e,r,i){this.ls=e,this.router=r,this.userService=i,this.isLogin$=this.userService.isLogin$,this.routeData$=this.router.events.pipe(vr(o=>o instanceof Nx),Se(o=>{var s,a,u;return o instanceof Nx?null===(u=null===(a=null===(s=null==o?void 0:o.state)||void 0===s?void 0:s.root)||void 0===a?void 0:a.firstChild)||void 0===u?void 0:u.data:{}}))}logout(){this.ls.setAuthorization(""),this.router.navigateByUrl("")}}return n.\u0275fac=function(e){return new(e||n)(C(pC),C(hr),C(Cue))},n.\u0275cmp=Hn({type:n,selectors:[["app-root"]],decls:2,vars:0,template:function(e,r){1&e&&(et(0,"main"),tn(1,"router-outlet"),tt())},directives:[ew],styles:["header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100vw;height:48px;padding:0 20px;box-sizing:border-box;position:fixed;left:0;top:0;z-index:999;background-color:#fff;box-shadow:0 1px 5px #ccc}.title[_ngcontent-%COMP%]{margin:0;font-size:18px}main[_ngcontent-%COMP%]{min-height:calc(100vh - $header-height);padding-top:48px;box-sizing:border-box}"]}),n})(),eV=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[mC]]}),n})(),tV=(()=>{class n{constructor(e,r){cl(r)&&!e&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}static withConfig(e,r=[]){return{ngModule:n,providers:e.serverLoaded?[{provide:Vi,useValue:Object.assign(Object.assign({},vC),e)},{provide:yC,useValue:r,multi:!0},{provide:iu,useValue:!0}]:[{provide:Vi,useValue:Object.assign(Object.assign({},vC),e)},{provide:yC,useValue:r,multi:!0}]}}}return n.\u0275fac=function(e){return new(e||n)(R(iu),R(Yn))},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[VB,$B,eV],VB,$B,eV]}),n})(),Gde=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n}),n.\u0275inj=Ie({imports:[[tV]]}),n})(),zde=(()=>{class n{constructor(e){this.ls=e}intercept(e,r){const i=e.clone({setHeaders:{Authorization:this.ls.getAuthorization()||""}});return r.handle(i)}}return n.\u0275fac=function(e){return new(e||n)(R(pC))},n.\u0275prov=K({token:n,factory:n.\u0275fac}),n})();const $de=[UR,AY,iQ,dx,MJ,NJ];let qde=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Ne({type:n,bootstrap:[Cce]}),n.\u0275inj=Ie({providers:[{provide:Zb,useClass:zde,multi:!0}],imports:[[ab,wce,d9,ll,Gde,CJ,tV,mY,...$de]]}),n})();(function(){if(OM)throw new Error("Cannot enable prod mode after platform setup.");kM=!1})(),Nq().bootstrapModule(qde).catch(n=>console.error(n))},805:tc=>{function cs(Co){return Promise.resolve().then(()=>{var Hi=new Error("Cannot find module '"+Co+"'");throw Hi.code="MODULE_NOT_FOUND",Hi})}cs.keys=()=>[],cs.resolve=cs,cs.id=805,tc.exports=cs},902:()=>{},522:()=>{},753:()=>{}},tc=>{tc(tc.s=929)}]);